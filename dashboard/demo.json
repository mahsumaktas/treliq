{
  "repo": "openclaw/openclaw",
  "scannedAt": "2026-02-15T21:11:59.034Z",
  "totalPRs": 50,
  "spamCount": 0,
  "duplicateClusters": [
    {
      "id": 0,
      "prs": [
        {
          "number": 17517,
          "title": "fix(browser): catch unhandled promise rejection in dialog handling",
          "body": "# Fix: Unhandled Promise Rejection in Browser Dialog Handler\r\n\r\nFixes #17499\r\n\r\n## Summary\r\nThis PR fixes an issue where `armDialogViaPlaywright` would throw an unhandled promise rejection if the dialog was closed (e.g. via navigation or auto-dismissal) before `dialog.accept()` or `dialog.dismiss()` could be called.\r\n\r\nThe fix wraps the `dialog.accept()`/`dismiss()` calls in a `try/catch` block to suppress errors when the dialog is no longer available, which is the expected behavior (best-effort handling).\r\n\r\n## Changes\r\n- Modified `src/browser/pw-tools-core.downloads.ts` to catch errors during dialog interaction.\r\n- Added regression test `src/browser/pw-tools-core.dialog-errors.test.ts` to verify that `accept`/`dismiss` errors are gracefully handled.\r\n\r\n## Verification\r\n- Ran new regression test: `npm run test:fast -- src/browser/pw-tools-core.dialog-errors.test.ts` (Passed)\r\n- Ran existing tests: `npm run test:fast -- src/browser/pw-tools-core.last-file-chooser-arm-wins.test.ts` (Passed)\n\n<!-- greptile_comment -->\n\n<h3>Greptile Summary</h3>\n\nAdded try/catch around `dialog.accept()`/`dialog.dismiss()` calls in `armDialogViaPlaywright` to prevent unhandled promise rejections when dialogs close before interaction. This follows the existing best-effort pattern used elsewhere in the file (e.g., `armFileUploadViaPlaywright:127-130`).\n\n- Wraps dialog interactions in try/catch block to suppress errors when dialog is no longer available\n- Adds regression tests verifying both `accept` and `dismiss` errors are gracefully handled\n- Maintains the existing \"fire-and-forget\" behavior where dialog arming is best-effort\n\n<h3>Confidence Score: 5/5</h3>\n\n- Safe to merge with no risk\n- Simple defensive fix with comprehensive tests; follows existing codebase patterns for best-effort error handling\n- No files require special attention\n\n<sub>Last reviewed commit: 69cebdc</sub>\n\n<!-- greptile_other_comments_section -->\n\n<!-- /greptile_comment -->",
          "author": "shadril238",
          "authorAssociation": "CONTRIBUTOR",
          "createdAt": "2026-02-15T21:01:37Z",
          "updatedAt": "2026-02-15T21:06:02Z",
          "headRef": "fix/dialog-rejection",
          "baseRef": "main",
          "filesChanged": 2,
          "additions": 68,
          "deletions": 4,
          "commits": 2,
          "labels": [
            "size: S",
            "trusted-contributor"
          ],
          "ciStatus": "failure",
          "hasIssueRef": true,
          "issueNumbers": [
            17499
          ],
          "changedFiles": [
            "src/browser/pw-tools-core.dialog-errors.test.ts",
            "src/browser/pw-tools-core.downloads.ts"
          ],
          "diffUrl": "https://github.com/openclaw/openclaw/pull/17517.diff",
          "hasTests": true,
          "testFilesChanged": [
            "src/browser/pw-tools-core.dialog-errors.test.ts"
          ],
          "ageInDays": 0,
          "mergeable": "mergeable",
          "reviewState": "none",
          "reviewCount": 0,
          "commentCount": 0,
          "totalScore": 87,
          "signals": [
            {
              "name": "ci_status",
              "score": 10,
              "weight": 0.2,
              "reason": "CI: failure"
            },
            {
              "name": "diff_size",
              "score": 100,
              "weight": 0.1,
              "reason": "72 lines changed (68+/4-)"
            },
            {
              "name": "commit_quality",
              "score": 90,
              "weight": 0.05,
              "reason": "Conventional commit format"
            },
            {
              "name": "contributor",
              "score": 79,
              "weight": 0.15,
              "reason": "shadril238 (CONTRIBUTOR, rep: 100)"
            },
            {
              "name": "issue_ref",
              "score": 90,
              "weight": 0.1,
              "reason": "References: #17499"
            },
            {
              "name": "spam",
              "score": 100,
              "weight": 0.15,
              "reason": "No spam signals"
            },
            {
              "name": "test_coverage",
              "score": 90,
              "weight": 0.15,
              "reason": "1 test file(s) changed"
            },
            {
              "name": "staleness",
              "score": 100,
              "weight": 0.1,
              "reason": "0d old (Fresh)"
            },
            {
              "name": "mergeability",
              "score": 100,
              "weight": 0.15,
              "reason": "Merge status: mergeable"
            },
            {
              "name": "review_status",
              "score": 40,
              "weight": 0.1,
              "reason": "Review: none (0 reviews)"
            },
            {
              "name": "body_quality",
              "score": 90,
              "weight": 0.05,
              "reason": "Body: 1958 chars"
            },
            {
              "name": "activity",
              "score": 30,
              "weight": 0.05,
              "reason": "0 comments"
            },
            {
              "name": "breaking_change",
              "score": 80,
              "weight": 0.05,
              "reason": "No breaking change signals"
            }
          ],
          "isSpam": false,
          "spamReasons": [],
          "visionAlignment": "unchecked",
          "llmScore": 95,
          "llmRisk": "low",
          "llmReason": "This PR addresses a real issue (unhandled promise rejection) with a simple and effective fix. The implementation is correct, complete, and includes a regression test to prevent future occurrences. The Greptile summary confirms the safety and correctness of the changes. Merging this PR would improve the project by preventing noisy error logs and improving overall stability.",
          "duplicateGroup": 0
        },
        {
          "number": 17518,
          "title": "fix(browser): catch dialog accept/dismiss errors after page navigation",
          "body": "## Summary\n\nFixes #17499\n\nWhen a page navigates or a dialog auto-dismisses before the Playwright dialog handler fires, `dialog.accept()`/`dialog.dismiss()` throws a `Protocol error (Page.handleJavaScriptDialog): No dialog is showing`.\n\nThe existing `.catch()` on the promise chain only handles `waitForEvent` timeouts. Errors thrown inside the `.then()` callback (from `accept()`/`dismiss()`) create a new rejected promise that propagates as an unhandled rejection.\n\n## Fix\n\nWrap `dialog.accept()`/`dialog.dismiss()` in a `try-catch` inside the `.then()` callback. The error is silently caught since the dialog being gone is a benign race condition.\n\n## Testing\n\n- Lint passes (oxlint, 0 warnings/errors)\n- The change is a defensive catch around an existing code path \u2014 no behavior change when the dialog is present\n\n<!-- greptile_comment -->\n\n<h3>Greptile Summary</h3>\n\nWraps `dialog.accept()` and `dialog.dismiss()` in a try-catch block to handle race conditions where the dialog is dismissed or the page navigates before Playwright's dialog handler fires. The existing `.catch()` only handled `waitForEvent` timeouts, not errors thrown inside the `.then()` callback.\n\n<h3>Confidence Score: 5/5</h3>\n\n- This PR is safe to merge with minimal risk\n- The change adds defensive error handling for a known race condition. The fix is minimal, well-scoped, follows the same pattern used elsewhere in the file (e.g., lines 126-130, 134-147), and silently catches errors that are benign (dialog already gone). No behavior change when the dialog is present.\n- No files require special attention\n\n<sub>Last reviewed commit: 76c93a0</sub>\n\n<!-- greptile_other_comments_section -->\n\n<!-- /greptile_comment -->",
          "author": "aldoeliacim",
          "authorAssociation": "CONTRIBUTOR",
          "createdAt": "2026-02-15T21:02:01Z",
          "updatedAt": "2026-02-15T21:03:42Z",
          "headRef": "fix/browser-dialog-unhandled-rejection",
          "baseRef": "main",
          "filesChanged": 1,
          "additions": 8,
          "deletions": 4,
          "commits": 1,
          "labels": [
            "size: XS"
          ],
          "ciStatus": "failure",
          "hasIssueRef": true,
          "issueNumbers": [
            17499
          ],
          "changedFiles": [
            "src/browser/pw-tools-core.downloads.ts"
          ],
          "diffUrl": "https://github.com/openclaw/openclaw/pull/17518.diff",
          "hasTests": false,
          "testFilesChanged": [],
          "ageInDays": 0,
          "mergeable": "mergeable",
          "reviewState": "commented",
          "reviewCount": 1,
          "commentCount": 1,
          "totalScore": 84,
          "signals": [
            {
              "name": "ci_status",
              "score": 10,
              "weight": 0.2,
              "reason": "CI: failure"
            },
            {
              "name": "diff_size",
              "score": 70,
              "weight": 0.1,
              "reason": "12 lines changed (8+/4-)"
            },
            {
              "name": "commit_quality",
              "score": 90,
              "weight": 0.05,
              "reason": "Conventional commit format"
            },
            {
              "name": "contributor",
              "score": 79,
              "weight": 0.15,
              "reason": "aldoeliacim (CONTRIBUTOR, rep: 99)"
            },
            {
              "name": "issue_ref",
              "score": 90,
              "weight": 0.1,
              "reason": "References: #17499"
            },
            {
              "name": "spam",
              "score": 100,
              "weight": 0.15,
              "reason": "No spam signals"
            },
            {
              "name": "test_coverage",
              "score": 20,
              "weight": 0.15,
              "reason": "No test files changed in code PR"
            },
            {
              "name": "staleness",
              "score": 100,
              "weight": 0.1,
              "reason": "0d old (Fresh)"
            },
            {
              "name": "mergeability",
              "score": 100,
              "weight": 0.15,
              "reason": "Merge status: mergeable"
            },
            {
              "name": "review_status",
              "score": 60,
              "weight": 0.1,
              "reason": "Review: commented (1 reviews)"
            },
            {
              "name": "body_quality",
              "score": 90,
              "weight": 0.05,
              "reason": "Body: 1698 chars"
            },
            {
              "name": "activity",
              "score": 50,
              "weight": 0.05,
              "reason": "1 comments"
            },
            {
              "name": "breaking_change",
              "score": 80,
              "weight": 0.05,
              "reason": "No breaking change signals"
            }
          ],
          "isSpam": false,
          "spamReasons": [],
          "visionAlignment": "unchecked",
          "llmScore": 95,
          "llmRisk": "low",
          "llmReason": "Addresses a real race condition that leads to unhandled rejections. The fix is small, targeted, and defensive, adding a try-catch block to handle a benign error case. The greptile summary and the PR description both indicate a clear understanding of the problem and solution. The testing section confirms that the change is non-breaking and only addresses the error case.",
          "duplicateGroup": 0
        }
      ],
      "bestPR": 17517,
      "similarity": 0.9324490018015542,
      "reason": "2 similar PRs (avg similarity: 93.2%)"
    },
    {
      "id": 1,
      "prs": [
        {
          "number": 16163,
          "title": "feat(sessions): createdAt tracking, date-range filtering & PostgreSQL persistence plugin",
          "body": "## Summary\n\n- **createdAt tracking**: Adds `createdAt` field to `SessionEntry`, preserving session creation timestamps through merges and enabling date-range filtering on both `createdAt` and `updatedAt` via TypeBox schema extensions\n- **Date-range filtering**: Implements `createdAfter`/`createdBefore`/`updatedAfter`/`updatedBefore` parameters in `listSessionsFromStore` with full unit test coverage (10 new filter tests, 39 total)\n- **PostgreSQL persistence plugin**: New `persist-postgres` extension that persists user prompts (via `before_agent_start`) and assistant responses (via `agent_end`) to PostgreSQL using `porsager/postgres` tagged template literals with parameterized queries\n\n### Plugin Details\n- Reads `databaseUrl` from `api.pluginConfig` (falls back to `DATABASE_URL` env var)\n- Auto-creates `lp_conversations` and `lp_messages` tables with indexes (requires PostgreSQL 13+ for `gen_random_uuid()`)\n- Upserts conversations by `session_key`, increments `message_count` only on actual message inserts\n- E2E integration tests (gated behind `*.e2e.test.ts` pattern, excluded from `pnpm test`)\n\n### Addresses review feedback\n- Plugin config read from `api.pluginConfig?.databaseUrl` (not just env var)\n- Removed duplicate `message_received`/`message_sent` hooks (only `before_agent_start` + `agent_end`)\n- Fixed `message_count` inflation (increment only in `insertMessage`, not on upsert)\n- Documented PostgreSQL 13+ requirement for `gen_random_uuid()`\n- Renamed integration test to `.e2e.test.ts` for vitest exclusion\n\nSupersedes #15424 (rebased onto latest `main`).\n\n## Test plan\n- [x] Unit tests: `pnpm test` passes (39 session-utils tests including 10 new date-range filter tests)\n- [x] Type check: `tsgo` clean\n- [x] Lint/format: `oxlint` + `oxfmt` clean\n- [ ] E2E: `DATABASE_URL=... bun test extensions/persist-postgres/src/integration.e2e.test.ts` (requires PostgreSQL instance)\n\n\ud83e\udd16 Generated with [Claude Code](https://claude.com/claude-code)\n\n<!-- greptile_comment -->\n\n<h2>Greptile Overview</h2>\n\n<h3>Greptile Summary</h3>\n\nThis PR adds three well-integrated features: `createdAt` field tracking for session entries, date-range filtering parameters, and a new PostgreSQL persistence plugin.\n\n**Core Session Changes:**\n- Added `createdAt` field to `SessionEntry` that's preserved through merges (lines prioritize existing `createdAt` over patches)\n- Implemented `createdAfter`/`createdBefore`/`updatedAfter`/`updatedBefore` filtering in `listSessionsFromStore`\n- Extended TypeBox schema with four optional timestamp parameters for the sessions list API\n\n**PostgreSQL Plugin:**\n- New `persist-postgres` extension that captures user prompts via `before_agent_start` hook and assistant responses via `agent_end` hook\n- Uses `porsager/postgres` library with parameterized queries (preventing SQL injection)\n- Auto-creates `lp_conversations` and `lp_messages` tables with proper indexes\n- Plugin reads `databaseUrl` from `api.pluginConfig` with fallback to `DATABASE_URL` environment variable\n- Message count tracking fixed (increments only on actual inserts, not upserts)\n\n**Testing:**\n- 10 new unit tests for date-range filtering (39 total session tests passing)\n- Comprehensive E2E tests in `.e2e.test.ts` file (properly excluded from standard test runs)\n\n**Minor Issues:**\n- The `openclaw.plugin.json` declares `kind: \"persistence\"` but `PluginKind` type only includes `\"memory\"` (see src/plugins/types.ts:37)\n\n<h3>Confidence Score: 4/5</h3>\n\n- This PR is safe to merge with one minor type mismatch that should be fixed\n- Score reflects clean implementation with comprehensive tests, proper SQL injection prevention, and good separation of concerns. The plugin kind mismatch needs fixing before merge, and one style suggestion about query construction. All core session logic is well-tested (39 tests including 10 new date-range tests), and the PostgreSQL plugin properly uses parameterized queries.\n- extensions/persist-postgres/openclaw.plugin.json needs the kind field corrected to match the PluginKind type union\n\n<sub>Last reviewed commit: 6b456f6</sub>\n\n<!-- greptile_other_comments_section -->\n\n<sub>(3/5) Reply to the agent's comments like \"Can you suggest a fix for this @greptileai?\" or ask follow-up questions!</sub>\n\n<!-- /greptile_comment -->",
          "author": "supmo668",
          "authorAssociation": "NONE",
          "createdAt": "2026-02-14T11:24:10Z",
          "updatedAt": "2026-02-15T20:57:06Z",
          "headRef": "main",
          "baseRef": "main",
          "filesChanged": 17,
          "additions": 1177,
          "deletions": 3,
          "commits": 9,
          "labels": [
            "docs",
            "app: macos",
            "app: web-ui",
            "gateway",
            "size: XL"
          ],
          "ciStatus": "failure",
          "hasIssueRef": true,
          "issueNumbers": [
            15424
          ],
          "changedFiles": [
            ".gitignore",
            "apps/macos/Sources/OpenClawProtocol/GatewayModels.swift",
            "apps/shared/OpenClawKit/Sources/OpenClawProtocol/GatewayModels.swift",
            "docs/concepts/session-tool.md",
            "docs/tools/index.md",
            "extensions/persist-postgres/openclaw.plugin.json",
            "extensions/persist-postgres/package.json",
            "extensions/persist-postgres/src/db.ts",
            "extensions/persist-postgres/src/index.ts",
            "extensions/persist-postgres/src/integration.e2e.test.ts",
            "extensions/persist-postgres/src/plugin.test.ts",
            "pnpm-lock.yaml",
            "src/config/sessions/types.ts",
            "src/gateway/protocol/schema/sessions.ts",
            "src/gateway/session-utils.test.ts",
            "src/gateway/session-utils.ts",
            "src/gateway/session-utils.types.ts"
          ],
          "diffUrl": "https://github.com/openclaw/openclaw/pull/16163.diff",
          "hasTests": true,
          "testFilesChanged": [
            "extensions/persist-postgres/src/integration.e2e.test.ts",
            "extensions/persist-postgres/src/plugin.test.ts",
            "src/gateway/session-utils.test.ts"
          ],
          "ageInDays": 1,
          "mergeable": "mergeable",
          "reviewState": "commented",
          "reviewCount": 1,
          "commentCount": 1,
          "totalScore": 80,
          "signals": [
            {
              "name": "ci_status",
              "score": 10,
              "weight": 0.2,
              "reason": "CI: failure"
            },
            {
              "name": "diff_size",
              "score": 60,
              "weight": 0.1,
              "reason": "1180 lines changed (1177+/3-)"
            },
            {
              "name": "commit_quality",
              "score": 90,
              "weight": 0.05,
              "reason": "Conventional commit format"
            },
            {
              "name": "contributor",
              "score": 51,
              "weight": 0.15,
              "reason": "supmo668 (NONE, rep: 100)"
            },
            {
              "name": "issue_ref",
              "score": 90,
              "weight": 0.1,
              "reason": "References: #15424"
            },
            {
              "name": "spam",
              "score": 100,
              "weight": 0.15,
              "reason": "No spam signals"
            },
            {
              "name": "test_coverage",
              "score": 90,
              "weight": 0.15,
              "reason": "3 test file(s) changed"
            },
            {
              "name": "staleness",
              "score": 100,
              "weight": 0.1,
              "reason": "1d old (Fresh)"
            },
            {
              "name": "mergeability",
              "score": 100,
              "weight": 0.15,
              "reason": "Merge status: mergeable"
            },
            {
              "name": "review_status",
              "score": 60,
              "weight": 0.1,
              "reason": "Review: commented (1 reviews)"
            },
            {
              "name": "body_quality",
              "score": 100,
              "weight": 0.05,
              "reason": "Body: 4278 chars"
            },
            {
              "name": "activity",
              "score": 50,
              "weight": 0.05,
              "reason": "1 comments"
            },
            {
              "name": "breaking_change",
              "score": 80,
              "weight": 0.05,
              "reason": "No breaking change signals"
            }
          ],
          "isSpam": false,
          "spamReasons": [],
          "visionAlignment": "unchecked",
          "llmScore": 85,
          "llmRisk": "medium",
          "llmReason": "This PR introduces valuable features: session creation tracking, date-range filtering, and PostgreSQL persistence. The implementation appears well-structured, with tests and documentation. The risk is medium because it introduces a new database dependency (PostgreSQL) and requires careful configuration. The E2E tests are not fully automated in CI, which increases the risk. The need for PostgreSQL 13+ is documented, which is good.",
          "duplicateGroup": 1
        },
        {
          "number": 17346,
          "title": "feat(hooks): add message_persist hook for all transcript messages",
          "body": "## Summary\n\nAdds a new synchronous plugin hook `message_persist` that is called for **all messages** (user, assistant, system, toolResult) before they are written to the session transcript on disk.\n\n## Why This Hook Matters\n\nOpenClaw's plugin system lets agents extend the platform without forking core. But there's a gap: **there's no way for a plugin to intercept user, assistant, or system messages before they're written to disk.**\n\nThe existing `tool_result_persist` hook only covers tool results. If you want to build:\n- \ud83d\udd12 **At-rest encryption** \u2014 encrypt ALL transcript content, not just tool results\n- \ud83d\udd07 **PII redaction** \u2014 strip sensitive data from every message type\n- \ud83d\udcdd **Audit logging** \u2014 complete conversation capture for compliance\n- \ud83c\udff7\ufe0f **Metadata injection** \u2014 tag messages with provenance, timestamps, or labels\n\n...you're stuck. You'd have to fork OpenClaw core.\n\nThis hook closes that gap. A plugin registers `message_persist`, and every message flows through it before hitting disk \u2014 same pattern plugin authors already know from `tool_result_persist`.\n\n## How We Built This (Development Process)\n\nThis PR was developed by an AI agent (Clawee \ud83d\udc3e) working through OpenClaw's own plugin system. Here's the process \u2014 useful as a template for agent-contributed PRs:\n\n1. **Identified the need**: Building an `@openclaw/vault` encryption plugin. Discovered `tool_result_persist` existed but couldn't intercept user/assistant/system messages.\n2. **Read the source**: Traced the persistence path \u2014 `SessionManager._persist()` \u2192 `appendFileSync()` \u2192 found `transformMessageForPersistence` callback in `session-tool-result-guard.ts` already intercepted ALL messages but wasn't exposed as a hook.\n3. **Mirrored the existing pattern**: Copied the `tool_result_persist` implementation exactly \u2014 same synchronous execution, same priority ordering, same async rejection, same zero-overhead guard when no hooks registered.\n4. **Wired it in**: Connected the new hook to the existing `transformMessageForPersistence` callback, running after input provenance tagging.\n5. **Validated**: TypeScript compiles, linting clean, formatting clean.\n\n## Design\n\nThe hook follows the exact same synchronous, sequential pattern as `tool_result_persist`:\n- Handlers run in priority order (higher first)\n- Each handler may return `{ message }` to replace the message for the next handler\n- Async handlers are rejected with a warning (hot path, same as `tool_result_persist`)\n- When no hooks are registered, zero overhead (guard check skipped entirely)\n\n### \u26a0\ufe0f Double-hook note for `toolResult` messages\n\n`toolResult` messages pass through **both** `message_persist` (via `transformMessageForPersistence`) and `tool_result_persist` (via `transformToolResultForPersistence`). This is by design \u2014 most plugins only need `message_persist` to cover everything. But if you register both hooks, guard against double-processing:\n\n```ts\n// Example: skip if already encrypted\napi.registerHook('message_persist', (event) => {\n  if (isAlreadyEncrypted(event.message)) return; // guard\n  return { message: encrypt(event.message) };\n});\n```\n\n## Changes\n\n| File | Change |\n|------|--------|\n| `src/plugins/types.ts` | Add `message_persist` to `PluginHookName`, event/result/context types, handler map entry |\n| `src/plugins/hooks.ts` | Add `runMessagePersist()` \u2014 mirrors `runToolResultPersist()` exactly |\n| `src/agents/session-tool-result-guard-wrapper.ts` | Wire hook into `transformMessageForPersistence` callback with inline docs |\n\n## Usage Example\n\n```ts\n// Plugin: encrypt all messages before they hit disk\nexport default function (api) {\n  api.registerHook('message_persist', (event, ctx) => {\n    // event.message \u2014 the raw message object (any role)\n    // event.role    \u2014 'user' | 'assistant' | 'system' | 'toolResult'\n    // ctx.agentId   \u2014 which agent's session this belongs to\n    // ctx.sessionKey \u2014 the session identifier\n    \n    const encrypted = encrypt(event.message);\n    return { message: encrypted }; // returned message replaces original on disk\n  }, { name: 'vault-encrypt', priority: 100 });\n}\n```\n\n## Backward Compatibility\n\nNo breaking changes. Existing behavior is fully preserved when no `message_persist` hooks are registered \u2014 the `transformMessageForPersistence` path still applies input provenance as before, with the hook transform applied afterward.\n\n## Testing\n\n- TypeScript compiles cleanly\n- Linting passes (oxlint: 0 warnings, 0 errors)\n- Formatting passes (oxfmt)\n- E2e test to follow (mirroring existing `tool_result_persist` test)\n",
          "author": "clawee-vanguard",
          "authorAssociation": "NONE",
          "createdAt": "2026-02-15T17:26:00Z",
          "updatedAt": "2026-02-15T20:37:12Z",
          "headRef": "feat/message-persist-hook",
          "baseRef": "main",
          "filesChanged": 4,
          "additions": 404,
          "deletions": 2,
          "commits": 3,
          "labels": [
            "agents",
            "size: M"
          ],
          "ciStatus": "pending",
          "hasIssueRef": false,
          "issueNumbers": [],
          "changedFiles": [
            "src/agents/session-tool-result-guard-wrapper.ts",
            "src/agents/session-tool-result-guard.message-persist-hook.e2e.test.ts",
            "src/plugins/hooks.ts",
            "src/plugins/types.ts"
          ],
          "diffUrl": "https://github.com/openclaw/openclaw/pull/17346.diff",
          "hasTests": true,
          "testFilesChanged": [
            "src/agents/session-tool-result-guard.message-persist-hook.e2e.test.ts"
          ],
          "ageInDays": 0,
          "mergeable": "mergeable",
          "reviewState": "commented",
          "reviewCount": 1,
          "commentCount": 1,
          "totalScore": 70,
          "signals": [
            {
              "name": "ci_status",
              "score": 50,
              "weight": 0.2,
              "reason": "CI: pending"
            },
            {
              "name": "diff_size",
              "score": 100,
              "weight": 0.1,
              "reason": "406 lines changed (404+/2-)"
            },
            {
              "name": "commit_quality",
              "score": 90,
              "weight": 0.05,
              "reason": "Conventional commit format"
            },
            {
              "name": "contributor",
              "score": 27,
              "weight": 0.15,
              "reason": "clawee-vanguard (NONE, rep: 21)"
            },
            {
              "name": "issue_ref",
              "score": 30,
              "weight": 0.1,
              "reason": "No issue reference"
            },
            {
              "name": "spam",
              "score": 75,
              "weight": 0.15,
              "reason": "No issue ref"
            },
            {
              "name": "test_coverage",
              "score": 90,
              "weight": 0.15,
              "reason": "1 test file(s) changed"
            },
            {
              "name": "staleness",
              "score": 100,
              "weight": 0.1,
              "reason": "0d old (Fresh)"
            },
            {
              "name": "mergeability",
              "score": 100,
              "weight": 0.15,
              "reason": "Merge status: mergeable"
            },
            {
              "name": "review_status",
              "score": 60,
              "weight": 0.1,
              "reason": "Review: commented (1 reviews)"
            },
            {
              "name": "body_quality",
              "score": 90,
              "weight": 0.05,
              "reason": "Body: 4549 chars"
            },
            {
              "name": "activity",
              "score": 50,
              "weight": 0.05,
              "reason": "1 comments"
            },
            {
              "name": "breaking_change",
              "score": 80,
              "weight": 0.05,
              "reason": "No breaking change signals"
            }
          ],
          "isSpam": false,
          "spamReasons": [],
          "visionAlignment": "unchecked",
          "duplicateGroup": 1
        },
        {
          "number": 16779,
          "title": "feat: add `openclaw sessions scrub` command and doctor check for secret leaks",
          "body": "## Summary\n\nCloses #11468\n\nRecreated from #11544 as a clean single-commit branch (the previous PR was closed for having too many unrelated commits).\n\nAdds two features to address `config.get` leaking secrets into session transcripts:\n\n1. **`openclaw sessions scrub`** \u2014 CLI command that scans historical session JSONL files and redacts leaked secrets in-place (with backup by default)\n2. **`openclaw doctor` check** \u2014 detects unredacted secrets in session files and warns the user\n\n## What's included\n\n### New files\n- `src/commands/sessions-scrub.ts` \u2014 scrub command implementation\n- `src/commands/doctor-sessions-secrets.ts` \u2014 doctor check for session secrets\n- `docs/cli/sessions-scrub.md` \u2014 documentation\n\n### Modified files\n- `src/cli/program/register.status-health-sessions.ts` \u2014 Commander.js registration, `sessions` becomes a command group with backward compat\n- `src/commands/doctor.ts` \u2014 wires in the new session secrets check\n\n### Design decisions\n- Reuses canonical `maskToken()` pattern from `src/logging/redact.ts` \u2014 no duplicated regex\n- Creates `.bak` backups by default; `--no-backup` to skip\n- Doctor check scans all files if \u2264200, deterministic sample for larger dirs\n- `openclaw sessions` (no subcommand) still works as before (lists sessions)\n- Multi-pass scrub loop with oscillation guard for stable redaction\n\n### Tests\n- 10 unit tests for sessions scrub (`src/commands/sessions-scrub.test.ts`)\n- 7 unit tests for doctor check (`src/commands/doctor-sessions-secrets.test.ts`)\n- All 17 tests passing\n\n<!-- greptile_comment -->\n\n<h2>Greptile Overview</h2>\n\n<h3>Greptile Summary</h3>\n\nAdds `openclaw sessions scrub` CLI command for at-rest redaction of leaked secrets in session JSONL files, plus a `doctor` check that warns users about unredacted secrets. The implementation is well-structured: scrub uses the canonical `redactSensitiveText` from `redact.ts`, includes a multi-pass loop with oscillation detection, bounded concurrency for performance, and `.bak` backups by default. The `sessions` command is cleanly promoted from a leaf to a command group (matching the existing `agents` pattern) with backward compatibility preserved.\n\n- Documentation states files are processed \"sequentially\" but the implementation uses bounded concurrency (default 20 workers) \u2014 docs should be corrected\n- `parsePattern` in `doctor-sessions-secrets.ts` duplicates the private function in `redact.ts`; consider exporting a shared version to prevent drift\n- Test coverage is thorough (17 tests covering dry-run, backup, multi-pass, oscillation guard, edge cases)\n\n<h3>Confidence Score: 4/5</h3>\n\n- This PR is safe to merge with minor documentation fixes needed\n- The core logic is sound: the scrub command correctly uses the canonical redaction utilities, the concurrency pattern is safe in Node.js, the oscillation guard prevents infinite loops, and the backward-compatible command group promotion follows established codebase patterns. The only actionable issue is a documentation inaccuracy (sequential vs concurrent processing). The duplicated parsePattern is a maintenance risk but not a runtime bug. Test coverage is solid at 17 tests.\n- docs/cli/sessions-scrub.md (documentation inaccuracy about processing model)\n\n<sub>Last reviewed commit: bec7b8e</sub>\n\n<!-- greptile_other_comments_section -->\n\n<!-- /greptile_comment -->",
          "author": "akoscz",
          "authorAssociation": "CONTRIBUTOR",
          "createdAt": "2026-02-15T03:46:23Z",
          "updatedAt": "2026-02-15T20:52:36Z",
          "headRef": "feature/sessions-scrub-clean",
          "baseRef": "main",
          "filesChanged": 10,
          "additions": 1125,
          "deletions": 12,
          "commits": 4,
          "labels": [
            "docs",
            "gateway",
            "cli",
            "commands",
            "size: L"
          ],
          "ciStatus": "failure",
          "hasIssueRef": true,
          "issueNumbers": [
            11468
          ],
          "changedFiles": [
            "docs/cli/sessions-scrub.md",
            "src/cli/program/register.status-health-sessions.ts",
            "src/cli/program/routes.ts",
            "src/commands/doctor-sessions-secrets.test.ts",
            "src/commands/doctor-sessions-secrets.ts",
            "src/commands/doctor.ts",
            "src/commands/sessions-scrub.test.ts",
            "src/commands/sessions-scrub.ts",
            "src/gateway/session-utils.fs.ts",
            "src/logging/redact.ts"
          ],
          "diffUrl": "https://github.com/openclaw/openclaw/pull/16779.diff",
          "hasTests": true,
          "testFilesChanged": [
            "src/commands/doctor-sessions-secrets.test.ts",
            "src/commands/sessions-scrub.test.ts"
          ],
          "ageInDays": 0,
          "mergeable": "unknown",
          "reviewState": "commented",
          "reviewCount": 2,
          "commentCount": 1,
          "totalScore": 82,
          "signals": [
            {
              "name": "ci_status",
              "score": 10,
              "weight": 0.2,
              "reason": "CI: failure"
            },
            {
              "name": "diff_size",
              "score": 60,
              "weight": 0.1,
              "reason": "1137 lines changed (1125+/12-)"
            },
            {
              "name": "commit_quality",
              "score": 90,
              "weight": 0.05,
              "reason": "Conventional commit format"
            },
            {
              "name": "contributor",
              "score": 79,
              "weight": 0.15,
              "reason": "akoscz (CONTRIBUTOR, rep: 100)"
            },
            {
              "name": "issue_ref",
              "score": 90,
              "weight": 0.1,
              "reason": "References: #11468"
            },
            {
              "name": "spam",
              "score": 100,
              "weight": 0.15,
              "reason": "No spam signals"
            },
            {
              "name": "test_coverage",
              "score": 90,
              "weight": 0.15,
              "reason": "2 test file(s) changed"
            },
            {
              "name": "staleness",
              "score": 100,
              "weight": 0.1,
              "reason": "0d old (Fresh)"
            },
            {
              "name": "mergeability",
              "score": 50,
              "weight": 0.15,
              "reason": "Merge status: unknown"
            },
            {
              "name": "review_status",
              "score": 70,
              "weight": 0.1,
              "reason": "Review: commented (2 reviews)"
            },
            {
              "name": "body_quality",
              "score": 90,
              "weight": 0.05,
              "reason": "Body: 3338 chars"
            },
            {
              "name": "activity",
              "score": 50,
              "weight": 0.05,
              "reason": "1 comments"
            },
            {
              "name": "breaking_change",
              "score": 80,
              "weight": 0.05,
              "reason": "No breaking change signals"
            }
          ],
          "isSpam": false,
          "spamReasons": [],
          "visionAlignment": "unchecked",
          "llmScore": 90,
          "llmRisk": "low",
          "llmReason": "Addresses a real security concern (secret leakage in session files). Implementation seems thorough with backup, doctor check, and tests. The design decisions (maskToken reuse, backup, sampling) are sensible. The multi-pass scrub loop with oscillation guard is a nice touch. The risk is low because it adds functionality without removing existing features, and includes tests.",
          "duplicateGroup": 1
        },
        {
          "number": 11602,
          "title": "fix(config): skip stale legacy config files when openclaw.json exists",
          "body": "## Summary\n\nFix for #11465 \u2014 After migrating from clawdbot to openclaw, the gateway reads stale legacy config files (clawdbot.json, moltbot.json, moldbot.json) causing validation failures and log spam every ~10 seconds via systemd restart loop.\n\n## Root Cause\n\n`resolveDefaultConfigCandidates()` in `src/config/paths.ts` generates candidate config paths including legacy filenames for every directory, even when `openclaw.json` already exists there. When a migration symlink exists (`~/.clawdbot \u2192 ~/.openclaw`), the stale legacy config gets picked up, fails validation, and the gateway crashes repeatedly.\n\n## Changes\n\n### Primary fix (`src/config/paths.ts`)\n- `resolveDefaultConfigCandidates()` now checks if `openclaw.json` exists in each candidate directory\n- If it does, legacy filenames (clawdbot.json, moltbot.json, moldbot.json) are skipped for that directory\n- Added `skipLegacyIfNewExists` option (default `true`) for backward compatibility in tests\n- Exported `LEGACY_CONFIG_FILENAMES` for use by doctor cleanup\n\n### Doctor cleanup (`src/commands/doctor-config-flow.ts`)\n- New `renameStaleLegacyConfigs()` function that renames stale legacy configs to `<name>.migrated` when `openclaw.json` exists\n- Respects `OPENCLAW_STATE_DIR` via `resolveStateDir()`\n- Called during `openclaw doctor` flow after legacy config migration\n\n### Tests\n- **`src/config/paths.test.ts`** \u2014 4 new tests:\n  - Skip legacy filenames when `openclaw.json` exists in same dir\n  - Include legacy filenames when `openclaw.json` does not exist (backward compat)\n  - Skip legacy in custom `OPENCLAW_STATE_DIR` with `openclaw.json`\n  - Symlink regression test (`~/.clawdbot \u2192 ~/.openclaw`) \u2014 the exact reported scenario\n- **`src/commands/doctor-config-flow.test.ts`** \u2014 4 new tests:\n  - Rename stale legacy configs when `openclaw.json` exists\n  - Skip when no primary config\n  - Skip when no legacy configs\n  - `.migrated` collision (safe to run doctor twice)\n- All 17 tests pass, all original tests preserved\n\n## Backward Compatibility\n\n- Legacy config paths still work for actual first-time migrations (when `openclaw.json` doesn't exist)\n- Doctor renames to `.migrated` rather than deleting (recoverable)\n- No changes to gateway startup logic\n\n## Verification\n\n```\npnpm check          \u2705 (typecheck + lint + format)\npnpm vitest run ... \u2705 (17 tests pass)\n```\n\n## Sign-Off\n\n- [x] AI-assisted (Claude Opus 4.6 via OpenClaw, with human review)\n- [x] Fully tested (17 unit tests covering all edge cases)\n- [x] Tested locally with OpenClaw instance\n- [x] Understand what the code does\n\nlobster-biscuit\n\n<!-- greptile_comment -->\n\n<h2>Greptile Overview</h2>\n\n<h3>Greptile Summary</h3>\n\nThis PR addresses #11465 by preventing stale legacy config files (`clawdbot.json`, `moltbot.json`, `moldbot.json`) from being considered when `openclaw.json` already exists in the same directory.\n\nKey changes:\n- `src/config/paths.ts`: `resolveDefaultConfigCandidates()` now omits legacy config filenames per-directory when `openclaw.json` exists, and `resolveConfigPath()` applies the same rule for explicit `stateDir` paths. Legacy config env override support is extended by treating `CLAWDBOT_CONFIG_PATH` as a fallback when `OPENCLAW_CONFIG_PATH` is unset.\n- `src/commands/doctor-config-flow.ts`: adds `renameStaleLegacyConfigs()` and runs it during `openclaw doctor` to rename stale legacy configs to `*.migrated` once a primary `openclaw.json` exists.\n- Tests cover the primary skip behavior, the symlink regression case, state-dir override behavior, and doctor rename collision behavior.\n\n\n<h3>Confidence Score: 5/5</h3>\n\n- This PR is safe to merge with minimal risk.\n- Changes are localized to config-path candidate generation and a best-effort doctor cleanup, with targeted tests covering the reported symlink regression and state-dir override scenarios.\n- No files require special attention\n\n<!-- greptile_other_comments_section -->\n\n<!-- /greptile_comment -->",
          "author": "akoscz",
          "authorAssociation": "CONTRIBUTOR",
          "createdAt": "2026-02-08T01:57:49Z",
          "updatedAt": "2026-02-15T20:52:25Z",
          "headRef": "fix/legacy-config-path-spam",
          "baseRef": "main",
          "filesChanged": 4,
          "additions": 284,
          "deletions": 22,
          "commits": 8,
          "labels": [
            "commands",
            "size: M"
          ],
          "ciStatus": "failure",
          "hasIssueRef": true,
          "issueNumbers": [
            11465
          ],
          "changedFiles": [
            "src/commands/doctor-config-flow.e2e.test.ts",
            "src/commands/doctor-config-flow.ts",
            "src/config/paths.test.ts",
            "src/config/paths.ts"
          ],
          "diffUrl": "https://github.com/openclaw/openclaw/pull/11602.diff",
          "hasTests": true,
          "testFilesChanged": [
            "src/commands/doctor-config-flow.e2e.test.ts",
            "src/config/paths.test.ts"
          ],
          "ageInDays": 7,
          "mergeable": "unknown",
          "reviewState": "commented",
          "reviewCount": 10,
          "commentCount": 17,
          "totalScore": 72,
          "signals": [
            {
              "name": "ci_status",
              "score": 10,
              "weight": 0.2,
              "reason": "CI: failure"
            },
            {
              "name": "diff_size",
              "score": 100,
              "weight": 0.1,
              "reason": "306 lines changed (284+/22-)"
            },
            {
              "name": "commit_quality",
              "score": 90,
              "weight": 0.05,
              "reason": "Conventional commit format"
            },
            {
              "name": "contributor",
              "score": 79,
              "weight": 0.15,
              "reason": "akoscz (CONTRIBUTOR, rep: 100)"
            },
            {
              "name": "issue_ref",
              "score": 90,
              "weight": 0.1,
              "reason": "References: #11465"
            },
            {
              "name": "spam",
              "score": 100,
              "weight": 0.15,
              "reason": "No spam signals"
            },
            {
              "name": "test_coverage",
              "score": 90,
              "weight": 0.15,
              "reason": "2 test file(s) changed"
            },
            {
              "name": "staleness",
              "score": 70,
              "weight": 0.1,
              "reason": "7d old (Aging)"
            },
            {
              "name": "mergeability",
              "score": 50,
              "weight": 0.15,
              "reason": "Merge status: unknown"
            },
            {
              "name": "review_status",
              "score": 70,
              "weight": 0.1,
              "reason": "Review: commented (10 reviews)"
            },
            {
              "name": "body_quality",
              "score": 100,
              "weight": 0.05,
              "reason": "Body: 3928 chars"
            },
            {
              "name": "activity",
              "score": 90,
              "weight": 0.05,
              "reason": "17 comments"
            },
            {
              "name": "breaking_change",
              "score": 80,
              "weight": 0.05,
              "reason": "No breaking change signals"
            }
          ],
          "isSpam": false,
          "spamReasons": [],
          "visionAlignment": "unchecked",
          "duplicateGroup": 1
        },
        {
          "number": 12296,
          "title": "security: persistence-only secret redaction for session transcripts",
          "body": "## Summary\r\n\r\n\ud83e\udd16 **AI-assisted** \u2014 Built by an OpenClaw agent (Claude Opus 4.6), fully tested, fully reviewed. The author understands the code and architecture decisions.\r\n\r\nRedact sensitive secrets (API keys, tokens, passwords) from session transcript JSONL files **at the persistence layer only**, keeping in-memory entries unredacted so the LLM can reason about full tool output (e.g., `curl` with Bearer tokens, `cat` of config files).\r\n\r\nSee [design document on #12182](https://github.com/openclaw/openclaw/issues/12182#issuecomment-3869025731) for full architecture rationale, tradeoffs, and coverage analysis.\r\n\r\n## Root Cause\r\n\r\nIn `session-tool-result-guard.ts`, tool results are persisted via `_appendEntry()` \u2192 `_persist()` which calls `JSON.stringify(entry)` + `appendFileSync` \u2014 no redaction applied. The existing `redactSensitiveText()` was only used on the read path.\r\n\r\nAdditionally, `appendAssistantMessageToSessionTranscript()` in `transcript.ts` creates a raw `SessionManager.open()` without the guard, bypassing any redaction.\r\n\r\n## Fix\r\n\r\n### Architecture: Persistence-only via `_persist` monkey-patch\r\n\r\n- **`SessionManager._persist()`** \u2014 Replaced entirely to apply `redactEntryForPersistence()` during `JSON.stringify` serialization (both bulk-flush and single-entry paths)\r\n- **`SessionManager._rewriteFile()`** \u2014 Also replaced for the migration/recovery write path\r\n- **`transcript.ts`** \u2014 Wrapped with `guardSessionManager()` to close the bypass\r\n- **In-memory `fileEntries[]`** \u2014 Untouched. LLM sees full unredacted content via `buildSessionContext()`\r\n\r\n### Entry types covered (all text-carrying types)\r\n\r\n| Entry Type | Field(s) Redacted |\r\n|---|---|\r\n| `message` (toolResult, assistant, user) | `message.content[].text` |\r\n| `compaction` / `branch_summary` | `summary` string |\r\n| `custom_message` | `content` (string or TextContent[]) |\r\n\r\n### Why monkey-patching\r\n\r\n`SessionManager` lives in the upstream `@mariozechner/pi-coding-agent` package \u2014 we cannot modify `_persist` directly. The existing guard already monkey-patches `appendMessage`; our `_persist` patch follows the same established pattern. We pin to upstream v0.52.8 with SHA-256 hash tests that fail on any structural change.\r\n\r\n### Other improvements\r\n\r\n- Cache compiled regex patterns (content-based `JSON.stringify` comparison)\r\n- Resolve redact options once at guard install time (no per-call `loadConfig()`)\r\n- Extract shared `redactTextBlocks()` helper (zero code duplication)\r\n\r\n## Test plan\r\n\r\n**38 tests total**, all passing (Node + Bun):\r\n\r\n- **Dual-path verification**: every redaction test checks both in-memory (unredacted) and on-disk (redacted) using disk-persisted `SessionManager`\r\n- **All message roles**: toolResult, assistant, user\r\n- **All entry types**: compaction, branch_summary, custom_message (string + array)\r\n- **Non-message passthrough**: session header unchanged\r\n- **Transcript mirror**: delivery-mirror redaction verified\r\n- **Upstream compatibility**: SHA-256 hash of `_persist.toString()` and `_rewriteFile.toString()`\r\n- **Clean passthrough**: entries without secrets return same reference\r\n\r\n## Related\r\n\r\n- Refs: #12182\r\n- Related: #12260 (similar goal, different architecture \u2014 redacts before `appendMessage` which also affects LLM context)\r\n\r\n## Files changed (5)\r\n\r\n- `src/agents/session-tool-result-guard.ts` \u2014 `redactEntryForPersistence()`, `_persist`/`_rewriteFile` patches, `redactTextBlocks()` helper\r\n- `src/agents/session-tool-result-guard.test.ts` \u2014 26 guard tests with dual-path verification\r\n- `src/config/sessions/transcript.ts` \u2014 `guardSessionManager()` wrapper\r\n- `src/config/sessions/transcript.test.ts` \u2014 delivery-mirror redaction test\r\n- `src/logging/redact.ts` \u2014 pattern caching\n\n<!-- greptile_comment -->\n\n<h2>Greptile Overview</h2>\n\n<h3>Greptile Summary</h3>\n\nThis PR changes session transcript persistence so secrets are redacted only when writing JSONL to disk, keeping in-memory session entries unredacted for LLM context. It does this by extending the existing `guardSessionManager()` approach to wrap `SessionManager`\u2019s persistence methods (`_persist` and `_rewriteFile`) to serialize redacted copies of entries, and by ensuring `transcript.ts` uses a guarded session manager so it can\u2019t bypass redaction. It also updates the redaction utility to cache compiled regex/pattern work and adds tests that verify the \u201cdual path\u201d behavior (unredacted in-memory, redacted on disk) across message roles and other transcript entry types.\n\n<h3>Confidence Score: 5/5</h3>\n\n- This PR is safe to merge with minimal risk.\n- Reviewed the changed persistence wrapper and transcript guard integration along with the updated redaction caching and tests; changes are focused, preserve upstream persistence semantics, and include strong dual-path test coverage to prevent regressions.\n- No files require special attention\n\n<!-- greptile_other_comments_section -->\n\n<!-- /greptile_comment -->",
          "author": "akoscz",
          "authorAssociation": "CONTRIBUTOR",
          "createdAt": "2026-02-09T03:08:09Z",
          "updatedAt": "2026-02-15T20:52:22Z",
          "headRef": "feature/exec-write-time-redaction",
          "baseRef": "main",
          "filesChanged": 7,
          "additions": 741,
          "deletions": 11,
          "commits": 10,
          "labels": [
            "docs",
            "gateway",
            "agents",
            "size: L"
          ],
          "ciStatus": "failure",
          "hasIssueRef": true,
          "issueNumbers": [
            12182,
            12182,
            12260
          ],
          "changedFiles": [
            "docs/gateway/security/index.md",
            "docs/logging.md",
            "src/agents/session-tool-result-guard.e2e.test.ts",
            "src/agents/session-tool-result-guard.ts",
            "src/config/sessions/transcript.test.ts",
            "src/config/sessions/transcript.ts",
            "src/logging/redact.ts"
          ],
          "diffUrl": "https://github.com/openclaw/openclaw/pull/12296.diff",
          "hasTests": true,
          "testFilesChanged": [
            "src/agents/session-tool-result-guard.e2e.test.ts",
            "src/config/sessions/transcript.test.ts"
          ],
          "ageInDays": 6,
          "mergeable": "unknown",
          "reviewState": "approved",
          "reviewCount": 15,
          "commentCount": 13,
          "totalScore": 80,
          "signals": [
            {
              "name": "ci_status",
              "score": 10,
              "weight": 0.2,
              "reason": "CI: failure"
            },
            {
              "name": "diff_size",
              "score": 60,
              "weight": 0.1,
              "reason": "752 lines changed (741+/11-)"
            },
            {
              "name": "commit_quality",
              "score": 50,
              "weight": 0.05,
              "reason": "Non-standard title"
            },
            {
              "name": "contributor",
              "score": 79,
              "weight": 0.15,
              "reason": "akoscz (CONTRIBUTOR, rep: 100)"
            },
            {
              "name": "issue_ref",
              "score": 90,
              "weight": 0.1,
              "reason": "References: #12182, #12182, #12260"
            },
            {
              "name": "spam",
              "score": 100,
              "weight": 0.15,
              "reason": "No spam signals"
            },
            {
              "name": "test_coverage",
              "score": 90,
              "weight": 0.15,
              "reason": "2 test file(s) changed"
            },
            {
              "name": "staleness",
              "score": 100,
              "weight": 0.1,
              "reason": "6d old (Fresh)"
            },
            {
              "name": "mergeability",
              "score": 50,
              "weight": 0.15,
              "reason": "Merge status: unknown"
            },
            {
              "name": "review_status",
              "score": 100,
              "weight": 0.1,
              "reason": "Review: approved (15 reviews)"
            },
            {
              "name": "body_quality",
              "score": 90,
              "weight": 0.05,
              "reason": "Body: 4933 chars"
            },
            {
              "name": "activity",
              "score": 90,
              "weight": 0.05,
              "reason": "13 comments"
            },
            {
              "name": "breaking_change",
              "score": 80,
              "weight": 0.05,
              "reason": "No breaking change signals"
            }
          ],
          "isSpam": false,
          "spamReasons": [],
          "visionAlignment": "unchecked",
          "llmScore": 85,
          "llmRisk": "medium",
          "llmReason": "Addresses a real security issue by redacting secrets in persisted session transcripts. The persistence-only approach is well-reasoned. Monkey-patching introduces some risk, but seems justified given the upstream package constraints. Comprehensive testing is crucial to mitigate the risk of unexpected side effects. The description is detailed and covers the rationale and implementation well.",
          "duplicateGroup": 1
        }
      ],
      "bestPR": 16779,
      "similarity": 0.8315231173337968,
      "reason": "5 similar PRs (avg similarity: 83.2%)"
    },
    {
      "id": 2,
      "prs": [
        {
          "number": 17497,
          "title": "ci(formal): skip informational PR comment on forked PRs",
          "body": "## Summary\n- guard the `Comment on PR (informational)` step in `.github/workflows/formal-conformance.yml`\n- run the comment step only when `github.event.pull_request.head.repo.full_name == github.repository`\n\n## Why\nFork PRs often have restricted token permissions, so posting PR comments from workflow can fail with:\n\n- `Resource not accessible by integration` (HTTP 403)\n\nThis currently marks `formal_conformance` as failed even though the check is informational.\n\n## Effect\n- same drift detection + artifact upload behavior\n- no failing comment-post step on fork PRs\n- preserves comment behavior for same-repo PRs\n\nRelated context: #16761\n\n<!-- greptile_comment -->\n\n<h3>Greptile Summary</h3>\n\nAdds a fork-guard to the \"Comment on PR (informational)\" step in the formal conformance workflow. The step now only posts a PR comment when the PR originates from the same repository, preventing 403 errors (`Resource not accessible by integration`) on fork PRs where the `GITHUB_TOKEN` lacks `pull-requests: write` scope.\n\n- Appends `&& github.event.pull_request.head.repo.full_name == github.repository` to the existing `if` condition on line 110\n- Drift detection, model checks, artifact upload, and the summary step remain unchanged\n- Uses the standard GitHub Actions idiom for fork detection\n\n<h3>Confidence Score: 5/5</h3>\n\n- This PR is safe to merge \u2014 it adds a standard, well-understood fork-guard condition to a single CI step.\n- The change is a one-line addition of a standard GitHub Actions fork-detection condition. It only affects when a PR comment is posted, with no impact on the actual conformance checks, artifact uploads, or other workflow behavior. The pattern is idiomatic and widely used in open-source GitHub Actions workflows.\n- No files require special attention.\n\n<sub>Last reviewed commit: 8eb4c7b</sub>\n\n<!-- greptile_other_comments_section -->\n\n<sub>(4/5) You can add custom instructions or style guidelines for the agent [here](https://app.greptile.com/review/github)!</sub>\n\n<!-- /greptile_comment -->",
          "author": "napetrov",
          "authorAssociation": "CONTRIBUTOR",
          "createdAt": "2026-02-15T20:33:13Z",
          "updatedAt": "2026-02-15T20:39:39Z",
          "headRef": "napetrov/fix-formal-conformance-fork-comment",
          "baseRef": "main",
          "filesChanged": 1,
          "additions": 1,
          "deletions": 1,
          "commits": 1,
          "labels": [
            "size: XS"
          ],
          "ciStatus": "pending",
          "hasIssueRef": true,
          "issueNumbers": [
            16761
          ],
          "changedFiles": [
            ".github/workflows/formal-conformance.yml"
          ],
          "diffUrl": "https://github.com/openclaw/openclaw/pull/17497.diff",
          "hasTests": false,
          "testFilesChanged": [],
          "ageInDays": 0,
          "mergeable": "mergeable",
          "reviewState": "none",
          "reviewCount": 0,
          "commentCount": 0,
          "totalScore": 85,
          "signals": [
            {
              "name": "ci_status",
              "score": 50,
              "weight": 0.2,
              "reason": "CI: pending"
            },
            {
              "name": "diff_size",
              "score": 20,
              "weight": 0.1,
              "reason": "2 lines changed (1+/1-)"
            },
            {
              "name": "commit_quality",
              "score": 90,
              "weight": 0.05,
              "reason": "Conventional commit format"
            },
            {
              "name": "contributor",
              "score": 79,
              "weight": 0.15,
              "reason": "napetrov (CONTRIBUTOR, rep: 100)"
            },
            {
              "name": "issue_ref",
              "score": 90,
              "weight": 0.1,
              "reason": "References: #16761"
            },
            {
              "name": "spam",
              "score": 75,
              "weight": 0.15,
              "reason": "<3 lines, contributor bonus -1"
            },
            {
              "name": "test_coverage",
              "score": 60,
              "weight": 0.15,
              "reason": "Docs/config PR \u2014 tests not expected"
            },
            {
              "name": "staleness",
              "score": 100,
              "weight": 0.1,
              "reason": "0d old (Fresh)"
            },
            {
              "name": "mergeability",
              "score": 100,
              "weight": 0.15,
              "reason": "Merge status: mergeable"
            },
            {
              "name": "review_status",
              "score": 40,
              "weight": 0.1,
              "reason": "Review: none (0 reviews)"
            },
            {
              "name": "body_quality",
              "score": 90,
              "weight": 0.05,
              "reason": "Body: 2027 chars"
            },
            {
              "name": "activity",
              "score": 30,
              "weight": 0.05,
              "reason": "0 comments"
            },
            {
              "name": "breaking_change",
              "score": 80,
              "weight": 0.05,
              "reason": "No breaking change signals"
            }
          ],
          "isSpam": false,
          "spamReasons": [],
          "visionAlignment": "unchecked",
          "llmScore": 95,
          "llmRisk": "low",
          "llmReason": "This PR effectively addresses a real problem: failing CI checks due to insufficient permissions when posting comments on PRs from forks. The implementation is straightforward and correct, using a standard GitHub Actions idiom for fork detection. Merging this PR would improve the project by preventing unnecessary CI failures and improving the overall developer experience.",
          "duplicateGroup": 2
        },
        {
          "number": 17452,
          "title": "ci: Grant write perms for Issues for formal-conformance.yml",
          "body": "This pull request makes a minor update to the GitHub Actions workflow configuration by adjusting permissions to ensure proper functionality.\r\n\r\n* Updated the `.github/workflows/formal-conformance.yml` workflow to explicitly add `issues: write` permission, which is required for the workflow to function correctly.\r\n\r\nThat's it.\n\n<!-- greptile_comment -->\n\n<h3>Greptile Summary</h3>\n\nAdded `issues: write` permission to the formal-conformance workflow, which is required for the workflow to post comments on pull requests using `github.rest.issues.createComment()` (line 126).\n\n- The permission is necessary because GitHub treats PR comments as issue comments in the REST API\n- Without this permission, the workflow would fail when attempting to post the drift detection comment\n\n<h3>Confidence Score: 5/5</h3>\n\n- This PR is safe to merge with minimal risk\n- Single-line addition of a required permission for an existing API call; the change is necessary for correct workflow functionality and carries no risk\n- No files require special attention\n\n<sub>Last reviewed commit: badca70</sub>\n\n<!-- greptile_other_comments_section -->\n\n<sub>(5/5) You can turn off certain types of comments like style [here](https://app.greptile.com/review/github)!</sub>\n\n<!-- /greptile_comment -->",
          "author": "thesomewhatyou",
          "authorAssociation": "CONTRIBUTOR",
          "createdAt": "2026-02-15T19:33:13Z",
          "updatedAt": "2026-02-15T19:56:40Z",
          "headRef": "patch-1",
          "baseRef": "main",
          "filesChanged": 1,
          "additions": 1,
          "deletions": 0,
          "commits": 3,
          "labels": [
            "size: XS"
          ],
          "ciStatus": "failure",
          "hasIssueRef": false,
          "issueNumbers": [],
          "changedFiles": [
            ".github/workflows/formal-conformance.yml"
          ],
          "diffUrl": "https://github.com/openclaw/openclaw/pull/17452.diff",
          "hasTests": false,
          "testFilesChanged": [],
          "ageInDays": 0,
          "mergeable": "unknown",
          "reviewState": "commented",
          "reviewCount": 1,
          "commentCount": 0,
          "totalScore": 52,
          "signals": [
            {
              "name": "ci_status",
              "score": 10,
              "weight": 0.2,
              "reason": "CI: failure"
            },
            {
              "name": "diff_size",
              "score": 20,
              "weight": 0.1,
              "reason": "1 lines changed (1+/0-)"
            },
            {
              "name": "commit_quality",
              "score": 90,
              "weight": 0.05,
              "reason": "Conventional commit format"
            },
            {
              "name": "contributor",
              "score": 77,
              "weight": 0.15,
              "reason": "thesomewhatyou (CONTRIBUTOR, rep: 94)"
            },
            {
              "name": "issue_ref",
              "score": 30,
              "weight": 0.1,
              "reason": "No issue reference"
            },
            {
              "name": "spam",
              "score": 50,
              "weight": 0.15,
              "reason": "<3 lines, No issue ref, contributor bonus -1"
            },
            {
              "name": "test_coverage",
              "score": 60,
              "weight": 0.15,
              "reason": "Docs/config PR \u2014 tests not expected"
            },
            {
              "name": "staleness",
              "score": 100,
              "weight": 0.1,
              "reason": "0d old (Fresh)"
            },
            {
              "name": "mergeability",
              "score": 50,
              "weight": 0.15,
              "reason": "Merge status: unknown"
            },
            {
              "name": "review_status",
              "score": 60,
              "weight": 0.1,
              "reason": "Review: commented (1 reviews)"
            },
            {
              "name": "body_quality",
              "score": 90,
              "weight": 0.05,
              "reason": "Body: 1277 chars"
            },
            {
              "name": "activity",
              "score": 30,
              "weight": 0.05,
              "reason": "0 comments"
            },
            {
              "name": "breaking_change",
              "score": 80,
              "weight": 0.05,
              "reason": "No breaking change signals"
            }
          ],
          "isSpam": false,
          "spamReasons": [],
          "visionAlignment": "unchecked",
          "duplicateGroup": 2
        }
      ],
      "bestPR": 17497,
      "similarity": 0.845132035915854,
      "reason": "2 similar PRs (avg similarity: 84.5%)"
    },
    {
      "id": 3,
      "prs": [
        {
          "number": 17453,
          "title": "fix(signal): make group reactions deterministic from inbound sender metadata",
          "body": "## Summary\r\n\r\n  Describe the problem and fix in 2\u20135 bullets:\r\n\r\n  - Problem: Signal group reactions were unreliable because targetAuthor/targetAuthorUuid was often missing or model-\r\n    guessed, causing reactions to fail or be accepted without visible UI effect.\r\n  - Why it matters: Group reaction behavior must deterministically target the exact inbound message author; otherwise\r\n    reactions are flaky in real group chats.\r\n  - What changed: Added an inbound reaction-target cache (groupId + messageId -> sender uuid/e164), populated it in\r\n    Signal inbound handling, and used it in outbound react action prep when targetAuthor* is not provided. Also\r\n    tightened reaction payload shaping to prefer UUID and set recipients for group reactions/removals.\r\n  - What did NOT change (scope boundary): No changes to non-Signal channels, no new external services, no schema/API\r\n    contract changes, and no config migration.\r\n\r\n  ## Change Type (select all)\r\n\r\n  - [x] Bug fix\r\n  - [ ] Feature\r\n  - [ ] Refactor\r\n  - [ ] Docs\r\n  - [ ] Security hardening\r\n  - [ ] Chore/infra\r\n\r\n  ## Scope (select all touched areas)\r\n\r\n  - [x] Gateway / orchestration\r\n  - [ ] Skills / tool execution\r\n  - [ ] Auth / tokens\r\n  - [x] Memory / storage\r\n  - [x] Integrations\r\n  - [ ] API / contracts\r\n  - [ ] UI / DX\r\n  - [ ] CI/CD / infra\r\n\r\n  ## Linked Issue/PR\r\n\r\n  - Closes #\r\n  - Related #\r\n\r\n  ## User-visible / Behavior Changes\r\n\r\n  - Signal group \u201creact to this message\u201d is now more reliable when messageId is known but targetAuthor* is omitted.\r\n  - For group reactions/removals, UUID targeting is preferred and recipient shaping is more consistent.\r\n  - No new user-facing config required.\r\n\r\n  ## Security Impact (required)\r\n\r\n  - New permissions/capabilities? (No)\r\n  - Secrets/tokens handling changed? (No)\r\n  - New/changed network calls? (No)\r\n  - Command/tool execution surface changed? (No)\r\n  - Data access scope changed? (Yes)\r\n  - If any Yes, explain risk + mitigation:\r\n      - Added a small in-memory cache of inbound group reaction metadata (sender identifier keyed by group/message) with\r\n        TTL and size cap.\r\n      - Mitigations: bounded cache (MAX_ENTRIES), expiration (TTL_MS), no persistence to disk, no secret material.\r\n\r\n  ## Repro + Verification\r\n\r\n  ### Environment\r\n\r\n  - OS: macOS\r\n  - Runtime/container: Docker Compose (openclaw-gateway + signal-cli-daemon)\r\n  - Model/provider: OpenAI Codex (gpt-5.3-codex)\r\n  - Integration/channel (if any): Signal group + direct chat\r\n  - Relevant config (redacted): channels.signal.reactionLevel=minimal, actions.reactions=true\r\n\r\n  ### Steps\r\n\r\n  1. Receive a Signal group inbound message and ask agent to react to that message.\r\n  2. Trigger message.react without explicitly forcing targetAuthorUuid.\r\n  3. Observe gateway logs and Signal UI behavior.\r\n\r\n  ### Expected\r\n\r\n  - Group reaction resolves to exact inbound sender and appears in Signal UI.\r\n\r\n  ### Actual\r\n\r\n  - Before fix: reactions frequently failed (targetAuthor required) or reported success but were not visible.\r\n  - After fix: deterministic sender targeting is applied via inbound cache; reactions are consistently resolved.\r\n\r\n  ## Evidence\r\n\r\n  Attach at least one:\r\n\r\n  - [x] Failing test/log before + passing after\r\n  - [x] Trace/log snippets\r\n  - [ ] Screenshot/recording\r\n  - [ ] Perf numbers (if relevant)\r\n\r\n  ## Human Verification (required)\r\n\r\n  What you personally verified (not just CI), and how:\r\n\r\n  - Verified scenarios:\r\n      - Group reaction target hydration from inbound metadata cache.\r\n      - UUID-preferred target selection.\r\n      - Group removal payload shaping using resolved target.\r\n  - Edge cases checked:\r\n      - Missing targetAuthor* with valid groupId + messageId.\r\n      - UUID vs E.164 fallback behavior.\r\n  - What you did not verify:\r\n      - Full matrix across all Signal daemon versions and multi-device clients.\r\n\r\n  ## Compatibility / Migration\r\n\r\n  - Backward compatible? (Yes)\r\n  - Config/env changes? (No)\r\n  - Migration needed? (No)\r\n  - If yes, exact upgrade steps:\r\n\r\n  ## Failure Recovery (if this breaks)\r\n\r\n  - How to disable/revert this change quickly:\r\n      - Revert commit cda8b78bbd8d76001d2331596038babb3cb82763.\r\n  - Files/config to restore:\r\n      - src/infra/outbound/message-action-runner.ts\r\n      - src/signal/monitor/event-handler.ts\r\n      - src/signal/send-reactions.ts\r\n      - remove src/signal/reaction-target-cache.ts\r\n  - Known bad symptoms reviewers should watch for:\r\n      - Group react regression to targetAuthor is required errors.\r\n      - Group reactions accepted but not visible in Signal UI.\r\n\r\n  ## Risks and Mitigations\r\n\r\n  - Risk:\r\n      - Stale cache entry could map message->author incorrectly if identifiers collide.\r\n      - Mitigation:\r\n          - Keyed by exact groupId + messageId, bounded size, TTL expiry, and no cross-group reuse.\n\n<!-- greptile_comment -->\n\n<h3>Greptile Summary</h3>\n\nAdds deterministic Signal group reaction targeting by caching inbound sender metadata (UUID/E.164) keyed by `groupId + messageId`. When reacting without explicit `targetAuthor*`, the system now hydrates from cache instead of failing or guessing.\n\nKey changes:\n- New `reaction-target-cache.ts` with bounded in-memory cache (5000 entries, 24h TTL)\n- `event-handler.ts` records sender metadata on group message receipt\n- `message-action-runner.ts` hydrates `targetAuthorUuid`/`targetAuthor` from cache when missing\n- `send-reactions.ts` prefers UUID over E.164 and shapes recipients array for group reactions/removals\n- Tests cover cache behavior, UUID preference, and target hydration\n\n<h3>Confidence Score: 4/5</h3>\n\n- Safe to merge with one minor overflow calculation bug in cache pruning\n- The implementation is sound with proper bounds, TTL, and test coverage. UUID preference ordering is correct, cache hydration logic works as intended, and the change is backward compatible. One bug in pruning overflow calculation uses sorted array length instead of current map size after expired entries are deleted, but this has minimal impact (slight over-pruning at most)\n- Pay attention to `src/signal/reaction-target-cache.ts` line 74 overflow calculation\n\n<sub>Last reviewed commit: cda8b78</sub>\n\n<!-- greptile_other_comments_section -->\n\n<sub>(5/5) You can turn off certain types of comments like style [here](https://app.greptile.com/review/github)!</sub>\n\n<!-- /greptile_comment -->",
          "author": "akalypse",
          "authorAssociation": "NONE",
          "createdAt": "2026-02-15T19:36:47Z",
          "updatedAt": "2026-02-15T20:27:38Z",
          "headRef": "fix/signal-group-reaction-deterministic",
          "baseRef": "main",
          "filesChanged": 7,
          "additions": 333,
          "deletions": 4,
          "commits": 4,
          "labels": [
            "channel: signal",
            "size: M"
          ],
          "ciStatus": "failure",
          "hasIssueRef": false,
          "issueNumbers": [],
          "changedFiles": [
            "src/infra/outbound/message-action-runner.threading.test.ts",
            "src/infra/outbound/message-action-runner.ts",
            "src/signal/monitor/event-handler.ts",
            "src/signal/reaction-target-cache.test.ts",
            "src/signal/reaction-target-cache.ts",
            "src/signal/send-reactions.test.ts",
            "src/signal/send-reactions.ts"
          ],
          "diffUrl": "https://github.com/openclaw/openclaw/pull/17453.diff",
          "hasTests": true,
          "testFilesChanged": [
            "src/infra/outbound/message-action-runner.threading.test.ts",
            "src/signal/reaction-target-cache.test.ts",
            "src/signal/send-reactions.test.ts"
          ],
          "ageInDays": 0,
          "mergeable": "mergeable",
          "reviewState": "commented",
          "reviewCount": 2,
          "commentCount": 0,
          "totalScore": 81,
          "signals": [
            {
              "name": "ci_status",
              "score": 10,
              "weight": 0.2,
              "reason": "CI: failure"
            },
            {
              "name": "diff_size",
              "score": 100,
              "weight": 0.1,
              "reason": "337 lines changed (333+/4-)"
            },
            {
              "name": "commit_quality",
              "score": 90,
              "weight": 0.05,
              "reason": "Conventional commit format"
            },
            {
              "name": "contributor",
              "score": 42,
              "weight": 0.15,
              "reason": "akalypse (NONE, rep: 69)"
            },
            {
              "name": "issue_ref",
              "score": 30,
              "weight": 0.1,
              "reason": "No issue reference"
            },
            {
              "name": "spam",
              "score": 75,
              "weight": 0.15,
              "reason": "No issue ref"
            },
            {
              "name": "test_coverage",
              "score": 90,
              "weight": 0.15,
              "reason": "3 test file(s) changed"
            },
            {
              "name": "staleness",
              "score": 100,
              "weight": 0.1,
              "reason": "0d old (Fresh)"
            },
            {
              "name": "mergeability",
              "score": 100,
              "weight": 0.15,
              "reason": "Merge status: mergeable"
            },
            {
              "name": "review_status",
              "score": 70,
              "weight": 0.1,
              "reason": "Review: commented (2 reviews)"
            },
            {
              "name": "body_quality",
              "score": 100,
              "weight": 0.05,
              "reason": "Body: 6395 chars"
            },
            {
              "name": "activity",
              "score": 30,
              "weight": 0.05,
              "reason": "0 comments"
            },
            {
              "name": "breaking_change",
              "score": 80,
              "weight": 0.05,
              "reason": "No breaking change signals"
            }
          ],
          "isSpam": false,
          "spamReasons": [],
          "visionAlignment": "unchecked",
          "llmScore": 90,
          "llmRisk": "low",
          "llmReason": "This PR addresses a real and significant bug affecting Signal group reactions. The description is clear, the changes are well-scoped, and the implementation appears sound with added tests. The risk is low because the changes are mostly internal and focused on improving existing functionality without introducing new external dependencies or API changes. The data access scope change is mitigated by the in-memory cache.",
          "duplicateGroup": 3
        },
        {
          "number": 16562,
          "title": "fix(signal): preserve case for group and username targets",
          "body": "## Summary\r\n\r\n  - Problem: Signal target normalization lowercased group: and username: target values.\r\n  - Why it matters: Case-sensitive identifiers can be mutated, causing misrouting or failed target resolution. In particular, it failed doing emoji reactions on group messages.\r\n  - What changed: normalizeSignalMessagingTarget now preserves value casing for group: and username: while still\r\n    recognizing prefixes.\r\n  - What did NOT change (scope boundary): UUID normalization paths and other channel normalizers remain unchanged.\r\n\r\n  ## Change Type (select all)\r\n\r\n  - [x] Bug fix\r\n  - [ ] Feature\r\n  - [ ] Refactor\r\n  - [ ] Docs\r\n  - [ ] Security hardening\r\n  - [ ] Chore/infra\r\n\r\n  ## Scope (select all touched areas)\r\n\r\n  - [ ] Gateway / orchestration\r\n  - [ ] Skills / tool execution\r\n  - [ ] Auth / tokens\r\n  - [ ] Memory / storage\r\n  - [x] Integrations\r\n  - [ ] API / contracts\r\n  - [ ] UI / DX\r\n  - [ ] CI/CD / infra\r\n\r\n  ## Linked Issue/PR\r\n\r\n  - Closes #\r\n  - Related #\r\n  - If #12793 covers this exact normalization path, I\u2019m happy to close this as duplicate.\r\n\r\n  ## User-visible / Behavior Changes\r\n\r\n  Signal group: and username: target values keep original case after normalization.\r\n  Previously they were lowercased.\r\n\r\n  ## Security Impact (required)\r\n\r\n  - New permissions/capabilities? (No)\r\n  - Secrets/tokens handling changed? (No)\r\n  - New/changed network calls? (No)\r\n  - Command/tool execution surface changed? (No)\r\n  - Data access scope changed? (No)\r\n  - If any Yes, explain risk + mitigation:\r\n\r\n  ## Repro + Verification\r\n\r\n  ### Environment\r\n\r\n  - OS: macOS\r\n  - Runtime/container: local dev runtime\r\n  - Model/provider: N/A\r\n  - Integration/channel (if any): Signal\r\n  - Relevant config (redacted): Signal target values using group: and username: prefixes\r\n\r\n  ### Steps\r\n\r\n  1. Call normalizeSignalMessagingTarget(\"group:AbC123-CaseSensitive\").\r\n  2. Call normalizeSignalMessagingTarget(\"username:MyMixedCaseUser\").\r\n  3. Compare normalized outputs.\r\n\r\n  ### Expected\r\n\r\n  - group:AbC123-CaseSensitive\r\n  - username:MyMixedCaseUser\r\n\r\n  ### Actual\r\n\r\n  - Before fix: values were lowercased.\r\n  - After fix: original case is preserved.\r\n\r\n  ## Evidence\r\n\r\n  Attach at least one:\r\n\r\n  - [x] Failing test/log before + passing after\r\n  - [ ] Trace/log snippets\r\n  - [ ] Screenshot/recording\r\n  - [ ] Perf numbers (if relevant)\r\n\r\n  ## Human Verification (required)\r\n\r\n  - Verified scenarios:\r\n      - Added tests in src/channels/plugins/normalize/signal.test.ts for case preservation.\r\n      - Ran pnpm test -- src/channels/plugins/normalize/signal.test.ts (passing).\r\n  - Edge cases checked:\r\n      - Existing UUID normalization tests still pass.\r\n  - What you did not verify:\r\n      - Full end-to-end Signal daemon flow in production-like environment.\r\n\r\n  ## Compatibility / Migration\r\n\r\n  - Backward compatible? (Yes)\r\n  - Config/env changes? (No)\r\n  - Migration needed? (No)\r\n  - If yes, exact upgrade steps:\r\n\r\n  ## Failure Recovery (if this breaks)\r\n\r\n  - How to disable/revert this change quickly: Revert commit fix(signal): preserve case for group and username targets.\r\n  - Files/config to restore: src/channels/plugins/normalize/signal.ts, src/channels/plugins/normalize/signal.test.ts\r\n  - Known bad symptoms reviewers should watch for:\r\n      - Unexpected lowercasing reappearing for group: or username: targets.\r\n\r\n  ## Risks and Mitigations\r\n\r\n  - Risk: Downstream logic may have implicitly relied on lowercased group:/username: values.\r\n      - Mitigation: Change is narrowly scoped; UUID normalization behavior unchanged; regression tests added.\n\n<!-- greptile_comment -->\n\n<h2>Greptile Overview</h2>\n\n<h3>Greptile Summary</h3>\n\nThis PR fixes a bug where `normalizeSignalMessagingTarget` was lowercasing `group:` and `username:` target values, which broke case-sensitive identifiers (e.g., emoji reactions on group messages). The fix correctly removes `.toLowerCase()` from the `group:` and `username:` normalization paths while keeping UUID normalization unchanged.\n\n- Preserves original casing for `group:` and `username:` prefixed Signal targets\n- Adds two regression tests for case preservation\n- **Issue**: The `u:` shorthand prefix (a shorthand for `username:`) still applies `.toLowerCase()`, creating an inconsistency where `u:MyUser` normalizes to `username:myuser` while `username:MyUser` normalizes to `username:MyUser`. Since downstream routing uses strict equality (`===`) on peer IDs, these would not match each other.\n\n<h3>Confidence Score: 3/5</h3>\n\n- The core fix is correct but the `u:` shorthand path has been left inconsistent, which could cause misrouted messages when the shorthand is used.\n- The `group:` and `username:` fixes are sound and well-tested. However, the `u:` shorthand\u2014which is an alias for `username:`\u2014still lowercases, creating a behavioral inconsistency. This is a functional issue since downstream routing uses strict equality on normalized IDs.\n- `src/channels/plugins/normalize/signal.ts` \u2014 the `u:` prefix handler at lines 22-25 needs the same case-preservation treatment as the `username:` handler.\n\n<sub>Last reviewed commit: 138954e</sub>\n\n<!-- greptile_other_comments_section -->\n\n<sub>(2/5) Greptile learns from your feedback when you react with thumbs up/down!</sub>\n\n<!-- /greptile_comment -->",
          "author": "akalypse",
          "authorAssociation": "NONE",
          "createdAt": "2026-02-14T21:38:36Z",
          "updatedAt": "2026-02-15T20:03:02Z",
          "headRef": "fix/signal-target-normalization-case",
          "baseRef": "main",
          "filesChanged": 2,
          "additions": 24,
          "deletions": 3,
          "commits": 2,
          "labels": [
            "size: XS"
          ],
          "ciStatus": "failure",
          "hasIssueRef": true,
          "issueNumbers": [
            12793
          ],
          "changedFiles": [
            "src/channels/plugins/normalize/signal.test.ts",
            "src/channels/plugins/normalize/signal.ts"
          ],
          "diffUrl": "https://github.com/openclaw/openclaw/pull/16562.diff",
          "hasTests": true,
          "testFilesChanged": [
            "src/channels/plugins/normalize/signal.test.ts"
          ],
          "ageInDays": 0,
          "mergeable": "unknown",
          "reviewState": "commented",
          "reviewCount": 1,
          "commentCount": 2,
          "totalScore": 67,
          "signals": [
            {
              "name": "ci_status",
              "score": 10,
              "weight": 0.2,
              "reason": "CI: failure"
            },
            {
              "name": "diff_size",
              "score": 70,
              "weight": 0.1,
              "reason": "27 lines changed (24+/3-)"
            },
            {
              "name": "commit_quality",
              "score": 90,
              "weight": 0.05,
              "reason": "Conventional commit format"
            },
            {
              "name": "contributor",
              "score": 42,
              "weight": 0.15,
              "reason": "akalypse (NONE, rep: 69)"
            },
            {
              "name": "issue_ref",
              "score": 90,
              "weight": 0.1,
              "reason": "References: #12793"
            },
            {
              "name": "spam",
              "score": 100,
              "weight": 0.15,
              "reason": "No spam signals"
            },
            {
              "name": "test_coverage",
              "score": 90,
              "weight": 0.15,
              "reason": "1 test file(s) changed"
            },
            {
              "name": "staleness",
              "score": 100,
              "weight": 0.1,
              "reason": "0d old (Fresh)"
            },
            {
              "name": "mergeability",
              "score": 50,
              "weight": 0.15,
              "reason": "Merge status: unknown"
            },
            {
              "name": "review_status",
              "score": 60,
              "weight": 0.1,
              "reason": "Review: commented (1 reviews)"
            },
            {
              "name": "body_quality",
              "score": 100,
              "weight": 0.05,
              "reason": "Body: 5296 chars"
            },
            {
              "name": "activity",
              "score": 70,
              "weight": 0.05,
              "reason": "2 comments"
            },
            {
              "name": "breaking_change",
              "score": 80,
              "weight": 0.05,
              "reason": "No breaking change signals"
            }
          ],
          "isSpam": false,
          "spamReasons": [],
          "visionAlignment": "unchecked",
          "duplicateGroup": 3
        }
      ],
      "bestPR": 17453,
      "similarity": 0.8420455099397139,
      "reason": "2 similar PRs (avg similarity: 84.2%)"
    },
    {
      "id": 4,
      "prs": [
        {
          "number": 17473,
          "title": "fix(cache): inject cache_control into system prompt for OpenRouter Anthropic (#15151)",
          "body": "## Summary\n\nFixes #15151. OpenRouter Anthropic users pay full price for re-processing the system prompt (~18k tokens) on every request because no `cache_control` is injected on the system message.\n\n## Root Cause\n\nThe existing OpenRouter integration adds attribution headers (`createOpenRouterHeadersWrapper`) but does not inject Anthropic's `cache_control` field on messages. For direct Anthropic, caching is handled via the `cacheRetention` stream option \u2014 but OpenRouter uses the openai-completions API where caching requires explicit `cache_control` on message content blocks.\n\n## Fix\n\nAdd `createOpenRouterSystemCacheWrapper()` using the same `onPayload` pattern as `createOpenAIResponsesStoreWrapper()`:\n\n```ts\nonPayload: (payload) => {\n    for (const msg of messages) {\n        if (msg.role !== \"system\" && msg.role !== \"developer\") continue;\n        if (typeof msg.content === \"string\") {\n            msg.content = [\n                { type: \"text\", text: msg.content, cache_control: { type: \"ephemeral\" } },\n            ];\n        } else if (Array.isArray(msg.content)) {\n            last.cache_control = { type: \"ephemeral\" };\n        }\n    }\n};\n```\n\nOnly applies to `openrouter` provider with `anthropic/*` model IDs. One new wrapper, no new dependencies.\n\n## Test plan\n\n- [x] String system content converted to array with `cache_control`\n- [x] Array system content gets `cache_control` on last block only\n- [x] Non-Anthropic OpenRouter models not affected\n- [x] User messages not modified\n\n*AI-assisted (Claude). Reviewed by human.*",
          "author": "rrenamed",
          "authorAssociation": "NONE",
          "createdAt": "2026-02-15T19:57:26Z",
          "updatedAt": "2026-02-15T20:16:42Z",
          "headRef": "fix/openrouter-system-prompt-cache",
          "baseRef": "main",
          "filesChanged": 2,
          "additions": 151,
          "deletions": 0,
          "commits": 1,
          "labels": [
            "agents",
            "size: S"
          ],
          "ciStatus": "failure",
          "hasIssueRef": true,
          "issueNumbers": [
            15151
          ],
          "changedFiles": [
            "src/agents/pi-embedded-runner-extraparams.e2e.test.ts",
            "src/agents/pi-embedded-runner/extra-params.ts"
          ],
          "diffUrl": "https://github.com/openclaw/openclaw/pull/17473.diff",
          "hasTests": true,
          "testFilesChanged": [
            "src/agents/pi-embedded-runner-extraparams.e2e.test.ts"
          ],
          "ageInDays": 0,
          "mergeable": "mergeable",
          "reviewState": "none",
          "reviewCount": 0,
          "commentCount": 0,
          "totalScore": 83,
          "signals": [
            {
              "name": "ci_status",
              "score": 10,
              "weight": 0.2,
              "reason": "CI: failure"
            },
            {
              "name": "diff_size",
              "score": 100,
              "weight": 0.1,
              "reason": "151 lines changed (151+/0-)"
            },
            {
              "name": "commit_quality",
              "score": 90,
              "weight": 0.05,
              "reason": "Conventional commit format"
            },
            {
              "name": "contributor",
              "score": 44,
              "weight": 0.15,
              "reason": "rrenamed (NONE, rep: 75)"
            },
            {
              "name": "issue_ref",
              "score": 90,
              "weight": 0.1,
              "reason": "References: #15151"
            },
            {
              "name": "spam",
              "score": 100,
              "weight": 0.15,
              "reason": "No spam signals"
            },
            {
              "name": "test_coverage",
              "score": 90,
              "weight": 0.15,
              "reason": "1 test file(s) changed"
            },
            {
              "name": "staleness",
              "score": 100,
              "weight": 0.1,
              "reason": "0d old (Fresh)"
            },
            {
              "name": "mergeability",
              "score": 100,
              "weight": 0.15,
              "reason": "Merge status: mergeable"
            },
            {
              "name": "review_status",
              "score": 40,
              "weight": 0.1,
              "reason": "Review: none (0 reviews)"
            },
            {
              "name": "body_quality",
              "score": 100,
              "weight": 0.05,
              "reason": "Body: 1542 chars"
            },
            {
              "name": "activity",
              "score": 30,
              "weight": 0.05,
              "reason": "0 comments"
            },
            {
              "name": "breaking_change",
              "score": 80,
              "weight": 0.05,
              "reason": "No breaking change signals"
            }
          ],
          "isSpam": false,
          "spamReasons": [],
          "visionAlignment": "unchecked",
          "llmScore": 90,
          "llmRisk": "low",
          "llmReason": "This PR addresses a real and significant performance issue for OpenRouter Anthropic users by enabling caching of the system prompt. The implementation appears correct and targeted, with tests covering the key scenarios. The risk is low because the changes are isolated to the OpenRouter integration and include checks to avoid unintended side effects on other models or message types. The provided code snippet and explanation are clear and concise.",
          "duplicateGroup": 4
        },
        {
          "number": 17470,
          "title": "feat(cache): per-agent params for cacheRetention control (#17112)",
          "body": "## Summary\n\nFixes #17112. No way to set `cacheRetention` per-agent. Low-traffic agents (e.g., cron jobs running every 30 min) waste money on cache writes ($1.25/MTok) that expire before the next request.\n\n## Root Cause\n\n`resolveExtraParams()` only reads from global model defaults (`agents.defaults.models[\"provider/model\"].params`). There is no per-agent override \u2014 all agents sharing the same model get identical cache settings.\n\n## Fix\n\nAdd optional `params` field to `AgentConfig` and resolve it in `resolveExtraParams()`:\n\n```ts\n// types.agents.ts\nexport type AgentConfig = {\n  // ...existing fields...\n  params?: Record<string, unknown>;\n};\n```\n\n```ts\n// extra-params.ts \u2014 resolveExtraParams now accepts agentId\nconst agentConfig = cfg?.agents?.list?.find((a) => a.id === params.agentId);\nreturn Object.assign({}, globalParams, agentConfig?.params);\n```\n\nAgent params merge on top of global model defaults. Three files changed, no new dependencies.\n\n**Config example:**\n```json\n{\n  \"agents\": {\n    \"list\": [{\n      \"id\": \"risk-reviewer\",\n      \"params\": { \"cacheRetention\": \"none\" }\n    }]\n  }\n}\n```\n\n## Test plan\n\n- [x] Per-agent params returned when agentId matches\n- [x] Agent params merge over global model defaults (agent wins)\n- [x] Unmatched agentId returns undefined (no side effects)\n\n*AI-assisted (Claude). Reviewed by human.*",
          "author": "rrenamed",
          "authorAssociation": "NONE",
          "createdAt": "2026-02-15T19:54:37Z",
          "updatedAt": "2026-02-15T20:16:20Z",
          "headRef": "feat/per-agent-cache-retention",
          "baseRef": "main",
          "filesChanged": 4,
          "additions": 97,
          "deletions": 1,
          "commits": 1,
          "labels": [
            "agents",
            "size: S"
          ],
          "ciStatus": "failure",
          "hasIssueRef": true,
          "issueNumbers": [
            17112
          ],
          "changedFiles": [
            "src/agents/pi-embedded-runner-extraparams.e2e.test.ts",
            "src/agents/pi-embedded-runner/extra-params.ts",
            "src/agents/pi-embedded-runner/run/attempt.ts",
            "src/config/types.agents.ts"
          ],
          "diffUrl": "https://github.com/openclaw/openclaw/pull/17470.diff",
          "hasTests": true,
          "testFilesChanged": [
            "src/agents/pi-embedded-runner-extraparams.e2e.test.ts"
          ],
          "ageInDays": 0,
          "mergeable": "mergeable",
          "reviewState": "none",
          "reviewCount": 0,
          "commentCount": 0,
          "totalScore": 83,
          "signals": [
            {
              "name": "ci_status",
              "score": 10,
              "weight": 0.2,
              "reason": "CI: failure"
            },
            {
              "name": "diff_size",
              "score": 100,
              "weight": 0.1,
              "reason": "98 lines changed (97+/1-)"
            },
            {
              "name": "commit_quality",
              "score": 90,
              "weight": 0.05,
              "reason": "Conventional commit format"
            },
            {
              "name": "contributor",
              "score": 44,
              "weight": 0.15,
              "reason": "rrenamed (NONE, rep: 75)"
            },
            {
              "name": "issue_ref",
              "score": 90,
              "weight": 0.1,
              "reason": "References: #17112"
            },
            {
              "name": "spam",
              "score": 100,
              "weight": 0.15,
              "reason": "No spam signals"
            },
            {
              "name": "test_coverage",
              "score": 90,
              "weight": 0.15,
              "reason": "1 test file(s) changed"
            },
            {
              "name": "staleness",
              "score": 100,
              "weight": 0.1,
              "reason": "0d old (Fresh)"
            },
            {
              "name": "mergeability",
              "score": 100,
              "weight": 0.15,
              "reason": "Merge status: mergeable"
            },
            {
              "name": "review_status",
              "score": 40,
              "weight": 0.1,
              "reason": "Review: none (0 reviews)"
            },
            {
              "name": "body_quality",
              "score": 100,
              "weight": 0.05,
              "reason": "Body: 1342 chars"
            },
            {
              "name": "activity",
              "score": 30,
              "weight": 0.05,
              "reason": "0 comments"
            },
            {
              "name": "breaking_change",
              "score": 80,
              "weight": 0.05,
              "reason": "No breaking change signals"
            }
          ],
          "isSpam": false,
          "spamReasons": [],
          "visionAlignment": "unchecked",
          "llmScore": 90,
          "llmRisk": "low",
          "llmReason": "Solves a real problem (unnecessary cache writes for low-traffic agents). Implementation seems correct and complete, with tests covering the key scenarios. The change is relatively small and well-explained. Merging this would improve the project by allowing more granular control over caching behavior and potentially saving money.",
          "duplicateGroup": 4
        },
        {
          "number": 17462,
          "title": "fix(cache): enable cache retention for Google Vertex AI (#15525)",
          "body": "## Summary\n\nFixes #15525. Vertex AI users get no prompt caching because `resolveCacheRetention()` only checks `provider === \"anthropic\"` and `isCacheTtlEligibleProvider()` excludes `google-vertex`. Since Vertex AI uses the Anthropic Messages API natively, it supports the same `cacheRetention` stream option.\n\n## Root Cause\n\nIn `extra-params.ts`, the provider guard rejects everything except `\"anthropic\"`:\n\n```ts\nif (provider !== \"anthropic\") {\n    return undefined;\n}\n```\n\nIn `cache-ttl.ts`, the eligibility check only allows `\"anthropic\"` and `\"openrouter\"` with anthropic models:\n\n```ts\nif (normalizedProvider === \"anthropic\") {\n    return true;\n}\n```\n\n## Fix\n\nAdd `google-vertex` to both provider checks:\n\n```ts\nif (provider !== \"anthropic\" && provider !== \"google-vertex\") {\n```\n\n```ts\nif (normalizedProvider === \"anthropic\" || normalizedProvider === \"google-vertex\") {\n```\n\nTwo-line change across two files. No new dependencies.\n\n## Test plan\n\n- [x] e2e test: `cacheRetention` applied for `google-vertex` provider\n- [x] e2e test: `cacheRetention` NOT applied for non-Anthropic providers\n- [x] Unit tests for `isCacheTtlEligibleProvider` covering all providers + case insensitivity\n\n*AI-assisted (Claude). Reviewed by human.*",
          "author": "rrenamed",
          "authorAssociation": "NONE",
          "createdAt": "2026-02-15T19:50:04Z",
          "updatedAt": "2026-02-15T20:16:01Z",
          "headRef": "fix/vertex-ai-cache-retention",
          "baseRef": "main",
          "filesChanged": 3,
          "additions": 112,
          "deletions": 4,
          "commits": 1,
          "labels": [
            "agents",
            "size: S"
          ],
          "ciStatus": "failure",
          "hasIssueRef": true,
          "issueNumbers": [
            15525
          ],
          "changedFiles": [
            "src/agents/pi-embedded-runner-extraparams.e2e.test.ts",
            "src/agents/pi-embedded-runner/cache-ttl.ts",
            "src/agents/pi-embedded-runner/extra-params.ts"
          ],
          "diffUrl": "https://github.com/openclaw/openclaw/pull/17462.diff",
          "hasTests": true,
          "testFilesChanged": [
            "src/agents/pi-embedded-runner-extraparams.e2e.test.ts"
          ],
          "ageInDays": 0,
          "mergeable": "mergeable",
          "reviewState": "none",
          "reviewCount": 0,
          "commentCount": 0,
          "totalScore": 86,
          "signals": [
            {
              "name": "ci_status",
              "score": 10,
              "weight": 0.2,
              "reason": "CI: failure"
            },
            {
              "name": "diff_size",
              "score": 100,
              "weight": 0.1,
              "reason": "116 lines changed (112+/4-)"
            },
            {
              "name": "commit_quality",
              "score": 90,
              "weight": 0.05,
              "reason": "Conventional commit format"
            },
            {
              "name": "contributor",
              "score": 44,
              "weight": 0.15,
              "reason": "rrenamed (NONE, rep: 75)"
            },
            {
              "name": "issue_ref",
              "score": 90,
              "weight": 0.1,
              "reason": "References: #15525"
            },
            {
              "name": "spam",
              "score": 100,
              "weight": 0.15,
              "reason": "No spam signals"
            },
            {
              "name": "test_coverage",
              "score": 90,
              "weight": 0.15,
              "reason": "1 test file(s) changed"
            },
            {
              "name": "staleness",
              "score": 100,
              "weight": 0.1,
              "reason": "0d old (Fresh)"
            },
            {
              "name": "mergeability",
              "score": 100,
              "weight": 0.15,
              "reason": "Merge status: mergeable"
            },
            {
              "name": "review_status",
              "score": 40,
              "weight": 0.1,
              "reason": "Review: none (0 reviews)"
            },
            {
              "name": "body_quality",
              "score": 100,
              "weight": 0.05,
              "reason": "Body: 1231 chars"
            },
            {
              "name": "activity",
              "score": 30,
              "weight": 0.05,
              "reason": "0 comments"
            },
            {
              "name": "breaking_change",
              "score": 80,
              "weight": 0.05,
              "reason": "No breaking change signals"
            }
          ],
          "isSpam": false,
          "spamReasons": [],
          "visionAlignment": "unchecked",
          "llmScore": 95,
          "llmRisk": "low",
          "llmReason": "This PR addresses a clear bug preventing cache retention for Google Vertex AI, which should be supported. The fix is small, targeted, and includes comprehensive testing (e2e and unit). The description clearly explains the problem, root cause, and solution. The tests cover both positive and negative cases, increasing confidence in the fix. The AI assistance is acknowledged, and human review is confirmed.",
          "duplicateGroup": 4
        }
      ],
      "bestPR": 17462,
      "similarity": 0.8333274696097295,
      "reason": "3 similar PRs (avg similarity: 83.3%)"
    }
  ],
  "rankedPRs": [
    {
      "number": 17517,
      "title": "fix(browser): catch unhandled promise rejection in dialog handling",
      "body": "# Fix: Unhandled Promise Rejection in Browser Dialog Handler\r\n\r\nFixes #17499\r\n\r\n## Summary\r\nThis PR fixes an issue where `armDialogViaPlaywright` would throw an unhandled promise rejection if the dialog was closed (e.g. via navigation or auto-dismissal) before `dialog.accept()` or `dialog.dismiss()` could be called.\r\n\r\nThe fix wraps the `dialog.accept()`/`dismiss()` calls in a `try/catch` block to suppress errors when the dialog is no longer available, which is the expected behavior (best-effort handling).\r\n\r\n## Changes\r\n- Modified `src/browser/pw-tools-core.downloads.ts` to catch errors during dialog interaction.\r\n- Added regression test `src/browser/pw-tools-core.dialog-errors.test.ts` to verify that `accept`/`dismiss` errors are gracefully handled.\r\n\r\n## Verification\r\n- Ran new regression test: `npm run test:fast -- src/browser/pw-tools-core.dialog-errors.test.ts` (Passed)\r\n- Ran existing tests: `npm run test:fast -- src/browser/pw-tools-core.last-file-chooser-arm-wins.test.ts` (Passed)\n\n<!-- greptile_comment -->\n\n<h3>Greptile Summary</h3>\n\nAdded try/catch around `dialog.accept()`/`dialog.dismiss()` calls in `armDialogViaPlaywright` to prevent unhandled promise rejections when dialogs close before interaction. This follows the existing best-effort pattern used elsewhere in the file (e.g., `armFileUploadViaPlaywright:127-130`).\n\n- Wraps dialog interactions in try/catch block to suppress errors when dialog is no longer available\n- Adds regression tests verifying both `accept` and `dismiss` errors are gracefully handled\n- Maintains the existing \"fire-and-forget\" behavior where dialog arming is best-effort\n\n<h3>Confidence Score: 5/5</h3>\n\n- Safe to merge with no risk\n- Simple defensive fix with comprehensive tests; follows existing codebase patterns for best-effort error handling\n- No files require special attention\n\n<sub>Last reviewed commit: 69cebdc</sub>\n\n<!-- greptile_other_comments_section -->\n\n<!-- /greptile_comment -->",
      "author": "shadril238",
      "authorAssociation": "CONTRIBUTOR",
      "createdAt": "2026-02-15T21:01:37Z",
      "updatedAt": "2026-02-15T21:06:02Z",
      "headRef": "fix/dialog-rejection",
      "baseRef": "main",
      "filesChanged": 2,
      "additions": 68,
      "deletions": 4,
      "commits": 2,
      "labels": [
        "size: S",
        "trusted-contributor"
      ],
      "ciStatus": "failure",
      "hasIssueRef": true,
      "issueNumbers": [
        17499
      ],
      "changedFiles": [
        "src/browser/pw-tools-core.dialog-errors.test.ts",
        "src/browser/pw-tools-core.downloads.ts"
      ],
      "diffUrl": "https://github.com/openclaw/openclaw/pull/17517.diff",
      "hasTests": true,
      "testFilesChanged": [
        "src/browser/pw-tools-core.dialog-errors.test.ts"
      ],
      "ageInDays": 0,
      "mergeable": "mergeable",
      "reviewState": "none",
      "reviewCount": 0,
      "commentCount": 0,
      "totalScore": 87,
      "signals": [
        {
          "name": "ci_status",
          "score": 10,
          "weight": 0.2,
          "reason": "CI: failure"
        },
        {
          "name": "diff_size",
          "score": 100,
          "weight": 0.1,
          "reason": "72 lines changed (68+/4-)"
        },
        {
          "name": "commit_quality",
          "score": 90,
          "weight": 0.05,
          "reason": "Conventional commit format"
        },
        {
          "name": "contributor",
          "score": 79,
          "weight": 0.15,
          "reason": "shadril238 (CONTRIBUTOR, rep: 100)"
        },
        {
          "name": "issue_ref",
          "score": 90,
          "weight": 0.1,
          "reason": "References: #17499"
        },
        {
          "name": "spam",
          "score": 100,
          "weight": 0.15,
          "reason": "No spam signals"
        },
        {
          "name": "test_coverage",
          "score": 90,
          "weight": 0.15,
          "reason": "1 test file(s) changed"
        },
        {
          "name": "staleness",
          "score": 100,
          "weight": 0.1,
          "reason": "0d old (Fresh)"
        },
        {
          "name": "mergeability",
          "score": 100,
          "weight": 0.15,
          "reason": "Merge status: mergeable"
        },
        {
          "name": "review_status",
          "score": 40,
          "weight": 0.1,
          "reason": "Review: none (0 reviews)"
        },
        {
          "name": "body_quality",
          "score": 90,
          "weight": 0.05,
          "reason": "Body: 1958 chars"
        },
        {
          "name": "activity",
          "score": 30,
          "weight": 0.05,
          "reason": "0 comments"
        },
        {
          "name": "breaking_change",
          "score": 80,
          "weight": 0.05,
          "reason": "No breaking change signals"
        }
      ],
      "isSpam": false,
      "spamReasons": [],
      "visionAlignment": "unchecked",
      "llmScore": 95,
      "llmRisk": "low",
      "llmReason": "This PR addresses a real issue (unhandled promise rejection) with a simple and effective fix. The implementation is correct, complete, and includes a regression test to prevent future occurrences. The Greptile summary confirms the safety and correctness of the changes. Merging this PR would improve the project by preventing noisy error logs and improving overall stability.",
      "duplicateGroup": 0
    },
    {
      "number": 17462,
      "title": "fix(cache): enable cache retention for Google Vertex AI (#15525)",
      "body": "## Summary\n\nFixes #15525. Vertex AI users get no prompt caching because `resolveCacheRetention()` only checks `provider === \"anthropic\"` and `isCacheTtlEligibleProvider()` excludes `google-vertex`. Since Vertex AI uses the Anthropic Messages API natively, it supports the same `cacheRetention` stream option.\n\n## Root Cause\n\nIn `extra-params.ts`, the provider guard rejects everything except `\"anthropic\"`:\n\n```ts\nif (provider !== \"anthropic\") {\n    return undefined;\n}\n```\n\nIn `cache-ttl.ts`, the eligibility check only allows `\"anthropic\"` and `\"openrouter\"` with anthropic models:\n\n```ts\nif (normalizedProvider === \"anthropic\") {\n    return true;\n}\n```\n\n## Fix\n\nAdd `google-vertex` to both provider checks:\n\n```ts\nif (provider !== \"anthropic\" && provider !== \"google-vertex\") {\n```\n\n```ts\nif (normalizedProvider === \"anthropic\" || normalizedProvider === \"google-vertex\") {\n```\n\nTwo-line change across two files. No new dependencies.\n\n## Test plan\n\n- [x] e2e test: `cacheRetention` applied for `google-vertex` provider\n- [x] e2e test: `cacheRetention` NOT applied for non-Anthropic providers\n- [x] Unit tests for `isCacheTtlEligibleProvider` covering all providers + case insensitivity\n\n*AI-assisted (Claude). Reviewed by human.*",
      "author": "rrenamed",
      "authorAssociation": "NONE",
      "createdAt": "2026-02-15T19:50:04Z",
      "updatedAt": "2026-02-15T20:16:01Z",
      "headRef": "fix/vertex-ai-cache-retention",
      "baseRef": "main",
      "filesChanged": 3,
      "additions": 112,
      "deletions": 4,
      "commits": 1,
      "labels": [
        "agents",
        "size: S"
      ],
      "ciStatus": "failure",
      "hasIssueRef": true,
      "issueNumbers": [
        15525
      ],
      "changedFiles": [
        "src/agents/pi-embedded-runner-extraparams.e2e.test.ts",
        "src/agents/pi-embedded-runner/cache-ttl.ts",
        "src/agents/pi-embedded-runner/extra-params.ts"
      ],
      "diffUrl": "https://github.com/openclaw/openclaw/pull/17462.diff",
      "hasTests": true,
      "testFilesChanged": [
        "src/agents/pi-embedded-runner-extraparams.e2e.test.ts"
      ],
      "ageInDays": 0,
      "mergeable": "mergeable",
      "reviewState": "none",
      "reviewCount": 0,
      "commentCount": 0,
      "totalScore": 86,
      "signals": [
        {
          "name": "ci_status",
          "score": 10,
          "weight": 0.2,
          "reason": "CI: failure"
        },
        {
          "name": "diff_size",
          "score": 100,
          "weight": 0.1,
          "reason": "116 lines changed (112+/4-)"
        },
        {
          "name": "commit_quality",
          "score": 90,
          "weight": 0.05,
          "reason": "Conventional commit format"
        },
        {
          "name": "contributor",
          "score": 44,
          "weight": 0.15,
          "reason": "rrenamed (NONE, rep: 75)"
        },
        {
          "name": "issue_ref",
          "score": 90,
          "weight": 0.1,
          "reason": "References: #15525"
        },
        {
          "name": "spam",
          "score": 100,
          "weight": 0.15,
          "reason": "No spam signals"
        },
        {
          "name": "test_coverage",
          "score": 90,
          "weight": 0.15,
          "reason": "1 test file(s) changed"
        },
        {
          "name": "staleness",
          "score": 100,
          "weight": 0.1,
          "reason": "0d old (Fresh)"
        },
        {
          "name": "mergeability",
          "score": 100,
          "weight": 0.15,
          "reason": "Merge status: mergeable"
        },
        {
          "name": "review_status",
          "score": 40,
          "weight": 0.1,
          "reason": "Review: none (0 reviews)"
        },
        {
          "name": "body_quality",
          "score": 100,
          "weight": 0.05,
          "reason": "Body: 1231 chars"
        },
        {
          "name": "activity",
          "score": 30,
          "weight": 0.05,
          "reason": "0 comments"
        },
        {
          "name": "breaking_change",
          "score": 80,
          "weight": 0.05,
          "reason": "No breaking change signals"
        }
      ],
      "isSpam": false,
      "spamReasons": [],
      "visionAlignment": "unchecked",
      "llmScore": 95,
      "llmRisk": "low",
      "llmReason": "This PR addresses a clear bug preventing cache retention for Google Vertex AI, which should be supported. The fix is small, targeted, and includes comprehensive testing (e2e and unit). The description clearly explains the problem, root cause, and solution. The tests cover both positive and negative cases, increasing confidence in the fix. The AI assistance is acknowledged, and human review is confirmed.",
      "duplicateGroup": 4
    },
    {
      "number": 17463,
      "title": "fix: write config files with explicit 0o600 mode instead of post-write chmod",
      "body": "Closes #17440\n\n## Changes\n\n### Problem\nConfig files containing API keys/secrets were written with default umask permissions, then `chmod 0o600` was called separately. This created:\n1. A race window where secrets could be world-readable between write and chmod\n2. Silent failures when chmod failed (errors were swallowed with empty `.catch(() => {})`)\n\n### Fix\n- **`src/infra/json-file.ts`**: Pass `{ mode: 0o600 }` directly to `writeFileSync` so files are created with correct permissions atomically. Keep `chmodSync` as best-effort fallback for pre-existing files whose permissions drifted.\n- **`src/config/io.ts`**: Replace silent `.catch(() => {})` with a warning log when chmod fails in the Windows rename-fallback path.\n- **`src/infra/tls/gateway.ts`**: Replace silent `.catch(() => {})` with warning logs when TLS key/cert chmod fails. Added `warn` to the log type signature.\n\n### Tests\n- Added `src/infra/json-file.test.ts` \u2014 verifies 0o600 permissions, JSON content, overwrite behavior, and parent dir creation (0o700).\n- Added `src/config/io.permissions.test.ts` \u2014 verifies writeConfigFile creates files with 0o600 and logs warnings on chmod failure (mocked fs).\n\n<!-- greptile_comment -->\n\n<h3>Greptile Summary</h3>\n\nEliminated race condition where config files with secrets were written with default umask permissions before being secured with `chmod`. The fix passes `mode: 0o600` directly to `writeFileSync` so files are created atomically with correct permissions.\n\n**Key improvements:**\n- `src/infra/json-file.ts`: atomically creates files with 0o600 via `writeFileSync` options; keeps `chmodSync` fallback for pre-existing files\n- `src/config/io.ts`: replaces silent `.catch(() => {})` with warning logs when chmod fails in Windows copyFile fallback path\n- `src/infra/tls/gateway.ts`: replaces silent catches with warning logs for TLS key/cert chmod failures; adds `warn` to log signature\n- Comprehensive test coverage verifies 0o600 permissions and warning logs\n\n**Issue found:**\n- TLS gateway still has a race window between `openssl` creating key/cert files and `chmod` securing them (see inline comment)\n\n<h3>Confidence Score: 4/5</h3>\n\n- Safe to merge with one remaining race condition in TLS key generation that should be addressed in follow-up\n- The PR successfully fixes the primary race condition in config file writes and adds proper error visibility. Tests thoroughly verify the fix. The remaining TLS race condition is a pre-existing pattern that wasn't the focus of this PR, but should be addressed separately\n- Pay attention to `src/infra/tls/gateway.ts` - the openssl race condition should be fixed in a follow-up PR\n\n<sub>Last reviewed commit: 5fdaa95</sub>\n\n<!-- greptile_other_comments_section -->\n\n<sub>(3/5) Reply to the agent's comments like \"Can you suggest a fix for this @greptileai?\" or ask follow-up questions!</sub>\n\n<!-- /greptile_comment -->",
      "author": "miclaldogan",
      "authorAssociation": "NONE",
      "createdAt": "2026-02-15T19:51:10Z",
      "updatedAt": "2026-02-15T20:15:31Z",
      "headRef": "fix/config-file-permissions-17440",
      "baseRef": "main",
      "filesChanged": 5,
      "additions": 177,
      "deletions": 7,
      "commits": 2,
      "labels": [
        "size: S"
      ],
      "ciStatus": "failure",
      "hasIssueRef": true,
      "issueNumbers": [
        17440
      ],
      "changedFiles": [
        "src/config/io.permissions.test.ts",
        "src/config/io.ts",
        "src/infra/json-file.test.ts",
        "src/infra/json-file.ts",
        "src/infra/tls/gateway.ts"
      ],
      "diffUrl": "https://github.com/openclaw/openclaw/pull/17463.diff",
      "hasTests": true,
      "testFilesChanged": [
        "src/config/io.permissions.test.ts",
        "src/infra/json-file.test.ts"
      ],
      "ageInDays": 0,
      "mergeable": "mergeable",
      "reviewState": "commented",
      "reviewCount": 1,
      "commentCount": 1,
      "totalScore": 86,
      "signals": [
        {
          "name": "ci_status",
          "score": 10,
          "weight": 0.2,
          "reason": "CI: failure"
        },
        {
          "name": "diff_size",
          "score": 100,
          "weight": 0.1,
          "reason": "184 lines changed (177+/7-)"
        },
        {
          "name": "commit_quality",
          "score": 90,
          "weight": 0.05,
          "reason": "Conventional commit format"
        },
        {
          "name": "contributor",
          "score": 41,
          "weight": 0.15,
          "reason": "miclaldogan (NONE, rep: 65)"
        },
        {
          "name": "issue_ref",
          "score": 90,
          "weight": 0.1,
          "reason": "References: #17440"
        },
        {
          "name": "spam",
          "score": 100,
          "weight": 0.15,
          "reason": "No spam signals"
        },
        {
          "name": "test_coverage",
          "score": 90,
          "weight": 0.15,
          "reason": "2 test file(s) changed"
        },
        {
          "name": "staleness",
          "score": 100,
          "weight": 0.1,
          "reason": "0d old (Fresh)"
        },
        {
          "name": "mergeability",
          "score": 100,
          "weight": 0.15,
          "reason": "Merge status: mergeable"
        },
        {
          "name": "review_status",
          "score": 60,
          "weight": 0.1,
          "reason": "Review: commented (1 reviews)"
        },
        {
          "name": "body_quality",
          "score": 90,
          "weight": 0.05,
          "reason": "Body: 2886 chars"
        },
        {
          "name": "activity",
          "score": 50,
          "weight": 0.05,
          "reason": "1 comments"
        },
        {
          "name": "breaking_change",
          "score": 80,
          "weight": 0.05,
          "reason": "No breaking change signals"
        }
      ],
      "isSpam": false,
      "spamReasons": [],
      "visionAlignment": "unchecked",
      "llmScore": 95,
      "llmRisk": "low",
      "llmReason": "This PR addresses a critical security vulnerability (race condition exposing secrets) with a well-reasoned and tested solution. The changes are focused, the tests are comprehensive, and the error handling is improved. The fallback chmod is a good safety net. The risk is low because the changes are localized and the tests provide good coverage."
    },
    {
      "number": 17497,
      "title": "ci(formal): skip informational PR comment on forked PRs",
      "body": "## Summary\n- guard the `Comment on PR (informational)` step in `.github/workflows/formal-conformance.yml`\n- run the comment step only when `github.event.pull_request.head.repo.full_name == github.repository`\n\n## Why\nFork PRs often have restricted token permissions, so posting PR comments from workflow can fail with:\n\n- `Resource not accessible by integration` (HTTP 403)\n\nThis currently marks `formal_conformance` as failed even though the check is informational.\n\n## Effect\n- same drift detection + artifact upload behavior\n- no failing comment-post step on fork PRs\n- preserves comment behavior for same-repo PRs\n\nRelated context: #16761\n\n<!-- greptile_comment -->\n\n<h3>Greptile Summary</h3>\n\nAdds a fork-guard to the \"Comment on PR (informational)\" step in the formal conformance workflow. The step now only posts a PR comment when the PR originates from the same repository, preventing 403 errors (`Resource not accessible by integration`) on fork PRs where the `GITHUB_TOKEN` lacks `pull-requests: write` scope.\n\n- Appends `&& github.event.pull_request.head.repo.full_name == github.repository` to the existing `if` condition on line 110\n- Drift detection, model checks, artifact upload, and the summary step remain unchanged\n- Uses the standard GitHub Actions idiom for fork detection\n\n<h3>Confidence Score: 5/5</h3>\n\n- This PR is safe to merge \u2014 it adds a standard, well-understood fork-guard condition to a single CI step.\n- The change is a one-line addition of a standard GitHub Actions fork-detection condition. It only affects when a PR comment is posted, with no impact on the actual conformance checks, artifact uploads, or other workflow behavior. The pattern is idiomatic and widely used in open-source GitHub Actions workflows.\n- No files require special attention.\n\n<sub>Last reviewed commit: 8eb4c7b</sub>\n\n<!-- greptile_other_comments_section -->\n\n<sub>(4/5) You can add custom instructions or style guidelines for the agent [here](https://app.greptile.com/review/github)!</sub>\n\n<!-- /greptile_comment -->",
      "author": "napetrov",
      "authorAssociation": "CONTRIBUTOR",
      "createdAt": "2026-02-15T20:33:13Z",
      "updatedAt": "2026-02-15T20:39:39Z",
      "headRef": "napetrov/fix-formal-conformance-fork-comment",
      "baseRef": "main",
      "filesChanged": 1,
      "additions": 1,
      "deletions": 1,
      "commits": 1,
      "labels": [
        "size: XS"
      ],
      "ciStatus": "pending",
      "hasIssueRef": true,
      "issueNumbers": [
        16761
      ],
      "changedFiles": [
        ".github/workflows/formal-conformance.yml"
      ],
      "diffUrl": "https://github.com/openclaw/openclaw/pull/17497.diff",
      "hasTests": false,
      "testFilesChanged": [],
      "ageInDays": 0,
      "mergeable": "mergeable",
      "reviewState": "none",
      "reviewCount": 0,
      "commentCount": 0,
      "totalScore": 85,
      "signals": [
        {
          "name": "ci_status",
          "score": 50,
          "weight": 0.2,
          "reason": "CI: pending"
        },
        {
          "name": "diff_size",
          "score": 20,
          "weight": 0.1,
          "reason": "2 lines changed (1+/1-)"
        },
        {
          "name": "commit_quality",
          "score": 90,
          "weight": 0.05,
          "reason": "Conventional commit format"
        },
        {
          "name": "contributor",
          "score": 79,
          "weight": 0.15,
          "reason": "napetrov (CONTRIBUTOR, rep: 100)"
        },
        {
          "name": "issue_ref",
          "score": 90,
          "weight": 0.1,
          "reason": "References: #16761"
        },
        {
          "name": "spam",
          "score": 75,
          "weight": 0.15,
          "reason": "<3 lines, contributor bonus -1"
        },
        {
          "name": "test_coverage",
          "score": 60,
          "weight": 0.15,
          "reason": "Docs/config PR \u2014 tests not expected"
        },
        {
          "name": "staleness",
          "score": 100,
          "weight": 0.1,
          "reason": "0d old (Fresh)"
        },
        {
          "name": "mergeability",
          "score": 100,
          "weight": 0.15,
          "reason": "Merge status: mergeable"
        },
        {
          "name": "review_status",
          "score": 40,
          "weight": 0.1,
          "reason": "Review: none (0 reviews)"
        },
        {
          "name": "body_quality",
          "score": 90,
          "weight": 0.05,
          "reason": "Body: 2027 chars"
        },
        {
          "name": "activity",
          "score": 30,
          "weight": 0.05,
          "reason": "0 comments"
        },
        {
          "name": "breaking_change",
          "score": 80,
          "weight": 0.05,
          "reason": "No breaking change signals"
        }
      ],
      "isSpam": false,
      "spamReasons": [],
      "visionAlignment": "unchecked",
      "llmScore": 95,
      "llmRisk": "low",
      "llmReason": "This PR effectively addresses a real problem: failing CI checks due to insufficient permissions when posting comments on PRs from forks. The implementation is straightforward and correct, using a standard GitHub Actions idiom for fork detection. Merging this PR would improve the project by preventing unnecessary CI failures and improving the overall developer experience.",
      "duplicateGroup": 2
    },
    {
      "number": 17518,
      "title": "fix(browser): catch dialog accept/dismiss errors after page navigation",
      "body": "## Summary\n\nFixes #17499\n\nWhen a page navigates or a dialog auto-dismisses before the Playwright dialog handler fires, `dialog.accept()`/`dialog.dismiss()` throws a `Protocol error (Page.handleJavaScriptDialog): No dialog is showing`.\n\nThe existing `.catch()` on the promise chain only handles `waitForEvent` timeouts. Errors thrown inside the `.then()` callback (from `accept()`/`dismiss()`) create a new rejected promise that propagates as an unhandled rejection.\n\n## Fix\n\nWrap `dialog.accept()`/`dialog.dismiss()` in a `try-catch` inside the `.then()` callback. The error is silently caught since the dialog being gone is a benign race condition.\n\n## Testing\n\n- Lint passes (oxlint, 0 warnings/errors)\n- The change is a defensive catch around an existing code path \u2014 no behavior change when the dialog is present\n\n<!-- greptile_comment -->\n\n<h3>Greptile Summary</h3>\n\nWraps `dialog.accept()` and `dialog.dismiss()` in a try-catch block to handle race conditions where the dialog is dismissed or the page navigates before Playwright's dialog handler fires. The existing `.catch()` only handled `waitForEvent` timeouts, not errors thrown inside the `.then()` callback.\n\n<h3>Confidence Score: 5/5</h3>\n\n- This PR is safe to merge with minimal risk\n- The change adds defensive error handling for a known race condition. The fix is minimal, well-scoped, follows the same pattern used elsewhere in the file (e.g., lines 126-130, 134-147), and silently catches errors that are benign (dialog already gone). No behavior change when the dialog is present.\n- No files require special attention\n\n<sub>Last reviewed commit: 76c93a0</sub>\n\n<!-- greptile_other_comments_section -->\n\n<!-- /greptile_comment -->",
      "author": "aldoeliacim",
      "authorAssociation": "CONTRIBUTOR",
      "createdAt": "2026-02-15T21:02:01Z",
      "updatedAt": "2026-02-15T21:03:42Z",
      "headRef": "fix/browser-dialog-unhandled-rejection",
      "baseRef": "main",
      "filesChanged": 1,
      "additions": 8,
      "deletions": 4,
      "commits": 1,
      "labels": [
        "size: XS"
      ],
      "ciStatus": "failure",
      "hasIssueRef": true,
      "issueNumbers": [
        17499
      ],
      "changedFiles": [
        "src/browser/pw-tools-core.downloads.ts"
      ],
      "diffUrl": "https://github.com/openclaw/openclaw/pull/17518.diff",
      "hasTests": false,
      "testFilesChanged": [],
      "ageInDays": 0,
      "mergeable": "mergeable",
      "reviewState": "commented",
      "reviewCount": 1,
      "commentCount": 1,
      "totalScore": 84,
      "signals": [
        {
          "name": "ci_status",
          "score": 10,
          "weight": 0.2,
          "reason": "CI: failure"
        },
        {
          "name": "diff_size",
          "score": 70,
          "weight": 0.1,
          "reason": "12 lines changed (8+/4-)"
        },
        {
          "name": "commit_quality",
          "score": 90,
          "weight": 0.05,
          "reason": "Conventional commit format"
        },
        {
          "name": "contributor",
          "score": 79,
          "weight": 0.15,
          "reason": "aldoeliacim (CONTRIBUTOR, rep: 99)"
        },
        {
          "name": "issue_ref",
          "score": 90,
          "weight": 0.1,
          "reason": "References: #17499"
        },
        {
          "name": "spam",
          "score": 100,
          "weight": 0.15,
          "reason": "No spam signals"
        },
        {
          "name": "test_coverage",
          "score": 20,
          "weight": 0.15,
          "reason": "No test files changed in code PR"
        },
        {
          "name": "staleness",
          "score": 100,
          "weight": 0.1,
          "reason": "0d old (Fresh)"
        },
        {
          "name": "mergeability",
          "score": 100,
          "weight": 0.15,
          "reason": "Merge status: mergeable"
        },
        {
          "name": "review_status",
          "score": 60,
          "weight": 0.1,
          "reason": "Review: commented (1 reviews)"
        },
        {
          "name": "body_quality",
          "score": 90,
          "weight": 0.05,
          "reason": "Body: 1698 chars"
        },
        {
          "name": "activity",
          "score": 50,
          "weight": 0.05,
          "reason": "1 comments"
        },
        {
          "name": "breaking_change",
          "score": 80,
          "weight": 0.05,
          "reason": "No breaking change signals"
        }
      ],
      "isSpam": false,
      "spamReasons": [],
      "visionAlignment": "unchecked",
      "llmScore": 95,
      "llmRisk": "low",
      "llmReason": "Addresses a real race condition that leads to unhandled rejections. The fix is small, targeted, and defensive, adding a try-catch block to handle a benign error case. The greptile summary and the PR description both indicate a clear understanding of the problem and solution. The testing section confirms that the change is non-breaking and only addresses the error case.",
      "duplicateGroup": 0
    },
    {
      "number": 17513,
      "title": "fix(discord): respect groupPolicy in channel config fallback (#4555)",
      "body": "## Problem\n\nDiscord guild messages are silently dropped when:\n1. A guild entry has a `channels` block with at least one entry\n2. The incoming message is from a channel NOT listed in that block\n3. `groupPolicy` is `\"open\"`\n\n`resolveDiscordChannelConfigWithFallback()` returns `{ allowed: false }` as a default when no channel entry matches. A second check in the preflight handler (`channelConfig?.allowed === false`) then drops the message \u2014 **even though `isDiscordGroupAllowedByPolicy()` already returned `true`** for open policy.\n\n## Why most users are NOT affected\n\nMost users fall into one of these categories that avoid the bug:\n\n- **No `channels` block in guild config** \u2192 `resolveDiscordChannelConfigWithFallback` returns `null` (not `{ allowed: false }`), and `null?.allowed === false` evaluates to `false`, so messages pass through\n- **Wildcard `\"*\"` channel entry** \u2192 matches everything, returns `{ allowed: true }`\n- **Explicit channel entries covering all active channels** \u2192 always matches\n- **No guild config at all** \u2192 `channelConfig` is `null`\n\nThe bug only triggers when a user has a **partial** channels config (e.g., configuring `requireMention` for one channel) combined with `groupPolicy: \"open\"` \u2014 the unconfigured channels get silently dropped.\n\n## Fix\n\nSkip the redundant `channelConfig?.allowed === false` check when `groupPolicy === \"open\"`, since `isDiscordGroupAllowedByPolicy` already approved the message.\n\n**1 line changed** in `message-handler.preflight.ts` + **80 lines of tests** covering the groupPolicy \u00d7 channel-config matrix.\n\nFixes #4555\n\n<!-- greptile_comment -->\n\n<h3>Greptile Summary</h3>\n\nFixed a subtle bug where Discord messages from unconfigured channels were silently dropped despite `groupPolicy: \"open\"`. The issue occurred when a guild had partial channel configuration (e.g., one channel with `requireMention` set) but `groupPolicy` was `\"open\"` - unconfigured channels would return `{ allowed: false }` from the fallback resolver and get incorrectly blocked by a redundant secondary check.\n\nThe fix correctly skips the redundant `channelConfig?.allowed === false` check when `groupPolicy === \"open\"`, since `isDiscordGroupAllowedByPolicy()` already approved the message. The logic now properly respects the policy hierarchy:\n- **open policy**: all guild channels allowed (regardless of channel config)\n- **allowlist policy**: only explicitly configured channels allowed\n- **disabled policy**: all guild messages blocked\n\nChanges:\n- Added `&& params.groupPolicy !== \"open\"` guard to the secondary channel check in `message-handler.preflight.ts:372`\n- Added 80 lines of comprehensive unit tests covering the groupPolicy \u00d7 channel-config interaction matrix\n- Tests verify correct behavior of `resolveDiscordChannelConfigWithFallback()` and policy enforcement for all three policy modes\n\n<h3>Confidence Score: 5/5</h3>\n\n- This PR is safe to merge with high confidence\n- The fix is a minimal, surgical change (1 line) that addresses a well-documented edge case. The logic is sound: the second check was redundant for open policy since `isDiscordGroupAllowedByPolicy()` already returns true unconditionally. Comprehensive test coverage (80 lines) validates the fix and prevents regression. The change only affects the specific bug scenario (partial channel config + open policy) and preserves correct behavior for allowlist and disabled policies.\n- No files require special attention\n\n<sub>Last reviewed commit: 9386b3d</sub>\n\n<!-- greptile_other_comments_section -->\n\n<!-- /greptile_comment -->",
      "author": "aronchick",
      "authorAssociation": "NONE",
      "createdAt": "2026-02-15T20:54:59Z",
      "updatedAt": "2026-02-15T20:57:23Z",
      "headRef": "fix/discord-channel-config-fallback-4555",
      "baseRef": "main",
      "filesChanged": 2,
      "additions": 81,
      "deletions": 1,
      "commits": 1,
      "labels": [
        "channel: discord",
        "size: S"
      ],
      "ciStatus": "failure",
      "hasIssueRef": true,
      "issueNumbers": [
        4555
      ],
      "changedFiles": [
        "src/discord/monitor.test.ts",
        "src/discord/monitor/message-handler.preflight.ts"
      ],
      "diffUrl": "https://github.com/openclaw/openclaw/pull/17513.diff",
      "hasTests": true,
      "testFilesChanged": [
        "src/discord/monitor.test.ts"
      ],
      "ageInDays": 0,
      "mergeable": "unknown",
      "reviewState": "none",
      "reviewCount": 0,
      "commentCount": 0,
      "totalScore": 84,
      "signals": [
        {
          "name": "ci_status",
          "score": 10,
          "weight": 0.2,
          "reason": "CI: failure"
        },
        {
          "name": "diff_size",
          "score": 100,
          "weight": 0.1,
          "reason": "82 lines changed (81+/1-)"
        },
        {
          "name": "commit_quality",
          "score": 90,
          "weight": 0.05,
          "reason": "Conventional commit format"
        },
        {
          "name": "contributor",
          "score": 51,
          "weight": 0.15,
          "reason": "aronchick (NONE, rep: 100)"
        },
        {
          "name": "issue_ref",
          "score": 90,
          "weight": 0.1,
          "reason": "References: #4555"
        },
        {
          "name": "spam",
          "score": 100,
          "weight": 0.15,
          "reason": "No spam signals"
        },
        {
          "name": "test_coverage",
          "score": 90,
          "weight": 0.15,
          "reason": "1 test file(s) changed"
        },
        {
          "name": "staleness",
          "score": 100,
          "weight": 0.1,
          "reason": "0d old (Fresh)"
        },
        {
          "name": "mergeability",
          "score": 50,
          "weight": 0.15,
          "reason": "Merge status: unknown"
        },
        {
          "name": "review_status",
          "score": 40,
          "weight": 0.1,
          "reason": "Review: none (0 reviews)"
        },
        {
          "name": "body_quality",
          "score": 90,
          "weight": 0.05,
          "reason": "Body: 3542 chars"
        },
        {
          "name": "activity",
          "score": 30,
          "weight": 0.05,
          "reason": "0 comments"
        },
        {
          "name": "breaking_change",
          "score": 80,
          "weight": 0.05,
          "reason": "No breaking change signals"
        }
      ],
      "isSpam": false,
      "spamReasons": [],
      "visionAlignment": "unchecked",
      "llmScore": 95,
      "llmRisk": "low",
      "llmReason": "The PR addresses a real, albeit subtle, bug that can lead to unexpected message drops in Discord integrations. The explanation is clear, the fix is concise, and the extensive tests provide confidence in its correctness. The risk is low because the change is small and well-tested, and it only affects a specific configuration scenario. Merging this would improve the project by resolving a potentially confusing issue for users with partial channel configurations."
    },
    {
      "number": 13075,
      "title": "[Feature]: Add Gemini (Google Search grounding) as web_search provider",
      "body": "## Summary\n\nAdds `\"gemini\"` as a web_search provider alongside Brave, Perplexity, and Grok, using Gemini's built-in [Google Search grounding](https://ai.google.dev/gemini-api/docs/grounding). Also adds **auto-detection** of search providers when no explicit `provider` is configured.\n\nCloses #13074\n\n## What changed\n\n### `src/agents/tools/web-search.ts`\n- New `runGeminiSearch()` \u2014 calls Gemini `generateContent` with `tools: [{ google_search: {} }]`\n- `resolveRedirectUrl()` \u2014 resolves Google grounding redirect URLs to direct URLs via parallel HEAD requests (5s timeout, graceful fallback)\n- Gemini config resolution helpers (`resolveGeminiConfig`, `resolveGeminiApiKey`, `resolveGeminiModel`)\n- Updated `runWebSearch()`, `createWebSearchTool()`, `missingSearchKeyPayload()`, `resolveSearchProvider()` to handle the gemini provider path\n- **Auto-detection:** When no explicit `provider` is set, checks for available API keys in priority order: Brave \u2192 Gemini \u2192 Perplexity \u2192 Grok. Falls back to Brave if none found.\n- **Security:** API key stripped from error messages (`key=***`) to prevent leakage in logs \u2014 Gemini REST API requires key as query parameter (no Bearer token alternative without ADC)\n\n### Config types & validation\n- `types.tools.ts` \u2014 added `\"gemini\"` to provider union, added `gemini` config block\n- `zod-schema.agent-runtime.ts` \u2014 added `\"gemini\"` to zod validation, added gemini schema\n- `schema.ts` \u2014 updated provider description string\n\n### Tests\n- 2 new config validation tests (gemini with config, gemini with defaults)\n- 8 new auto-detection tests (per-provider detection, priority order, explicit override, fallback)\n- All existing + new tests passing (11 total)\n\n### Docs\n- `docs/tools/web.md` \u2014 added Auto-detection section documenting priority order and fallback behavior\n\n## Config\n\n```json5\n{\n  tools: {\n    web: {\n      search: {\n        provider: \"gemini\",           // optional \u2014 auto-detected from available keys\n        gemini: {\n          apiKey: \"...\",              // optional if GEMINI_API_KEY env var is set\n          model: \"gemini-2.5-flash\"   // optional, this is the default\n        }\n      }\n    }\n  }\n}\n```\n\n### Auto-detection\n\nWhen no `provider` is explicitly set, OpenClaw checks for available API keys in this order:\n\n1. **Brave** \u2014 `BRAVE_API_KEY` env var or `search.apiKey` config\n2. **Gemini** \u2014 `GEMINI_API_KEY` env var or `search.gemini.apiKey` config\n3. **Perplexity** \u2014 `PERPLEXITY_API_KEY` / `OPENROUTER_API_KEY` env var or `search.perplexity.apiKey` config\n4. **Grok** \u2014 `XAI_API_KEY` env var or `search.grok.apiKey` config\n\nIf no keys are found, falls back to Brave (existing behavior).\n\n## Testing\n- [x] `pnpm check` passes (lint + format)\n- [x] Unit tests pass (11/11)\n- [x] Live tested against Gemini API \u2014 grounding returns content + citations with resolved URLs\n- [x] Self-review completed \u2014 found and fixed API key leakage in error messages before finalizing\n- [x] AI-assisted (Claude Opus 4.6 via OpenClaw) \u2014 fully reviewed and understood\n\n## Design decisions\n- **URL resolution:** Gemini grounding returns citations through `vertexaisearch.cloud.google.com/grounding-api-redirect/...` redirects. We resolve these to direct URLs via parallel HEAD requests (5s timeout, graceful fallback to redirect URL on failure). This adds latency but gives the agent usable URLs.\n- **API key in query string:** Gemini REST API requires this (no header alternative without ADC). We strip `key=...` from error messages to prevent log leakage.\n- **Default model:** `gemini-2.5-flash` \u2014 fast, cheap, supports grounding.\n- **Auto-detection priority:** Brave first (most common existing setup), then Gemini, Perplexity, Grok. Explicit `provider` config always overrides auto-detection.\n\n## Related\n- #5775 (Grok provider \u2014 similar pattern)\n- #11399 (Extensible providers)\n\n<!-- greptile_comment -->\n\n<h2>Greptile Overview</h2>\n\n<h3>Greptile Summary</h3>\n\nAdds Gemini as a web search provider with Google Search grounding capability, alongside existing Brave, Perplexity, and Grok providers. Implements auto-detection of search providers based on available API keys when no explicit `provider` is configured.\n\n**Key changes:**\n- New `runGeminiSearch()` function calling Gemini's `generateContent` API with Google Search grounding tool\n- URL resolution helper (`resolveRedirectUrl()`) to convert Google grounding redirect URLs to direct URLs via parallel HEAD requests (5s timeout, graceful fallback)\n- Auto-detection logic checking API keys in priority order: Brave \u2192 Gemini \u2192 Perplexity \u2192 Grok, with fallback to Brave\n- Configuration schema updates across types, zod validation, and documentation\n- Security: API key redaction in error messages to prevent log leakage (Gemini REST API requires key as query param)\n- Comprehensive test coverage (11 tests total: 3 config validation, 8 auto-detection scenarios)\n\n**Implementation follows existing patterns:**\n- Consistent with Grok/Perplexity provider structure\n- Proper `externalContent` metadata included\n- API keys marked as sensitive in zod schema\n- Config help and labels added for new Gemini fields\n- Documentation updated with setup instructions and auto-detection behavior\n\nAll previously reported issues from review threads have been addressed (error message redaction, JSON parse guards, config schema entries).\n\n<h3>Confidence Score: 5/5</h3>\n\n- This PR is safe to merge with minimal risk\n- Implementation is thorough and follows established patterns in the codebase. All previously identified issues (API key leakage, JSON parse guards, missing config entries) have been addressed. The code includes proper error handling, security measures (API key redaction), comprehensive test coverage (11/11 passing), and maintains consistency with existing provider implementations. Auto-detection logic is well-tested with 8 test cases covering priority order and fallback behavior.\n- No files require special attention\n\n<sub>Last reviewed commit: cfca253</sub>\n\n<!-- greptile_other_comments_section -->\n\n<!-- /greptile_comment -->",
      "author": "akoscz",
      "authorAssociation": "CONTRIBUTOR",
      "createdAt": "2026-02-10T03:10:57Z",
      "updatedAt": "2026-02-15T20:52:22Z",
      "headRef": "feature/gemini-web-search",
      "baseRef": "main",
      "filesChanged": 7,
      "additions": 449,
      "deletions": 15,
      "commits": 10,
      "labels": [
        "docs",
        "agents",
        "size: M"
      ],
      "ciStatus": "failure",
      "hasIssueRef": true,
      "issueNumbers": [
        13074
      ],
      "changedFiles": [
        "docs/tools/web.md",
        "src/agents/tools/web-search.ts",
        "src/config/config.web-search-provider.test.ts",
        "src/config/schema.help.ts",
        "src/config/schema.labels.ts",
        "src/config/types.tools.ts",
        "src/config/zod-schema.agent-runtime.ts"
      ],
      "diffUrl": "https://github.com/openclaw/openclaw/pull/13075.diff",
      "hasTests": true,
      "testFilesChanged": [
        "src/config/config.web-search-provider.test.ts"
      ],
      "ageInDays": 5,
      "mergeable": "unknown",
      "reviewState": "commented",
      "reviewCount": 15,
      "commentCount": 21,
      "totalScore": 83,
      "signals": [
        {
          "name": "ci_status",
          "score": 10,
          "weight": 0.2,
          "reason": "CI: failure"
        },
        {
          "name": "diff_size",
          "score": 100,
          "weight": 0.1,
          "reason": "464 lines changed (449+/15-)"
        },
        {
          "name": "commit_quality",
          "score": 50,
          "weight": 0.05,
          "reason": "Non-standard title"
        },
        {
          "name": "contributor",
          "score": 79,
          "weight": 0.15,
          "reason": "akoscz (CONTRIBUTOR, rep: 100)"
        },
        {
          "name": "issue_ref",
          "score": 90,
          "weight": 0.1,
          "reason": "References: #13074"
        },
        {
          "name": "spam",
          "score": 100,
          "weight": 0.15,
          "reason": "No spam signals"
        },
        {
          "name": "test_coverage",
          "score": 90,
          "weight": 0.15,
          "reason": "1 test file(s) changed"
        },
        {
          "name": "staleness",
          "score": 100,
          "weight": 0.1,
          "reason": "5d old (Fresh)"
        },
        {
          "name": "mergeability",
          "score": 50,
          "weight": 0.15,
          "reason": "Merge status: unknown"
        },
        {
          "name": "review_status",
          "score": 70,
          "weight": 0.1,
          "reason": "Review: commented (15 reviews)"
        },
        {
          "name": "body_quality",
          "score": 100,
          "weight": 0.05,
          "reason": "Body: 6031 chars"
        },
        {
          "name": "activity",
          "score": 90,
          "weight": 0.05,
          "reason": "21 comments"
        },
        {
          "name": "breaking_change",
          "score": 80,
          "weight": 0.05,
          "reason": "No breaking change signals"
        }
      ],
      "isSpam": false,
      "spamReasons": [],
      "visionAlignment": "unchecked",
      "llmScore": 90,
      "llmRisk": "medium",
      "llmReason": "Adds valuable Gemini search grounding, including auto-detection and redirect resolution. Implementation seems thorough with tests and documentation. The security measure of stripping the API key from error messages is good. The risk is 'medium' because auto-detection could have unexpected consequences if API keys are present but not intended for use, and the redirect resolution adds complexity that could introduce latency or failure points. Also, the lack of a Bearer token alternative for Gemini API key authentication is a potential security concern, though mitigated by the key stripping."
    },
    {
      "number": 16761,
      "title": "sessions_spawn: inline attachments + redaction + hardening",
      "body": "Fixes #17214\n\nImage-specific request remains tracked in #16344 as a special case of general file attachments.\n\n## Summary\n\nThis Pull Request introduces robust support for passing inline attachments to sub-agents via `sessions_spawn`. This enables more complex workflows where agents require specific files, such as images for analysis (e.g., in response to a user's request to \"analyze this image\"), code snippets, or other structured data, making it a more comprehensive solution for inter-agent communication.\n\nThis feature moves beyond basic text exchange, addressing a crucial need for agents to operate on concrete file inputs.\n\n### Core Idea\n\nThe goal is to allow a spawning agent (or user) to provide files directly with a `sessions_spawn` call. These files are then safely materialized into the target sub-agent's isolated workspace, making them accessible to the sub-agent's tools and thought process. This allows for scenarios like:\n-   An agent analyzing an image provided by a user.\n-   An agent receiving a configuration file for processing.\n-   An agent getting a dataset for a specific task.\n\n### Implemented Details\n\n-   Adds `attachments[]` support to `sessions_spawn` (accepts inline content as `utf8` or `base64` encoded strings).\n-   Materializes attachments into the child sub-agent's isolated workspace at a deterministic relative path:\n    -   `.openclaw/attachments/<uuid>/`\n    -   Includes a `.manifest.json` file within this directory, containing metadata for all attached files (name, size, SHA256 hash).\n-   Returns an attachment receipt (`count`, `totalBytes`, `files`, `relDir`) in the `sessions_spawn` tool result, allowing the spawning agent to confirm successful transfer.\n-   Appends a system note to the child sub-agent's context, informing it of the canonical `relDir` where attachments can be found (the `mountPath` concept is explicitly reserved for future, more advanced mount-based implementations and is not used as a runtime path authority in this implementation).\n\n### Security and Robustness Hardening\n\nExtensive measures have been taken to ensure the security and integrity of attachment handling:\n-   **Strict Transcript Redaction**: `sessions_spawn` attachment `content` is strictly redacted from transcript persistence (both `arguments` and `input` tool-call shapes) to prevent accidental logging of sensitive data.\n-   **Robust Base64 Validation**: Implements strict base64 validation (checking alphabet, padding, and roundtrip consistency). Critically, it includes a **pre-decode encoded-size guard** to prevent memory exhaustion (DoS) from overly large base64 inputs before full decoding.\n-   **Atomic Materialization & Rollback**: Attachment staging includes atomic file writes and a comprehensive rollback mechanism: if any error occurs during materialization (e.g., validation failure, disk write issue), the partially created attachment directory is fully removed.\n-   **Spawn Failure Cleanup**: If the `agent.callGateway` (the actual sub-agent spawn) fails after attachments have been materialized, the staged attachment directory is removed according to the defined cleanup policy.\n-   **Lifecycle-Aware Cleanup**: The cleanup policy (`cleanup=delete` or `retainOnSessionKeep=false`) is fully wired into the sub-agent registry's `finalize` process, ensuring attachment directories are reliably removed after the sub-agent run completes or its session is archived.\n-   **Constrained Deletion**: Attachment directory deletion is strictly constrained to the canonical attachments root within the child sub-agent's workspace, preventing accidental deletion of files outside the intended scope (path traversal protection).\n-   **Tightened File Permissions**: File system permissions for materialized attachments are highly restricted: directories are set to `0700` and files/manifests to `0600`, ensuring only the owner (the sub-agent process) can access them.\n\n### Tests Run\n\nThe following tests have been run and passed:\n-   `pnpm lint --silent` (static code analysis)\n-   `pnpm exec vitest run --config vitest.unit.config.ts src/agents/session-transcript-repair.attachments.test.ts` (unit tests for transcript redaction and base64 handling)\n-   `pnpm exec vitest run --config vitest.e2e.config.ts src/agents/openclaw-tools.sessions.e2e.test.ts` (end-to-end tests for `sessions_spawn` functionality)\n\n---\n\n## Reviewer Guide\n\n**What to look for:**\n\n1.  **Security (Critical):**\n    *   **`sessions_spawn-tool.ts`**:\n        *   `decodeStrictBase64` logic: Confirm the `maxEncodedBytes` calculation and its enforcement *before* `Buffer.from` to prevent memory DoS.\n        *   Attachment file/dir creation (`fs.mkdir`, `fs.writeFile`): Verify `mode` (0700/0600) and `flag: \"wx\"` (no overwrite).\n        *   Error handling logic in the attachment materialization `try/catch` block: Ensure `fs.rm(absDir, { recursive: true, force: true })` is called on *any* failure to prevent residue.\n    *   **`subagent-registry.ts`**:\n        *   `safeRemoveAttachmentsDir`: Verify the `fs.realpath` and `startsWith(rootWithSep)` checks are robust against path traversal for deletion.\n        *   `finalizeSubagentCleanup`: Ensure `shouldDeleteAttachments` logic correctly triggers `safeRemoveAttachmentsDir` based on `cleanup` and `retainAttachmentsOnKeep`.\n    *   **`session-transcript-repair.ts`**:\n        *   `sanitizeToolCallInputs`: Confirm `attachments[].content` is redacted for both `arguments` and `input` fields in `sessions_spawn` tool calls.\n\n2.  **Correctness (High):**\n    *   **`sessions_spawn-tool.ts`**:\n        *   `decodeStrictBase64`: Test with various valid, invalid, and edge-case base64 strings (e.g., malformed padding, non-base64 chars, empty, very long inputs).\n        *   Attachment limits (`maxFiles`, `maxTotalBytes`, `maxFileBytes`): Ensure these are correctly enforced at various stages.\n        *   Filename validation: Check edge cases for `.` `..` `/` `\\` `\\\\^@` and ensure they are rejected.\n        *   `relDir` generation: Confirm it is deterministic and reliably points to the attachment location in the child workspace.\n        *   System prompt message: Verify it clearly states the `relDir` and the untrusted nature of attachments.\n    *   **`subagent-registry.ts`**:\n        *   `registerSubagentRun`: Ensure `attachmentsDir` and `retainAttachmentsOnKeep` are correctly recorded.\n        *   `finalizeSubagentCleanup`: Verify the timing and conditions for `safeRemoveAttachmentsDir` are correct (i.e., it doesn't try to delete before creation, and doesn't leave residue).\n\n3.  **Architecture / Design (Medium):**\n    *   **`sessions_spawn-tool.ts`**:\n        *   Confirm that the `attachAs.mountPath` field is indeed *not* used for path resolution in the MVP, but retained as a placeholder (and documented as such in the code comments).\n        *   Attachment lifecycle (creation, use, cleanup) is clear and robust.\n    *   **Overall**: Ensure that this inline attachment mechanism is a solid foundation for future extensions (e.g., streaming, more complex storage).\n\n**Suggested Manual Test Cases:**\n\n1.  **Successful Attachment**: Spawn a sub-agent with a small UTF8 text file. Verify the sub-agent can `read` the file at the reported `relDir`.\n2.  **Successful Base64 Image**: Spawn a sub-agent with a base64 encoded image (within limits). Verify the sub-agent can `read` the file (e.g., check its size or first few bytes).\n3.  **Attachment Limits**:\n    *   Send a single file exceeding `maxFileBytes`. Expect rejection.\n    *   Send multiple files whose `totalBytes` exceed `maxTotalBytes`. Expect rejection (even if individual files are fine).\n    *   Send more than `maxFiles`. Expect rejection.\n4.  **Invalid Base64**: Send an attachment with malformed base64 `content`. Expect `attachments_invalid_base64_or_too_large` error.\n5.  **Invalid Filenames**: Send attachments with `../` `//` `\\` `\\\\^@` or null bytes in the `name`. Expect `attachments_invalid_name` error.\n6.  **Duplicate Filenames**: Send multiple attachments with the same valid `name`. Expect `attachments_duplicate_name` error.\n7.  **Rollback on Materialization Error**: Simulate a disk full or permission error during file writing (manually block `fs.writeFile` in a test environment, if possible). Verify that no residual attachment directory or files are left.\n8.  **Spawn Failure Cleanup**: Trigger `sessions_spawn` with valid attachments, but ensure the actual sub-agent spawn (`callGateway<...>(method: \"agent\", ...)` fails (e.g., invalid `agentId`). Verify that the attachment directory is removed.\n9.  **`cleanup=delete`**: Spawn an agent with attachments and `cleanup=\"delete\"`. Verify the attachment directory is removed after the sub-agent completes successfully.\n10. **`cleanup=keep` (default)**: Spawn an agent with attachments and `cleanup=\"keep\"`. Verify the attachment directory *is not* removed after the sub-agent completes.\n\n\n\n\nMentions: #16344\n\n",
      "author": "napetrov",
      "authorAssociation": "CONTRIBUTOR",
      "createdAt": "2026-02-15T02:46:05Z",
      "updatedAt": "2026-02-15T20:50:45Z",
      "headRef": "napetrov/sessions-spawn-attachments",
      "baseRef": "main",
      "filesChanged": 7,
      "additions": 427,
      "deletions": 23,
      "commits": 11,
      "labels": [
        "channel: discord",
        "channel: whatsapp-web",
        "agents",
        "size: M"
      ],
      "ciStatus": "failure",
      "hasIssueRef": true,
      "issueNumbers": [
        17214
      ],
      "changedFiles": [
        "src/agents/session-transcript-repair.attachments.test.ts",
        "src/agents/session-transcript-repair.ts",
        "src/agents/subagent-registry.ts",
        "src/agents/tools/sessions-spawn-tool.ts",
        "src/discord/monitor/message-handler.preflight.ts",
        "src/media/local-roots.ts",
        "src/web/media.test.ts"
      ],
      "diffUrl": "https://github.com/openclaw/openclaw/pull/16761.diff",
      "hasTests": true,
      "testFilesChanged": [
        "src/agents/session-transcript-repair.attachments.test.ts",
        "src/web/media.test.ts"
      ],
      "ageInDays": 0,
      "mergeable": "unknown",
      "reviewState": "commented",
      "reviewCount": 1,
      "commentCount": 9,
      "totalScore": 83,
      "signals": [
        {
          "name": "ci_status",
          "score": 10,
          "weight": 0.2,
          "reason": "CI: failure"
        },
        {
          "name": "diff_size",
          "score": 100,
          "weight": 0.1,
          "reason": "450 lines changed (427+/23-)"
        },
        {
          "name": "commit_quality",
          "score": 50,
          "weight": 0.05,
          "reason": "Non-standard title"
        },
        {
          "name": "contributor",
          "score": 79,
          "weight": 0.15,
          "reason": "napetrov (CONTRIBUTOR, rep: 100)"
        },
        {
          "name": "issue_ref",
          "score": 90,
          "weight": 0.1,
          "reason": "References: #17214"
        },
        {
          "name": "spam",
          "score": 100,
          "weight": 0.15,
          "reason": "No spam signals"
        },
        {
          "name": "test_coverage",
          "score": 90,
          "weight": 0.15,
          "reason": "2 test file(s) changed"
        },
        {
          "name": "staleness",
          "score": 100,
          "weight": 0.1,
          "reason": "0d old (Fresh)"
        },
        {
          "name": "mergeability",
          "score": 50,
          "weight": 0.15,
          "reason": "Merge status: unknown"
        },
        {
          "name": "review_status",
          "score": 60,
          "weight": 0.1,
          "reason": "Review: commented (1 reviews)"
        },
        {
          "name": "body_quality",
          "score": 90,
          "weight": 0.05,
          "reason": "Body: 8924 chars"
        },
        {
          "name": "activity",
          "score": 90,
          "weight": 0.05,
          "reason": "9 comments"
        },
        {
          "name": "breaking_change",
          "score": 80,
          "weight": 0.05,
          "reason": "No breaking change signals"
        }
      ],
      "isSpam": false,
      "spamReasons": [],
      "visionAlignment": "unchecked",
      "llmScore": 90,
      "llmRisk": "low",
      "llmReason": "This PR introduces a valuable feature for passing attachments to sub-agents, addressing a real need for more complex inter-agent communication. The implementation appears well-thought-out, including security considerations like deterministic paths and metadata manifests. The tests and file changes seem appropriate. The risk is low because the changes are well-contained and the feature is additive."
    },
    {
      "number": 17488,
      "title": "fix(agents): skip workspace deletion when shared with other agents",
      "body": "## Summary\n\n- Problem: `agents delete` unconditionally trashes the resolved workspace directory. When multiple agents share the same workspace path (e.g. `~/Projects`), deleting one agent nukes the entire directory \u2014 destroying files belonging to other agents and the user's own projects.\n- Why it matters: Critical data loss. Real-world incident: deleting a secondary agent trashed a user's entire `~/Projects` directory containing all repos, configs, and workspace files.\n- What changed: Added `isWorkspaceSharedByOtherAgent()` helper that checks all registered agents + the implicit default agent before deletion. Both the CLI (`agents.commands.delete.ts`) and gateway handler (`agents.ts`) now skip workspace trashing when the path is shared.\n- What did NOT change (scope boundary): `moveToTrash` itself, agent config pruning, `--force` flag behavior, session/agentDir deletion (those are per-agent and always safe to delete).\n\nlobster-biscuit\n\n## Change Type (select all)\n\n- [x] Bug fix\n- [ ] Feature\n- [ ] Refactor\n- [ ] Docs\n- [x] Security hardening\n- [ ] Chore/infra\n\n## Scope (select all touched areas)\n\n- [x] Gateway / orchestration\n- [ ] Skills / tool execution\n- [ ] Auth / tokens\n- [ ] Memory / storage\n- [ ] Integrations\n- [x] API / contracts\n- [ ] UI / DX\n- [ ] CI/CD / infra\n\n## Linked Issue/PR\n\n- Closes # (none filed yet \u2014 discovered via real-world data loss incident)\n\n## User-visible / Behavior Changes\n\n- `agents delete` now logs `Skipping workspace deletion \u2014 shared with: <agent-ids>` when the workspace is used by other agents, instead of silently trashing it.\n- No behavior change when workspace is unique to the deleted agent (still trashed as before).\n\n## Security Impact (required)\n\n- New permissions/capabilities? `No`\n- Secrets/tokens handling changed? `No`\n- New/changed network calls? `No`\n- Command/tool execution surface changed? `No`\n- Data access scope changed? `No`\n- If any Yes, explain risk + mitigation: N/A \u2014 this PR prevents data loss by checking workspace ownership before deletion.\n\n## Repro + Verification\n\n### Environment\n\n- OS: macOS\n- Runtime/container: Node.js (OpenClaw 2026.2.14+)\n- Model/provider: N/A (CLI/gateway behavior)\n- Integration/channel (if any): N/A\n- Relevant config (redacted): Two agents configured with same `workspace` path in `openclaw.json`\n\n### Steps\n\n1. Register two agents with the same workspace: `openclaw agents add agentA --workspace ~/Projects` and `openclaw agents add agentB --workspace ~/Projects`\n2. Delete one: `openclaw agents delete agentA --force`\n3. Check `~/Projects` \u2014 it has been trashed.\n\n### Expected\n\n- agentA's agent config dir and sessions dir are trashed\n- Shared workspace (`~/Projects`) is preserved since agentB still uses it\n\n### Actual\n\n- `~/Projects` is trashed along with agentA's config \u2014 agentB's workspace is destroyed\n\n## Evidence\n\n- [x] Failing test/log before + passing after\n- [ ] Trace/log snippets\n- [ ] Screenshot/recording\n- [ ] Perf numbers (if relevant)\n\nTest `\"skips workspace deletion when workspace is shared with another agent\"` fails before fix (workspace path found in trashed paths), passes after fix.\n\n## Human Verification (required)\n\n- Verified scenarios: shared workspace (2 agents same path), unique workspace (agent with own path), default agent implicit check\n- Edge cases checked: agent pointing to default workspace path, agent list containing only the deleted agent\n- What you did **not** verify: Windows/Linux path resolution, non-`trash` fallback path (manual `.Trash` move)\n\n## Compatibility / Migration\n\n- Backward compatible? `Yes`\n- Config/env changes? `No`\n- Migration needed? `No`\n\n## Failure Recovery (if this breaks)\n\n- How to disable/revert this change quickly: Revert the single commit \u2014 the guard is additive\n- Files/config to restore: None\n- Known bad symptoms reviewers should watch for: Workspace directories not being cleaned up after agent deletion when they should be (false positive shared detection)\n\n## Risks and Mitigations\n\n- Risk: False positive shared detection prevents legitimate workspace cleanup\n  - Mitigation: Uses exact path matching (`===`) on fully resolved paths. Only truly shared workspaces are skipped. Users can manually trash the workspace after deletion if needed.\n\n---\n\n- [x] Mark as AI-assisted in the PR title or description\n- [x] Note the degree of testing: fully tested (2 new unit tests + full suite green)\n- [x] Confirm understanding: all code understood by author\n\n\ud83e\udd16 AI-assisted PR (Claude Code) \u2014 fully tested, all code understood by author",
      "author": "soumikbhatta",
      "authorAssociation": "NONE",
      "createdAt": "2026-02-15T20:14:32Z",
      "updatedAt": "2026-02-15T20:28:46Z",
      "headRef": "fix/agents-delete-shared-workspace",
      "baseRef": "main",
      "filesChanged": 4,
      "additions": 94,
      "deletions": 3,
      "commits": 1,
      "labels": [
        "gateway",
        "commands",
        "agents",
        "size: S"
      ],
      "ciStatus": "failure",
      "hasIssueRef": false,
      "issueNumbers": [],
      "changedFiles": [
        "src/agents/agent-scope.ts",
        "src/commands/agents.commands.delete.ts",
        "src/gateway/server-methods/agents-mutate.test.ts",
        "src/gateway/server-methods/agents.ts"
      ],
      "diffUrl": "https://github.com/openclaw/openclaw/pull/17488.diff",
      "hasTests": true,
      "testFilesChanged": [
        "src/gateway/server-methods/agents-mutate.test.ts"
      ],
      "ageInDays": 0,
      "mergeable": "mergeable",
      "reviewState": "none",
      "reviewCount": 0,
      "commentCount": 0,
      "totalScore": 83,
      "signals": [
        {
          "name": "ci_status",
          "score": 10,
          "weight": 0.2,
          "reason": "CI: failure"
        },
        {
          "name": "diff_size",
          "score": 100,
          "weight": 0.1,
          "reason": "97 lines changed (94+/3-)"
        },
        {
          "name": "commit_quality",
          "score": 90,
          "weight": 0.05,
          "reason": "Conventional commit format"
        },
        {
          "name": "contributor",
          "score": 51,
          "weight": 0.15,
          "reason": "soumikbhatta (NONE, rep: 100)"
        },
        {
          "name": "issue_ref",
          "score": 30,
          "weight": 0.1,
          "reason": "No issue reference"
        },
        {
          "name": "spam",
          "score": 75,
          "weight": 0.15,
          "reason": "No issue ref"
        },
        {
          "name": "test_coverage",
          "score": 90,
          "weight": 0.15,
          "reason": "1 test file(s) changed"
        },
        {
          "name": "staleness",
          "score": 100,
          "weight": 0.1,
          "reason": "0d old (Fresh)"
        },
        {
          "name": "mergeability",
          "score": 100,
          "weight": 0.15,
          "reason": "Merge status: mergeable"
        },
        {
          "name": "review_status",
          "score": 40,
          "weight": 0.1,
          "reason": "Review: none (0 reviews)"
        },
        {
          "name": "body_quality",
          "score": 100,
          "weight": 0.05,
          "reason": "Body: 4525 chars"
        },
        {
          "name": "activity",
          "score": 30,
          "weight": 0.05,
          "reason": "0 comments"
        },
        {
          "name": "breaking_change",
          "score": 80,
          "weight": 0.05,
          "reason": "No breaking change signals"
        }
      ],
      "isSpam": false,
      "spamReasons": [],
      "visionAlignment": "unchecked",
      "llmScore": 95,
      "llmRisk": "low",
      "llmReason": "This PR addresses a critical data loss issue. The description is clear, the problem is well-defined, and the solution seems reasonable. The scope is well-defined, and the changes are limited to the necessary areas. The tests cover the core functionality. The security impact is correctly assessed as low. The logging improvement provides valuable feedback to the user. The only minor concern is the lack of a linked issue, but the explanation for its absence is acceptable given the real-world incident. The `isWorkspaceSharedByOtherAgent()` function is a good approach."
    },
    {
      "number": 17473,
      "title": "fix(cache): inject cache_control into system prompt for OpenRouter Anthropic (#15151)",
      "body": "## Summary\n\nFixes #15151. OpenRouter Anthropic users pay full price for re-processing the system prompt (~18k tokens) on every request because no `cache_control` is injected on the system message.\n\n## Root Cause\n\nThe existing OpenRouter integration adds attribution headers (`createOpenRouterHeadersWrapper`) but does not inject Anthropic's `cache_control` field on messages. For direct Anthropic, caching is handled via the `cacheRetention` stream option \u2014 but OpenRouter uses the openai-completions API where caching requires explicit `cache_control` on message content blocks.\n\n## Fix\n\nAdd `createOpenRouterSystemCacheWrapper()` using the same `onPayload` pattern as `createOpenAIResponsesStoreWrapper()`:\n\n```ts\nonPayload: (payload) => {\n    for (const msg of messages) {\n        if (msg.role !== \"system\" && msg.role !== \"developer\") continue;\n        if (typeof msg.content === \"string\") {\n            msg.content = [\n                { type: \"text\", text: msg.content, cache_control: { type: \"ephemeral\" } },\n            ];\n        } else if (Array.isArray(msg.content)) {\n            last.cache_control = { type: \"ephemeral\" };\n        }\n    }\n};\n```\n\nOnly applies to `openrouter` provider with `anthropic/*` model IDs. One new wrapper, no new dependencies.\n\n## Test plan\n\n- [x] String system content converted to array with `cache_control`\n- [x] Array system content gets `cache_control` on last block only\n- [x] Non-Anthropic OpenRouter models not affected\n- [x] User messages not modified\n\n*AI-assisted (Claude). Reviewed by human.*",
      "author": "rrenamed",
      "authorAssociation": "NONE",
      "createdAt": "2026-02-15T19:57:26Z",
      "updatedAt": "2026-02-15T20:16:42Z",
      "headRef": "fix/openrouter-system-prompt-cache",
      "baseRef": "main",
      "filesChanged": 2,
      "additions": 151,
      "deletions": 0,
      "commits": 1,
      "labels": [
        "agents",
        "size: S"
      ],
      "ciStatus": "failure",
      "hasIssueRef": true,
      "issueNumbers": [
        15151
      ],
      "changedFiles": [
        "src/agents/pi-embedded-runner-extraparams.e2e.test.ts",
        "src/agents/pi-embedded-runner/extra-params.ts"
      ],
      "diffUrl": "https://github.com/openclaw/openclaw/pull/17473.diff",
      "hasTests": true,
      "testFilesChanged": [
        "src/agents/pi-embedded-runner-extraparams.e2e.test.ts"
      ],
      "ageInDays": 0,
      "mergeable": "mergeable",
      "reviewState": "none",
      "reviewCount": 0,
      "commentCount": 0,
      "totalScore": 83,
      "signals": [
        {
          "name": "ci_status",
          "score": 10,
          "weight": 0.2,
          "reason": "CI: failure"
        },
        {
          "name": "diff_size",
          "score": 100,
          "weight": 0.1,
          "reason": "151 lines changed (151+/0-)"
        },
        {
          "name": "commit_quality",
          "score": 90,
          "weight": 0.05,
          "reason": "Conventional commit format"
        },
        {
          "name": "contributor",
          "score": 44,
          "weight": 0.15,
          "reason": "rrenamed (NONE, rep: 75)"
        },
        {
          "name": "issue_ref",
          "score": 90,
          "weight": 0.1,
          "reason": "References: #15151"
        },
        {
          "name": "spam",
          "score": 100,
          "weight": 0.15,
          "reason": "No spam signals"
        },
        {
          "name": "test_coverage",
          "score": 90,
          "weight": 0.15,
          "reason": "1 test file(s) changed"
        },
        {
          "name": "staleness",
          "score": 100,
          "weight": 0.1,
          "reason": "0d old (Fresh)"
        },
        {
          "name": "mergeability",
          "score": 100,
          "weight": 0.15,
          "reason": "Merge status: mergeable"
        },
        {
          "name": "review_status",
          "score": 40,
          "weight": 0.1,
          "reason": "Review: none (0 reviews)"
        },
        {
          "name": "body_quality",
          "score": 100,
          "weight": 0.05,
          "reason": "Body: 1542 chars"
        },
        {
          "name": "activity",
          "score": 30,
          "weight": 0.05,
          "reason": "0 comments"
        },
        {
          "name": "breaking_change",
          "score": 80,
          "weight": 0.05,
          "reason": "No breaking change signals"
        }
      ],
      "isSpam": false,
      "spamReasons": [],
      "visionAlignment": "unchecked",
      "llmScore": 90,
      "llmRisk": "low",
      "llmReason": "This PR addresses a real and significant performance issue for OpenRouter Anthropic users by enabling caching of the system prompt. The implementation appears correct and targeted, with tests covering the key scenarios. The risk is low because the changes are isolated to the OpenRouter integration and include checks to avoid unintended side effects on other models or message types. The provided code snippet and explanation are clear and concise.",
      "duplicateGroup": 4
    },
    {
      "number": 17470,
      "title": "feat(cache): per-agent params for cacheRetention control (#17112)",
      "body": "## Summary\n\nFixes #17112. No way to set `cacheRetention` per-agent. Low-traffic agents (e.g., cron jobs running every 30 min) waste money on cache writes ($1.25/MTok) that expire before the next request.\n\n## Root Cause\n\n`resolveExtraParams()` only reads from global model defaults (`agents.defaults.models[\"provider/model\"].params`). There is no per-agent override \u2014 all agents sharing the same model get identical cache settings.\n\n## Fix\n\nAdd optional `params` field to `AgentConfig` and resolve it in `resolveExtraParams()`:\n\n```ts\n// types.agents.ts\nexport type AgentConfig = {\n  // ...existing fields...\n  params?: Record<string, unknown>;\n};\n```\n\n```ts\n// extra-params.ts \u2014 resolveExtraParams now accepts agentId\nconst agentConfig = cfg?.agents?.list?.find((a) => a.id === params.agentId);\nreturn Object.assign({}, globalParams, agentConfig?.params);\n```\n\nAgent params merge on top of global model defaults. Three files changed, no new dependencies.\n\n**Config example:**\n```json\n{\n  \"agents\": {\n    \"list\": [{\n      \"id\": \"risk-reviewer\",\n      \"params\": { \"cacheRetention\": \"none\" }\n    }]\n  }\n}\n```\n\n## Test plan\n\n- [x] Per-agent params returned when agentId matches\n- [x] Agent params merge over global model defaults (agent wins)\n- [x] Unmatched agentId returns undefined (no side effects)\n\n*AI-assisted (Claude). Reviewed by human.*",
      "author": "rrenamed",
      "authorAssociation": "NONE",
      "createdAt": "2026-02-15T19:54:37Z",
      "updatedAt": "2026-02-15T20:16:20Z",
      "headRef": "feat/per-agent-cache-retention",
      "baseRef": "main",
      "filesChanged": 4,
      "additions": 97,
      "deletions": 1,
      "commits": 1,
      "labels": [
        "agents",
        "size: S"
      ],
      "ciStatus": "failure",
      "hasIssueRef": true,
      "issueNumbers": [
        17112
      ],
      "changedFiles": [
        "src/agents/pi-embedded-runner-extraparams.e2e.test.ts",
        "src/agents/pi-embedded-runner/extra-params.ts",
        "src/agents/pi-embedded-runner/run/attempt.ts",
        "src/config/types.agents.ts"
      ],
      "diffUrl": "https://github.com/openclaw/openclaw/pull/17470.diff",
      "hasTests": true,
      "testFilesChanged": [
        "src/agents/pi-embedded-runner-extraparams.e2e.test.ts"
      ],
      "ageInDays": 0,
      "mergeable": "mergeable",
      "reviewState": "none",
      "reviewCount": 0,
      "commentCount": 0,
      "totalScore": 83,
      "signals": [
        {
          "name": "ci_status",
          "score": 10,
          "weight": 0.2,
          "reason": "CI: failure"
        },
        {
          "name": "diff_size",
          "score": 100,
          "weight": 0.1,
          "reason": "98 lines changed (97+/1-)"
        },
        {
          "name": "commit_quality",
          "score": 90,
          "weight": 0.05,
          "reason": "Conventional commit format"
        },
        {
          "name": "contributor",
          "score": 44,
          "weight": 0.15,
          "reason": "rrenamed (NONE, rep: 75)"
        },
        {
          "name": "issue_ref",
          "score": 90,
          "weight": 0.1,
          "reason": "References: #17112"
        },
        {
          "name": "spam",
          "score": 100,
          "weight": 0.15,
          "reason": "No spam signals"
        },
        {
          "name": "test_coverage",
          "score": 90,
          "weight": 0.15,
          "reason": "1 test file(s) changed"
        },
        {
          "name": "staleness",
          "score": 100,
          "weight": 0.1,
          "reason": "0d old (Fresh)"
        },
        {
          "name": "mergeability",
          "score": 100,
          "weight": 0.15,
          "reason": "Merge status: mergeable"
        },
        {
          "name": "review_status",
          "score": 40,
          "weight": 0.1,
          "reason": "Review: none (0 reviews)"
        },
        {
          "name": "body_quality",
          "score": 100,
          "weight": 0.05,
          "reason": "Body: 1342 chars"
        },
        {
          "name": "activity",
          "score": 30,
          "weight": 0.05,
          "reason": "0 comments"
        },
        {
          "name": "breaking_change",
          "score": 80,
          "weight": 0.05,
          "reason": "No breaking change signals"
        }
      ],
      "isSpam": false,
      "spamReasons": [],
      "visionAlignment": "unchecked",
      "llmScore": 90,
      "llmRisk": "low",
      "llmReason": "Solves a real problem (unnecessary cache writes for low-traffic agents). Implementation seems correct and complete, with tests covering the key scenarios. The change is relatively small and well-explained. Merging this would improve the project by allowing more granular control over caching behavior and potentially saving money.",
      "duplicateGroup": 4
    },
    {
      "number": 17333,
      "title": "feat: enhanced GitHub Copilot integration \u2014 SDK provider, CLI backend, and thinking signature fix",
      "body": "## Summary\n\n- **Problem:** OpenClaw's existing Copilot support lacks SDK-based auth/model discovery, CLI backend support, and has a critical bug where multi-turn conversations crash with HTTP 400 when Claude models replay thinking blocks with field-name-as-signature through the `openai-completions` API.\n- **Why it matters:** Users leveraging GitHub Copilot as a model provider (Claude Opus 4.6, GPT-5.3, etc.) get proper token management, automatic model discovery, CLI-mode support, and reliable multi-turn conversations without crashes.\n- **What changed:** (1) Full Copilot SDK provider with auth and model discovery, (2) Copilot CLI backend for terminal usage, (3) Sanitizer that strips thinking blocks with fake signatures before they poison future turns.\n- **What did NOT change:** No modifications to existing Copilot provider behavior \u2014 these are additive enhancements. Direct Anthropic/OpenAI/Google API paths are untouched.\n\n## Change Type (select all)\n\n- [x] Bug fix\n- [x] Feature\n\n## Scope (select all touched areas)\n\n- [x] Auth / tokens\n- [x] Integrations\n- [x] API / contracts\n\n## Linked Issue/PR\n\n- Related openclaw/openclaw#17284 (CLI backend \u2014 standalone PR)\n- Related openclaw/openclaw#14371 (Claude Opus 4.6 Fast model support)\n- Related #2 (Copilot SDK tracking issue)\n\n## Commits\n\n1. **feat: add GitHub Copilot SDK as CLI backend** \u2014 Copilot credentials, SDK wrapper, CLI runner with streaming + tool call support (22 tests)\n2. **feat: add Copilot SDK provider for auth and model discovery** \u2014 Full provider registration, token management, auto model discovery (31 tests)\n3. **fix: strip thinking blocks with field-name-as-signature** \u2014 Sanitizer + transcript policy for the openai-completions thinking signature bug (15 tests)\n\n## User-visible / Behavior Changes\n\n- New provider `github-copilot` available for model configuration with SDK-based auth\n- Copilot models (Claude Opus 4.6, GPT-5.3, etc.) auto-discovered from the API\n- `copilot` CLI backend available for terminal usage\n- Multi-turn conversations with Claude models via Copilot no longer crash with \"Invalid signature in thinking block\" errors\n- New `stripCompletionsReasoningFieldSignatures` transcript policy flag \u2014 enabled automatically for non-native providers using `openai-completions`\n\n## Security Impact (required)\n\n- New permissions/capabilities? Yes \u2014 Copilot SDK auth reads/refreshes tokens from GitHub\n- Secrets/tokens handling changed? Yes \u2014 new Copilot token management flow\n- New/changed network calls? Yes \u2014 calls to Copilot API for auth and model discovery\n- Command/tool execution surface changed? No\n- Data access scope changed? No\n- Risk + mitigation: Token handling follows existing auth profile patterns. Tokens stored in standard credential store, not logged. API calls use HTTPS only.\n\n## Evidence\n\n68 tests passing across 6 test files. Live-tested all models: Claude Opus 4.6 \u2705, 4.6 Fast \u2705, 4.6 1M \u2705, GPT-5.3 Codex \u2705\n\n## Human Verification (required)\n\n- Verified: Multi-turn conversations with all Copilot Claude models, thinking block replay, fallback chain, CLI backend streaming\n- Edge cases: Real signatures preserved (not stripped), non-Copilot providers unaffected, mixed thinking/non-thinking turns\n- Not verified: Windows, Docker sandbox mode\n\n## Compatibility / Migration\n\n- Backward compatible? Yes\n- Config/env changes? Yes \u2014 new optional `github-copilot` provider config\n- Migration needed? No\n\n## Failure Recovery (if this breaks)\n\n- Remove `github-copilot` provider from config, switch to another provider\n- Known symptoms: Auth failures if token expires (auto-refreshes)\n\n## Risks and Mitigations\n\n- Risk: Copilot API changes model IDs or auth flow\n  - Mitigation: SDK-based discovery adapts automatically\n- Risk: Thinking signature stripping too aggressive\n  - Mitigation: Only targets field-name patterns, real cryptographic signatures preserved. Policy only activates for non-native providers.\n\n<!-- greptile_comment -->\n\n<h3>Greptile Summary</h3>\n\nThis PR adds three features: (1) a Copilot SDK provider for auth and model discovery, (2) a Copilot CLI backend for terminal usage, and (3) a sanitizer that strips thinking blocks with fake field-name-as-signature from `openai-completions` sessions.\n\nThe changes are well-structured and additive \u2014 existing provider paths are untouched. Tests are thorough (68 tests across 6 files). Key findings:\n\n- **Bug: `max_prompt_tokens` mapped to `maxTokens`** \u2014 In `buildCopilotModelDefinitionFromSdk`, the SDK's `max_prompt_tokens` (input limit) is mapped to `maxTokens` (output limit). This will inflate the `max_output_tokens` sent to the API for SDK-discovered models.\n- **SDK-managed auth gap in REST runner path** \u2014 When auth is SDK-managed but no `GH_TOKEN`/`GITHUB_TOKEN` env var exists, both `run.ts` and `compact.ts` silently skip setting the API key. The comment says the SDK handles auth, but the SDK is only involved in the CLI backend path \u2014 the REST runner needs a bearer token.\n- **Shared client startup failure not recoverable** \u2014 In `ensureCopilotSdkClient`, a rejected `client.start()` promise is cached forever; subsequent calls return the same rejection with no retry mechanism.\n\n<h3>Confidence Score: 2/5</h3>\n\n- This PR has a confirmed semantic bug in model token mapping and a silent auth failure path that should be resolved before merging.\n- Score of 2 reflects: (1) a definite logic bug where `max_prompt_tokens` is mapped to `maxTokens` (max output tokens), which will cause incorrect API parameters for SDK-discovered models; (2) a silent auth failure in the REST runner path when SDK-managed auth has no env token fallback; and (3) a non-recoverable shared client state on startup failure. The thinking block sanitizer and CLI backend additions look correct.\n- `src/providers/github-copilot-sdk.ts` (token mapping bug + client lifecycle), `src/agents/pi-embedded-runner/run.ts` and `src/agents/pi-embedded-runner/compact.ts` (silent auth gap)\n\n<sub>Last reviewed commit: 798c57a</sub>\n\n<!-- greptile_other_comments_section -->\n\n<sub>(4/5) You can add custom instructions or style guidelines for the agent [here](https://app.greptile.com/review/github)!</sub>\n\n<!-- /greptile_comment -->",
      "author": "tag-assistant",
      "authorAssociation": "NONE",
      "createdAt": "2026-02-15T17:16:53Z",
      "updatedAt": "2026-02-15T20:15:42Z",
      "headRef": "copilot",
      "baseRef": "main",
      "filesChanged": 25,
      "additions": 2047,
      "deletions": 28,
      "commits": 8,
      "labels": [
        "agents",
        "size: XL"
      ],
      "ciStatus": "pending",
      "hasIssueRef": true,
      "issueNumbers": [
        17284,
        14371,
        2
      ],
      "changedFiles": [
        "package.json",
        "pnpm-lock.yaml",
        "src/agents/auth-profiles/constants.ts",
        "src/agents/cli-backends.ts",
        "src/agents/cli-runner.ts",
        "src/agents/copilot-runner.test.ts",
        "src/agents/copilot-runner.ts",
        "src/agents/copilot-sdk.test.ts",
        "src/agents/copilot-sdk.ts",
        "src/agents/model-selection.ts",
        "src/agents/models-config.providers.ts",
        "src/agents/pi-embedded-helpers.strip-completions-reasoning.test.ts",
        "src/agents/pi-embedded-helpers.ts",
        "src/agents/pi-embedded-helpers/openai.ts",
        "src/agents/pi-embedded-runner/compact.ts",
        "src/agents/pi-embedded-runner/google.ts",
        "src/agents/pi-embedded-runner/run.ts",
        "src/agents/transcript-policy.test.ts",
        "src/agents/transcript-policy.ts",
        "src/providers/github-copilot-auth.ts",
        "src/providers/github-copilot-models.test.ts",
        "src/providers/github-copilot-models.ts",
        "src/providers/github-copilot-sdk.test.ts",
        "src/providers/github-copilot-sdk.ts",
        "src/providers/github-copilot-token.ts"
      ],
      "diffUrl": "https://github.com/openclaw/openclaw/pull/17333.diff",
      "hasTests": true,
      "testFilesChanged": [
        "src/agents/copilot-runner.test.ts",
        "src/agents/copilot-sdk.test.ts",
        "src/agents/pi-embedded-helpers.strip-completions-reasoning.test.ts",
        "src/agents/transcript-policy.test.ts",
        "src/providers/github-copilot-models.test.ts",
        "src/providers/github-copilot-sdk.test.ts"
      ],
      "ageInDays": 0,
      "mergeable": "mergeable",
      "reviewState": "commented",
      "reviewCount": 4,
      "commentCount": 1,
      "totalScore": 83,
      "signals": [
        {
          "name": "ci_status",
          "score": 50,
          "weight": 0.2,
          "reason": "CI: pending"
        },
        {
          "name": "diff_size",
          "score": 30,
          "weight": 0.1,
          "reason": "2075 lines changed (2047+/28-)"
        },
        {
          "name": "commit_quality",
          "score": 90,
          "weight": 0.05,
          "reason": "Conventional commit format"
        },
        {
          "name": "contributor",
          "score": 32,
          "weight": 0.15,
          "reason": "tag-assistant (NONE, rep: 35)"
        },
        {
          "name": "issue_ref",
          "score": 90,
          "weight": 0.1,
          "reason": "References: #17284, #14371, #2"
        },
        {
          "name": "spam",
          "score": 100,
          "weight": 0.15,
          "reason": "No spam signals"
        },
        {
          "name": "test_coverage",
          "score": 90,
          "weight": 0.15,
          "reason": "6 test file(s) changed"
        },
        {
          "name": "staleness",
          "score": 100,
          "weight": 0.1,
          "reason": "0d old (Fresh)"
        },
        {
          "name": "mergeability",
          "score": 100,
          "weight": 0.15,
          "reason": "Merge status: mergeable"
        },
        {
          "name": "review_status",
          "score": 70,
          "weight": 0.1,
          "reason": "Review: commented (4 reviews)"
        },
        {
          "name": "body_quality",
          "score": 100,
          "weight": 0.05,
          "reason": "Body: 6184 chars"
        },
        {
          "name": "activity",
          "score": 50,
          "weight": 0.05,
          "reason": "1 comments"
        },
        {
          "name": "breaking_change",
          "score": 40,
          "weight": 0.05,
          "reason": "Risky files: package.json"
        }
      ],
      "isSpam": false,
      "spamReasons": [],
      "visionAlignment": "unchecked",
      "llmScore": 90,
      "llmRisk": "low",
      "llmReason": "This PR addresses a real problem by enhancing Copilot integration with SDK support, CLI backend, and a critical bug fix. The implementation appears complete with tests, and the changes are additive, minimizing risk. The detailed description and clear commit messages increase confidence in its merge-readiness."
    },
    {
      "number": 16779,
      "title": "feat: add `openclaw sessions scrub` command and doctor check for secret leaks",
      "body": "## Summary\n\nCloses #11468\n\nRecreated from #11544 as a clean single-commit branch (the previous PR was closed for having too many unrelated commits).\n\nAdds two features to address `config.get` leaking secrets into session transcripts:\n\n1. **`openclaw sessions scrub`** \u2014 CLI command that scans historical session JSONL files and redacts leaked secrets in-place (with backup by default)\n2. **`openclaw doctor` check** \u2014 detects unredacted secrets in session files and warns the user\n\n## What's included\n\n### New files\n- `src/commands/sessions-scrub.ts` \u2014 scrub command implementation\n- `src/commands/doctor-sessions-secrets.ts` \u2014 doctor check for session secrets\n- `docs/cli/sessions-scrub.md` \u2014 documentation\n\n### Modified files\n- `src/cli/program/register.status-health-sessions.ts` \u2014 Commander.js registration, `sessions` becomes a command group with backward compat\n- `src/commands/doctor.ts` \u2014 wires in the new session secrets check\n\n### Design decisions\n- Reuses canonical `maskToken()` pattern from `src/logging/redact.ts` \u2014 no duplicated regex\n- Creates `.bak` backups by default; `--no-backup` to skip\n- Doctor check scans all files if \u2264200, deterministic sample for larger dirs\n- `openclaw sessions` (no subcommand) still works as before (lists sessions)\n- Multi-pass scrub loop with oscillation guard for stable redaction\n\n### Tests\n- 10 unit tests for sessions scrub (`src/commands/sessions-scrub.test.ts`)\n- 7 unit tests for doctor check (`src/commands/doctor-sessions-secrets.test.ts`)\n- All 17 tests passing\n\n<!-- greptile_comment -->\n\n<h2>Greptile Overview</h2>\n\n<h3>Greptile Summary</h3>\n\nAdds `openclaw sessions scrub` CLI command for at-rest redaction of leaked secrets in session JSONL files, plus a `doctor` check that warns users about unredacted secrets. The implementation is well-structured: scrub uses the canonical `redactSensitiveText` from `redact.ts`, includes a multi-pass loop with oscillation detection, bounded concurrency for performance, and `.bak` backups by default. The `sessions` command is cleanly promoted from a leaf to a command group (matching the existing `agents` pattern) with backward compatibility preserved.\n\n- Documentation states files are processed \"sequentially\" but the implementation uses bounded concurrency (default 20 workers) \u2014 docs should be corrected\n- `parsePattern` in `doctor-sessions-secrets.ts` duplicates the private function in `redact.ts`; consider exporting a shared version to prevent drift\n- Test coverage is thorough (17 tests covering dry-run, backup, multi-pass, oscillation guard, edge cases)\n\n<h3>Confidence Score: 4/5</h3>\n\n- This PR is safe to merge with minor documentation fixes needed\n- The core logic is sound: the scrub command correctly uses the canonical redaction utilities, the concurrency pattern is safe in Node.js, the oscillation guard prevents infinite loops, and the backward-compatible command group promotion follows established codebase patterns. The only actionable issue is a documentation inaccuracy (sequential vs concurrent processing). The duplicated parsePattern is a maintenance risk but not a runtime bug. Test coverage is solid at 17 tests.\n- docs/cli/sessions-scrub.md (documentation inaccuracy about processing model)\n\n<sub>Last reviewed commit: bec7b8e</sub>\n\n<!-- greptile_other_comments_section -->\n\n<!-- /greptile_comment -->",
      "author": "akoscz",
      "authorAssociation": "CONTRIBUTOR",
      "createdAt": "2026-02-15T03:46:23Z",
      "updatedAt": "2026-02-15T20:52:36Z",
      "headRef": "feature/sessions-scrub-clean",
      "baseRef": "main",
      "filesChanged": 10,
      "additions": 1125,
      "deletions": 12,
      "commits": 4,
      "labels": [
        "docs",
        "gateway",
        "cli",
        "commands",
        "size: L"
      ],
      "ciStatus": "failure",
      "hasIssueRef": true,
      "issueNumbers": [
        11468
      ],
      "changedFiles": [
        "docs/cli/sessions-scrub.md",
        "src/cli/program/register.status-health-sessions.ts",
        "src/cli/program/routes.ts",
        "src/commands/doctor-sessions-secrets.test.ts",
        "src/commands/doctor-sessions-secrets.ts",
        "src/commands/doctor.ts",
        "src/commands/sessions-scrub.test.ts",
        "src/commands/sessions-scrub.ts",
        "src/gateway/session-utils.fs.ts",
        "src/logging/redact.ts"
      ],
      "diffUrl": "https://github.com/openclaw/openclaw/pull/16779.diff",
      "hasTests": true,
      "testFilesChanged": [
        "src/commands/doctor-sessions-secrets.test.ts",
        "src/commands/sessions-scrub.test.ts"
      ],
      "ageInDays": 0,
      "mergeable": "unknown",
      "reviewState": "commented",
      "reviewCount": 2,
      "commentCount": 1,
      "totalScore": 82,
      "signals": [
        {
          "name": "ci_status",
          "score": 10,
          "weight": 0.2,
          "reason": "CI: failure"
        },
        {
          "name": "diff_size",
          "score": 60,
          "weight": 0.1,
          "reason": "1137 lines changed (1125+/12-)"
        },
        {
          "name": "commit_quality",
          "score": 90,
          "weight": 0.05,
          "reason": "Conventional commit format"
        },
        {
          "name": "contributor",
          "score": 79,
          "weight": 0.15,
          "reason": "akoscz (CONTRIBUTOR, rep: 100)"
        },
        {
          "name": "issue_ref",
          "score": 90,
          "weight": 0.1,
          "reason": "References: #11468"
        },
        {
          "name": "spam",
          "score": 100,
          "weight": 0.15,
          "reason": "No spam signals"
        },
        {
          "name": "test_coverage",
          "score": 90,
          "weight": 0.15,
          "reason": "2 test file(s) changed"
        },
        {
          "name": "staleness",
          "score": 100,
          "weight": 0.1,
          "reason": "0d old (Fresh)"
        },
        {
          "name": "mergeability",
          "score": 50,
          "weight": 0.15,
          "reason": "Merge status: unknown"
        },
        {
          "name": "review_status",
          "score": 70,
          "weight": 0.1,
          "reason": "Review: commented (2 reviews)"
        },
        {
          "name": "body_quality",
          "score": 90,
          "weight": 0.05,
          "reason": "Body: 3338 chars"
        },
        {
          "name": "activity",
          "score": 50,
          "weight": 0.05,
          "reason": "1 comments"
        },
        {
          "name": "breaking_change",
          "score": 80,
          "weight": 0.05,
          "reason": "No breaking change signals"
        }
      ],
      "isSpam": false,
      "spamReasons": [],
      "visionAlignment": "unchecked",
      "llmScore": 90,
      "llmRisk": "low",
      "llmReason": "Addresses a real security concern (secret leakage in session files). Implementation seems thorough with backup, doctor check, and tests. The design decisions (maskToken reuse, backup, sampling) are sensible. The multi-pass scrub loop with oscillation guard is a nice touch. The risk is low because it adds functionality without removing existing features, and includes tests.",
      "duplicateGroup": 1
    },
    {
      "number": 16961,
      "title": "docs: warn against storing secrets in injected workspace files",
      "body": "## Summary\n\n- Problem: Workspace bootstrap files (`AGENTS.md`, `TOOLS.md`, `SOUL.md`, etc.) are injected into model context during runs. Users who store API keys, passwords, or tokens in these files unknowingly expose them to the model.\n- Why it matters: Security risk \u2014 credentials end up in prompt context and may leak via model outputs, logs, or context compaction artifacts.\n- What changed: Added explicit \"do not store secrets here\" warnings across all documentation pages and templates where users are likely to paste credentials.\n- What did NOT change (scope boundary): No runtime behavior changes. Pure documentation/template updates.\n\nlobster-biscuit\n\n## Change Type (select all)\n\n- [ ] Bug fix\n- [ ] Feature\n- [ ] Refactor\n- [x] Docs\n- [x] Security hardening\n- [ ] Chore/infra\n\n## Scope (select all touched areas)\n\n- [ ] Gateway / orchestration\n- [ ] Skills / tool execution\n- [ ] Auth / tokens\n- [ ] Memory / storage\n- [ ] Integrations\n- [ ] API / contracts\n- [x] UI / DX\n- [ ] CI/CD / infra\n\n## Linked Issue/PR\n\n- Supersedes #13290 (closed for fresh resubmission)\n\n## User-visible / Behavior Changes\n\n- New security warnings visible in documentation and workspace templates.\n- Dev workspace fallback template string now includes a one-line secrets warning.\n\n## Security Impact (required)\n\n- New permissions/capabilities? `No`\n- Secrets/tokens handling changed? `No`\n- New/changed network calls? `No`\n- Command/tool execution surface changed? `No`\n- Data access scope changed? `No`\n- This PR *prevents* a security footgun by making the risk visible to users.\n\n## Repro + Verification\n\n### Environment\n\n- OS: Any\n- Runtime/container: N/A (documentation)\n- Model/provider: N/A\n- Integration/channel (if any): N/A\n\n### Steps\n\n1. Read any workspace template or docs page about TOOLS.md / workspace files\n2. Look for guidance about secrets\n\n### Expected\n\n- Clear warnings that these files are injected into model context and must not contain secrets\n\n### Actual\n\n- No warnings (before this PR)\n\n## Evidence\n\n- [x] Trace/log snippets: Verified all 8 files render correctly with warnings in place\n\n## Human Verification (required)\n\n- Verified scenarios: Read each modified file to confirm warnings are clear and non-disruptive\n- Edge cases checked: Ensured dev workspace fallback string in `dev.ts` renders correctly as a one-liner\n- What you did **not** verify: Docs build rendering (no local docs build available)\n\n## Compatibility / Migration\n\n- Backward compatible? `Yes`\n- Config/env changes? `No`\n- Migration needed? `No`\n\n## Failure Recovery (if this breaks)\n\n- How to disable/revert this change quickly: Revert the single commit\n- Files/config to restore: 7 docs files + `src/cli/gateway-cli/dev.ts`\n- Known bad symptoms reviewers should watch for: Broken markdown rendering in docs\n\n## Risks and Mitigations\n\nNone \u2014 pure documentation additions.\n\n---\n\n- [x] Mark as AI-assisted in the PR title or description\n- [x] Note the degree of testing: fully tested (8 files verified), all code understood by author\n- [x] Confirm understanding: all code understood by author\n\n\ud83e\udd16 AI-assisted PR (Claude Code) \u2014 fully tested, all code understood by author",
      "author": "soumikbhatta",
      "authorAssociation": "NONE",
      "createdAt": "2026-02-15T08:39:37Z",
      "updatedAt": "2026-02-15T20:39:34Z",
      "headRef": "docs/secrets-in-workspace-files",
      "baseRef": "main",
      "filesChanged": 8,
      "additions": 35,
      "deletions": 4,
      "commits": 1,
      "labels": [
        "docs",
        "cli",
        "size: XS"
      ],
      "ciStatus": "failure",
      "hasIssueRef": true,
      "issueNumbers": [
        13290
      ],
      "changedFiles": [
        "docs/concepts/agent-workspace.md",
        "docs/concepts/system-prompt.md",
        "docs/reference/AGENTS.default.md",
        "docs/reference/templates/AGENTS.md",
        "docs/reference/templates/TOOLS.dev.md",
        "docs/reference/templates/TOOLS.md",
        "docs/start/openclaw.md",
        "src/cli/gateway-cli/dev.ts"
      ],
      "diffUrl": "https://github.com/openclaw/openclaw/pull/16961.diff",
      "hasTests": false,
      "testFilesChanged": [],
      "ageInDays": 0,
      "mergeable": "mergeable",
      "reviewState": "none",
      "reviewCount": 0,
      "commentCount": 0,
      "totalScore": 82,
      "signals": [
        {
          "name": "ci_status",
          "score": 10,
          "weight": 0.2,
          "reason": "CI: failure"
        },
        {
          "name": "diff_size",
          "score": 70,
          "weight": 0.1,
          "reason": "39 lines changed (35+/4-)"
        },
        {
          "name": "commit_quality",
          "score": 90,
          "weight": 0.05,
          "reason": "Conventional commit format"
        },
        {
          "name": "contributor",
          "score": 51,
          "weight": 0.15,
          "reason": "soumikbhatta (NONE, rep: 100)"
        },
        {
          "name": "issue_ref",
          "score": 90,
          "weight": 0.1,
          "reason": "References: #13290"
        },
        {
          "name": "spam",
          "score": 100,
          "weight": 0.15,
          "reason": "No spam signals"
        },
        {
          "name": "test_coverage",
          "score": 20,
          "weight": 0.15,
          "reason": "No test files changed in code PR"
        },
        {
          "name": "staleness",
          "score": 100,
          "weight": 0.1,
          "reason": "0d old (Fresh)"
        },
        {
          "name": "mergeability",
          "score": 100,
          "weight": 0.15,
          "reason": "Merge status: mergeable"
        },
        {
          "name": "review_status",
          "score": 40,
          "weight": 0.1,
          "reason": "Review: none (0 reviews)"
        },
        {
          "name": "body_quality",
          "score": 100,
          "weight": 0.05,
          "reason": "Body: 3156 chars"
        },
        {
          "name": "activity",
          "score": 30,
          "weight": 0.05,
          "reason": "0 comments"
        },
        {
          "name": "breaking_change",
          "score": 80,
          "weight": 0.05,
          "reason": "No breaking change signals"
        }
      ],
      "isSpam": false,
      "spamReasons": [],
      "visionAlignment": "unchecked",
      "llmScore": 95,
      "llmRisk": "low",
      "llmReason": "Addresses a real security risk by preventing users from accidentally exposing secrets. The implementation is straightforward and complete, adding warnings to relevant documentation and templates. The PR improves the project by enhancing security awareness and reducing the likelihood of accidental credential leaks. The risk is low because it only adds documentation and template updates without changing runtime behavior."
    },
    {
      "number": 17454,
      "title": "feat(matrix): support device verification via recovery key",
      "body": "## Summary\r\n\r\n- **Problem:** While Matrix E2EE bots could participate in some encrypted conversations, device verification was impossible in OpenClaw, creating trust issues and poor UX. Messages could be flagged due to unverified devices, and certain user/admin settings would prevent interacting with unverified devices completely. Bots also couldn't restore encrypted message history from backup.\r\n- **Why it matters:** Unverified device warnings undermine user trust and make bots appear insecure or compromised. In security-conscious environments, users may ignore or distrust unverified bot messages, limiting bot utility in E2EE channels.\r\n- **What changed:** Added complete Matrix device verification workflow via recovery key, including secret storage decryption, cross-signing key restoration, device signing, and encrypted backup restoration. Multi-account support allows managing multiple Matrix identities with independent verification states. Verified bots now send trusted messages without warnings.\r\n- **What did NOT change (scope boundary):** Interactive device verification flows (QR code, emoji comparison), manual secret storage setup, or backup creation. This PR only handles verification/restoration using an existing recovery key from Element/another client.\r\n\r\n## Change Type (select all)\r\n\r\n- [ ] Bug fix\r\n- [x] Feature\r\n- [ ] Refactor\r\n- [ ] Docs\r\n- [ ] Security hardening\r\n- [ ] Chore/infra\r\n\r\n## Scope (select all touched areas)\r\n\r\n- [x] Gateway / orchestration\r\n- [ ] Skills / tool execution\r\n- [ ] Auth / tokens\r\n- [ ] Memory / storage\r\n- [x] Integrations\r\n- [x] API / contracts\r\n- [x] UI / DX\r\n- [ ] CI/CD / infra\r\n\r\n## Linked Issue/PR\r\n\r\n- Closes #7649, #15706, and probably many other duplicated issues\r\n\r\n## User-visible / Behavior Changes\r\n\r\n**New CLI Commands:**\r\n- `openclaw matrix verify status` - Show device verification status for a Matrix account\r\n- `openclaw matrix verify recovery-key <key>` - Verify device using recovery key\r\n- Both commands support `--account <id>` for multi-account setups\r\n- JSON output via `--json` flag\r\n\r\n**Gateway RPC Methods:**\r\n- `matrix.verify.recoveryKey` - Verify device and restore encrypted backups\r\n- `matrix.verify.status` - Get current verification state\r\n\r\n**Configuration:**\r\n- No config changes required; works with existing `channels.matrix.accounts` multi-account setup\r\n- E2EE must be enabled: `channels.matrix.encryption: true`\r\n\r\n**Behavior:**\r\n- Verified devices can now read encrypted room history\r\n- Devices remain verified across restarts (state persisted per account)\r\n- Backup restoration happens automatically during verification (if available)\r\n- Bot-SDK limitation: backup restoration requires Element for full functionality\r\n\r\n## Security Impact (required)\r\n\r\n- New permissions/capabilities? `Yes`\r\n- Secrets/tokens handling changed? `Yes`\r\n- New/changed network calls? `Yes`\r\n- Command/tool execution surface changed? `No`\r\n- Data access scope changed? `Yes`\r\n\r\n**Explanation:**\r\n\r\n**New Capabilities:**\r\n- Decrypts secret storage using recovery key (PBKDF2 key derivation + AES-CTR)\r\n- Accesses Matrix account's encrypted cross-signing keys (master, self-signing, user-signing)\r\n- Signs device with cross-signing keys to establish trust\r\n- Downloads and decrypts encrypted message backup from homeserver\r\n\r\n**Risk + Mitigation:**\r\n\r\n1. **Recovery key exposure in CLI arguments:**\r\n   - Risk: Shell history/process listing exposure\r\n   - Mitigation: Supports `--file` flag to read from file, warns when using env var, CLI help encourages secure patterns\r\n\r\n2. **Decrypted keys in memory:**\r\n   - Risk: Cross-signing private keys held in memory during verification\r\n   - Mitigation: Keys only loaded during verification operation, not retained long-term; Node.js memory isolation\r\n\r\n3. **Verification state persistence:**\r\n   - Risk: Verification timestamp/backup version stored in per-account SQLite DB\r\n   - Mitigation: No sensitive keys persisted; only verification metadata; DB stored in standard OpenClaw paths with OS-level permissions\r\n\r\n4. **Homeserver API calls:**\r\n   - Risk: New API calls to fetch secret storage, backup versions, backup keys\r\n   - Mitigation: All calls use existing authenticated Matrix client; follows matrix-js-sdk patterns; proper error handling for API failures\r\n\r\n## Repro + Verification\r\n\r\n### Environment\r\n\r\n- OS: macOS 14 (tested), Linux (tested)\r\n- Runtime/container: Node.js 22+\r\n- Model/provider: N/A (Matrix integration)\r\n- Integration/channel: Matrix (matrix-js-sdk)\r\n- Relevant config (redacted):\r\n```json\r\n{\r\n  \"channels\": {\r\n    \"matrix\": {\r\n      \"enabled\": true,\r\n      \"homeserver\": \"https://matrix.example.com\",\r\n      \"encryption\": true,\r\n      \"accounts\": {\r\n        \"main\": {\r\n          \"name\": \"Main Bot\",\r\n          \"accessToken\": \"syt_...\"\r\n        },\r\n        \"work\": {\r\n          \"name\": \"Work Bot\",\r\n          \"accessToken\": \"syt_...\"\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n```\r\n\r\n### Steps\r\n\r\n**Single Account:**\r\n1. Configure Matrix channel with E2EE enabled\r\n2. Obtain recovery key from Matrix client such as Element (Settings \u2192 Security \u2192 Key Backup)\r\n3. Run `openclaw matrix verify recovery-key \"AbCd ... 6789\"`\r\n4. Run `openclaw matrix verify status` to confirm verification\r\n5. Send encrypted message to bot's room\r\n6. Verify bot can read and respond to encrypted messages\r\n\r\n**Multi-Account:**\r\n1. Configure multiple Matrix accounts in config\r\n2. Run `openclaw matrix verify status --account main` (shows unconfigured)\r\n3. Run `openclaw matrix verify recovery-key <key> --account main`\r\n4. Run `openclaw matrix verify status --account work` (still unconfigured)\r\n5. Verify each account has independent verification state\r\n\r\n### Expected\r\n\r\n- Device verification succeeds with valid recovery key\r\n- Bot can decrypt incoming encrypted messages\r\n- Encrypted backup restored (if available)\r\n- Status shows \"Verified \u2713\" with device ID and backup info\r\n- Multi-account setups maintain separate verification states\r\n\r\n### Actual\r\n\r\n- All expected behaviors confirmed \u2713\r\n- Helpful error messages when account not configured\r\n- Clean JSON output for scripting/automation\r\n\r\n## Evidence\r\n\r\n- [x] Failing test/log before + passing after\r\n- [x] Trace/log snippets\r\n- [x] Screenshot/recording\r\n- [ ] Perf numbers (if relevant)\r\n<img width=\"884\" height=\"132\" alt=\"image\" src=\"https://github.com/user-attachments/assets/da1584a9-eca7-4f38-aff3-8c26d1fc484f\" />\r\n\r\n\r\n**Test Coverage:**\r\n- 65 new tests across 4 test suites\r\n- Unit tests: crypto utils, secret storage, backup restoration, device signing\r\n- Integration tests: multi-account verification, account isolation, handler lifecycle\r\n- CLI tests: command parsing, output formatting, error handling\r\n- All tests passing (146/150 total; 4 pre-existing failures unrelated to this work)\r\n\r\n**Code Coverage:**\r\n- Registry: >95% (multi-account handler management)\r\n- Handler: >90% (verification workflow)\r\n- CLI: >90% (command parsing, output formatting)\r\n\r\n## Human Verification (required)\r\n\r\nWhat you personally verified (not just CI), and how:\r\n\r\n**Verified scenarios:**\r\n- Single-account verification with recovery key from Element\r\n- Multi-account setup with two Matrix identities\r\n- Status command shows correct verification state per account\r\n- Helpful error messages when account not found\r\n- Bot successfully reads encrypted messages after verification\r\n- Verification state persists across gateway restarts\r\n- JSON output mode for both commands\r\n\r\n**Edge cases checked:**\r\n- Invalid recovery key format (shows clear error)\r\n- Account not configured (shows troubleshooting steps)\r\n- No default account (CLI requires explicit `--account`)\r\n- Missing E2EE configuration (clear error message)\r\n- Backup available but not restored (shows bot-SDK limitation note)\r\n\r\n**What I did NOT verify:**\r\n- Windows platform (matrix-js-sdk should work, but not manually tested)\r\n- Homeserver federation edge cases\r\n- Large backup restoration (>1000 keys)\r\n- Concurrent verification requests across accounts\r\n- Recovery key rotation scenarios\r\n\r\n## Compatibility / Migration\r\n\r\n- Backward compatible? `Yes`\r\n- Config/env changes? `No`\r\n- Migration needed? `No`\r\n\r\n**Details:**\r\n- Works with existing `channels.matrix.accounts` multi-account configuration\r\n- No config migration required\r\n- Verification is opt-in; existing deployments work unchanged\r\n- Single-account setups use `default` account ID automatically\r\n- Graceful degradation: if handler not available, shows \"not configured\" status\r\n\r\n## Failure Recovery (if this breaks)\r\n\r\n**How to disable/revert this change quickly:**\r\n- Remove recovery key from environment/files\r\n- Verification state is stored per-account in `~/.openclaw/extensions/matrix/<accountId>/verification.db`\r\n- To reset: `rm ~/.openclaw/extensions/matrix/*/verification.db` and restart gateway\r\n\r\n**Files/config to restore:**\r\n- No config changes needed to disable\r\n- To fully revert: checkout previous commit and rebuild\r\n\r\n**Known bad symptoms reviewers should watch for:**\r\n- Bot unable to read encrypted messages \u2192 Check verification status with `openclaw matrix verify status`\r\n- \"Account not found\" errors \u2192 Ensure account ID matches config, E2EE enabled\r\n- Verification succeeds but messages still encrypted \u2192 Backup restoration may require Element client\r\n- Memory leaks during verification \u2192 Monitor Node.js heap (unlikely, keys only held during operation)\r\n\r\n## Risks and Mitigations\r\n\r\n- **Risk:** Recovery key exposure via CLI arguments or shell history\r\n  - **Mitigation:** CLI supports `--file` flag, warns on env var usage, documentation encourages secure file-based approach\r\n\r\n- **Risk:** Verification state desync if multiple gateways run concurrently\r\n  - **Mitigation:** Verification state stored per-process; gateway runs as singleton by design; multi-gateway setups should use separate config/accounts\r\n\r\n- **Risk:** Bot-SDK limitations prevent full backup restoration\r\n  - **Mitigation:** User-visible note in CLI output; documented in Matrix channel docs; verification still establishes trust even without full backup restore\r\n\r\n- **Risk:** Breaking changes to matrix-js-sdk encryption APIs\r\n  - **Mitigation:** Uses stable matrix-js-sdk APIs; extensive test coverage will catch API changes; crypto implementation follows Element's patterns\r\n\r\n## AI usage\r\n- This PR was created with the assistance of AI\r\n- I've manually tested as much as I could locally and in my instance, including both success and failure paths\r\n- I do understand what the code does\n\n<!-- greptile_comment -->\n\n<h3>Greptile Summary</h3>\n\nThis PR adds complete Matrix device verification via recovery key, enabling bots to participate in encrypted conversations as verified devices. The implementation covers Base58 key decoding, Matrix SSSS (Secure Secret Storage and Sharing) decryption, cross-signing key restoration, Ed25519 device signing, and encrypted backup restoration. Multi-account support allows independent verification states per Matrix identity.\n\n- **Crypto implementation** is solid: proper HKDF key derivation, HMAC-SHA256 MAC verification with constant-time comparison (`timingSafeEqual`), and AES-256-CTR decryption follow the Matrix spec correctly\n- **Key material cleanup issue**: on error paths in `handler.ts`, the recovery key and cross-signing private keys are not zeroed out \u2014 only the happy path runs `.fill(0)`. This should use a `finally` block to ensure cleanup in all cases\n- **Canonical JSON sorting**: `canonicalJsonStringify` in `device-signing.ts` uses `localeCompare()` instead of codepoint comparison for key sorting. Works for current ASCII-only keys but deviates from the Matrix spec\n- **Architecture**: follows existing extension patterns \u2014 gateway methods registered via `api.registerGatewayMethod()`, CLI commands use `callGatewayFromCli` with proper progress indicators, state persistence uses file locking via `proper-lockfile`\n- **Backup restoration** is a documented no-op due to bot-SDK limitations \u2014 clearly communicated in code, logs, and user-facing CLI output\n- **Test coverage** is thorough with 65 new tests covering crypto, storage, multi-account, and CLI layers\n\n<h3>Confidence Score: 4/5</h3>\n\n- This PR is safe to merge with one security improvement recommended for key material cleanup on error paths.\n- The cryptographic implementation is well-structured and follows Matrix spec correctly. The one concern is that sensitive key material (recovery key, cross-signing private keys) is not zeroed on error paths in the verification handler, which is a security best practice gap. The rest of the code is clean with thorough test coverage, proper error handling, and good architecture that follows existing codebase patterns.\n- `extensions/matrix/src/matrix/recovery-key/handler.ts` needs attention for the key zeroing issue on error paths.\n\n<sub>Last reviewed commit: 01d3d78</sub>\n\n<!-- greptile_other_comments_section -->\n\n<sub>(3/5) Reply to the agent's comments like \"Can you suggest a fix for this @greptileai?\" or ask follow-up questions!</sub>\n\n<!-- /greptile_comment -->",
      "author": "kylerm42",
      "authorAssociation": "NONE",
      "createdAt": "2026-02-15T19:39:41Z",
      "updatedAt": "2026-02-15T20:19:39Z",
      "headRef": "feat/matrix-device-verification-recovery-key",
      "baseRef": "main",
      "filesChanged": 31,
      "additions": 6428,
      "deletions": 16,
      "commits": 1,
      "labels": [
        "docs",
        "channel: matrix",
        "app: web-ui",
        "gateway",
        "cli",
        "size: XL"
      ],
      "ciStatus": "failure",
      "hasIssueRef": true,
      "issueNumbers": [
        7649
      ],
      "changedFiles": [
        "docs/channels/matrix.md",
        "extensions/matrix/index.ts",
        "extensions/matrix/package.json",
        "extensions/matrix/src/matrix/monitor/index.ts",
        "extensions/matrix/src/matrix/probe.ts",
        "extensions/matrix/src/matrix/recovery-key/backup.test.ts",
        "extensions/matrix/src/matrix/recovery-key/backup.ts",
        "extensions/matrix/src/matrix/recovery-key/constants.ts",
        "extensions/matrix/src/matrix/recovery-key/crypto-utils.test.ts",
        "extensions/matrix/src/matrix/recovery-key/crypto-utils.ts",
        "extensions/matrix/src/matrix/recovery-key/device-signing.test.ts",
        "extensions/matrix/src/matrix/recovery-key/device-signing.ts",
        "extensions/matrix/src/matrix/recovery-key/handler.test.ts",
        "extensions/matrix/src/matrix/recovery-key/handler.ts",
        "extensions/matrix/src/matrix/recovery-key/index.ts",
        "extensions/matrix/src/matrix/recovery-key/multi-account-e2e.test.ts",
        "extensions/matrix/src/matrix/recovery-key/registry.test.ts",
        "extensions/matrix/src/matrix/recovery-key/registry.ts",
        "extensions/matrix/src/matrix/recovery-key/secret-storage.test.ts",
        "extensions/matrix/src/matrix/recovery-key/secret-storage.ts",
        "extensions/matrix/src/matrix/recovery-key/store.test.ts",
        "extensions/matrix/src/matrix/recovery-key/store.ts",
        "extensions/matrix/src/matrix/recovery-key/types.ts",
        "src/cli/matrix-cli-output.test.ts",
        "src/cli/matrix-cli.test.ts",
        "src/cli/matrix-cli.ts",
        "src/cli/program/command-registry.ts",
        "src/gateway/protocol/index.ts",
        "src/gateway/protocol/schema.ts",
        "src/gateway/protocol/schema/matrix.ts",
        "src/gateway/server-methods.ts"
      ],
      "diffUrl": "https://github.com/openclaw/openclaw/pull/17454.diff",
      "hasTests": true,
      "testFilesChanged": [
        "extensions/matrix/src/matrix/recovery-key/backup.test.ts",
        "extensions/matrix/src/matrix/recovery-key/crypto-utils.test.ts",
        "extensions/matrix/src/matrix/recovery-key/device-signing.test.ts",
        "extensions/matrix/src/matrix/recovery-key/handler.test.ts",
        "extensions/matrix/src/matrix/recovery-key/multi-account-e2e.test.ts",
        "extensions/matrix/src/matrix/recovery-key/registry.test.ts",
        "extensions/matrix/src/matrix/recovery-key/secret-storage.test.ts",
        "extensions/matrix/src/matrix/recovery-key/store.test.ts",
        "src/cli/matrix-cli-output.test.ts",
        "src/cli/matrix-cli.test.ts"
      ],
      "ageInDays": 0,
      "mergeable": "mergeable",
      "reviewState": "commented",
      "reviewCount": 1,
      "commentCount": 1,
      "totalScore": 82,
      "signals": [
        {
          "name": "ci_status",
          "score": 10,
          "weight": 0.2,
          "reason": "CI: failure"
        },
        {
          "name": "diff_size",
          "score": 30,
          "weight": 0.1,
          "reason": "6444 lines changed (6428+/16-)"
        },
        {
          "name": "commit_quality",
          "score": 90,
          "weight": 0.05,
          "reason": "Conventional commit format"
        },
        {
          "name": "contributor",
          "score": 49,
          "weight": 0.15,
          "reason": "kylerm42 (NONE, rep: 94)"
        },
        {
          "name": "issue_ref",
          "score": 90,
          "weight": 0.1,
          "reason": "References: #7649"
        },
        {
          "name": "spam",
          "score": 100,
          "weight": 0.15,
          "reason": "No spam signals"
        },
        {
          "name": "test_coverage",
          "score": 90,
          "weight": 0.15,
          "reason": "10 test file(s) changed"
        },
        {
          "name": "staleness",
          "score": 100,
          "weight": 0.1,
          "reason": "0d old (Fresh)"
        },
        {
          "name": "mergeability",
          "score": 100,
          "weight": 0.15,
          "reason": "Merge status: mergeable"
        },
        {
          "name": "review_status",
          "score": 60,
          "weight": 0.1,
          "reason": "Review: commented (1 reviews)"
        },
        {
          "name": "body_quality",
          "score": 100,
          "weight": 0.05,
          "reason": "Body: 13046 chars"
        },
        {
          "name": "activity",
          "score": 50,
          "weight": 0.05,
          "reason": "1 comments"
        },
        {
          "name": "breaking_change",
          "score": 80,
          "weight": 0.05,
          "reason": "No breaking change signals"
        }
      ],
      "isSpam": false,
      "spamReasons": [],
      "visionAlignment": "unchecked",
      "llmScore": 90,
      "llmRisk": "medium",
      "llmReason": "This PR addresses a significant usability and security gap for Matrix E2EE bots by enabling device verification via recovery keys. The description is thorough, outlining the problem, solution, and scope. The inclusion of tests (unit and multi-account) is excellent. The risk is medium because the changes touch several areas (integrations, API, UI), and recovery key handling is security-sensitive. Thorough review and testing are crucial before merging."
    },
    {
      "number": 17453,
      "title": "fix(signal): make group reactions deterministic from inbound sender metadata",
      "body": "## Summary\r\n\r\n  Describe the problem and fix in 2\u20135 bullets:\r\n\r\n  - Problem: Signal group reactions were unreliable because targetAuthor/targetAuthorUuid was often missing or model-\r\n    guessed, causing reactions to fail or be accepted without visible UI effect.\r\n  - Why it matters: Group reaction behavior must deterministically target the exact inbound message author; otherwise\r\n    reactions are flaky in real group chats.\r\n  - What changed: Added an inbound reaction-target cache (groupId + messageId -> sender uuid/e164), populated it in\r\n    Signal inbound handling, and used it in outbound react action prep when targetAuthor* is not provided. Also\r\n    tightened reaction payload shaping to prefer UUID and set recipients for group reactions/removals.\r\n  - What did NOT change (scope boundary): No changes to non-Signal channels, no new external services, no schema/API\r\n    contract changes, and no config migration.\r\n\r\n  ## Change Type (select all)\r\n\r\n  - [x] Bug fix\r\n  - [ ] Feature\r\n  - [ ] Refactor\r\n  - [ ] Docs\r\n  - [ ] Security hardening\r\n  - [ ] Chore/infra\r\n\r\n  ## Scope (select all touched areas)\r\n\r\n  - [x] Gateway / orchestration\r\n  - [ ] Skills / tool execution\r\n  - [ ] Auth / tokens\r\n  - [x] Memory / storage\r\n  - [x] Integrations\r\n  - [ ] API / contracts\r\n  - [ ] UI / DX\r\n  - [ ] CI/CD / infra\r\n\r\n  ## Linked Issue/PR\r\n\r\n  - Closes #\r\n  - Related #\r\n\r\n  ## User-visible / Behavior Changes\r\n\r\n  - Signal group \u201creact to this message\u201d is now more reliable when messageId is known but targetAuthor* is omitted.\r\n  - For group reactions/removals, UUID targeting is preferred and recipient shaping is more consistent.\r\n  - No new user-facing config required.\r\n\r\n  ## Security Impact (required)\r\n\r\n  - New permissions/capabilities? (No)\r\n  - Secrets/tokens handling changed? (No)\r\n  - New/changed network calls? (No)\r\n  - Command/tool execution surface changed? (No)\r\n  - Data access scope changed? (Yes)\r\n  - If any Yes, explain risk + mitigation:\r\n      - Added a small in-memory cache of inbound group reaction metadata (sender identifier keyed by group/message) with\r\n        TTL and size cap.\r\n      - Mitigations: bounded cache (MAX_ENTRIES), expiration (TTL_MS), no persistence to disk, no secret material.\r\n\r\n  ## Repro + Verification\r\n\r\n  ### Environment\r\n\r\n  - OS: macOS\r\n  - Runtime/container: Docker Compose (openclaw-gateway + signal-cli-daemon)\r\n  - Model/provider: OpenAI Codex (gpt-5.3-codex)\r\n  - Integration/channel (if any): Signal group + direct chat\r\n  - Relevant config (redacted): channels.signal.reactionLevel=minimal, actions.reactions=true\r\n\r\n  ### Steps\r\n\r\n  1. Receive a Signal group inbound message and ask agent to react to that message.\r\n  2. Trigger message.react without explicitly forcing targetAuthorUuid.\r\n  3. Observe gateway logs and Signal UI behavior.\r\n\r\n  ### Expected\r\n\r\n  - Group reaction resolves to exact inbound sender and appears in Signal UI.\r\n\r\n  ### Actual\r\n\r\n  - Before fix: reactions frequently failed (targetAuthor required) or reported success but were not visible.\r\n  - After fix: deterministic sender targeting is applied via inbound cache; reactions are consistently resolved.\r\n\r\n  ## Evidence\r\n\r\n  Attach at least one:\r\n\r\n  - [x] Failing test/log before + passing after\r\n  - [x] Trace/log snippets\r\n  - [ ] Screenshot/recording\r\n  - [ ] Perf numbers (if relevant)\r\n\r\n  ## Human Verification (required)\r\n\r\n  What you personally verified (not just CI), and how:\r\n\r\n  - Verified scenarios:\r\n      - Group reaction target hydration from inbound metadata cache.\r\n      - UUID-preferred target selection.\r\n      - Group removal payload shaping using resolved target.\r\n  - Edge cases checked:\r\n      - Missing targetAuthor* with valid groupId + messageId.\r\n      - UUID vs E.164 fallback behavior.\r\n  - What you did not verify:\r\n      - Full matrix across all Signal daemon versions and multi-device clients.\r\n\r\n  ## Compatibility / Migration\r\n\r\n  - Backward compatible? (Yes)\r\n  - Config/env changes? (No)\r\n  - Migration needed? (No)\r\n  - If yes, exact upgrade steps:\r\n\r\n  ## Failure Recovery (if this breaks)\r\n\r\n  - How to disable/revert this change quickly:\r\n      - Revert commit cda8b78bbd8d76001d2331596038babb3cb82763.\r\n  - Files/config to restore:\r\n      - src/infra/outbound/message-action-runner.ts\r\n      - src/signal/monitor/event-handler.ts\r\n      - src/signal/send-reactions.ts\r\n      - remove src/signal/reaction-target-cache.ts\r\n  - Known bad symptoms reviewers should watch for:\r\n      - Group react regression to targetAuthor is required errors.\r\n      - Group reactions accepted but not visible in Signal UI.\r\n\r\n  ## Risks and Mitigations\r\n\r\n  - Risk:\r\n      - Stale cache entry could map message->author incorrectly if identifiers collide.\r\n      - Mitigation:\r\n          - Keyed by exact groupId + messageId, bounded size, TTL expiry, and no cross-group reuse.\n\n<!-- greptile_comment -->\n\n<h3>Greptile Summary</h3>\n\nAdds deterministic Signal group reaction targeting by caching inbound sender metadata (UUID/E.164) keyed by `groupId + messageId`. When reacting without explicit `targetAuthor*`, the system now hydrates from cache instead of failing or guessing.\n\nKey changes:\n- New `reaction-target-cache.ts` with bounded in-memory cache (5000 entries, 24h TTL)\n- `event-handler.ts` records sender metadata on group message receipt\n- `message-action-runner.ts` hydrates `targetAuthorUuid`/`targetAuthor` from cache when missing\n- `send-reactions.ts` prefers UUID over E.164 and shapes recipients array for group reactions/removals\n- Tests cover cache behavior, UUID preference, and target hydration\n\n<h3>Confidence Score: 4/5</h3>\n\n- Safe to merge with one minor overflow calculation bug in cache pruning\n- The implementation is sound with proper bounds, TTL, and test coverage. UUID preference ordering is correct, cache hydration logic works as intended, and the change is backward compatible. One bug in pruning overflow calculation uses sorted array length instead of current map size after expired entries are deleted, but this has minimal impact (slight over-pruning at most)\n- Pay attention to `src/signal/reaction-target-cache.ts` line 74 overflow calculation\n\n<sub>Last reviewed commit: cda8b78</sub>\n\n<!-- greptile_other_comments_section -->\n\n<sub>(5/5) You can turn off certain types of comments like style [here](https://app.greptile.com/review/github)!</sub>\n\n<!-- /greptile_comment -->",
      "author": "akalypse",
      "authorAssociation": "NONE",
      "createdAt": "2026-02-15T19:36:47Z",
      "updatedAt": "2026-02-15T20:27:38Z",
      "headRef": "fix/signal-group-reaction-deterministic",
      "baseRef": "main",
      "filesChanged": 7,
      "additions": 333,
      "deletions": 4,
      "commits": 4,
      "labels": [
        "channel: signal",
        "size: M"
      ],
      "ciStatus": "failure",
      "hasIssueRef": false,
      "issueNumbers": [],
      "changedFiles": [
        "src/infra/outbound/message-action-runner.threading.test.ts",
        "src/infra/outbound/message-action-runner.ts",
        "src/signal/monitor/event-handler.ts",
        "src/signal/reaction-target-cache.test.ts",
        "src/signal/reaction-target-cache.ts",
        "src/signal/send-reactions.test.ts",
        "src/signal/send-reactions.ts"
      ],
      "diffUrl": "https://github.com/openclaw/openclaw/pull/17453.diff",
      "hasTests": true,
      "testFilesChanged": [
        "src/infra/outbound/message-action-runner.threading.test.ts",
        "src/signal/reaction-target-cache.test.ts",
        "src/signal/send-reactions.test.ts"
      ],
      "ageInDays": 0,
      "mergeable": "mergeable",
      "reviewState": "commented",
      "reviewCount": 2,
      "commentCount": 0,
      "totalScore": 81,
      "signals": [
        {
          "name": "ci_status",
          "score": 10,
          "weight": 0.2,
          "reason": "CI: failure"
        },
        {
          "name": "diff_size",
          "score": 100,
          "weight": 0.1,
          "reason": "337 lines changed (333+/4-)"
        },
        {
          "name": "commit_quality",
          "score": 90,
          "weight": 0.05,
          "reason": "Conventional commit format"
        },
        {
          "name": "contributor",
          "score": 42,
          "weight": 0.15,
          "reason": "akalypse (NONE, rep: 69)"
        },
        {
          "name": "issue_ref",
          "score": 30,
          "weight": 0.1,
          "reason": "No issue reference"
        },
        {
          "name": "spam",
          "score": 75,
          "weight": 0.15,
          "reason": "No issue ref"
        },
        {
          "name": "test_coverage",
          "score": 90,
          "weight": 0.15,
          "reason": "3 test file(s) changed"
        },
        {
          "name": "staleness",
          "score": 100,
          "weight": 0.1,
          "reason": "0d old (Fresh)"
        },
        {
          "name": "mergeability",
          "score": 100,
          "weight": 0.15,
          "reason": "Merge status: mergeable"
        },
        {
          "name": "review_status",
          "score": 70,
          "weight": 0.1,
          "reason": "Review: commented (2 reviews)"
        },
        {
          "name": "body_quality",
          "score": 100,
          "weight": 0.05,
          "reason": "Body: 6395 chars"
        },
        {
          "name": "activity",
          "score": 30,
          "weight": 0.05,
          "reason": "0 comments"
        },
        {
          "name": "breaking_change",
          "score": 80,
          "weight": 0.05,
          "reason": "No breaking change signals"
        }
      ],
      "isSpam": false,
      "spamReasons": [],
      "visionAlignment": "unchecked",
      "llmScore": 90,
      "llmRisk": "low",
      "llmReason": "This PR addresses a real and significant bug affecting Signal group reactions. The description is clear, the changes are well-scoped, and the implementation appears sound with added tests. The risk is low because the changes are mostly internal and focused on improving existing functionality without introducing new external dependencies or API changes. The data access scope change is mitigated by the in-memory cache.",
      "duplicateGroup": 3
    },
    {
      "number": 17419,
      "title": "Discord: add component UI support",
      "body": "## Summary\n\nDescribe the problem and fix in 2\u20135 bullets:\n\n- Problem: Discord lacked agent-driven interactive UI (components + modals) for dynamic prompts.\n- Why it matters: agents need buttons/selects/forms for approvals and structured input.\n- What changed: added component schema/builders, registry + handlers, send path, reply routing, tests, and docs.\n- What did NOT change (scope boundary): no changes to other channels or command registration flow.\n\n## Change Type (select all)\n\n- [ ] Bug fix\n- [x] Feature\n- [ ] Refactor\n- [x] Docs\n- [ ] Security hardening\n- [ ] Chore/infra\n\n## Scope (select all touched areas)\n\n- [x] Gateway / orchestration\n- [x] Skills / tool execution\n- [ ] Auth / tokens\n- [ ] Memory / storage\n- [x] Integrations\n- [ ] API / contracts\n- [ ] UI / DX\n- [ ] CI/CD / infra\n\n## Linked Issue/PR\n\n- Closes #N/A\n- Related #N/A\n\n## User-visible / Behavior Changes\n\n- Agents can send Discord v2 component containers with buttons/selects and optional modal forms.\n- Interaction results are routed back to the agent as normal inbound messages (replyToMode honored).\n\n## Security Impact (required)\n\n- New permissions/capabilities? (No)\n- Secrets/tokens handling changed? (No)\n- New/changed network calls? (Yes)\n- Command/tool execution surface changed? (Yes)\n- Data access scope changed? (No)\n- If any `Yes`, explain risk + mitigation:\n  - Uses existing Discord API endpoints; allowlists + DM policy checks still gate interactions.\n  - Components are one-off with TTL + registry validation.\n\n## Repro + Verification\n\n### Environment\n\n- OS: N/A\n- Runtime/container: N/A\n- Model/provider: N/A\n- Integration/channel (if any): Discord\n- Relevant config (redacted): N/A\n\n### Steps\n\n1. Not run.\n\n### Expected\n\n- N/A\n\n### Actual\n\n- N/A\n\n## Evidence\n\nAttach at least one:\n\n- [ ] Failing test/log before + passing after\n- [ ] Trace/log snippets\n- [ ] Screenshot/recording\n- [ ] Perf numbers (if relevant)\n\n## Human Verification (required)\n\nWhat you personally verified (not just CI), and how:\n\n- Verified scenarios: Not run.\n- Edge cases checked: Not run.\n- What you did **not** verify: All runtime behaviors.\n\n## Compatibility / Migration\n\n- Backward compatible? (Yes)\n- Config/env changes? (No)\n- Migration needed? (No)\n- If yes, exact upgrade steps: N/A\n\n## Failure Recovery (if this breaks)\n\n- How to disable/revert this change quickly: revert this PR or stop sending `components` payloads.\n- Files/config to restore: none (code-only).\n- Known bad symptoms reviewers should watch for: Discord component interactions failing or missing replies.\n\n## Risks and Mitigations\n\nList only real risks for this PR. Add/remove entries as needed. If none, write `None`.\n\n- Risk: malformed component payloads cause Discord API errors.\n  - Mitigation: schema validation + clear error messages before send.\n- Risk: unexpected reply reference behavior in component responses.\n  - Mitigation: replyToMode used consistently; components include messageId for reply references.\n\n<!-- greptile_comment -->\n\n<h3>Greptile Summary</h3>\n\nAdded Discord components v2 support for interactive UI (buttons, selects, modals) in agent messages. The implementation includes:\n- Component schema validation and builders (`components.ts`, 1088 LOC)\n- Registry with TTL-based expiry for one-time component IDs (`components-registry.ts`)\n- Carbon-based handlers for button/select/modal interactions with DM policy and allowlist checks (`agent-components.ts`, 916 LOC added)\n- Integration into message tool schema and Discord send path\n- Tests cover basic schema validation and registry consume behavior\n\nThe change routes component interactions back to agents as inbound messages, reusing existing Discord `replyToMode` and session resolution logic.\n\n<h3>Confidence Score: 4/5</h3>\n\n- This PR is mostly safe to merge with minor attention needed for link button edge cases\n- The implementation is well-structured with proper validation, security checks (DM policy, allowlists, channel spoofing prevention), and TTL-based registry. One minor edge case exists with link button URL validation that should be tightened. Test coverage is present but could be more comprehensive for interaction handling flows.\n- Pay attention to `src/discord/components.ts` (link button URL handling) and `src/discord/monitor/agent-components.ts` (complex interaction routing logic)\n\n<sub>Last reviewed commit: c308624</sub>\n\n<!-- greptile_other_comments_section -->\n\n<!-- /greptile_comment -->",
      "author": "thewilloftheshadow",
      "authorAssociation": "MEMBER",
      "createdAt": "2026-02-15T18:50:03Z",
      "updatedAt": "2026-02-15T19:56:47Z",
      "headRef": "discord-components-ui",
      "baseRef": "main",
      "filesChanged": 14,
      "additions": 2775,
      "deletions": 43,
      "commits": 4,
      "labels": [
        "docs",
        "channel: discord",
        "agents",
        "maintainer",
        "size: XL"
      ],
      "ciStatus": "pending",
      "hasIssueRef": false,
      "issueNumbers": [],
      "changedFiles": [
        "docs/channels/discord.md",
        "extensions/discord/src/channel.ts",
        "src/agents/tools/discord-actions-messaging.ts",
        "src/agents/tools/message-tool.ts",
        "src/channels/plugins/actions/discord/handle-action.ts",
        "src/discord/components-registry.ts",
        "src/discord/components.test.ts",
        "src/discord/components.ts",
        "src/discord/monitor/agent-components.test.ts",
        "src/discord/monitor/agent-components.ts",
        "src/discord/monitor/provider.ts",
        "src/discord/send.components.ts",
        "src/discord/send.ts",
        "src/infra/outbound/message-action-runner.ts"
      ],
      "diffUrl": "https://github.com/openclaw/openclaw/pull/17419.diff",
      "hasTests": true,
      "testFilesChanged": [
        "src/discord/components.test.ts",
        "src/discord/monitor/agent-components.test.ts"
      ],
      "ageInDays": 0,
      "mergeable": "mergeable",
      "reviewState": "commented",
      "reviewCount": 1,
      "commentCount": 4,
      "totalScore": 81,
      "signals": [
        {
          "name": "ci_status",
          "score": 50,
          "weight": 0.2,
          "reason": "CI: pending"
        },
        {
          "name": "diff_size",
          "score": 30,
          "weight": 0.1,
          "reason": "2818 lines changed (2775+/43-)"
        },
        {
          "name": "commit_quality",
          "score": 50,
          "weight": 0.05,
          "reason": "Non-standard title"
        },
        {
          "name": "contributor",
          "score": 93,
          "weight": 0.15,
          "reason": "thewilloftheshadow (MEMBER, rep: 100)"
        },
        {
          "name": "issue_ref",
          "score": 30,
          "weight": 0.1,
          "reason": "No issue reference"
        },
        {
          "name": "spam",
          "score": 100,
          "weight": 0.15,
          "reason": "No issue ref, contributor bonus -1"
        },
        {
          "name": "test_coverage",
          "score": 90,
          "weight": 0.15,
          "reason": "2 test file(s) changed"
        },
        {
          "name": "staleness",
          "score": 100,
          "weight": 0.1,
          "reason": "0d old (Fresh)"
        },
        {
          "name": "mergeability",
          "score": 100,
          "weight": 0.15,
          "reason": "Merge status: mergeable"
        },
        {
          "name": "review_status",
          "score": 60,
          "weight": 0.1,
          "reason": "Review: commented (1 reviews)"
        },
        {
          "name": "body_quality",
          "score": 100,
          "weight": 0.05,
          "reason": "Body: 4445 chars"
        },
        {
          "name": "activity",
          "score": 70,
          "weight": 0.05,
          "reason": "4 comments"
        },
        {
          "name": "breaking_change",
          "score": 80,
          "weight": 0.05,
          "reason": "No breaking change signals"
        }
      ],
      "isSpam": false,
      "spamReasons": [],
      "visionAlignment": "unchecked",
      "llmScore": 85,
      "llmRisk": "medium",
      "llmReason": "This PR introduces a significant feature (Discord component UI support) that addresses a real need for agent interactivity. The description is clear, and the included tests and documentation are positive signs. The security impact assessment seems reasonable. However, the lack of a concrete repro/verification section and the broad scope (touching gateway, skills, integrations, UI) introduce a medium risk. Thorough manual testing and code review are crucial before merging."
    },
    {
      "number": 17393,
      "title": "fix(ci): resolve TS2742 type error blocking all PRs",
      "body": "## Summary\n\n- Fix TS2742 error in `src/slack/monitor/slash.test-harness.ts` that blocks the `check` job (`pnpm tsgo`) on **all pull requests**\n- Replace `ReturnType<typeof vi.fn>` with `MockInstance` (directly exported by vitest) to resolve the non-portable type reference to `.pnpm/@vitest+spy@4.0.18/...`\n\n## Root Cause\n\nThe `getSlackSlashMocks()` function is **exported**, so TypeScript needs to generate a portable type definition. `ReturnType<typeof vi.fn>` resolves to an internal vitest type at a `.pnpm/` path that TypeScript cannot reference portably, triggering TS2742.\n\n`MockInstance` is the proper public type exported by vitest for mock functions and provides the exact same type contract.\n\n## Impact\n\n**Critical** \u2014 This error currently blocks the `check` CI job on every PR in the repository.\n\nCloses #17315\n\n## Note on #17341 (OOM)\n\nThe CI OOM crash (issue #17341) requires adding `NODE_OPTIONS: --max-old-space-size=4096` to the Ubuntu `checks` job in `.github/workflows/ci.yml`. This change needs the `workflow` token scope and couldn't be included in this PR. The fix is documented in the issue \u2014 a maintainer with write access can apply it (2-line change matching the existing Windows/macOS configuration).\n\n## Test plan\n\n- [ ] CI `check` job passes (tsgo no longer errors on this file)\n- [ ] Existing Slack slash command tests still pass\n- [ ] No functional change \u2014 `MockInstance` is the same type as `ReturnType<typeof vi.fn>`\n\n\n\n<!-- greptile_comment -->\n\n<h3>Greptile Summary</h3>\n\nFixes a TS2742 type portability error in `src/slack/monitor/slash.test-harness.ts` that was blocking the `check` CI job (`pnpm tsgo`) on all PRs. The exported `getSlackSlashMocks()` function used `ReturnType<typeof vi.fn>` which resolved to an internal `.pnpm/` path that TypeScript couldn't reference portably. The fix replaces it with `MockInstance`, the proper public type exported by vitest.\n\n- Replaced `ReturnType<typeof vi.fn>` with `MockInstance` in the `SlashHarnessMocks` type definition\n- Added `type MockInstance` to the vitest import\n- No functional change \u2014 `MockInstance` is the supertype of `Mock` (returned by `vi.fn()`), and all consumer usage (assertions, mock setup) only relies on `MockInstance` methods\n- Consistent with existing patterns elsewhere in the codebase (`audio.test-helpers.ts`, `agent.e2e.test.ts`)\n\n<h3>Confidence Score: 5/5</h3>\n\n- This PR is safe to merge \u2014 it's a minimal, correct type-only fix with no behavioral changes.\n- Single-file change affecting only a type annotation in a test harness. The fix is well-understood (TS2742 portability), uses the correct public vitest type, follows existing codebase patterns, and introduces no runtime changes.\n- No files require special attention.\n\n<sub>Last reviewed commit: caad89a</sub>\n\n<!-- greptile_other_comments_section -->\n\n<sub>(5/5) You can turn off certain types of comments like style [here](https://app.greptile.com/review/github)!</sub>\n\n<!-- /greptile_comment -->\n",
      "author": "miloudbelarebia",
      "authorAssociation": "NONE",
      "createdAt": "2026-02-15T18:16:43Z",
      "updatedAt": "2026-02-15T20:57:36Z",
      "headRef": "fix/ci-ts2742-and-oom",
      "baseRef": "main",
      "filesChanged": 1,
      "additions": 5,
      "deletions": 5,
      "commits": 1,
      "labels": [
        "channel: slack",
        "size: XS"
      ],
      "ciStatus": "failure",
      "hasIssueRef": true,
      "issueNumbers": [
        17315
      ],
      "changedFiles": [
        "src/slack/monitor/slash.test-harness.ts"
      ],
      "diffUrl": "https://github.com/openclaw/openclaw/pull/17393.diff",
      "hasTests": false,
      "testFilesChanged": [],
      "ageInDays": 0,
      "mergeable": "unknown",
      "reviewState": "none",
      "reviewCount": 0,
      "commentCount": 0,
      "totalScore": 80,
      "signals": [
        {
          "name": "ci_status",
          "score": 10,
          "weight": 0.2,
          "reason": "CI: failure"
        },
        {
          "name": "diff_size",
          "score": 70,
          "weight": 0.1,
          "reason": "10 lines changed (5+/5-)"
        },
        {
          "name": "commit_quality",
          "score": 90,
          "weight": 0.05,
          "reason": "Conventional commit format"
        },
        {
          "name": "contributor",
          "score": 43,
          "weight": 0.15,
          "reason": "miloudbelarebia (NONE, rep: 73)"
        },
        {
          "name": "issue_ref",
          "score": 90,
          "weight": 0.1,
          "reason": "References: #17315"
        },
        {
          "name": "spam",
          "score": 100,
          "weight": 0.15,
          "reason": "No spam signals"
        },
        {
          "name": "test_coverage",
          "score": 20,
          "weight": 0.15,
          "reason": "No test files changed in code PR"
        },
        {
          "name": "staleness",
          "score": 100,
          "weight": 0.1,
          "reason": "0d old (Fresh)"
        },
        {
          "name": "mergeability",
          "score": 50,
          "weight": 0.15,
          "reason": "Merge status: unknown"
        },
        {
          "name": "review_status",
          "score": 40,
          "weight": 0.1,
          "reason": "Review: none (0 reviews)"
        },
        {
          "name": "body_quality",
          "score": 100,
          "weight": 0.05,
          "reason": "Body: 2969 chars"
        },
        {
          "name": "activity",
          "score": 30,
          "weight": 0.05,
          "reason": "0 comments"
        },
        {
          "name": "breaking_change",
          "score": 80,
          "weight": 0.05,
          "reason": "No breaking change signals"
        }
      ],
      "isSpam": false,
      "spamReasons": [],
      "visionAlignment": "unchecked",
      "llmScore": 95,
      "llmRisk": "low",
      "llmReason": "This PR addresses a critical issue blocking CI. The explanation is clear, the fix is straightforward, and the test plan is adequate. The suggested alternative solution using `MockInstance` is correct and appropriate. The PR also acknowledges a related issue (OOM) and provides clear instructions for maintainers to address it. High score due to unblocking all PRs."
    },
    {
      "number": 16163,
      "title": "feat(sessions): createdAt tracking, date-range filtering & PostgreSQL persistence plugin",
      "body": "## Summary\n\n- **createdAt tracking**: Adds `createdAt` field to `SessionEntry`, preserving session creation timestamps through merges and enabling date-range filtering on both `createdAt` and `updatedAt` via TypeBox schema extensions\n- **Date-range filtering**: Implements `createdAfter`/`createdBefore`/`updatedAfter`/`updatedBefore` parameters in `listSessionsFromStore` with full unit test coverage (10 new filter tests, 39 total)\n- **PostgreSQL persistence plugin**: New `persist-postgres` extension that persists user prompts (via `before_agent_start`) and assistant responses (via `agent_end`) to PostgreSQL using `porsager/postgres` tagged template literals with parameterized queries\n\n### Plugin Details\n- Reads `databaseUrl` from `api.pluginConfig` (falls back to `DATABASE_URL` env var)\n- Auto-creates `lp_conversations` and `lp_messages` tables with indexes (requires PostgreSQL 13+ for `gen_random_uuid()`)\n- Upserts conversations by `session_key`, increments `message_count` only on actual message inserts\n- E2E integration tests (gated behind `*.e2e.test.ts` pattern, excluded from `pnpm test`)\n\n### Addresses review feedback\n- Plugin config read from `api.pluginConfig?.databaseUrl` (not just env var)\n- Removed duplicate `message_received`/`message_sent` hooks (only `before_agent_start` + `agent_end`)\n- Fixed `message_count` inflation (increment only in `insertMessage`, not on upsert)\n- Documented PostgreSQL 13+ requirement for `gen_random_uuid()`\n- Renamed integration test to `.e2e.test.ts` for vitest exclusion\n\nSupersedes #15424 (rebased onto latest `main`).\n\n## Test plan\n- [x] Unit tests: `pnpm test` passes (39 session-utils tests including 10 new date-range filter tests)\n- [x] Type check: `tsgo` clean\n- [x] Lint/format: `oxlint` + `oxfmt` clean\n- [ ] E2E: `DATABASE_URL=... bun test extensions/persist-postgres/src/integration.e2e.test.ts` (requires PostgreSQL instance)\n\n\ud83e\udd16 Generated with [Claude Code](https://claude.com/claude-code)\n\n<!-- greptile_comment -->\n\n<h2>Greptile Overview</h2>\n\n<h3>Greptile Summary</h3>\n\nThis PR adds three well-integrated features: `createdAt` field tracking for session entries, date-range filtering parameters, and a new PostgreSQL persistence plugin.\n\n**Core Session Changes:**\n- Added `createdAt` field to `SessionEntry` that's preserved through merges (lines prioritize existing `createdAt` over patches)\n- Implemented `createdAfter`/`createdBefore`/`updatedAfter`/`updatedBefore` filtering in `listSessionsFromStore`\n- Extended TypeBox schema with four optional timestamp parameters for the sessions list API\n\n**PostgreSQL Plugin:**\n- New `persist-postgres` extension that captures user prompts via `before_agent_start` hook and assistant responses via `agent_end` hook\n- Uses `porsager/postgres` library with parameterized queries (preventing SQL injection)\n- Auto-creates `lp_conversations` and `lp_messages` tables with proper indexes\n- Plugin reads `databaseUrl` from `api.pluginConfig` with fallback to `DATABASE_URL` environment variable\n- Message count tracking fixed (increments only on actual inserts, not upserts)\n\n**Testing:**\n- 10 new unit tests for date-range filtering (39 total session tests passing)\n- Comprehensive E2E tests in `.e2e.test.ts` file (properly excluded from standard test runs)\n\n**Minor Issues:**\n- The `openclaw.plugin.json` declares `kind: \"persistence\"` but `PluginKind` type only includes `\"memory\"` (see src/plugins/types.ts:37)\n\n<h3>Confidence Score: 4/5</h3>\n\n- This PR is safe to merge with one minor type mismatch that should be fixed\n- Score reflects clean implementation with comprehensive tests, proper SQL injection prevention, and good separation of concerns. The plugin kind mismatch needs fixing before merge, and one style suggestion about query construction. All core session logic is well-tested (39 tests including 10 new date-range tests), and the PostgreSQL plugin properly uses parameterized queries.\n- extensions/persist-postgres/openclaw.plugin.json needs the kind field corrected to match the PluginKind type union\n\n<sub>Last reviewed commit: 6b456f6</sub>\n\n<!-- greptile_other_comments_section -->\n\n<sub>(3/5) Reply to the agent's comments like \"Can you suggest a fix for this @greptileai?\" or ask follow-up questions!</sub>\n\n<!-- /greptile_comment -->",
      "author": "supmo668",
      "authorAssociation": "NONE",
      "createdAt": "2026-02-14T11:24:10Z",
      "updatedAt": "2026-02-15T20:57:06Z",
      "headRef": "main",
      "baseRef": "main",
      "filesChanged": 17,
      "additions": 1177,
      "deletions": 3,
      "commits": 9,
      "labels": [
        "docs",
        "app: macos",
        "app: web-ui",
        "gateway",
        "size: XL"
      ],
      "ciStatus": "failure",
      "hasIssueRef": true,
      "issueNumbers": [
        15424
      ],
      "changedFiles": [
        ".gitignore",
        "apps/macos/Sources/OpenClawProtocol/GatewayModels.swift",
        "apps/shared/OpenClawKit/Sources/OpenClawProtocol/GatewayModels.swift",
        "docs/concepts/session-tool.md",
        "docs/tools/index.md",
        "extensions/persist-postgres/openclaw.plugin.json",
        "extensions/persist-postgres/package.json",
        "extensions/persist-postgres/src/db.ts",
        "extensions/persist-postgres/src/index.ts",
        "extensions/persist-postgres/src/integration.e2e.test.ts",
        "extensions/persist-postgres/src/plugin.test.ts",
        "pnpm-lock.yaml",
        "src/config/sessions/types.ts",
        "src/gateway/protocol/schema/sessions.ts",
        "src/gateway/session-utils.test.ts",
        "src/gateway/session-utils.ts",
        "src/gateway/session-utils.types.ts"
      ],
      "diffUrl": "https://github.com/openclaw/openclaw/pull/16163.diff",
      "hasTests": true,
      "testFilesChanged": [
        "extensions/persist-postgres/src/integration.e2e.test.ts",
        "extensions/persist-postgres/src/plugin.test.ts",
        "src/gateway/session-utils.test.ts"
      ],
      "ageInDays": 1,
      "mergeable": "mergeable",
      "reviewState": "commented",
      "reviewCount": 1,
      "commentCount": 1,
      "totalScore": 80,
      "signals": [
        {
          "name": "ci_status",
          "score": 10,
          "weight": 0.2,
          "reason": "CI: failure"
        },
        {
          "name": "diff_size",
          "score": 60,
          "weight": 0.1,
          "reason": "1180 lines changed (1177+/3-)"
        },
        {
          "name": "commit_quality",
          "score": 90,
          "weight": 0.05,
          "reason": "Conventional commit format"
        },
        {
          "name": "contributor",
          "score": 51,
          "weight": 0.15,
          "reason": "supmo668 (NONE, rep: 100)"
        },
        {
          "name": "issue_ref",
          "score": 90,
          "weight": 0.1,
          "reason": "References: #15424"
        },
        {
          "name": "spam",
          "score": 100,
          "weight": 0.15,
          "reason": "No spam signals"
        },
        {
          "name": "test_coverage",
          "score": 90,
          "weight": 0.15,
          "reason": "3 test file(s) changed"
        },
        {
          "name": "staleness",
          "score": 100,
          "weight": 0.1,
          "reason": "1d old (Fresh)"
        },
        {
          "name": "mergeability",
          "score": 100,
          "weight": 0.15,
          "reason": "Merge status: mergeable"
        },
        {
          "name": "review_status",
          "score": 60,
          "weight": 0.1,
          "reason": "Review: commented (1 reviews)"
        },
        {
          "name": "body_quality",
          "score": 100,
          "weight": 0.05,
          "reason": "Body: 4278 chars"
        },
        {
          "name": "activity",
          "score": 50,
          "weight": 0.05,
          "reason": "1 comments"
        },
        {
          "name": "breaking_change",
          "score": 80,
          "weight": 0.05,
          "reason": "No breaking change signals"
        }
      ],
      "isSpam": false,
      "spamReasons": [],
      "visionAlignment": "unchecked",
      "llmScore": 85,
      "llmRisk": "medium",
      "llmReason": "This PR introduces valuable features: session creation tracking, date-range filtering, and PostgreSQL persistence. The implementation appears well-structured, with tests and documentation. The risk is medium because it introduces a new database dependency (PostgreSQL) and requires careful configuration. The E2E tests are not fully automated in CI, which increases the risk. The need for PostgreSQL 13+ is documented, which is good.",
      "duplicateGroup": 1
    },
    {
      "number": 12296,
      "title": "security: persistence-only secret redaction for session transcripts",
      "body": "## Summary\r\n\r\n\ud83e\udd16 **AI-assisted** \u2014 Built by an OpenClaw agent (Claude Opus 4.6), fully tested, fully reviewed. The author understands the code and architecture decisions.\r\n\r\nRedact sensitive secrets (API keys, tokens, passwords) from session transcript JSONL files **at the persistence layer only**, keeping in-memory entries unredacted so the LLM can reason about full tool output (e.g., `curl` with Bearer tokens, `cat` of config files).\r\n\r\nSee [design document on #12182](https://github.com/openclaw/openclaw/issues/12182#issuecomment-3869025731) for full architecture rationale, tradeoffs, and coverage analysis.\r\n\r\n## Root Cause\r\n\r\nIn `session-tool-result-guard.ts`, tool results are persisted via `_appendEntry()` \u2192 `_persist()` which calls `JSON.stringify(entry)` + `appendFileSync` \u2014 no redaction applied. The existing `redactSensitiveText()` was only used on the read path.\r\n\r\nAdditionally, `appendAssistantMessageToSessionTranscript()` in `transcript.ts` creates a raw `SessionManager.open()` without the guard, bypassing any redaction.\r\n\r\n## Fix\r\n\r\n### Architecture: Persistence-only via `_persist` monkey-patch\r\n\r\n- **`SessionManager._persist()`** \u2014 Replaced entirely to apply `redactEntryForPersistence()` during `JSON.stringify` serialization (both bulk-flush and single-entry paths)\r\n- **`SessionManager._rewriteFile()`** \u2014 Also replaced for the migration/recovery write path\r\n- **`transcript.ts`** \u2014 Wrapped with `guardSessionManager()` to close the bypass\r\n- **In-memory `fileEntries[]`** \u2014 Untouched. LLM sees full unredacted content via `buildSessionContext()`\r\n\r\n### Entry types covered (all text-carrying types)\r\n\r\n| Entry Type | Field(s) Redacted |\r\n|---|---|\r\n| `message` (toolResult, assistant, user) | `message.content[].text` |\r\n| `compaction` / `branch_summary` | `summary` string |\r\n| `custom_message` | `content` (string or TextContent[]) |\r\n\r\n### Why monkey-patching\r\n\r\n`SessionManager` lives in the upstream `@mariozechner/pi-coding-agent` package \u2014 we cannot modify `_persist` directly. The existing guard already monkey-patches `appendMessage`; our `_persist` patch follows the same established pattern. We pin to upstream v0.52.8 with SHA-256 hash tests that fail on any structural change.\r\n\r\n### Other improvements\r\n\r\n- Cache compiled regex patterns (content-based `JSON.stringify` comparison)\r\n- Resolve redact options once at guard install time (no per-call `loadConfig()`)\r\n- Extract shared `redactTextBlocks()` helper (zero code duplication)\r\n\r\n## Test plan\r\n\r\n**38 tests total**, all passing (Node + Bun):\r\n\r\n- **Dual-path verification**: every redaction test checks both in-memory (unredacted) and on-disk (redacted) using disk-persisted `SessionManager`\r\n- **All message roles**: toolResult, assistant, user\r\n- **All entry types**: compaction, branch_summary, custom_message (string + array)\r\n- **Non-message passthrough**: session header unchanged\r\n- **Transcript mirror**: delivery-mirror redaction verified\r\n- **Upstream compatibility**: SHA-256 hash of `_persist.toString()` and `_rewriteFile.toString()`\r\n- **Clean passthrough**: entries without secrets return same reference\r\n\r\n## Related\r\n\r\n- Refs: #12182\r\n- Related: #12260 (similar goal, different architecture \u2014 redacts before `appendMessage` which also affects LLM context)\r\n\r\n## Files changed (5)\r\n\r\n- `src/agents/session-tool-result-guard.ts` \u2014 `redactEntryForPersistence()`, `_persist`/`_rewriteFile` patches, `redactTextBlocks()` helper\r\n- `src/agents/session-tool-result-guard.test.ts` \u2014 26 guard tests with dual-path verification\r\n- `src/config/sessions/transcript.ts` \u2014 `guardSessionManager()` wrapper\r\n- `src/config/sessions/transcript.test.ts` \u2014 delivery-mirror redaction test\r\n- `src/logging/redact.ts` \u2014 pattern caching\n\n<!-- greptile_comment -->\n\n<h2>Greptile Overview</h2>\n\n<h3>Greptile Summary</h3>\n\nThis PR changes session transcript persistence so secrets are redacted only when writing JSONL to disk, keeping in-memory session entries unredacted for LLM context. It does this by extending the existing `guardSessionManager()` approach to wrap `SessionManager`\u2019s persistence methods (`_persist` and `_rewriteFile`) to serialize redacted copies of entries, and by ensuring `transcript.ts` uses a guarded session manager so it can\u2019t bypass redaction. It also updates the redaction utility to cache compiled regex/pattern work and adds tests that verify the \u201cdual path\u201d behavior (unredacted in-memory, redacted on disk) across message roles and other transcript entry types.\n\n<h3>Confidence Score: 5/5</h3>\n\n- This PR is safe to merge with minimal risk.\n- Reviewed the changed persistence wrapper and transcript guard integration along with the updated redaction caching and tests; changes are focused, preserve upstream persistence semantics, and include strong dual-path test coverage to prevent regressions.\n- No files require special attention\n\n<!-- greptile_other_comments_section -->\n\n<!-- /greptile_comment -->",
      "author": "akoscz",
      "authorAssociation": "CONTRIBUTOR",
      "createdAt": "2026-02-09T03:08:09Z",
      "updatedAt": "2026-02-15T20:52:22Z",
      "headRef": "feature/exec-write-time-redaction",
      "baseRef": "main",
      "filesChanged": 7,
      "additions": 741,
      "deletions": 11,
      "commits": 10,
      "labels": [
        "docs",
        "gateway",
        "agents",
        "size: L"
      ],
      "ciStatus": "failure",
      "hasIssueRef": true,
      "issueNumbers": [
        12182,
        12182,
        12260
      ],
      "changedFiles": [
        "docs/gateway/security/index.md",
        "docs/logging.md",
        "src/agents/session-tool-result-guard.e2e.test.ts",
        "src/agents/session-tool-result-guard.ts",
        "src/config/sessions/transcript.test.ts",
        "src/config/sessions/transcript.ts",
        "src/logging/redact.ts"
      ],
      "diffUrl": "https://github.com/openclaw/openclaw/pull/12296.diff",
      "hasTests": true,
      "testFilesChanged": [
        "src/agents/session-tool-result-guard.e2e.test.ts",
        "src/config/sessions/transcript.test.ts"
      ],
      "ageInDays": 6,
      "mergeable": "unknown",
      "reviewState": "approved",
      "reviewCount": 15,
      "commentCount": 13,
      "totalScore": 80,
      "signals": [
        {
          "name": "ci_status",
          "score": 10,
          "weight": 0.2,
          "reason": "CI: failure"
        },
        {
          "name": "diff_size",
          "score": 60,
          "weight": 0.1,
          "reason": "752 lines changed (741+/11-)"
        },
        {
          "name": "commit_quality",
          "score": 50,
          "weight": 0.05,
          "reason": "Non-standard title"
        },
        {
          "name": "contributor",
          "score": 79,
          "weight": 0.15,
          "reason": "akoscz (CONTRIBUTOR, rep: 100)"
        },
        {
          "name": "issue_ref",
          "score": 90,
          "weight": 0.1,
          "reason": "References: #12182, #12182, #12260"
        },
        {
          "name": "spam",
          "score": 100,
          "weight": 0.15,
          "reason": "No spam signals"
        },
        {
          "name": "test_coverage",
          "score": 90,
          "weight": 0.15,
          "reason": "2 test file(s) changed"
        },
        {
          "name": "staleness",
          "score": 100,
          "weight": 0.1,
          "reason": "6d old (Fresh)"
        },
        {
          "name": "mergeability",
          "score": 50,
          "weight": 0.15,
          "reason": "Merge status: unknown"
        },
        {
          "name": "review_status",
          "score": 100,
          "weight": 0.1,
          "reason": "Review: approved (15 reviews)"
        },
        {
          "name": "body_quality",
          "score": 90,
          "weight": 0.05,
          "reason": "Body: 4933 chars"
        },
        {
          "name": "activity",
          "score": 90,
          "weight": 0.05,
          "reason": "13 comments"
        },
        {
          "name": "breaking_change",
          "score": 80,
          "weight": 0.05,
          "reason": "No breaking change signals"
        }
      ],
      "isSpam": false,
      "spamReasons": [],
      "visionAlignment": "unchecked",
      "llmScore": 85,
      "llmRisk": "medium",
      "llmReason": "Addresses a real security issue by redacting secrets in persisted session transcripts. The persistence-only approach is well-reasoned. Monkey-patching introduces some risk, but seems justified given the upstream package constraints. Comprehensive testing is crucial to mitigate the risk of unexpected side effects. The description is detailed and covers the rationale and implementation well.",
      "duplicateGroup": 1
    },
    {
      "number": 16957,
      "title": "fix(doctor): skip false positive permission warnings for Nix store symlinks",
      "body": "## Summary\n\n- Problem: `openclaw doctor` warns NixOS users that config/state directories have \"too open\" permissions \u2014 a false positive because symlinks always report `0o777` via `lstatSync`, regardless of the actual target permissions.\n- Why it matters: False positives erode trust in the diagnostic tool and cause NixOS users to ignore real warnings.\n- What changed: Use `lstatSync` to detect symlinks, resolve the target with `realpathSync`, and suppress the warning only when the resolved path lives in `/nix/store/` (an immutable filesystem).\n- What did NOT change (scope boundary): Non-symlinked paths behave identically. Symlinks to insecure targets outside `/nix/store/` still trigger warnings.\n\nlobster-biscuit\n\n## Change Type (select all)\n\n- [x] Bug fix\n- [ ] Feature\n- [ ] Refactor\n- [ ] Docs\n- [ ] Security hardening\n- [ ] Chore/infra\n\n## Scope (select all touched areas)\n\n- [ ] Gateway / orchestration\n- [ ] Skills / tool execution\n- [ ] Auth / tokens\n- [ ] Memory / storage\n- [ ] Integrations\n- [ ] API / contracts\n- [x] UI / DX\n- [ ] CI/CD / infra\n\n## Linked Issue/PR\n\n- Supersedes #11425 (closed for fresh resubmission)\n\n## User-visible / Behavior Changes\n\n- NixOS users running `openclaw doctor` will no longer see false permission warnings for Nix store symlinks.\n- All other platforms and non-symlinked paths behave identically.\n\n## Security Impact (required)\n\n- New permissions/capabilities? `No`\n- Secrets/tokens handling changed? `No`\n- New/changed network calls? `No`\n- Command/tool execution surface changed? `No`\n- Data access scope changed? `No`\n\n## Repro + Verification\n\n### Environment\n\n- OS: NixOS / any Linux with Nix\n- Runtime/container: Node.js\n- Model/provider: N/A (CLI tooling)\n- Integration/channel (if any): N/A\n- Relevant config (redacted): State dir symlinked to `/nix/store/...`\n\n### Steps\n\n1. Install OpenClaw via Nix (state/config dirs become symlinks to `/nix/store/`)\n2. Run `openclaw doctor`\n3. Observe false \"permissions too open\" warning\n\n### Expected\n\n- No permission warning for paths resolved to `/nix/store/` (immutable)\n\n### Actual\n\n- Warning: \"State directory permissions are too open\" (false positive from symlink 777)\n\n## Evidence\n\n- [x] Trace/log snippets: `lstatSync` on a symlink returns `mode: 0o120777` regardless of target\n\n## Human Verification (required)\n\n- Verified scenarios: Confirmed `lstatSync` returns 777 for all symlinks on Linux, `statSync` on resolved path returns actual target permissions\n- Edge cases checked: Non-symlinked paths unchanged; symlinks to non-Nix-store targets still trigger warnings\n- What you did **not** verify: Actual NixOS hardware (verified behavior via Linux symlink semantics)\n\n## Compatibility / Migration\n\n- Backward compatible? `Yes`\n- Config/env changes? `No`\n- Migration needed? `No`\n\n## Failure Recovery (if this breaks)\n\n- How to disable/revert this change quickly: Revert the single commit\n- Files/config to restore: `src/commands/doctor-state-integrity.ts`\n- Known bad symptoms reviewers should watch for: Permission warnings disappearing for non-Nix symlinks\n\n## Risks and Mitigations\n\n- Risk: A symlink to an insecure target inside `/nix/store/` could be silenced\n  - Mitigation: `/nix/store/` is immutable by design \u2014 files there cannot be modified without Nix rebuilds\n\n---\n\n- [x] Mark as AI-assisted in the PR title or description\n- [x] Note the degree of testing: fully tested, all code understood by author\n- [x] Confirm understanding: all code understood by author\n\n\ud83e\udd16 AI-assisted PR (Claude Code) \u2014 fully tested, all code understood by author",
      "author": "soumikbhatta",
      "authorAssociation": "NONE",
      "createdAt": "2026-02-15T08:36:03Z",
      "updatedAt": "2026-02-15T20:39:42Z",
      "headRef": "fix/doctor-symlink-nix-perms",
      "baseRef": "main",
      "filesChanged": 1,
      "additions": 17,
      "deletions": 4,
      "commits": 1,
      "labels": [
        "commands",
        "size: XS"
      ],
      "ciStatus": "failure",
      "hasIssueRef": true,
      "issueNumbers": [
        11425
      ],
      "changedFiles": [
        "src/commands/doctor-state-integrity.ts"
      ],
      "diffUrl": "https://github.com/openclaw/openclaw/pull/16957.diff",
      "hasTests": false,
      "testFilesChanged": [],
      "ageInDays": 0,
      "mergeable": "mergeable",
      "reviewState": "commented",
      "reviewCount": 1,
      "commentCount": 0,
      "totalScore": 80,
      "signals": [
        {
          "name": "ci_status",
          "score": 10,
          "weight": 0.2,
          "reason": "CI: failure"
        },
        {
          "name": "diff_size",
          "score": 70,
          "weight": 0.1,
          "reason": "21 lines changed (17+/4-)"
        },
        {
          "name": "commit_quality",
          "score": 90,
          "weight": 0.05,
          "reason": "Conventional commit format"
        },
        {
          "name": "contributor",
          "score": 51,
          "weight": 0.15,
          "reason": "soumikbhatta (NONE, rep: 100)"
        },
        {
          "name": "issue_ref",
          "score": 90,
          "weight": 0.1,
          "reason": "References: #11425"
        },
        {
          "name": "spam",
          "score": 100,
          "weight": 0.15,
          "reason": "No spam signals"
        },
        {
          "name": "test_coverage",
          "score": 20,
          "weight": 0.15,
          "reason": "No test files changed in code PR"
        },
        {
          "name": "staleness",
          "score": 100,
          "weight": 0.1,
          "reason": "0d old (Fresh)"
        },
        {
          "name": "mergeability",
          "score": 100,
          "weight": 0.15,
          "reason": "Merge status: mergeable"
        },
        {
          "name": "review_status",
          "score": 60,
          "weight": 0.1,
          "reason": "Review: commented (1 reviews)"
        },
        {
          "name": "body_quality",
          "score": 100,
          "weight": 0.05,
          "reason": "Body: 3558 chars"
        },
        {
          "name": "activity",
          "score": 30,
          "weight": 0.05,
          "reason": "0 comments"
        },
        {
          "name": "breaking_change",
          "score": 80,
          "weight": 0.05,
          "reason": "No breaking change signals"
        }
      ],
      "isSpam": false,
      "spamReasons": [],
      "visionAlignment": "unchecked",
      "llmScore": 90,
      "llmRisk": "low",
      "llmReason": "This PR addresses a real problem (false positives in the doctor command for NixOS users). The implementation seems correct by checking for symlinks, resolving them, and only suppressing the warning if the target is within the immutable Nix store. The scope is well-defined, and the security impact is explicitly stated as none. The repro steps are clear. The PR improves the usability of the doctor command for NixOS users without introducing new risks."
    },
    {
      "number": 17455,
      "title": "fix: strip content before orphan closing think tags",
      "body": "## Summary\n\nHandle inference endpoints that output broken thinking tokens with only a closing `</think>` tag (no opening `<think>`). When an orphan closing tag is encountered, all content before it is now stripped, keeping only the content after the tag.\n\n## Problem\n\nSome non-standard inference endpoints output internal reasoning content followed by a `</think>` closing tag without a corresponding opening tag:\n\n```\nLet me analyze this step by step...\n\nFirst, I need to consider...</think>Here is your answer.\n```\n\nPreviously, this would leak the reasoning content into user-facing messages.\n\n## Solution\n\nModified `stripReasoningTagsFromText` to detect orphan closing tags (when not inside a thinking block) and reset the accumulated result, effectively stripping all content before the orphan tag.\n\n## Testing\n\n- All 41 unit tests in `reasoning-tags.test.ts` pass\n- Added 3 new test cases for orphan closing tag handling\n- Updated 1 existing test to reflect new behavior\n\n---\n\n**AI-assisted**: Yes\n**Testing degree**: Fully tested (all unit tests pass)\n**I confirm I understand what the code does**: Yes\n\n---\nPull Request opened by [Augment Code](https://www.augmentcode.com/) with guidance from the PR author\n\n<!-- greptile_comment -->\n\n<h3>Greptile Summary</h3>\n\nModifies `stripReasoningTagsFromText` to handle orphan `</think>` closing tags (no matching opening tag) by resetting the accumulated result, effectively stripping all content before the orphan tag. This addresses non-standard inference endpoints that leak internal reasoning content followed by a bare `</think>`.\n\n- The core change in `reasoning-tags.ts` swaps the control flow for the `!inThinking` branch: orphan close tags now reset `result = \"\"` instead of preserving preceding text.\n- 3 new test cases cover the orphan closing tag behavior; 1 existing test (`nested think patterns`) and 1 edge case (`lone closing tag`) updated to reflect the new stripping semantics.\n- All callers (`message-tool.ts`, `pi-embedded-utils.ts`, `ui/format.ts`) process model-generated output, so the more aggressive stripping is appropriate and unlikely to affect user-authored content.\n\n<h3>Confidence Score: 4/5</h3>\n\n- This PR is safe to merge \u2014 the behavioral change is well-scoped to a shared text utility with comprehensive test coverage.\n- The change is small (net +7 lines in the source file), logically sound, and well-tested with 3 new test cases plus updated existing tests. The function is only called on model-generated output, reducing risk of unintended stripping. The only reason it's not a 5 is the inherently destructive nature of resetting `result = \"\"` \u2014 in an edge case with legitimate content before an orphan close tag outside code blocks, that content would be lost. However, this is the intended behavior for the target use case.\n- No files require special attention.\n\n<sub>Last reviewed commit: b82d5c0</sub>\n\n<!-- greptile_other_comments_section -->\n\n<sub>(2/5) Greptile learns from your feedback when you react with thumbs up/down!</sub>\n\n<!-- /greptile_comment -->",
      "author": "jwt625",
      "authorAssociation": "NONE",
      "createdAt": "2026-02-15T19:40:38Z",
      "updatedAt": "2026-02-15T20:00:22Z",
      "headRef": "fix/strip-orphan-think-closing-tags",
      "baseRef": "main",
      "filesChanged": 3,
      "additions": 29,
      "deletions": 10,
      "commits": 3,
      "labels": [
        "agents",
        "size: XS"
      ],
      "ciStatus": "failure",
      "hasIssueRef": false,
      "issueNumbers": [],
      "changedFiles": [
        "src/agents/pi-embedded-subscribe.ts",
        "src/shared/text/reasoning-tags.test.ts",
        "src/shared/text/reasoning-tags.ts"
      ],
      "diffUrl": "https://github.com/openclaw/openclaw/pull/17455.diff",
      "hasTests": true,
      "testFilesChanged": [
        "src/shared/text/reasoning-tags.test.ts"
      ],
      "ageInDays": 0,
      "mergeable": "unknown",
      "reviewState": "none",
      "reviewCount": 0,
      "commentCount": 0,
      "totalScore": 80,
      "signals": [
        {
          "name": "ci_status",
          "score": 10,
          "weight": 0.2,
          "reason": "CI: failure"
        },
        {
          "name": "diff_size",
          "score": 70,
          "weight": 0.1,
          "reason": "39 lines changed (29+/10-)"
        },
        {
          "name": "commit_quality",
          "score": 90,
          "weight": 0.05,
          "reason": "Conventional commit format"
        },
        {
          "name": "contributor",
          "score": 51,
          "weight": 0.15,
          "reason": "jwt625 (NONE, rep: 100)"
        },
        {
          "name": "issue_ref",
          "score": 30,
          "weight": 0.1,
          "reason": "No issue reference"
        },
        {
          "name": "spam",
          "score": 75,
          "weight": 0.15,
          "reason": "No issue ref"
        },
        {
          "name": "test_coverage",
          "score": 90,
          "weight": 0.15,
          "reason": "1 test file(s) changed"
        },
        {
          "name": "staleness",
          "score": 100,
          "weight": 0.1,
          "reason": "0d old (Fresh)"
        },
        {
          "name": "mergeability",
          "score": 50,
          "weight": 0.15,
          "reason": "Merge status: unknown"
        },
        {
          "name": "review_status",
          "score": 40,
          "weight": 0.1,
          "reason": "Review: none (0 reviews)"
        },
        {
          "name": "body_quality",
          "score": 90,
          "weight": 0.05,
          "reason": "Body: 3051 chars"
        },
        {
          "name": "activity",
          "score": 30,
          "weight": 0.05,
          "reason": "0 comments"
        },
        {
          "name": "breaking_change",
          "score": 80,
          "weight": 0.05,
          "reason": "No breaking change signals"
        }
      ],
      "isSpam": false,
      "spamReasons": [],
      "visionAlignment": "unchecked",
      "llmScore": 95,
      "llmRisk": "low",
      "llmReason": "This PR addresses a real problem with a clear and effective solution. The implementation is well-tested with new test cases specifically targeting the identified issue. The change is isolated and unlikely to cause regressions. The problem description and solution are well-explained, and the testing is thorough. The Greptile summary confirms the changes and affected files."
    },
    {
      "number": 17449,
      "title": "feat(extension): add cost-guard \u2014 budget enforcement and cost alerts",
      "body": "## Summary\n\n- **New extension** `cost-guard` that monitors API costs in real time and enforces budget limits\n- Listens to `model.usage` diagnostic events via `onDiagnosticEvent()` (same pattern as `diagnostics-otel`)\n- In-memory tracker accumulates spend per provider, per day/month\n- `before_agent_start` hook injects budget warnings into agent context when approaching limits\n- `message_sending` hook blocks responses when budget exceeded (configurable hard stop)\n- `/cost` slash command shows current spend and budget status\n- Configurable: daily/monthly budgets, warning threshold, per-provider caps\n\n## Motivation\n\nMultiple community members have reported unexpected high API costs:\n- $100/month on Gemini API\n- $40 in a single morning on OpenAI\n\nThe codebase has excellent cost tracking infrastructure (diagnostic events, session-cost-usage) but **zero enforcement** \u2014 costs are calculated and emitted but never checked against any budget.\n\nThis extension fills that gap by adding a lightweight enforcement layer via the existing plugin system.\n\n## Configuration\n\n```yaml\n# openclaw.yaml\nplugins:\n  cost-guard:\n    dailyBudgetUsd: 5.0        # Default: $5/day\n    monthlyBudgetUsd: 50.0     # Default: $50/month\n    warningThreshold: 0.8      # Alert at 80% of budget\n    hardStop: true              # Block responses when exceeded\n    providerLimits:             # Optional per-provider caps\n      anthropic:\n        dailyUsd: 3.0\n      openai:\n        dailyUsd: 2.0\n```\n\n## Files\n\n| File | Purpose |\n|------|---------|\n| `extensions/cost-guard/index.ts` | Plugin entry point \u2014 registers service, hooks, command |\n| `extensions/cost-guard/package.json` | Package metadata |\n| `extensions/cost-guard/src/config.ts` | Config schema with validation and UI hints |\n| `extensions/cost-guard/src/tracker.ts` | In-memory cost accumulator with budget checking |\n| `extensions/cost-guard/src/service.ts` | Service subscribing to diagnostic events |\n| `extensions/cost-guard/src/format.ts` | USD formatting and summary display |\n\n## Change Type (select all)\n\n- [ ] Bug fix\n- [x] Feature\n- [ ] Refactor\n- [ ] Docs\n- [ ] Security hardening\n- [ ] Chore/infra\n\n## Scope (select all touched areas)\n\n- [ ] Gateway / orchestration\n- [ ] Skills / tool execution\n- [ ] Auth / tokens\n- [ ] Memory / storage\n- [x] Integrations\n- [ ] API / contracts\n- [ ] UI / DX\n- [ ] CI/CD / infra\n\n## Linked Issue/PR\n\n- Related #12299 (programmatic cost access)\n- Related #8485 (token/cost display)\n- Related #14779 (plugin hooks for cost management)\n- Related #9812 (agent-level rate limiting)\n\n## User-visible / Behavior Changes\n\nNew `/cost` command available when extension is enabled. Budget warnings injected into agent context. Optional hard stop when budget exceeded.\n\n## Security Impact\n\nNo security impact. Extension only reads diagnostic events (read-only) and uses standard plugin hooks. No new API keys, no external network calls, no file system writes.\n\n## Repro + Verification\n\n1. Enable the `cost-guard` extension in config\n2. Send messages that trigger API calls\n3. Use `/cost` to verify spend tracking\n4. Observe budget warnings in logs at 80% threshold\n5. Verify hard stop blocks responses when budget exceeded\n\n### Environment\n\n- OS: macOS (Apple Silicon)\n- Runtime: Node.js v22.22.0\n- TypeScript: passes `tsc --noEmit`\n- Formatting: passes `oxfmt --check`\n\n## Human Verification (required)\n\n- Verified TypeScript compilation passes with zero errors\n- Verified oxfmt formatting passes\n- Reviewed all plugin-sdk imports match exported members\n- Cross-referenced hook signatures against `src/plugins/types.ts`\n- Followed `diagnostics-otel` pattern for service + event subscription\n- Followed `memory-lancedb` pattern for config schema + hooks + commands\n\n## Risks and Mitigations\n\n- **In-memory tracker resets on restart**: Acceptable since historical costs are already stored in `session-cost-usage.ts`. The tracker only needs real-time data for enforcement.\n- **costUsd may be undefined**: Gracefully handled \u2014 entries with missing cost are ignored.\n\n## Test plan\n\n- [ ] TypeScript compilation passes\n- [ ] oxfmt formatting passes\n- [ ] CI checks pass\n- [ ] Extension loads without errors\n- [ ] `/cost` command returns formatted output\n- [ ] Budget warnings appear in logs at threshold\n- [ ] Hard stop blocks messages when exceeded\n\n\n\n<!-- greptile_comment -->\n\n<h3>Greptile Summary</h3>\n\nNew `cost-guard` extension that monitors API costs in real time and enforces configurable budget limits. It subscribes to `model.usage` diagnostic events, accumulates spend in-memory per provider/day/month, injects budget warnings into agent context via `before_agent_start`, optionally blocks responses via `message_sending` when budgets are exceeded, and exposes a `/cost` command. The implementation closely follows established extension patterns (`diagnostics-otel` for service/event subscription, `memory-lancedb` for config schema).\n\n- The `before_agent_start` hook always reports the daily budget in exceeded/warning messages, even when only the monthly budget triggered the status \u2014 this will show misleading information to users.\n- The `setInterval` used for periodic pruning is missing `.unref()`, which will keep the Node.js process alive even after all other work is done (the `nostr` extension handles this correctly).\n- `checkBudget()` is called on every diagnostic event and makes 4 redundant full-array filter passes \u2014 caching the filtered results within the method would improve efficiency.\n\n<h3>Confidence Score: 3/5</h3>\n\n- This PR is safe to merge with low risk, but has a user-facing logic bug in budget status messaging that should be fixed first.\n- The extension follows established patterns well and the core budget enforcement logic is correct. However, the exceeded/warning messages always reference the daily budget even when the monthly budget triggered the alert, which will confuse users. The missing `.unref()` on the prune timer could prevent clean process shutdown. No security concerns \u2014 the extension is read-only and makes no external calls.\n- `extensions/cost-guard/index.ts` (misleading budget messages), `extensions/cost-guard/src/service.ts` (missing timer unref)\n\n<sub>Last reviewed commit: 3b2d123</sub>\n\n<!-- greptile_other_comments_section -->\n\n<!-- /greptile_comment -->\n",
      "author": "miloudbelarebia",
      "authorAssociation": "NONE",
      "createdAt": "2026-02-15T19:27:17Z",
      "updatedAt": "2026-02-15T20:54:59Z",
      "headRef": "feat/cost-guard-extension",
      "baseRef": "main",
      "filesChanged": 8,
      "additions": 772,
      "deletions": 0,
      "commits": 4,
      "labels": [
        "size: L"
      ],
      "ciStatus": "failure",
      "hasIssueRef": true,
      "issueNumbers": [
        12299,
        8485,
        14779,
        9812
      ],
      "changedFiles": [
        "extensions/cost-guard/index.ts",
        "extensions/cost-guard/openclaw.plugin.json",
        "extensions/cost-guard/package.json",
        "extensions/cost-guard/src/config.ts",
        "extensions/cost-guard/src/format.ts",
        "extensions/cost-guard/src/service.ts",
        "extensions/cost-guard/src/tracker.ts",
        "pnpm-lock.yaml"
      ],
      "diffUrl": "https://github.com/openclaw/openclaw/pull/17449.diff",
      "hasTests": false,
      "testFilesChanged": [],
      "ageInDays": 0,
      "mergeable": "mergeable",
      "reviewState": "commented",
      "reviewCount": 1,
      "commentCount": 0,
      "totalScore": 79,
      "signals": [
        {
          "name": "ci_status",
          "score": 10,
          "weight": 0.2,
          "reason": "CI: failure"
        },
        {
          "name": "diff_size",
          "score": 60,
          "weight": 0.1,
          "reason": "772 lines changed (772+/0-)"
        },
        {
          "name": "commit_quality",
          "score": 90,
          "weight": 0.05,
          "reason": "Conventional commit format"
        },
        {
          "name": "contributor",
          "score": 43,
          "weight": 0.15,
          "reason": "miloudbelarebia (NONE, rep: 73)"
        },
        {
          "name": "issue_ref",
          "score": 90,
          "weight": 0.1,
          "reason": "References: #12299, #8485, #14779, #9812"
        },
        {
          "name": "spam",
          "score": 100,
          "weight": 0.15,
          "reason": "No spam signals"
        },
        {
          "name": "test_coverage",
          "score": 20,
          "weight": 0.15,
          "reason": "No test files changed in code PR"
        },
        {
          "name": "staleness",
          "score": 100,
          "weight": 0.1,
          "reason": "0d old (Fresh)"
        },
        {
          "name": "mergeability",
          "score": 100,
          "weight": 0.15,
          "reason": "Merge status: mergeable"
        },
        {
          "name": "review_status",
          "score": 60,
          "weight": 0.1,
          "reason": "Review: commented (1 reviews)"
        },
        {
          "name": "body_quality",
          "score": 100,
          "weight": 0.05,
          "reason": "Body: 6296 chars"
        },
        {
          "name": "activity",
          "score": 30,
          "weight": 0.05,
          "reason": "0 comments"
        },
        {
          "name": "breaking_change",
          "score": 80,
          "weight": 0.05,
          "reason": "No breaking change signals"
        }
      ],
      "isSpam": false,
      "spamReasons": [],
      "visionAlignment": "unchecked",
      "llmScore": 90,
      "llmRisk": "medium",
      "llmReason": "This PR addresses a real and pressing problem (unexpected API costs) with a well-structured and configurable solution. The use of existing diagnostic events and the plugin system is excellent. The in-memory tracker is a reasonable starting point. The risk is 'medium' because in-memory tracking is not persistent, so costs reset on server restart. This could be confusing or lead to overspending if not clearly documented. Also, the hard stop feature could disrupt user experience if not handled gracefully (e.g., clear error messages). The lack of tests is a concern, but the overall design is sound."
    },
    {
      "number": 17503,
      "title": "feat(dashboard): add Uninstall button for bundled skills",
      "body": "## Summary\n\n- Adds a `skills.uninstall` gateway RPC method that removes a bundled skill directory and appends it to `.gitignore` (preventing it from returning on `git pull`/update)\n- Adds an \"Uninstall\" button (danger style) in the Skills dashboard view for bundled skills\n- Follows the same patterns as the existing `skills.install` flow\n\n## Changes\n\n### Backend\n- **`src/gateway/protocol/schema/agents-models-skills.ts`** \u2014 New `SkillsUninstallParamsSchema`\n- **`src/gateway/protocol/schema/types.ts`** \u2014 New `SkillsUninstallParams` type\n- **`src/gateway/protocol/index.ts`** \u2014 Register validator + exports\n- **`src/gateway/server-methods/skills.ts`** \u2014 `skills.uninstall` handler (validates params, resolves bundled dir, deletes skill folder, appends to `.gitignore`)\n- **`src/gateway/server-methods.ts`** \u2014 Add `skills.uninstall` to admin-scoped methods\n\n### Frontend\n- **`ui/src/ui/controllers/skills.ts`** \u2014 `uninstallSkill()` controller function\n- **`ui/src/ui/views/skills.ts`** \u2014 \"Uninstall\" button for `openclaw-bundled` skills\n- **`ui/src/ui/app-render.ts`** \u2014 Wire `onUninstall` handler\n\n## Motivation\n\nCurrently, removing a bundled skill requires manually deleting its folder and editing `.gitignore`. This PR automates the process with a single click from the dashboard.\n\n## Test plan\n\n- [ ] Open dashboard \u2192 Skills \u2192 Built-in Skills\n- [ ] Click \"Uninstall\" on a bundled skill\n- [ ] Verify skill folder is deleted\n- [ ] Verify `skills/<name>/` is appended to `.gitignore`\n- [ ] Verify skill disappears from list after refresh\n- [ ] Verify non-bundled skills do not show the button\n- [ ] Verify disabled skills do not show the button\n\n\ud83e\udd16 Generated with [Claude Code](https://claude.com/claude-code)\n\n<!-- greptile_comment -->\n\n<h3>Greptile Summary</h3>\n\nAdds a `skills.uninstall` gateway RPC endpoint and dashboard UI button to remove bundled skills. The backend handler deletes the skill directory and appends to `.gitignore`; the frontend adds an \"Uninstall\" button for `openclaw-bundled` skills. The protocol schema, type exports, auth gating, controller, and view wiring all follow existing patterns.\n\n- **Path traversal vulnerability in `skills.uninstall` handler**: The `name` parameter is only validated as non-empty. A crafted name like `../../` would resolve outside the bundled skills directory and `fs.promises.rm(..., { recursive: true, force: true })` would delete arbitrary directories. The resolved path must be validated to stay within `bundledDir`.\n- **`.gitignore` update never executes**: `resolveOpenClawPackageRootSync({})` is called with all-undefined options, so the candidates list is empty and it always returns `null`. The gitignore update \u2014 a core part of the feature's purpose (preventing the skill from returning on `git pull`) \u2014 is silently skipped. Needs to pass at least `{ cwd: process.cwd() }`.\n\n\n<h3>Confidence Score: 1/5</h3>\n\n- This PR has a path traversal vulnerability that allows arbitrary directory deletion and a logic bug that prevents the gitignore feature from working.\n- Score of 1 reflects two significant issues: (1) a security vulnerability where unsanitized input to path.join + recursive rm enables arbitrary directory deletion, and (2) a logic bug where the .gitignore update (a stated goal of the PR) never actually executes due to resolveOpenClawPackageRootSync being called with empty options.\n- `src/gateway/server-methods/skills.ts` \u2014 both the path traversal vulnerability and the non-functional .gitignore logic are in this file.\n\n<sub>Last reviewed commit: b141a6f</sub>\n\n<!-- greptile_other_comments_section -->\n\n<sub>(2/5) Greptile learns from your feedback when you react with thumbs up/down!</sub>\n\n<!-- /greptile_comment -->",
      "author": "diegofornalha",
      "authorAssociation": "NONE",
      "createdAt": "2026-02-15T20:41:36Z",
      "updatedAt": "2026-02-15T20:45:03Z",
      "headRef": "feat/dashboard-skill-uninstall",
      "baseRef": "main",
      "filesChanged": 8,
      "additions": 125,
      "deletions": 0,
      "commits": 1,
      "labels": [
        "app: web-ui",
        "gateway",
        "size: S"
      ],
      "ciStatus": "failure",
      "hasIssueRef": false,
      "issueNumbers": [],
      "changedFiles": [
        "src/gateway/protocol/index.ts",
        "src/gateway/protocol/schema/agents-models-skills.ts",
        "src/gateway/protocol/schema/types.ts",
        "src/gateway/server-methods.ts",
        "src/gateway/server-methods/skills.ts",
        "ui/src/ui/app-render.ts",
        "ui/src/ui/controllers/skills.ts",
        "ui/src/ui/views/skills.ts"
      ],
      "diffUrl": "https://github.com/openclaw/openclaw/pull/17503.diff",
      "hasTests": false,
      "testFilesChanged": [],
      "ageInDays": 0,
      "mergeable": "mergeable",
      "reviewState": "commented",
      "reviewCount": 1,
      "commentCount": 0,
      "totalScore": 78,
      "signals": [
        {
          "name": "ci_status",
          "score": 10,
          "weight": 0.2,
          "reason": "CI: failure"
        },
        {
          "name": "diff_size",
          "score": 100,
          "weight": 0.1,
          "reason": "125 lines changed (125+/0-)"
        },
        {
          "name": "commit_quality",
          "score": 90,
          "weight": 0.05,
          "reason": "Conventional commit format"
        },
        {
          "name": "contributor",
          "score": 51,
          "weight": 0.15,
          "reason": "diegofornalha (NONE, rep: 100)"
        },
        {
          "name": "issue_ref",
          "score": 30,
          "weight": 0.1,
          "reason": "No issue reference"
        },
        {
          "name": "spam",
          "score": 75,
          "weight": 0.15,
          "reason": "No issue ref"
        },
        {
          "name": "test_coverage",
          "score": 20,
          "weight": 0.15,
          "reason": "No test files changed in code PR"
        },
        {
          "name": "staleness",
          "score": 100,
          "weight": 0.1,
          "reason": "0d old (Fresh)"
        },
        {
          "name": "mergeability",
          "score": 100,
          "weight": 0.15,
          "reason": "Merge status: mergeable"
        },
        {
          "name": "review_status",
          "score": 60,
          "weight": 0.1,
          "reason": "Review: commented (1 reviews)"
        },
        {
          "name": "body_quality",
          "score": 100,
          "weight": 0.05,
          "reason": "Body: 3701 chars"
        },
        {
          "name": "activity",
          "score": 30,
          "weight": 0.05,
          "reason": "0 comments"
        },
        {
          "name": "breaking_change",
          "score": 80,
          "weight": 0.05,
          "reason": "No breaking change signals"
        }
      ],
      "isSpam": false,
      "spamReasons": [],
      "visionAlignment": "unchecked",
      "llmScore": 90,
      "llmRisk": "low",
      "llmReason": "This PR provides a valuable feature by automating the removal of bundled skills, improving the user experience. The implementation appears well-structured, with clear separation of concerns between frontend and backend. The test plan is comprehensive and covers the key aspects of the functionality. The risk is low because the changes are relatively isolated and the test plan seems thorough."
    },
    {
      "number": 12094,
      "title": "docs(examples): Linux browser-use reliability improvements for dynamic pages",
      "body": "Related to #10994\n\n## Summary\nThis PR documents a Linux-first browser automation setup that keeps OpenClaw stable with Chrome CDP and dynamic pages:\n\n- user-level `systemd` units for `Xvfb` and Chrome CDP\n- dedicated automation profile sync script (copy default profile into isolated profile dir)\n- stale-ref-resistant browser workflow example (`snapshot -> ref lookup -> action -> retry`)\n\nThe goal is to improve reliability on Linux where users often hit:\n- CDP endpoint flakiness\n- display/auth issues\n- dynamic DOM ref invalidation between snapshot and action\n\n## What's Included\n- docs: Linux stable CDP setup and troubleshooting\n- service templates: user-level Xvfb and Chrome main CDP\n- example scripts:\n  - profile sync script\n  - X post helper with fresh-snapshot + retry logic\n\n## Platform Support\n- Core scripts (`openclaw-browser-safe-action.sh`, `openclaw-x-post.sh`) are **cross-platform** (Linux/macOS/WSL) - dependencies: bash, flock, jq\n- Service templates (`openclaw-xvfb.service`, `openclaw-chrome-main.service`) are **Linux-specific** (systemd)\n- macOS (launchd) and Windows (Task Scheduler) adapters can be added in follow-up PRs\n\n## Why\nOn dynamic pages, element refs from snapshot can change before action. A retry loop that always refreshes snapshot and resolves ref by semantic attributes (role/name) is significantly more stable than static ref reuse.\n\n## Notes\n- This PR intentionally avoids machine-specific values.\n- Paths and service names are template-based and configurable.\n- No user data, credentials, or local config files are included.\n\n## Test Steps\n1. Start user services (`openclaw-xvfb`, `openclaw-chrome-main`).\n2. Verify CDP endpoint responds on loopback.\n3. Run example script in dry-run mode.\n4. Confirm retry logic handles ref invalidation without failing hard.\n\n## Follow-ups (Optional)\n- add first-class docs link from browser CLI help\n- provide official retry helper in OpenClaw examples\n- add platform-specific adapters/docs for macOS (launchd) and Windows (Task Scheduler)\n\n<!-- greptile_comment -->\n\n<h2>Greptile Overview</h2>\n\n<h3>Greptile Summary</h3>\n\nThis PR adds Linux-focused documentation and examples intended to improve browser automation reliability on dynamic pages: a systemd user-service setup for Xvfb + Chrome CDP, a Chrome managed-policy hardening example, and bash scripts for syncing a Chrome profile and performing \u201cstale-ref-safe\u201d snapshot\u2192ref-resolve\u2192action retries.\n\nKey integration points are the new `examples/scripts/*` helpers which wrap `openclaw browser` commands (snapshot/click/type/evaluate) and the `examples/systemd/*` units which run a loopback-only CDP Chrome under a dedicated user-data-dir.\n\n<h3>Confidence Score: 3/5</h3>\n\n- This PR is close to mergeable but has a couple of issues that will break the documented workflow and one script at runtime.\n- The added docs reference paths that don\u2019t exist in the repo, and `openclaw-browser-safe-action.sh` contains a top-level array assignment using `local` under `set -u`, which will cause the script to exit when `--url` is used. Other changes are additive examples/services and don\u2019t appear to affect existing code paths.\n- examples/scripts/openclaw-browser-safe-action.sh, docs/linux-stable-cdp.md\n\n<!-- greptile_other_comments_section -->\n\n<sub>(2/5) Greptile learns from your feedback when you react with thumbs up/down!</sub>\n\n<!-- /greptile_comment -->\n",
      "author": "mahsumaktas",
      "authorAssociation": "NONE",
      "createdAt": "2026-02-08T21:03:04Z",
      "updatedAt": "2026-02-15T20:16:24Z",
      "headRef": "feat/linux-stable-cdp-docs",
      "baseRef": "main",
      "filesChanged": 7,
      "additions": 792,
      "deletions": 0,
      "commits": 3,
      "labels": [
        "docs",
        "size: L"
      ],
      "ciStatus": "pending",
      "hasIssueRef": true,
      "issueNumbers": [
        10994
      ],
      "changedFiles": [
        "docs/linux-stable-cdp.md",
        "examples/policies/chrome-managed-hardening.json",
        "examples/scripts/openclaw-browser-safe-action.sh",
        "examples/scripts/openclaw-x-post.sh",
        "examples/scripts/sync-main-profile-to-openclaw.sh",
        "examples/systemd/openclaw-chrome-main.service",
        "examples/systemd/openclaw-xvfb.service"
      ],
      "diffUrl": "https://github.com/openclaw/openclaw/pull/12094.diff",
      "hasTests": false,
      "testFilesChanged": [],
      "ageInDays": 7,
      "mergeable": "mergeable",
      "reviewState": "commented",
      "reviewCount": 4,
      "commentCount": 1,
      "totalScore": 78,
      "signals": [
        {
          "name": "ci_status",
          "score": 50,
          "weight": 0.2,
          "reason": "CI: pending"
        },
        {
          "name": "diff_size",
          "score": 60,
          "weight": 0.1,
          "reason": "792 lines changed (792+/0-)"
        },
        {
          "name": "commit_quality",
          "score": 90,
          "weight": 0.05,
          "reason": "Conventional commit format"
        },
        {
          "name": "contributor",
          "score": 46,
          "weight": 0.15,
          "reason": "mahsumaktas (NONE, rep: 83)"
        },
        {
          "name": "issue_ref",
          "score": 90,
          "weight": 0.1,
          "reason": "References: #10994"
        },
        {
          "name": "spam",
          "score": 100,
          "weight": 0.15,
          "reason": "No spam signals"
        },
        {
          "name": "test_coverage",
          "score": 20,
          "weight": 0.15,
          "reason": "No test files changed in code PR"
        },
        {
          "name": "staleness",
          "score": 70,
          "weight": 0.1,
          "reason": "7d old (Aging)"
        },
        {
          "name": "mergeability",
          "score": 100,
          "weight": 0.15,
          "reason": "Merge status: mergeable"
        },
        {
          "name": "review_status",
          "score": 70,
          "weight": 0.1,
          "reason": "Review: commented (4 reviews)"
        },
        {
          "name": "body_quality",
          "score": 90,
          "weight": 0.05,
          "reason": "Body: 3394 chars"
        },
        {
          "name": "activity",
          "score": 50,
          "weight": 0.05,
          "reason": "1 comments"
        },
        {
          "name": "breaking_change",
          "score": 80,
          "weight": 0.05,
          "reason": "No breaking change signals"
        }
      ],
      "isSpam": false,
      "spamReasons": [],
      "visionAlignment": "unchecked",
      "llmScore": 85,
      "llmRisk": "low",
      "llmReason": "This PR provides valuable documentation and scripts to improve the reliability of browser automation on Linux, addressing common issues like CDP flakiness and dynamic DOM ref invalidation. The implementation appears well-structured, with cross-platform core scripts and Linux-specific service templates. The inclusion of a retry loop with fresh snapshots is a good approach. The test steps are clear and the follow-up suggestions are reasonable. The risk is low because the changes are mostly additive (documentation and examples) and avoid machine-specific values."
    },
    {
      "number": 17512,
      "title": "feat(image-tool): support multiple images in a single tool call",
      "body": "## What\n\nThe `image` tool now accepts a **single image path/URL** (string) **or an array of up to 20** image paths/URLs in a single call. Backward compatible \u2014 existing single-string usage works unchanged.\n\n## Why\n\nMost vision models (GPT-4o, Claude, Gemini, etc.) natively support multiple images per request. This unlocks use cases like:\n- Comparing two or more images side-by-side\n- Analyzing a set of screenshots in one pass\n- Batch image description / OCR\n\nPreviously you had to make N separate tool calls, losing cross-image context.\n\n## Changes\n\n- **Parameter schema** updated to a union type (`string | string[]`)\n- **`buildImageContext`** handles building multiple image content parts\n- **`execute`** normalizes single-string input into an array internally\n- **`maxImages`** parameter added (default: **20**) to cap array length\n- Fully **backward compatible** \u2014 single string still works as before\n\n### MiniMax note\nMiniMax's vision API only supports a single image per request, so the MiniMax provider falls back to using the **first image only** when multiple are provided.\n\n## Tests\n\nAll **20 existing tests pass**. Description assertion updated to reflect the new multi-image capability.\n\n<!-- greptile_comment -->\n\n<h3>Greptile Summary</h3>\n\nAdds multi-image support to the `image` tool, allowing a single tool call to process up to 20 images. The implementation normalizes `string | string[]` input, loads each image sequentially, sends all images in a single `buildImageContext` call, and correctly falls back to single-image mode for MiniMax's VLM API. Backward compatibility with existing single-string usage is maintained.\n\n- **`Type.Union` in tool schema violates repo guardrails**: The `image` parameter now uses `Type.Union([Type.String(), Type.Array(Type.String())])`, which compiles to `anyOf` \u2014 explicitly forbidden by the repository's tool schema guidelines (AGENTS.md line 166). This will cause schema validation failures on Claude/Vertex AI and OpenAI providers. Other tools in the codebase use flattened schemas or separate parameters to avoid this.\n- **`maxImages` cap is overridable by the caller**: The `maxImages` parameter is exposed in the public tool schema, allowing an agent to set `maxImages: 1000` and bypass the intended resource limit. If the cap is a safety measure, it should not be user-controllable.\n- **No new tests for multi-image paths**: The only test change is an assertion text update. No tests exercise array input, `maxImages` enforcement, the `too_many_images` error path, or MiniMax behavior with multiple images.\n\n<h3>Confidence Score: 2/5</h3>\n\n- This PR will break the image tool on some LLM providers due to a prohibited schema pattern\n- Score of 2 reflects the Type.Union schema guardrail violation which will cause runtime failures on multiple providers (Vertex AI, OpenAI), the user-controllable maxImages cap that bypasses resource limits, and the absence of test coverage for all new code paths.\n- src/agents/tools/image-tool.ts \u2014 the Type.Union in the parameter schema (line 379) and the exposed maxImages parameter (line 382) need to be addressed before merging\n\n<sub>Last reviewed commit: 6fbbc07</sub>\n\n<!-- greptile_other_comments_section -->\n\n**Context used:**\n\n- Context from `dashboard` - CLAUDE.md ([source](https://app.greptile.com/review/custom-context?memory=fd949e91-5c3a-4ab5-90a1-cbe184fd6ce8))\n\n<!-- /greptile_comment -->",
      "author": "tyler6204",
      "authorAssociation": "MEMBER",
      "createdAt": "2026-02-15T20:53:16Z",
      "updatedAt": "2026-02-15T21:00:00Z",
      "headRef": "fix/multi-image-tool",
      "baseRef": "main",
      "filesChanged": 2,
      "additions": 159,
      "deletions": 87,
      "commits": 2,
      "labels": [
        "agents",
        "maintainer",
        "size: M"
      ],
      "ciStatus": "pending",
      "hasIssueRef": false,
      "issueNumbers": [],
      "changedFiles": [
        "src/agents/tools/image-tool.e2e.test.ts",
        "src/agents/tools/image-tool.ts"
      ],
      "diffUrl": "https://github.com/openclaw/openclaw/pull/17512.diff",
      "hasTests": true,
      "testFilesChanged": [
        "src/agents/tools/image-tool.e2e.test.ts"
      ],
      "ageInDays": 0,
      "mergeable": "mergeable",
      "reviewState": "commented",
      "reviewCount": 3,
      "commentCount": 1,
      "totalScore": 77,
      "signals": [
        {
          "name": "ci_status",
          "score": 50,
          "weight": 0.2,
          "reason": "CI: pending"
        },
        {
          "name": "diff_size",
          "score": 100,
          "weight": 0.1,
          "reason": "246 lines changed (159+/87-)"
        },
        {
          "name": "commit_quality",
          "score": 90,
          "weight": 0.05,
          "reason": "Conventional commit format"
        },
        {
          "name": "contributor",
          "score": 91,
          "weight": 0.15,
          "reason": "tyler6204 (MEMBER, rep: 93)"
        },
        {
          "name": "issue_ref",
          "score": 30,
          "weight": 0.1,
          "reason": "No issue reference"
        },
        {
          "name": "spam",
          "score": 100,
          "weight": 0.15,
          "reason": "No issue ref, contributor bonus -1"
        },
        {
          "name": "test_coverage",
          "score": 90,
          "weight": 0.15,
          "reason": "1 test file(s) changed"
        },
        {
          "name": "staleness",
          "score": 100,
          "weight": 0.1,
          "reason": "0d old (Fresh)"
        },
        {
          "name": "mergeability",
          "score": 100,
          "weight": 0.15,
          "reason": "Merge status: mergeable"
        },
        {
          "name": "review_status",
          "score": 70,
          "weight": 0.1,
          "reason": "Review: commented (3 reviews)"
        },
        {
          "name": "body_quality",
          "score": 90,
          "weight": 0.05,
          "reason": "Body: 3403 chars"
        },
        {
          "name": "activity",
          "score": 50,
          "weight": 0.05,
          "reason": "1 comments"
        },
        {
          "name": "breaking_change",
          "score": 80,
          "weight": 0.05,
          "reason": "No breaking change signals"
        }
      ],
      "isSpam": false,
      "spamReasons": [],
      "visionAlignment": "unchecked",
      "llmScore": 75,
      "llmRisk": "medium",
      "llmReason": "Solves a real problem by enabling multi-image processing, which is valuable for modern vision models. Implementation seems correct and backward compatible. However, the use of `Type.Union` in the tool schema violates repository guardrails, potentially causing schema validation failures with certain providers. This needs to be addressed before merging."
    },
    {
      "number": 16622,
      "title": "fix(mattermost): record pending history for messages dropped by groupAllowFrom",
      "body": "Fixes #16621\n\n## What\n\nWhen a message in a channel is dropped because the sender is not in `groupAllowFrom` (e.g. another agent's bot reply), the message is now saved as pending history via `recordPendingHistoryEntryIfEnabled()`.\n\n## Why\n\nIn multi-agent setups where several bots share a channel, each bot only has the human user in its `groupAllowFrom`. Other bots' replies get dropped \u2014 and previously, that meant the conversation context was lost. When an agent was later @mentioned, it couldn't see what other agents had said.\n\n## How\n\nBefore the early `return` in the `groupAllowFrom` check, we now:\n1. Resolve the route/session key (using the same logic as the main flow)\n2. Call `recordPendingHistoryEntryIfEnabled()` with the message content\n\nThis uses the existing pending history infrastructure \u2014 no new config or breaking changes. The existing `historyLimit` setting controls the buffer size.\n\n## Testing\n\nTested manually with two agents (Ada + Erik) in a shared Mattermost channel. Before: Erik couldn't see Ada's replies. After: Erik sees full conversation context when @mentioned.\n\n<!-- greptile_comment -->\n\n<h2>Greptile Overview</h2>\n\n<h3>Greptile Summary</h3>\n\nRecords pending history for group messages dropped by the `groupAllowFrom` allowlist check in the Mattermost monitor, so that multi-agent conversation context is preserved when an agent is later `@mentioned`.\n\n- Adds route/session key resolution and `recordPendingHistoryEntryIfEnabled()` call before the early `return` in the `groupAllowFrom` gate (lines 484-525 of `monitor.ts`)\n- The logic is correctly scoped inside the `kind !== \"direct\"` branch, ensuring it only applies to group/channel messages\n- Follows an established pattern already used in Slack, Discord, Feishu, and Web channels for recording pending history on early-exit paths (though those channels apply it to mention gating rather than `groupAllowFrom`)\n- No new configuration surface \u2014 leverages existing `historyLimit` setting and pending history infrastructure\n- Some route/thread resolution logic is duplicated from the main flow (~30 lines below), but this is pragmatic and consistent with patterns in other channels\n\n<h3>Confidence Score: 4/5</h3>\n\n- This PR is safe to merge \u2014 it adds a well-scoped side effect (pending history recording) to an existing early-exit path with no changes to the main message processing flow.\n- Score of 4 reflects that: (1) the change is additive-only and does not alter existing behavior for messages that are processed normally, (2) the logic correctly mirrors the main flow's route resolution and is properly nested inside the group/channel branch, (3) it follows an established pattern used across multiple other channel monitors, (4) deducted 1 point because the duplicated route/thread resolution code could theoretically drift from the main flow if either is modified independently, though this is a minor maintainability concern rather than a correctness issue.\n- No files require special attention \u2014 the single changed file is well-contained and follows existing patterns.\n\n<sub>Last reviewed commit: 86b7516</sub>\n\n<!-- greptile_other_comments_section -->\n\n<sub>(3/5) Reply to the agent's comments like \"Can you suggest a fix for this @greptileai?\" or ask follow-up questions!</sub>\n\n<!-- /greptile_comment -->",
      "author": "oskarmodig",
      "authorAssociation": "NONE",
      "createdAt": "2026-02-14T23:32:18Z",
      "updatedAt": "2026-02-15T20:55:34Z",
      "headRef": "fix/mattermost-pending-history-groupallowfrom",
      "baseRef": "main",
      "filesChanged": 1,
      "additions": 39,
      "deletions": 1,
      "commits": 1,
      "labels": [
        "channel: mattermost",
        "size: XS"
      ],
      "ciStatus": "failure",
      "hasIssueRef": true,
      "issueNumbers": [
        16621
      ],
      "changedFiles": [
        "extensions/mattermost/src/mattermost/monitor.ts"
      ],
      "diffUrl": "https://github.com/openclaw/openclaw/pull/16622.diff",
      "hasTests": false,
      "testFilesChanged": [],
      "ageInDays": 0,
      "mergeable": "unknown",
      "reviewState": "none",
      "reviewCount": 0,
      "commentCount": 3,
      "totalScore": 77,
      "signals": [
        {
          "name": "ci_status",
          "score": 10,
          "weight": 0.2,
          "reason": "CI: failure"
        },
        {
          "name": "diff_size",
          "score": 70,
          "weight": 0.1,
          "reason": "40 lines changed (39+/1-)"
        },
        {
          "name": "commit_quality",
          "score": 90,
          "weight": 0.05,
          "reason": "Conventional commit format"
        },
        {
          "name": "contributor",
          "score": 46,
          "weight": 0.15,
          "reason": "oskarmodig (NONE, rep: 84)"
        },
        {
          "name": "issue_ref",
          "score": 90,
          "weight": 0.1,
          "reason": "References: #16621"
        },
        {
          "name": "spam",
          "score": 100,
          "weight": 0.15,
          "reason": "No spam signals"
        },
        {
          "name": "test_coverage",
          "score": 20,
          "weight": 0.15,
          "reason": "No test files changed in code PR"
        },
        {
          "name": "staleness",
          "score": 100,
          "weight": 0.1,
          "reason": "0d old (Fresh)"
        },
        {
          "name": "mergeability",
          "score": 50,
          "weight": 0.15,
          "reason": "Merge status: unknown"
        },
        {
          "name": "review_status",
          "score": 40,
          "weight": 0.1,
          "reason": "Review: none (0 reviews)"
        },
        {
          "name": "body_quality",
          "score": 90,
          "weight": 0.05,
          "reason": "Body: 3305 chars"
        },
        {
          "name": "activity",
          "score": 70,
          "weight": 0.05,
          "reason": "3 comments"
        },
        {
          "name": "breaking_change",
          "score": 80,
          "weight": 0.05,
          "reason": "No breaking change signals"
        }
      ],
      "isSpam": false,
      "spamReasons": [],
      "visionAlignment": "unchecked",
      "llmScore": 90,
      "llmRisk": "low",
      "llmReason": "This PR addresses a real problem in multi-agent setups by preserving conversation context when messages are dropped due to `groupAllowFrom` restrictions. The implementation appears correct, leveraging existing infrastructure and avoiding breaking changes. The manual testing described provides confidence in the fix. The Greptile overview confirms the logic is sound and follows established patterns."
    },
    {
      "number": 13381,
      "title": "UI: add Slack-style emoji shortcode autocomplete to chat",
      "body": "## Summary\n\nAdds Slack-style `:emoji:` shortcode autocomplete to the Control UI chat textarea.\n\n## What it does\n\n- Type `:` followed by 2+ characters to trigger an emoji autocomplete popup\n- Navigate with \u2191/\u2193 arrow keys, select with Enter or Tab, dismiss with Escape\n- Replaces the `:shortcode:` text with the actual emoji character\n- Supports 200+ common emoji shortcodes (smile, heart, thumbsup, fire, etc.)\n\n## Implementation\n\n- **`ui/src/ui/emoji-data.ts`** \u2014 Lightweight shortcode\u2192emoji map (~200 entries, no external deps)\n- **`ui/src/ui/components/emoji-autocomplete.ts`** \u2014 Lit component with keyboard navigation, filtering, and text replacement\n- **`ui/src/styles/components/emoji-autocomplete.css`** \u2014 Styled using existing CSS variables for theme consistency\n- **`ui/src/ui/components/emoji-autocomplete.test.ts`** \u2014 Unit tests for filtering, selection, and edge cases\n- **`ui/src/ui/views/chat.ts`** \u2014 Integration into the chat textarea (input handler + keydown interception)\n- **`ui/src/styles.css`** \u2014 CSS import added\n\n## Design decisions\n\n- No external emoji libraries \u2014 keeps bundle small\n- Minimum 2 chars after `:` before showing suggestions (reduces noise)\n- Max 8 suggestions shown at a time\n- Uses existing CSS variables (`--card`, `--border`, `--ring`, etc.) for consistent theming\n- Follows existing Lit patterns (legacy decorators, `experimentalDecorators`)\n\n## Testing\n\n- All existing tests pass (914 files, 5908 tests, 0 failures)\n- New unit tests for the autocomplete component\n- `pnpm build && pnpm check && pnpm test` all green\n\n<!-- greptile_comment -->\n\n<h2>Greptile Overview</h2>\n\n<h3>Greptile Summary</h3>\n\nThis PR adds a Slack-style `:emoji:` shortcode autocomplete to the chat compose textarea by introducing a small in-repo shortcode\u2192emoji dataset (`ui/src/ui/emoji-data.ts`), a pure Lit render/logic module for filtering + keyboard handling (`ui/src/ui/components/emoji-autocomplete.ts`), styling for the popup (`ui/src/styles/chat/emoji-autocomplete.css` imported from `ui/src/styles/chat.css`), and integrates it into the chat view (`ui/src/ui/views/chat.ts`) via `@input` updates and `@keydown` interception.\n\nThe overall integration approach fits the existing UI architecture (Lit render functions + state stored in the app render state), but there are a couple of correctness issues to address before merge: the hover behavior in the popup is currently a no-op despite being wired up, the documented \u201c2+ chars after `:`\u201d trigger doesn\u2019t match the implementation, and the autocomplete state is stored at module scope in `chat.ts` which can leak/stale across session/tab changes.\n\n<h3>Confidence Score: 3/5</h3>\n\n- This PR has user-visible correctness issues that should be fixed before merging.\n- Core functionality and tests look reasonable, but there are confirmed behavior mismatches (hover selection handler is effectively dead code, and the documented minimum trigger length doesn\u2019t match the implementation) plus module-scoped state in the chat view that can persist across session/tab changes and leave stale UI state.\n- ui/src/ui/components/emoji-autocomplete.ts, ui/src/ui/views/chat.ts\n\n<!-- greptile_other_comments_section -->\n\n<sub>(2/5) Greptile learns from your feedback when you react with thumbs up/down!</sub>\n\n<!-- /greptile_comment -->",
      "author": "emre6943",
      "authorAssociation": "NONE",
      "createdAt": "2026-02-10T12:44:02Z",
      "updatedAt": "2026-02-15T20:09:57Z",
      "headRef": "feature/emoji-shortcode-autocomplete",
      "baseRef": "main",
      "filesChanged": 6,
      "additions": 1199,
      "deletions": 3,
      "commits": 11,
      "labels": [
        "app: web-ui",
        "size: XL"
      ],
      "ciStatus": "failure",
      "hasIssueRef": false,
      "issueNumbers": [],
      "changedFiles": [
        "ui/src/styles/chat.css",
        "ui/src/styles/chat/emoji-autocomplete.css",
        "ui/src/ui/components/emoji-autocomplete.test.ts",
        "ui/src/ui/components/emoji-autocomplete.ts",
        "ui/src/ui/emoji-data.ts",
        "ui/src/ui/views/chat.ts"
      ],
      "diffUrl": "https://github.com/openclaw/openclaw/pull/13381.diff",
      "hasTests": true,
      "testFilesChanged": [
        "ui/src/ui/components/emoji-autocomplete.test.ts"
      ],
      "ageInDays": 5,
      "mergeable": "mergeable",
      "reviewState": "commented",
      "reviewCount": 1,
      "commentCount": 0,
      "totalScore": 76,
      "signals": [
        {
          "name": "ci_status",
          "score": 10,
          "weight": 0.2,
          "reason": "CI: failure"
        },
        {
          "name": "diff_size",
          "score": 60,
          "weight": 0.1,
          "reason": "1202 lines changed (1199+/3-)"
        },
        {
          "name": "commit_quality",
          "score": 50,
          "weight": 0.05,
          "reason": "Non-standard title"
        },
        {
          "name": "contributor",
          "score": 50,
          "weight": 0.15,
          "reason": "emre6943 (NONE, rep: 98)"
        },
        {
          "name": "issue_ref",
          "score": 30,
          "weight": 0.1,
          "reason": "No issue reference"
        },
        {
          "name": "spam",
          "score": 75,
          "weight": 0.15,
          "reason": "No issue ref"
        },
        {
          "name": "test_coverage",
          "score": 90,
          "weight": 0.15,
          "reason": "1 test file(s) changed"
        },
        {
          "name": "staleness",
          "score": 100,
          "weight": 0.1,
          "reason": "5d old (Fresh)"
        },
        {
          "name": "mergeability",
          "score": 100,
          "weight": 0.15,
          "reason": "Merge status: mergeable"
        },
        {
          "name": "review_status",
          "score": 60,
          "weight": 0.1,
          "reason": "Review: commented (1 reviews)"
        },
        {
          "name": "body_quality",
          "score": 90,
          "weight": 0.05,
          "reason": "Body: 3296 chars"
        },
        {
          "name": "activity",
          "score": 30,
          "weight": 0.05,
          "reason": "0 comments"
        },
        {
          "name": "breaking_change",
          "score": 80,
          "weight": 0.05,
          "reason": "No breaking change signals"
        }
      ],
      "isSpam": false,
      "spamReasons": [],
      "visionAlignment": "unchecked",
      "llmScore": 85,
      "llmRisk": "low",
      "llmReason": "The PR adds a useful feature (emoji autocomplete) to the chat interface. The implementation appears well-structured, with dedicated components, styles, and tests. The design decisions seem reasonable (e.g., no external dependencies, minimum characters for triggering). The testing section indicates thorough testing, including existing tests and new unit tests. The risk is low because the changes are relatively isolated and well-tested, and the design avoids external dependencies."
    },
    {
      "number": 17506,
      "title": "Fix Entrypoint in docker-compose",
      "body": "Fixes https://github.com/openclaw/openclaw/issues/17504 by moving `node dist/index.js` from `command` to `entrypoint`.\r\n\r\n## Summary\r\n\r\nIssue with the entrypoint when running `sudo docker compose up -d openclaw-gateway` : `error: unknown command 'dist/index.js'`\r\n\r\n## Change Type (select all)\r\n\r\n- [x] Bug fix\r\n- [ ] Feature\r\n- [ ] Refactor\r\n- [ ] Docs\r\n- [ ] Security hardening\r\n- [ ] Chore/infra\r\n\r\n## Scope (select all touched areas)\r\n\r\n- [ ] Gateway / orchestration\r\n- [ ] Skills / tool execution\r\n- [ ] Auth / tokens\r\n- [ ] Memory / storage\r\n- [ ] Integrations\r\n- [ ] API / contracts\r\n- [ ] UI / DX\r\n- [ ] CI/CD / infra\r\n\r\n## Linked Issue/PR\r\n\r\n- Closes [#17504 ](https://github.com/openclaw/openclaw/issues/17504)\r\n\r\n## User-visible / Behavior Changes\r\n\r\nNone\r\n\r\n## Security Impact (required)\r\n\r\n- New permissions/capabilities? `No`\r\n- Secrets/tokens handling changed? `No`\r\n- New/changed network calls? `No`\r\n- Command/tool execution surface changed? `No`\r\n- Data access scope changed? `No`\r\n\r\n## Repro + Verification\r\n\r\ncf https://github.com/openclaw/openclaw/issues/17504\r\n\r\n## Human Verification (required)\r\n\r\nWhat you personally verified (not just CI), and how:\r\n\r\n- Changed the docker-compose on my repo, has fixed the issue\r\n\r\n## Compatibility / Migration\r\n\r\n- Backward compatible? `Yes`\r\n- Config/env changes? `No`\r\n- Migration needed? `No`\r\n\r\n## Risks and Mitigations\r\n\r\n`None`.",
      "author": "NeilSCGH",
      "authorAssociation": "NONE",
      "createdAt": "2026-02-15T20:47:04Z",
      "updatedAt": "2026-02-15T20:50:56Z",
      "headRef": "patch-3",
      "baseRef": "main",
      "filesChanged": 1,
      "additions": 1,
      "deletions": 2,
      "commits": 1,
      "labels": [
        "docker",
        "size: XS"
      ],
      "ciStatus": "failure",
      "hasIssueRef": true,
      "issueNumbers": [
        17504
      ],
      "changedFiles": [
        "docker-compose.yml"
      ],
      "diffUrl": "https://github.com/openclaw/openclaw/pull/17506.diff",
      "hasTests": false,
      "testFilesChanged": [],
      "ageInDays": 0,
      "mergeable": "unknown",
      "reviewState": "none",
      "reviewCount": 0,
      "commentCount": 0,
      "totalScore": 75,
      "signals": [
        {
          "name": "ci_status",
          "score": 10,
          "weight": 0.2,
          "reason": "CI: failure"
        },
        {
          "name": "diff_size",
          "score": 20,
          "weight": 0.1,
          "reason": "3 lines changed (1+/2-)"
        },
        {
          "name": "commit_quality",
          "score": 50,
          "weight": 0.05,
          "reason": "Non-standard title"
        },
        {
          "name": "contributor",
          "score": 48,
          "weight": 0.15,
          "reason": "NeilSCGH (NONE, rep: 90)"
        },
        {
          "name": "issue_ref",
          "score": 90,
          "weight": 0.1,
          "reason": "References: #17504"
        },
        {
          "name": "spam",
          "score": 75,
          "weight": 0.15,
          "reason": "<5 lines"
        },
        {
          "name": "test_coverage",
          "score": 60,
          "weight": 0.15,
          "reason": "Docs/config PR \u2014 tests not expected"
        },
        {
          "name": "staleness",
          "score": 100,
          "weight": 0.1,
          "reason": "0d old (Fresh)"
        },
        {
          "name": "mergeability",
          "score": 50,
          "weight": 0.15,
          "reason": "Merge status: unknown"
        },
        {
          "name": "review_status",
          "score": 40,
          "weight": 0.1,
          "reason": "Review: none (0 reviews)"
        },
        {
          "name": "body_quality",
          "score": 100,
          "weight": 0.05,
          "reason": "Body: 1394 chars"
        },
        {
          "name": "activity",
          "score": 30,
          "weight": 0.05,
          "reason": "0 comments"
        },
        {
          "name": "breaking_change",
          "score": 80,
          "weight": 0.05,
          "reason": "No breaking change signals"
        }
      ],
      "isSpam": false,
      "spamReasons": [],
      "visionAlignment": "unchecked",
      "llmScore": 90,
      "llmRisk": "low",
      "llmReason": "Addresses a reported bug by correctly configuring the Docker entrypoint. The provided information suggests the fix is verified and backward compatible. The change is isolated and well-documented."
    },
    {
      "number": 17445,
      "title": "fix(pi-embedded): add aggregate timeout to compaction retry + harden SIGUSR1 restart",
      "body": "Fixes #17444\n\n## Summary\n\nThis PR addresses two related \u201csession looks hung\u201d failure modes in the PI embedded runner:\n\n1. **Compaction retry waits can block the session lane with no aggregate timeout**.\n2. **SIGUSR1 in-process restart can proceed while embedded compaction is still in-flight**, leaving session write locks held by the previous lifecycle.\n\n## What changed\n\n### 1) Bound compaction retry waits (aggregate timeout)\n\n- Add `waitForCompactionRetryWithAggregateTimeout()`.\n- In `run/attempt.ts`, replace the unbounded `await abortable(waitForCompactionRetry())` with a **60s aggregate timeout**.\n- On aggregate timeout:\n  - set `timedOutDuringCompaction = true`\n  - log a warning and proceed using the existing pre-compaction snapshot selection logic\n\nThis prevents long compaction retry waits from freezing the session lane.\n\n### 2) Harden SIGUSR1 restart against in-flight embedded runs/compaction\n\n- Increase default SIGUSR1 deferral budget: `DEFAULT_DEFERRAL_MAX_WAIT_MS` **30s \u2192 90s**.\n- Increase gateway run-loop drain budget: `DRAIN_TIMEOUT_MS` **30s \u2192 90s**.\n- On SIGUSR1 restart in the gateway run loop:\n  1. **Abort compacting embedded runs** (best-effort)\n  2. Drain **both** active command-queue tasks and active embedded runs (up to 90s)\n  3. If drain times out, **abort all embedded runs** (best-effort) and proceed\n\nThis reduces the chance that an in-process restart leaves the new lifecycle blocked behind a lock/state owned by the previous lifecycle.\n\n## Why this is safe\n\n- The aggregate timeout only affects cases where compaction retry waits would otherwise stall; normal compaction runs are unchanged.\n- Restart already implies disruption; aborting compacting runs is a targeted best-effort to ensure session locks are released.\n- Changes are localized to restart/compaction wait paths.\n\n## Tests\n\n- `src/agents/pi-embedded-runner/run/compaction-retry-aggregate-timeout.e2e.test.ts`\n- `src/agents/pi-embedded-runner/runs.e2e.test.ts`\n- Updated:\n  - `src/cli/gateway-cli/run-loop.test.ts`\n  - `src/infra/infra-runtime.test.ts`\n\nManual:\n\n```bash\npnpm -s lint\npnpm -s format:check\nnpx vitest run src/agents/pi-embedded-runner/ src/cli/gateway-cli/run-loop.test.ts src/infra/infra-runtime.test.ts --reporter=verbose\n```\n\n## Notes / follow-ups\n\n- This PR does **not** change per-attempt compaction safety timeouts; if desired, we can follow up with a smaller `EMBEDDED_COMPACTION_TIMEOUT_MS` and/or a compaction re-entry cooldown once we have more production data.",
      "author": "joeykrug",
      "authorAssociation": "CONTRIBUTOR",
      "createdAt": "2026-02-15T19:24:02Z",
      "updatedAt": "2026-02-15T20:12:33Z",
      "headRef": "fix/compaction-lane-blocking",
      "baseRef": "main",
      "filesChanged": 9,
      "additions": 403,
      "deletions": 19,
      "commits": 2,
      "labels": [
        "cli",
        "agents",
        "size: M"
      ],
      "ciStatus": "failure",
      "hasIssueRef": true,
      "issueNumbers": [
        17444
      ],
      "changedFiles": [
        "src/agents/pi-embedded-runner/run/attempt.ts",
        "src/agents/pi-embedded-runner/run/compaction-retry-aggregate-timeout.e2e.test.ts",
        "src/agents/pi-embedded-runner/run/compaction-retry-aggregate-timeout.ts",
        "src/agents/pi-embedded-runner/runs.e2e.test.ts",
        "src/agents/pi-embedded-runner/runs.ts",
        "src/cli/gateway-cli/run-loop.test.ts",
        "src/cli/gateway-cli/run-loop.ts",
        "src/infra/infra-runtime.test.ts",
        "src/infra/restart.ts"
      ],
      "diffUrl": "https://github.com/openclaw/openclaw/pull/17445.diff",
      "hasTests": true,
      "testFilesChanged": [
        "src/agents/pi-embedded-runner/run/compaction-retry-aggregate-timeout.e2e.test.ts",
        "src/agents/pi-embedded-runner/runs.e2e.test.ts",
        "src/cli/gateway-cli/run-loop.test.ts",
        "src/infra/infra-runtime.test.ts"
      ],
      "ageInDays": 0,
      "mergeable": "mergeable",
      "reviewState": "none",
      "reviewCount": 0,
      "commentCount": 0,
      "totalScore": 75,
      "signals": [
        {
          "name": "ci_status",
          "score": 10,
          "weight": 0.2,
          "reason": "CI: failure"
        },
        {
          "name": "diff_size",
          "score": 100,
          "weight": 0.1,
          "reason": "422 lines changed (403+/19-)"
        },
        {
          "name": "commit_quality",
          "score": 90,
          "weight": 0.05,
          "reason": "Conventional commit format"
        },
        {
          "name": "contributor",
          "score": 79,
          "weight": 0.15,
          "reason": "joeykrug (CONTRIBUTOR, rep: 100)"
        },
        {
          "name": "issue_ref",
          "score": 90,
          "weight": 0.1,
          "reason": "References: #17444"
        },
        {
          "name": "spam",
          "score": 100,
          "weight": 0.15,
          "reason": "No spam signals"
        },
        {
          "name": "test_coverage",
          "score": 90,
          "weight": 0.15,
          "reason": "4 test file(s) changed"
        },
        {
          "name": "staleness",
          "score": 100,
          "weight": 0.1,
          "reason": "0d old (Fresh)"
        },
        {
          "name": "mergeability",
          "score": 100,
          "weight": 0.15,
          "reason": "Merge status: mergeable"
        },
        {
          "name": "review_status",
          "score": 40,
          "weight": 0.1,
          "reason": "Review: none (0 reviews)"
        },
        {
          "name": "body_quality",
          "score": 90,
          "weight": 0.05,
          "reason": "Body: 2491 chars"
        },
        {
          "name": "activity",
          "score": 30,
          "weight": 0.05,
          "reason": "0 comments"
        },
        {
          "name": "breaking_change",
          "score": 80,
          "weight": 0.05,
          "reason": "No breaking change signals"
        }
      ],
      "isSpam": false,
      "spamReasons": [],
      "visionAlignment": "unchecked"
    },
    {
      "number": 17502,
      "title": "feat: normalize skill scanner reason codes and trust messaging",
      "body": "## Summary\nAligns OpenClaw scanner and install/audit messaging with structured moderation reason codes and evidence semantics.\n\n## What changed\n- Standardized scanner reason-code contract and severity semantics in `src/security/skill-scanner.ts`.\n- Expanded scanner precision with markdown/manifest-aware checks and scoped matching.\n- Preserved malicious vs suspicious behavior while reducing false positives.\n- Updated install/update and plugin messaging to show structured reason codes + evidence snippets.\n- Updated extra audit reporting to print reason-code based findings instead of generic suspicious text.\n- Updated scanner/install/audit tests for the new contract and regressions.\n- Updated CLI security docs with reason-code semantics and examples.\n\n## Validation\n- Ran type-aware lint and unit/e2e tests for scanner, audit, and install flows.\n\n<!-- greptile_comment -->\n\n<h3>Greptile Summary</h3>\n\nThis PR normalizes skill/plugin scanner rule IDs from flat kebab-case (e.g., `dangerous-exec`) to a dotted `category.descriptor` convention (e.g., `suspicious.dangerous_exec`), adds four new scanner rules (prompt injection, `always:true` detection, URL shortener/raw IP install sources, known malware signatures), expands the scannable file set to include markdown and manifest formats (`.md`, `.mdx`, `.json`, `.yaml`, `.yml`, `.toml`), and updates install/audit messaging to surface reason codes with evidence snippets.\n\n- New `filePattern` scoping prevents markdown/manifest-only rules from firing on code files and vice versa.\n- `audit-extra.async.ts` correctly filters findings by severity before computing reason codes.\n- `skills-install.ts` and `plugins/install.ts` compute `reasonCodes` and `topEvidence` from **all** findings regardless of severity, so critical-path messages can include warn-level rule IDs \u2014 a regression from the old behavior that filtered by severity. `audit-extra.async.ts` does not have this issue.\n- Tests updated comprehensively with new rule IDs and new test cases for prompt injection and install-source detection.\n\n<h3>Confidence Score: 3/5</h3>\n\n- Mostly safe with a severity-filtering regression in install warning messages that should be fixed before merge.\n- The scanner rule changes and new rules are well-structured and tested. However, both `skills-install.ts` and `plugins/install.ts` lost the severity filtering that the old code had when composing warning messages. This means critical-level warnings can include warn-level findings, which is an inconsistency with `audit-extra.async.ts` and a regression from previous behavior.\n- `src/agents/skills-install.ts` and `src/plugins/install.ts` need severity-filtered `reasonCodes`/`topEvidence` to match the pattern used in `audit-extra.async.ts`.\n\n<sub>Last reviewed commit: e301a71</sub>\n\n<!-- greptile_other_comments_section -->\n\n<sub>(3/5) Reply to the agent's comments like \"Can you suggest a fix for this @greptileai?\" or ask follow-up questions!</sub>\n\n<!-- /greptile_comment -->",
      "author": "ArthurzKV",
      "authorAssociation": "NONE",
      "createdAt": "2026-02-15T20:41:20Z",
      "updatedAt": "2026-02-15T21:08:06Z",
      "headRef": "codex/skill-verification-v2-openclaw",
      "baseRef": "main",
      "filesChanged": 9,
      "additions": 209,
      "deletions": 68,
      "commits": 4,
      "labels": [
        "docs",
        "security",
        "agents",
        "size: M"
      ],
      "ciStatus": "pending",
      "hasIssueRef": false,
      "issueNumbers": [],
      "changedFiles": [
        ".github/workflows/formal-conformance.yml",
        "docs/cli/security.md",
        "src/agents/skills-install.e2e.test.ts",
        "src/agents/skills-install.ts",
        "src/plugins/install.ts",
        "src/security/audit-extra.async.ts",
        "src/security/audit.test.ts",
        "src/security/skill-scanner.test.ts",
        "src/security/skill-scanner.ts"
      ],
      "diffUrl": "https://github.com/openclaw/openclaw/pull/17502.diff",
      "hasTests": true,
      "testFilesChanged": [
        "src/agents/skills-install.e2e.test.ts",
        "src/security/audit.test.ts",
        "src/security/skill-scanner.test.ts"
      ],
      "ageInDays": 0,
      "mergeable": "mergeable",
      "reviewState": "commented",
      "reviewCount": 1,
      "commentCount": 1,
      "totalScore": 74,
      "signals": [
        {
          "name": "ci_status",
          "score": 50,
          "weight": 0.2,
          "reason": "CI: pending"
        },
        {
          "name": "diff_size",
          "score": 100,
          "weight": 0.1,
          "reason": "277 lines changed (209+/68-)"
        },
        {
          "name": "commit_quality",
          "score": 90,
          "weight": 0.05,
          "reason": "Conventional commit format"
        },
        {
          "name": "contributor",
          "score": 45,
          "weight": 0.15,
          "reason": "ArthurzKV (NONE, rep: 81)"
        },
        {
          "name": "issue_ref",
          "score": 30,
          "weight": 0.1,
          "reason": "No issue reference"
        },
        {
          "name": "spam",
          "score": 75,
          "weight": 0.15,
          "reason": "No issue ref"
        },
        {
          "name": "test_coverage",
          "score": 90,
          "weight": 0.15,
          "reason": "3 test file(s) changed"
        },
        {
          "name": "staleness",
          "score": 100,
          "weight": 0.1,
          "reason": "0d old (Fresh)"
        },
        {
          "name": "mergeability",
          "score": 100,
          "weight": 0.15,
          "reason": "Merge status: mergeable"
        },
        {
          "name": "review_status",
          "score": 60,
          "weight": 0.1,
          "reason": "Review: commented (1 reviews)"
        },
        {
          "name": "body_quality",
          "score": 90,
          "weight": 0.05,
          "reason": "Body: 2987 chars"
        },
        {
          "name": "activity",
          "score": 50,
          "weight": 0.05,
          "reason": "1 comments"
        },
        {
          "name": "breaking_change",
          "score": 80,
          "weight": 0.05,
          "reason": "No breaking change signals"
        }
      ],
      "isSpam": false,
      "spamReasons": [],
      "visionAlignment": "unchecked",
      "llmScore": 75,
      "llmRisk": "medium",
      "llmReason": "Solves a real problem by standardizing reason codes and improving scanner precision. Implementation appears mostly correct and complete, with comprehensive test updates. However, the Greptile summary identifies a potential regression in `skills-install.ts` and `plugins/install.ts` where critical-path messages might include warn-level rule IDs, which needs further investigation and correction before merging. The risk is medium because this regression could lead to less informative or misleading security messages during installation."
    },
    {
      "number": 17459,
      "title": "feat(cron): support multiple schedules and priority guardrails",
      "body": "# OpenClaw Cron: Stability + Feature Update Notes\r\n\r\nThis document summarizes the implemented work for roadmap priorities:\r\n\r\n- `1` Cron stability fixes\r\n- `2` Cron enhancements (multi-schedule, per-job timeout hardening, isolated announce reliability)\r\n- `3` Security, orchestration, and memory-quality guardrails\r\n\r\n## Priority 1: Stability Fixes\r\n\r\n### 1) Windows cron store write resilience (`EBUSY`/`EPERM`/`ENOTEMPTY`)\r\n\r\n- Added atomic rename retry with backoff for cron store writes.\r\n- Added temp-file cleanup in `finally` to avoid leftover `.tmp` files on failures.\r\n\r\nFiles:\r\n\r\n- `openclaw/src/cron/store.ts`\r\n- `openclaw/src/cron/store.test.ts`\r\n\r\n### 2) Timer re-arm and spin-loop prevention improvements\r\n\r\n- `nextWakeAtMs` now ignores jobs currently marked `runningAtMs`.\r\n- When all enabled jobs are blocked by `runningAtMs`, scheduler now arms a maintenance tick (60s) instead of skipping/spinning.\r\n\r\nFiles:\r\n\r\n- `openclaw/src/cron/service/jobs.ts`\r\n- `openclaw/src/cron/service/timer.ts`\r\n- `openclaw/src/cron/service.rearm-timer-when-running.test.ts`\r\n\r\n## Priority 2: Enhancements\r\n\r\n### 1) Multi-schedule support per job (`schedules[]`)\r\n\r\n- Added support for multiple schedules on a single job while preserving backward compatibility with `schedule`.\r\n- `nextRunAtMs` now resolves to the earliest next run across all configured schedules.\r\n- Update path supports patching `schedules[]`.\r\n- Store migration/normalization keeps `schedule` and `schedules[0]` in sync for compatibility.\r\n- Protocol schema now accepts `schedules[]` in add/update payloads.\r\n\r\nFiles:\r\n\r\n- `openclaw/src/cron/types.ts`\r\n- `openclaw/src/cron/service/jobs.ts`\r\n- `openclaw/src/cron/service/ops.ts`\r\n- `openclaw/src/cron/service/store.ts`\r\n- `openclaw/src/cron/normalize.ts`\r\n- `openclaw/src/gateway/protocol/schema/cron.ts`\r\n- `openclaw/src/cron/service.issue-regressions.test.ts`\r\n- `openclaw/src/cron/normalize.test.ts`\r\n\r\n### 2) Per-job timeout hardening\r\n\r\n- Added timeout normalization/clamping in timer execution path:\r\n  - minimum: 1 second\r\n  - maximum cap: 24 hours\r\n  - default fallback remains 10 minutes when unset/invalid\r\n\r\nFiles:\r\n\r\n- `openclaw/src/cron/service/timer.ts`\r\n\r\n### 3) Isolated announce reliability fallback\r\n\r\n- When subagent announce flow fails, isolated cron now attempts one direct outbound fallback delivery before failing.\r\n- This improves reliability for cases where announce orchestration fails but direct delivery can still succeed.\r\n\r\nFiles:\r\n\r\n- `openclaw/src/cron/isolated-agent/run.ts`\r\n\r\n## Priority 3: Security + Intelligence Guardrails\r\n\r\n### 1) Secrets manager integration (`op://` and `vault://`)\r\n\r\n- Added config-time secret URI resolution support:\r\n  - `op://...` via `op read <ref>`\r\n  - `vault://path#field` via `vault kv get -field=<field> <path>`\r\n- Resolution runs during config load, after `${ENV}` substitution.\r\n\r\nFiles:\r\n\r\n- `openclaw/src/config/secret-resolver.ts`\r\n- `openclaw/src/config/io.ts`\r\n- `openclaw/src/config/secret-resolver.test.ts`\r\n\r\n### 2) Membrane-style tool boundary enforcement\r\n\r\n- Added optional pre-tool-call membrane checks:\r\n  - hard deny specific tools\r\n  - deny exec calls containing blocked command substrings\r\n- Denials include explicit membrane tags in block reasons.\r\n\r\nFiles:\r\n\r\n- `openclaw/src/agents/pi-tools.before-tool-call.ts`\r\n- `openclaw/src/agents/pi-tools.ts`\r\n- `openclaw/src/config/types.tools.ts`\r\n- `openclaw/src/config/zod-schema.agent-runtime.ts`\r\n- `openclaw/src/agents/pi-tools.before-tool-call.e2e.test.ts`\r\n\r\n### 3) Smart model routing (simple vs complex messages)\r\n\r\n- Added optional per-agent routing config to select cheaper model for simple tasks and stronger model for complex tasks.\r\n- Integrated into isolated cron agent-turn model selection path.\r\n\r\nFiles:\r\n\r\n- `openclaw/src/agents/model-routing.ts`\r\n- `openclaw/src/agents/model-routing.test.ts`\r\n- `openclaw/src/config/types.agent-defaults.ts`\r\n- `openclaw/src/config/zod-schema.agent-defaults.ts`\r\n- `openclaw/src/cron/isolated-agent/run.ts`\r\n\r\n### 4) Fact-check gate for session-memory hook writes\r\n\r\n- Added optional hook-level fact-check thresholds before writing session memory snapshots.\r\n- Can require minimum user/assistant evidence before persisting.\r\n\r\nFiles:\r\n\r\n- `openclaw/src/hooks/bundled/session-memory/handler.ts`\r\n- `openclaw/src/hooks/bundled/session-memory/handler.test.ts`\r\n\r\n## Validation\r\n\r\nExecuted targeted tests:\r\n\r\n```powershell\r\npnpm -C openclaw test:fast -- `\r\n  src/cron/store.test.ts `\r\n  src/cron/service.rearm-timer-when-running.test.ts `\r\n  src/cron/service.issue-13992-regression.test.ts `\r\n  src/cron/service.issue-16156-list-skips-cron.test.ts `\r\n  src/cron/service.issue-regressions.test.ts\r\n```\r\n\r\n```powershell\r\npnpm -C openclaw test:fast -- `\r\n  src/cron/service.issue-regressions.test.ts `\r\n  src/cron/normalize.test.ts `\r\n  src/cron/store.test.ts `\r\n  src/cron/service.store-migration.test.ts `\r\n  src/cron/service.store.migration.test.ts `\r\n  src/cron/service.delivery-plan.test.ts\r\n```\r\n\r\nAll passed in the latest run.\r\n\r\nAdditional priority-3 verification:\r\n\r\n```powershell\r\npnpm -C openclaw test:fast -- `\r\n  src/config/secret-resolver.test.ts `\r\n  src/hooks/bundled/session-memory/handler.test.ts `\r\n  src/agents/model-routing.test.ts\r\n```\r\n\r\n```powershell\r\npnpm -C openclaw exec vitest run --config vitest.e2e.config.ts `\r\n  src/agents/pi-tools.before-tool-call.e2e.test.ts\r\n```\n\n<!-- greptile_comment -->\n\n<h3>Greptile Summary</h3>\n\nThis PR implements comprehensive cron system improvements across three areas: stability fixes, feature enhancements, and security guardrails.\n\n**Priority 1 - Stability Fixes:**\n- Atomic rename retry logic with exponential backoff for Windows file-lock races (`EBUSY`/`EPERM`/`ENOTEMPTY`)\n- Timer re-arm improvements to prevent scheduler deadlock when jobs are blocked by `runningAtMs` markers\n- Added 60s maintenance tick when all enabled jobs are running to avoid spin-loops\n\n**Priority 2 - Feature Enhancements:**\n- Multi-schedule support per job with backward-compatible migration (keeps `schedule` and `schedules[0]` in sync)\n- Per-job timeout normalization with 1s minimum and 24h maximum safety cap\n- Isolated announce fallback that attempts direct delivery when subagent announce flow fails\n- Telegram poll support with answer caching and system event integration\n\n**Priority 3 - Security & Intelligence Guardrails:**\n- Secrets manager integration for `op://` (1Password) and `vault://` (HashiCorp Vault) URIs\n- Membrane-style tool boundary enforcement with configurable deny lists for tools and command substrings\n- Smart model routing to select cheaper models for simple tasks vs complex tasks\n- Fact-check gate for session-memory hook writes requiring minimum message thresholds\n\nThe implementation includes comprehensive test coverage and proper migration/normalization logic to maintain backward compatibility.\n\n<h3>Confidence Score: 4/5</h3>\n\n- Safe to merge with minor considerations around scope and testing\n- The PR includes well-tested stability fixes and features with comprehensive test coverage. The multi-schedule implementation properly maintains backward compatibility through migration logic. Security features use standard subprocess execution patterns. Score reflects broad scope mixing unrelated features (Telegram polls alongside cron fixes) and the inherent complexity of scheduler state management, though tests demonstrate correctness.\n- No files require special attention\n\n<sub>Last reviewed commit: 086efd4</sub>\n\n<!-- greptile_other_comments_section -->\n\n<sub>(3/5) Reply to the agent's comments like \"Can you suggest a fix for this @greptileai?\" or ask follow-up questions!</sub>\n\n<!-- /greptile_comment -->",
      "author": "akyourowngames",
      "authorAssociation": "NONE",
      "createdAt": "2026-02-15T19:45:20Z",
      "updatedAt": "2026-02-15T20:06:17Z",
      "headRef": "feat/cron-multi-schedule",
      "baseRef": "main",
      "filesChanged": 51,
      "additions": 1976,
      "deletions": 384,
      "commits": 15,
      "labels": [
        "docs",
        "channel: telegram",
        "app: web-ui",
        "gateway",
        "scripts",
        "agents",
        "size: XL"
      ],
      "ciStatus": "failure",
      "hasIssueRef": false,
      "issueNumbers": [],
      "changedFiles": [
        "CRON_STABILIZATION_AND_FEATURES_README.md",
        "README.md",
        "docs/gateway/configuration-examples.md",
        "docs/gateway/configuration.md",
        "package.json",
        "pnpm-lock.yaml",
        "scripts/run-skill-scan.ts",
        "skills/poll-confirmation/SKILL.md",
        "src/agents/model-routing.test.ts",
        "src/agents/model-routing.ts",
        "src/agents/pi-tools.before-tool-call.e2e.test.ts",
        "src/agents/pi-tools.before-tool-call.ts",
        "src/agents/pi-tools.ts",
        "src/agents/tools/message-tool.e2e.test.ts",
        "src/agents/tools/message-tool.ts",
        "src/agents/tools/telegram-actions.ts",
        "src/channels/plugins/actions/telegram.test.ts",
        "src/channels/plugins/actions/telegram.ts",
        "src/channels/plugins/outbound/telegram.test.ts",
        "src/channels/plugins/outbound/telegram.ts",
        "src/config/io.ts",
        "src/config/secret-resolver.test.ts",
        "src/config/secret-resolver.ts",
        "src/config/types.agent-defaults.ts",
        "src/config/types.tools.ts",
        "src/config/zod-schema.agent-defaults.ts",
        "src/config/zod-schema.agent-runtime.ts",
        "src/cron/isolated-agent/run.ts",
        "src/cron/normalize.test.ts",
        "src/cron/normalize.ts",
        "src/cron/service.issue-regressions.test.ts",
        "src/cron/service.rearm-timer-when-running.test.ts",
        "src/cron/service/jobs.ts",
        "src/cron/service/ops.ts",
        "src/cron/service/store.ts",
        "src/cron/service/timer.ts",
        "src/cron/store.test.ts",
        "src/cron/store.ts",
        "src/cron/types.ts",
        "src/gateway/protocol/schema/cron.ts",
        "src/hooks/bundled/session-memory/handler.test.ts",
        "src/hooks/bundled/session-memory/handler.ts",
        "src/telegram/allowed-updates.test.ts",
        "src/telegram/allowed-updates.ts",
        "src/telegram/bot.ts",
        "src/telegram/bot/helpers.test.ts",
        "src/telegram/bot/helpers.ts",
        "src/telegram/poll-answer-cache.test.ts",
        "src/telegram/poll-answer-cache.ts",
        "src/telegram/send.poll.test.ts",
        "src/telegram/send.ts"
      ],
      "diffUrl": "https://github.com/openclaw/openclaw/pull/17459.diff",
      "hasTests": true,
      "testFilesChanged": [
        "src/agents/model-routing.test.ts",
        "src/agents/pi-tools.before-tool-call.e2e.test.ts",
        "src/agents/tools/message-tool.e2e.test.ts",
        "src/channels/plugins/actions/telegram.test.ts",
        "src/channels/plugins/outbound/telegram.test.ts",
        "src/config/secret-resolver.test.ts",
        "src/cron/normalize.test.ts",
        "src/cron/service.issue-regressions.test.ts",
        "src/cron/service.rearm-timer-when-running.test.ts",
        "src/cron/store.test.ts",
        "src/hooks/bundled/session-memory/handler.test.ts",
        "src/telegram/allowed-updates.test.ts",
        "src/telegram/bot/helpers.test.ts",
        "src/telegram/poll-answer-cache.test.ts",
        "src/telegram/send.poll.test.ts"
      ],
      "ageInDays": 0,
      "mergeable": "mergeable",
      "reviewState": "none",
      "reviewCount": 0,
      "commentCount": 0,
      "totalScore": 74,
      "signals": [
        {
          "name": "ci_status",
          "score": 10,
          "weight": 0.2,
          "reason": "CI: failure"
        },
        {
          "name": "diff_size",
          "score": 30,
          "weight": 0.1,
          "reason": "2360 lines changed (1976+/384-)"
        },
        {
          "name": "commit_quality",
          "score": 90,
          "weight": 0.05,
          "reason": "Conventional commit format"
        },
        {
          "name": "contributor",
          "score": 45,
          "weight": 0.15,
          "reason": "akyourowngames (NONE, rep: 81)"
        },
        {
          "name": "issue_ref",
          "score": 30,
          "weight": 0.1,
          "reason": "No issue reference"
        },
        {
          "name": "spam",
          "score": 75,
          "weight": 0.15,
          "reason": "No issue ref"
        },
        {
          "name": "test_coverage",
          "score": 90,
          "weight": 0.15,
          "reason": "15 test file(s) changed"
        },
        {
          "name": "staleness",
          "score": 100,
          "weight": 0.1,
          "reason": "0d old (Fresh)"
        },
        {
          "name": "mergeability",
          "score": 100,
          "weight": 0.15,
          "reason": "Merge status: mergeable"
        },
        {
          "name": "review_status",
          "score": 40,
          "weight": 0.1,
          "reason": "Review: none (0 reviews)"
        },
        {
          "name": "body_quality",
          "score": 90,
          "weight": 0.05,
          "reason": "Body: 7691 chars"
        },
        {
          "name": "activity",
          "score": 30,
          "weight": 0.05,
          "reason": "0 comments"
        },
        {
          "name": "breaking_change",
          "score": 40,
          "weight": 0.05,
          "reason": "Risky files: package.json; 384 deletions"
        }
      ],
      "isSpam": false,
      "spamReasons": [],
      "visionAlignment": "unchecked",
      "llmScore": 85,
      "llmRisk": "medium",
      "llmReason": "This PR addresses real stability issues and adds valuable features like multi-schedule support. The description is detailed and includes file lists for each change. The risk is medium because the changes touch core components like the cron store and scheduler, requiring careful review to ensure no regressions are introduced, especially with the store migration and timer re-arming logic. The large number of files touched also increases the risk."
    },
    {
      "number": 11602,
      "title": "fix(config): skip stale legacy config files when openclaw.json exists",
      "body": "## Summary\n\nFix for #11465 \u2014 After migrating from clawdbot to openclaw, the gateway reads stale legacy config files (clawdbot.json, moltbot.json, moldbot.json) causing validation failures and log spam every ~10 seconds via systemd restart loop.\n\n## Root Cause\n\n`resolveDefaultConfigCandidates()` in `src/config/paths.ts` generates candidate config paths including legacy filenames for every directory, even when `openclaw.json` already exists there. When a migration symlink exists (`~/.clawdbot \u2192 ~/.openclaw`), the stale legacy config gets picked up, fails validation, and the gateway crashes repeatedly.\n\n## Changes\n\n### Primary fix (`src/config/paths.ts`)\n- `resolveDefaultConfigCandidates()` now checks if `openclaw.json` exists in each candidate directory\n- If it does, legacy filenames (clawdbot.json, moltbot.json, moldbot.json) are skipped for that directory\n- Added `skipLegacyIfNewExists` option (default `true`) for backward compatibility in tests\n- Exported `LEGACY_CONFIG_FILENAMES` for use by doctor cleanup\n\n### Doctor cleanup (`src/commands/doctor-config-flow.ts`)\n- New `renameStaleLegacyConfigs()` function that renames stale legacy configs to `<name>.migrated` when `openclaw.json` exists\n- Respects `OPENCLAW_STATE_DIR` via `resolveStateDir()`\n- Called during `openclaw doctor` flow after legacy config migration\n\n### Tests\n- **`src/config/paths.test.ts`** \u2014 4 new tests:\n  - Skip legacy filenames when `openclaw.json` exists in same dir\n  - Include legacy filenames when `openclaw.json` does not exist (backward compat)\n  - Skip legacy in custom `OPENCLAW_STATE_DIR` with `openclaw.json`\n  - Symlink regression test (`~/.clawdbot \u2192 ~/.openclaw`) \u2014 the exact reported scenario\n- **`src/commands/doctor-config-flow.test.ts`** \u2014 4 new tests:\n  - Rename stale legacy configs when `openclaw.json` exists\n  - Skip when no primary config\n  - Skip when no legacy configs\n  - `.migrated` collision (safe to run doctor twice)\n- All 17 tests pass, all original tests preserved\n\n## Backward Compatibility\n\n- Legacy config paths still work for actual first-time migrations (when `openclaw.json` doesn't exist)\n- Doctor renames to `.migrated` rather than deleting (recoverable)\n- No changes to gateway startup logic\n\n## Verification\n\n```\npnpm check          \u2705 (typecheck + lint + format)\npnpm vitest run ... \u2705 (17 tests pass)\n```\n\n## Sign-Off\n\n- [x] AI-assisted (Claude Opus 4.6 via OpenClaw, with human review)\n- [x] Fully tested (17 unit tests covering all edge cases)\n- [x] Tested locally with OpenClaw instance\n- [x] Understand what the code does\n\nlobster-biscuit\n\n<!-- greptile_comment -->\n\n<h2>Greptile Overview</h2>\n\n<h3>Greptile Summary</h3>\n\nThis PR addresses #11465 by preventing stale legacy config files (`clawdbot.json`, `moltbot.json`, `moldbot.json`) from being considered when `openclaw.json` already exists in the same directory.\n\nKey changes:\n- `src/config/paths.ts`: `resolveDefaultConfigCandidates()` now omits legacy config filenames per-directory when `openclaw.json` exists, and `resolveConfigPath()` applies the same rule for explicit `stateDir` paths. Legacy config env override support is extended by treating `CLAWDBOT_CONFIG_PATH` as a fallback when `OPENCLAW_CONFIG_PATH` is unset.\n- `src/commands/doctor-config-flow.ts`: adds `renameStaleLegacyConfigs()` and runs it during `openclaw doctor` to rename stale legacy configs to `*.migrated` once a primary `openclaw.json` exists.\n- Tests cover the primary skip behavior, the symlink regression case, state-dir override behavior, and doctor rename collision behavior.\n\n\n<h3>Confidence Score: 5/5</h3>\n\n- This PR is safe to merge with minimal risk.\n- Changes are localized to config-path candidate generation and a best-effort doctor cleanup, with targeted tests covering the reported symlink regression and state-dir override scenarios.\n- No files require special attention\n\n<!-- greptile_other_comments_section -->\n\n<!-- /greptile_comment -->",
      "author": "akoscz",
      "authorAssociation": "CONTRIBUTOR",
      "createdAt": "2026-02-08T01:57:49Z",
      "updatedAt": "2026-02-15T20:52:25Z",
      "headRef": "fix/legacy-config-path-spam",
      "baseRef": "main",
      "filesChanged": 4,
      "additions": 284,
      "deletions": 22,
      "commits": 8,
      "labels": [
        "commands",
        "size: M"
      ],
      "ciStatus": "failure",
      "hasIssueRef": true,
      "issueNumbers": [
        11465
      ],
      "changedFiles": [
        "src/commands/doctor-config-flow.e2e.test.ts",
        "src/commands/doctor-config-flow.ts",
        "src/config/paths.test.ts",
        "src/config/paths.ts"
      ],
      "diffUrl": "https://github.com/openclaw/openclaw/pull/11602.diff",
      "hasTests": true,
      "testFilesChanged": [
        "src/commands/doctor-config-flow.e2e.test.ts",
        "src/config/paths.test.ts"
      ],
      "ageInDays": 7,
      "mergeable": "unknown",
      "reviewState": "commented",
      "reviewCount": 10,
      "commentCount": 17,
      "totalScore": 72,
      "signals": [
        {
          "name": "ci_status",
          "score": 10,
          "weight": 0.2,
          "reason": "CI: failure"
        },
        {
          "name": "diff_size",
          "score": 100,
          "weight": 0.1,
          "reason": "306 lines changed (284+/22-)"
        },
        {
          "name": "commit_quality",
          "score": 90,
          "weight": 0.05,
          "reason": "Conventional commit format"
        },
        {
          "name": "contributor",
          "score": 79,
          "weight": 0.15,
          "reason": "akoscz (CONTRIBUTOR, rep: 100)"
        },
        {
          "name": "issue_ref",
          "score": 90,
          "weight": 0.1,
          "reason": "References: #11465"
        },
        {
          "name": "spam",
          "score": 100,
          "weight": 0.15,
          "reason": "No spam signals"
        },
        {
          "name": "test_coverage",
          "score": 90,
          "weight": 0.15,
          "reason": "2 test file(s) changed"
        },
        {
          "name": "staleness",
          "score": 70,
          "weight": 0.1,
          "reason": "7d old (Aging)"
        },
        {
          "name": "mergeability",
          "score": 50,
          "weight": 0.15,
          "reason": "Merge status: unknown"
        },
        {
          "name": "review_status",
          "score": 70,
          "weight": 0.1,
          "reason": "Review: commented (10 reviews)"
        },
        {
          "name": "body_quality",
          "score": 100,
          "weight": 0.05,
          "reason": "Body: 3928 chars"
        },
        {
          "name": "activity",
          "score": 90,
          "weight": 0.05,
          "reason": "17 comments"
        },
        {
          "name": "breaking_change",
          "score": 80,
          "weight": 0.05,
          "reason": "No breaking change signals"
        }
      ],
      "isSpam": false,
      "spamReasons": [],
      "visionAlignment": "unchecked",
      "duplicateGroup": 1
    },
    {
      "number": 16916,
      "title": "feat(status): expose context overhead breakdown in --deep mode",
      "body": "## Summary\n\n- **Problem:** `/status` reports context usage as conversation tokens only (e.g., `113k/190k`), but the system prompt, workspace files, skills, and tool schemas are invisible overhead that can consume 70-100k+ tokens\n- **Why it matters:** Users experience unexpected compaction and wasted tokens with no way to diagnose what's consuming their context window\n- **What changed:** Added a \"Context breakdown\" section to `/status --deep` that renders the existing `SessionSystemPromptReport` data as a human-readable table with per-component char counts and estimated token overhead\n- **What did NOT change:** No changes to data collection, default `/status` output, or any runtime behavior. This is purely a display-layer addition in `--deep` mode\n\nlobster-biscuit\n\n### Example output (`/status --deep`)\n\n```\nContext breakdown\nSystem prompt          42k chars (~10.5k tokens)\n  Workspace files      20k chars\n    SOUL.md              8.0k\n    AGENTS.md            6.0k\n    MEMORY.md            5.4k\n  Skills (2)           15k chars\n  Tools (2)            13k chars\n  Base prompt          20k chars\n  \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  Estimated overhead   ~10.5k tokens (hidden from context display)\n```\n\n## Change Type (select all)\n\n- [ ] Bug fix\n- [x] Feature\n- [ ] Refactor\n- [ ] Docs\n- [ ] Security hardening\n- [ ] Chore/infra\n\n## Scope (select all touched areas)\n\n- [ ] Gateway / orchestration\n- [ ] Skills / tool execution\n- [ ] Auth / tokens\n- [ ] Memory / storage\n- [ ] Integrations\n- [ ] API / contracts\n- [x] UI / DX\n- [ ] CI/CD / infra\n\n## Linked Issue/PR\n\n- Closes #16635\n- Related #16540\n\n## User-visible / Behavior Changes\n\n- **New:** `/status --deep` now includes a \"Context breakdown\" section showing system prompt overhead (workspace files, skills, tools, base prompt) with character counts and estimated token usage\n- Default `/status` output is **unchanged** \u2014 breakdown only appears with `--deep` flag\n\n## Security Impact (required)\n\n- New permissions/capabilities? `No`\n- Secrets/tokens handling changed? `No`\n- New/changed network calls? `No`\n- Command/tool execution surface changed? `No`\n- Data access scope changed? `No`\n\n## Repro + Verification\n\n### Environment\n\n- OS: macOS 15.3 (Sequoia)\n- Runtime/container: Node 22.x\n- Model/provider: Any (display-only change)\n- Integration/channel: CLI\n- Relevant config: Any workspace with CLAUDE.md / SOUL.md files\n\n### Steps\n\n1. Configure workspace files (e.g., CLAUDE.md, SOUL.md) in a project directory\n2. Start a session, then run `/status --deep`\n3. Observe the new \"Context breakdown\" section after the sessions table\n\n### Expected\n\n- Context breakdown appears showing system prompt chars, workspace file breakdown, skills, tools, and estimated token overhead\n- Each component shows its character count in `Xk` format\n- Truncated workspace files are marked with `(truncated)`\n\n### Actual\n\n- Context breakdown renders correctly with all components\n- Values match the `SessionSystemPromptReport` data already being collected\n\n## Evidence\n\n- [x] Failing test/log before + passing after\n- [ ] Trace/log snippets\n- [ ] Screenshot/recording\n- [ ] Perf numbers (if relevant)\n\n**Unit tests:** 6 new tests in `src/commands/status.format.test.ts` \u2014 all passing:\n- `estimateTokensFromChars` \u2014 basic char-to-token conversion\n- `formatContextBreakdown` \u2014 returns empty for undefined report\n- `formatContextBreakdown` \u2014 full report with files, skills, tools\n- `formatContextBreakdown` \u2014 minimal report with only base prompt\n- `formatTokensCompact` \u2014 basic formatting\n- `formatTokensCompact` \u2014 zero values\n\n```\n\u2713 src/commands/status.format.test.ts (6 tests) 2ms\n Test Files  1 passed (1)\n      Tests  6 passed (6)\n```\n\n## Human Verification (required)\n\n- **Verified scenarios:** TypeScript compiles clean across all modified files; unit tests pass; lint passes (oxlint + oxfmt via pre-commit hooks)\n- **Edge cases checked:** undefined/missing `systemPromptReport`, zero-value components (skills=0, tools=0), files with `truncated: true` flag, workspace with no project context\n- **What you did NOT verify:** Live `/status --deep` output with a running session (no local OpenClaw gateway running \u2014 verified via unit tests and type checking only)\n\n## Compatibility / Migration\n\n- Backward compatible? `Yes` \u2014 default `/status` unchanged, new output only in `--deep`\n- Config/env changes? `No`\n- Migration needed? `No`\n\n## Failure Recovery (if this breaks)\n\n- How to disable/revert this change quickly: Revert the 2 commits on this branch. The `--deep` flag section is isolated in `status.command.ts`\n- Files/config to restore: `status.command.ts`, `status.format.ts`, `status.summary.ts`, `status.types.ts`\n- Known bad symptoms reviewers should watch for: If `systemPromptReport` is undefined (older sessions), the breakdown section simply doesn't render \u2014 no crash risk\n\n## Risks and Mitigations\n\nNone \u2014 this is a pure display change that reads existing data from `SessionSystemPromptReport` (already persisted on every session). No new data collection, no state mutation, no config changes. The `--deep` guard ensures zero impact on default output.\n\n---\n\n- [x] Mark as AI-assisted in the PR title or description\n- [x] Note the degree of testing: fully tested (6 unit tests), all code understood by author\n- [x] Confirm understanding: all code understood by author\n\n\ud83e\udd16 AI-assisted PR (Claude Code) \u2014 fully tested, all code understood by author",
      "author": "soumikbhatta",
      "authorAssociation": "NONE",
      "createdAt": "2026-02-15T07:35:18Z",
      "updatedAt": "2026-02-15T20:39:53Z",
      "headRef": "fix/expose-context-overhead-in-status",
      "baseRef": "main",
      "filesChanged": 5,
      "additions": 217,
      "deletions": 0,
      "commits": 3,
      "labels": [
        "commands",
        "size: M"
      ],
      "ciStatus": "failure",
      "hasIssueRef": true,
      "issueNumbers": [
        16635
      ],
      "changedFiles": [
        "src/commands/status.command.ts",
        "src/commands/status.format.test.ts",
        "src/commands/status.format.ts",
        "src/commands/status.summary.ts",
        "src/commands/status.types.ts"
      ],
      "diffUrl": "https://github.com/openclaw/openclaw/pull/16916.diff",
      "hasTests": true,
      "testFilesChanged": [
        "src/commands/status.format.test.ts"
      ],
      "ageInDays": 0,
      "mergeable": "mergeable",
      "reviewState": "none",
      "reviewCount": 0,
      "commentCount": 0,
      "totalScore": 72,
      "signals": [
        {
          "name": "ci_status",
          "score": 10,
          "weight": 0.2,
          "reason": "CI: failure"
        },
        {
          "name": "diff_size",
          "score": 100,
          "weight": 0.1,
          "reason": "217 lines changed (217+/0-)"
        },
        {
          "name": "commit_quality",
          "score": 90,
          "weight": 0.05,
          "reason": "Conventional commit format"
        },
        {
          "name": "contributor",
          "score": 51,
          "weight": 0.15,
          "reason": "soumikbhatta (NONE, rep: 100)"
        },
        {
          "name": "issue_ref",
          "score": 90,
          "weight": 0.1,
          "reason": "References: #16635"
        },
        {
          "name": "spam",
          "score": 100,
          "weight": 0.15,
          "reason": "No spam signals"
        },
        {
          "name": "test_coverage",
          "score": 90,
          "weight": 0.15,
          "reason": "1 test file(s) changed"
        },
        {
          "name": "staleness",
          "score": 100,
          "weight": 0.1,
          "reason": "0d old (Fresh)"
        },
        {
          "name": "mergeability",
          "score": 100,
          "weight": 0.15,
          "reason": "Merge status: mergeable"
        },
        {
          "name": "review_status",
          "score": 40,
          "weight": 0.1,
          "reason": "Review: none (0 reviews)"
        },
        {
          "name": "body_quality",
          "score": 100,
          "weight": 0.05,
          "reason": "Body: 5417 chars"
        },
        {
          "name": "activity",
          "score": 30,
          "weight": 0.05,
          "reason": "0 comments"
        },
        {
          "name": "breaking_change",
          "score": 80,
          "weight": 0.05,
          "reason": "No breaking change signals"
        }
      ],
      "isSpam": false,
      "spamReasons": [],
      "visionAlignment": "unchecked"
    },
    {
      "number": 17349,
      "title": "feat: add AI PR triage GitHub Action for duplicate detection",
      "body": "## Summary\nAI-powered PR triage system that detects duplicate/overlapping PRs and silently labels them. Single Claude API call per PR with hourly-cached context of all open PRs and recent merge/close decisions.\n\n## Architecture\n- **4 files**: `scripts/pr-triage.mjs` (367 LOC), `scripts/pr-triage-github.mjs` (463 LOC), `scripts/pr-triage-labels.mjs` (133 LOC), `.github/workflows/pr-triage.yml` (55 LOC)\n- **Single LLM call** with adaptive thinking + structured JSON output (Opus 4.6)\n- **Hourly snapshot caching**: freezes open PR context via `actions/cache` so all PRs triaged in the same hour share byte-identical system prompts \u2192 Anthropic prompt cache hits (90% read discount)\n- **Deterministic pre-enrichment**: Jaccard file overlap + issue ref extraction before LLM\n- **GraphQL batch file fetching**: ~10 API calls for 500 PRs (25x improvement over REST N+1)\n- **Rate limit budget system**: checks remaining budget, degrades gracefully to semantic-only triage\n\n## Caching Architecture\nFirst PR of the hour builds a fresh snapshot of all open PRs + recent decisions and saves it to `actions/cache` with an hour-based key (`pr-triage-snapshot-YYYY-MM-DD-HH`). All subsequent PRs that hour load the snapshot, sending byte-identical system prompts to the Anthropic API.\n\n- **Cache hit rate**: ~93% (14 of 15 hourly PRs are cache reads)\n- **Cost reduction**: ~74% vs uncached (~$130-200/mo with Opus vs ~$507 uncached at 7,684 PRs/mo)\n- **Trade-off**: PRs opened in the last hour may not appear in context; most duplicates target older PRs, so accuracy impact is minimal\n- **Configurable**: `SNAPSHOT_MAX_AGE_MS` env var (default: 1 hour)\n\n## Model & Cost\n| Model | First call/hour | Cached calls | Monthly (7,684 PRs) |\n|-------|-----------------|--------------|---------------------|\n| Opus 4.6 | ~$0.15-0.30 | ~$0.03-0.06 | ~$130-200 |\n| Sonnet 4.5 | ~$0.09-0.18 | ~$0.02-0.04 | ~$70-120 |\n| Haiku 4.5 | ~$0.03-0.06 | ~$0.006-0.01 | ~$30-50 |\n\n- Default: Claude Opus 4.6 with adaptive thinking (effort=high) \u2014 best quality (3/3 on benchmarks)\n- Adaptive thinking + effort params gated to Opus only (Sonnet/Haiku don't support them)\n- Structured output with JSON schema validation via `anthropic-beta: structured-outputs-2025-11-13`\n\n## UX \u2014 Invisible to contributors\n- **Silent labels only**: `auto:bug`, `auto:feature`, `possible-overlap`, `cluster:#N`, `triage:likely-duplicate`, `triage:no-tests`, `triage:no-issue-ref`\n- **No public bot comments** (avoids the matplotlib/crabby-rathbun political risk)\n- **Private reasoning** via GitHub Action step summary (maintainers only)\n\n## Security\n- `sanitizeUntrusted()`: strips XML-like injection tags from PR titles, bodies, diffs\n- Length limits: body 4K chars, diff 8K chars\n- System prompt explicitly marks PR content as untrusted\n- Structured output schema prevents free-form text injection into output\n- Output validation: hallucinated PR numbers filtered against known open PRs\n\n## Verified against real PRs\n| PR | Opus 4.6 | Sonnet 4.5 | Haiku 4.5 |\n|----|----------|------------|-----------|\n| #17320 (auth fix) | bug/high/needs-review \u2713 | feature/high \u2717 | feature/high \u2717 |\n| #17296 (kitchen-sink) | likely-duplicate \u2713 | likely-duplicate \u2713 | needs-review \u2717 |\n| #17295 (duplicate) | likely-duplicate \u2713 | likely-duplicate \u2713 | likely-duplicate \u2713 |\n| **Score** | **3/3** | **2.5/3** | **1.5/3** |\n\n## Changes\n- `.github/workflows/pr-triage.yml` \u2014 Action with hourly snapshot cache step\n- `scripts/pr-triage.mjs` \u2014 Main orchestrator with snapshot load/save + LLM call\n- `scripts/pr-triage-github.mjs` \u2014 GitHub API helpers, GraphQL batching, validation\n- `scripts/pr-triage-labels.mjs` \u2014 Label application and summary output\n- `scripts/PR-TRIAGE.md` \u2014 Comprehensive documentation\n\n## Test plan\n- [x] Dry run mode: `DRY_RUN=1` skips LLM call, uses deterministic signals only\n- [x] Snapshot caching: first run creates snapshot, second run loads it (verified locally)\n- [x] Model compatibility: Opus uses adaptive thinking, Sonnet/Haiku skip it gracefully\n- [x] Real PR triage: tested on 3 production PRs across 3 models\n- [x] oxfmt + oxlint pass with zero errors",
      "author": "olivier-motium",
      "authorAssociation": "NONE",
      "createdAt": "2026-02-15T17:32:07Z",
      "updatedAt": "2026-02-15T20:54:08Z",
      "headRef": "melt/pr-triage-action",
      "baseRef": "main",
      "filesChanged": 8,
      "additions": 2277,
      "deletions": 1,
      "commits": 15,
      "labels": [
        "app: web-ui",
        "scripts",
        "size: XL"
      ],
      "ciStatus": "failure",
      "hasIssueRef": true,
      "issueNumbers": [
        17320,
        17296,
        17295
      ],
      "changedFiles": [
        ".github/workflows/pr-triage.yml",
        ".gitignore",
        "scripts/PR-TRIAGE.md",
        "scripts/pr-triage-github.mjs",
        "scripts/pr-triage-labels.mjs",
        "scripts/pr-triage.mjs",
        "scripts/pr-triage.test.mjs",
        "ui/vite.config.ts"
      ],
      "diffUrl": "https://github.com/openclaw/openclaw/pull/17349.diff",
      "hasTests": true,
      "testFilesChanged": [
        "scripts/pr-triage.test.mjs"
      ],
      "ageInDays": 0,
      "mergeable": "unknown",
      "reviewState": "commented",
      "reviewCount": 1,
      "commentCount": 0,
      "totalScore": 70,
      "signals": [
        {
          "name": "ci_status",
          "score": 10,
          "weight": 0.2,
          "reason": "CI: failure"
        },
        {
          "name": "diff_size",
          "score": 30,
          "weight": 0.1,
          "reason": "2278 lines changed (2277+/1-)"
        },
        {
          "name": "commit_quality",
          "score": 90,
          "weight": 0.05,
          "reason": "Conventional commit format"
        },
        {
          "name": "contributor",
          "score": 39,
          "weight": 0.15,
          "reason": "olivier-motium (NONE, rep: 60)"
        },
        {
          "name": "issue_ref",
          "score": 90,
          "weight": 0.1,
          "reason": "References: #17320, #17296, #17295"
        },
        {
          "name": "spam",
          "score": 100,
          "weight": 0.15,
          "reason": "No spam signals"
        },
        {
          "name": "test_coverage",
          "score": 90,
          "weight": 0.15,
          "reason": "1 test file(s) changed"
        },
        {
          "name": "staleness",
          "score": 100,
          "weight": 0.1,
          "reason": "0d old (Fresh)"
        },
        {
          "name": "mergeability",
          "score": 50,
          "weight": 0.15,
          "reason": "Merge status: unknown"
        },
        {
          "name": "review_status",
          "score": 60,
          "weight": 0.1,
          "reason": "Review: commented (1 reviews)"
        },
        {
          "name": "body_quality",
          "score": 100,
          "weight": 0.05,
          "reason": "Body: 4116 chars"
        },
        {
          "name": "activity",
          "score": 30,
          "weight": 0.05,
          "reason": "0 comments"
        },
        {
          "name": "breaking_change",
          "score": 80,
          "weight": 0.05,
          "reason": "No breaking change signals"
        }
      ],
      "isSpam": false,
      "spamReasons": [],
      "visionAlignment": "unchecked",
      "llmScore": 75,
      "llmRisk": "medium",
      "llmReason": "This PR introduces a valuable feature: automated duplicate PR detection. The architecture seems well-thought-out, with caching and rate limiting. However, the reliance on a single LLM (Claude) introduces a dependency and potential cost concerns. The cost estimates are helpful, but real-world usage might vary. The risk is medium because of the external dependency and the potential for false positives/negatives in the duplicate detection, which could annoy contributors. Thorough testing and monitoring will be crucial."
    },
    {
      "number": 17346,
      "title": "feat(hooks): add message_persist hook for all transcript messages",
      "body": "## Summary\n\nAdds a new synchronous plugin hook `message_persist` that is called for **all messages** (user, assistant, system, toolResult) before they are written to the session transcript on disk.\n\n## Why This Hook Matters\n\nOpenClaw's plugin system lets agents extend the platform without forking core. But there's a gap: **there's no way for a plugin to intercept user, assistant, or system messages before they're written to disk.**\n\nThe existing `tool_result_persist` hook only covers tool results. If you want to build:\n- \ud83d\udd12 **At-rest encryption** \u2014 encrypt ALL transcript content, not just tool results\n- \ud83d\udd07 **PII redaction** \u2014 strip sensitive data from every message type\n- \ud83d\udcdd **Audit logging** \u2014 complete conversation capture for compliance\n- \ud83c\udff7\ufe0f **Metadata injection** \u2014 tag messages with provenance, timestamps, or labels\n\n...you're stuck. You'd have to fork OpenClaw core.\n\nThis hook closes that gap. A plugin registers `message_persist`, and every message flows through it before hitting disk \u2014 same pattern plugin authors already know from `tool_result_persist`.\n\n## How We Built This (Development Process)\n\nThis PR was developed by an AI agent (Clawee \ud83d\udc3e) working through OpenClaw's own plugin system. Here's the process \u2014 useful as a template for agent-contributed PRs:\n\n1. **Identified the need**: Building an `@openclaw/vault` encryption plugin. Discovered `tool_result_persist` existed but couldn't intercept user/assistant/system messages.\n2. **Read the source**: Traced the persistence path \u2014 `SessionManager._persist()` \u2192 `appendFileSync()` \u2192 found `transformMessageForPersistence` callback in `session-tool-result-guard.ts` already intercepted ALL messages but wasn't exposed as a hook.\n3. **Mirrored the existing pattern**: Copied the `tool_result_persist` implementation exactly \u2014 same synchronous execution, same priority ordering, same async rejection, same zero-overhead guard when no hooks registered.\n4. **Wired it in**: Connected the new hook to the existing `transformMessageForPersistence` callback, running after input provenance tagging.\n5. **Validated**: TypeScript compiles, linting clean, formatting clean.\n\n## Design\n\nThe hook follows the exact same synchronous, sequential pattern as `tool_result_persist`:\n- Handlers run in priority order (higher first)\n- Each handler may return `{ message }` to replace the message for the next handler\n- Async handlers are rejected with a warning (hot path, same as `tool_result_persist`)\n- When no hooks are registered, zero overhead (guard check skipped entirely)\n\n### \u26a0\ufe0f Double-hook note for `toolResult` messages\n\n`toolResult` messages pass through **both** `message_persist` (via `transformMessageForPersistence`) and `tool_result_persist` (via `transformToolResultForPersistence`). This is by design \u2014 most plugins only need `message_persist` to cover everything. But if you register both hooks, guard against double-processing:\n\n```ts\n// Example: skip if already encrypted\napi.registerHook('message_persist', (event) => {\n  if (isAlreadyEncrypted(event.message)) return; // guard\n  return { message: encrypt(event.message) };\n});\n```\n\n## Changes\n\n| File | Change |\n|------|--------|\n| `src/plugins/types.ts` | Add `message_persist` to `PluginHookName`, event/result/context types, handler map entry |\n| `src/plugins/hooks.ts` | Add `runMessagePersist()` \u2014 mirrors `runToolResultPersist()` exactly |\n| `src/agents/session-tool-result-guard-wrapper.ts` | Wire hook into `transformMessageForPersistence` callback with inline docs |\n\n## Usage Example\n\n```ts\n// Plugin: encrypt all messages before they hit disk\nexport default function (api) {\n  api.registerHook('message_persist', (event, ctx) => {\n    // event.message \u2014 the raw message object (any role)\n    // event.role    \u2014 'user' | 'assistant' | 'system' | 'toolResult'\n    // ctx.agentId   \u2014 which agent's session this belongs to\n    // ctx.sessionKey \u2014 the session identifier\n    \n    const encrypted = encrypt(event.message);\n    return { message: encrypted }; // returned message replaces original on disk\n  }, { name: 'vault-encrypt', priority: 100 });\n}\n```\n\n## Backward Compatibility\n\nNo breaking changes. Existing behavior is fully preserved when no `message_persist` hooks are registered \u2014 the `transformMessageForPersistence` path still applies input provenance as before, with the hook transform applied afterward.\n\n## Testing\n\n- TypeScript compiles cleanly\n- Linting passes (oxlint: 0 warnings, 0 errors)\n- Formatting passes (oxfmt)\n- E2e test to follow (mirroring existing `tool_result_persist` test)\n",
      "author": "clawee-vanguard",
      "authorAssociation": "NONE",
      "createdAt": "2026-02-15T17:26:00Z",
      "updatedAt": "2026-02-15T20:37:12Z",
      "headRef": "feat/message-persist-hook",
      "baseRef": "main",
      "filesChanged": 4,
      "additions": 404,
      "deletions": 2,
      "commits": 3,
      "labels": [
        "agents",
        "size: M"
      ],
      "ciStatus": "pending",
      "hasIssueRef": false,
      "issueNumbers": [],
      "changedFiles": [
        "src/agents/session-tool-result-guard-wrapper.ts",
        "src/agents/session-tool-result-guard.message-persist-hook.e2e.test.ts",
        "src/plugins/hooks.ts",
        "src/plugins/types.ts"
      ],
      "diffUrl": "https://github.com/openclaw/openclaw/pull/17346.diff",
      "hasTests": true,
      "testFilesChanged": [
        "src/agents/session-tool-result-guard.message-persist-hook.e2e.test.ts"
      ],
      "ageInDays": 0,
      "mergeable": "mergeable",
      "reviewState": "commented",
      "reviewCount": 1,
      "commentCount": 1,
      "totalScore": 70,
      "signals": [
        {
          "name": "ci_status",
          "score": 50,
          "weight": 0.2,
          "reason": "CI: pending"
        },
        {
          "name": "diff_size",
          "score": 100,
          "weight": 0.1,
          "reason": "406 lines changed (404+/2-)"
        },
        {
          "name": "commit_quality",
          "score": 90,
          "weight": 0.05,
          "reason": "Conventional commit format"
        },
        {
          "name": "contributor",
          "score": 27,
          "weight": 0.15,
          "reason": "clawee-vanguard (NONE, rep: 21)"
        },
        {
          "name": "issue_ref",
          "score": 30,
          "weight": 0.1,
          "reason": "No issue reference"
        },
        {
          "name": "spam",
          "score": 75,
          "weight": 0.15,
          "reason": "No issue ref"
        },
        {
          "name": "test_coverage",
          "score": 90,
          "weight": 0.15,
          "reason": "1 test file(s) changed"
        },
        {
          "name": "staleness",
          "score": 100,
          "weight": 0.1,
          "reason": "0d old (Fresh)"
        },
        {
          "name": "mergeability",
          "score": 100,
          "weight": 0.15,
          "reason": "Merge status: mergeable"
        },
        {
          "name": "review_status",
          "score": 60,
          "weight": 0.1,
          "reason": "Review: commented (1 reviews)"
        },
        {
          "name": "body_quality",
          "score": 90,
          "weight": 0.05,
          "reason": "Body: 4549 chars"
        },
        {
          "name": "activity",
          "score": 50,
          "weight": 0.05,
          "reason": "1 comments"
        },
        {
          "name": "breaking_change",
          "score": 80,
          "weight": 0.05,
          "reason": "No breaking change signals"
        }
      ],
      "isSpam": false,
      "spamReasons": [],
      "visionAlignment": "unchecked",
      "duplicateGroup": 1
    },
    {
      "number": 17012,
      "title": "Add French documentation (README, index, getting-started)",
      "body": "## Summary\r\n\r\n- Problem: Documentation is currently English-only, limiting accessibility for French-speaking users.\r\n- Why it matters: Expanding language support helps grow the community and makes OpenClaw easier to adopt for non-English speakers.\r\n- What changed:\r\n    - Added `docs/fr/` directory structure.\r\n    - Added `README.fr.md`: Full translation of the main README.\r\n    - Added `docs/fr/index.md`: Translation of the documentation homepage.\r\n    - Added `docs/fr/start/getting-started.md`: Translation of the Getting Started guide.\r\n- What did NOT change (scope boundary): No code changes, no changes to existing English documentation.\r\n\r\n## Change Type (select all)\r\n\r\n- [ ] Bug fix\r\n- [ ] Feature\r\n- [ ] Refactor\r\n- [x] Docs\r\n- [ ] Security hardening\r\n- [ ] Chore/infra\r\n\r\n## Scope (select all touched areas)\r\n\r\n- [ ] Gateway / orchestration\r\n- [ ] Skills / tool execution\r\n- [ ] Auth / tokens\r\n- [ ] Memory / storage\r\n- [ ] Integrations\r\n- [ ] API / contracts\r\n- [x] UI / DX\r\n- [ ] CI/CD / infra\r\n\r\n## Linked Issue/PR\r\n\r\n- Closes #\r\n- Related #\r\n\r\n## User-visible / Behavior Changes\r\n\r\n- New documentation files available in French under `docs/fr/`.\r\n- New `README.fr.md` file in the root directory.\r\n\r\n## Security Impact (required)\r\n\r\n- New permissions/capabilities? (`No`)\r\n- Secrets/tokens handling changed? (`No`)\r\n- New/changed network calls? (`No`)\r\n- Command/tool execution surface changed? (`No`)\r\n- Data access scope changed? (`No`)\r\n- If any `Yes`, explain risk + mitigation: None\r\n\r\n## Repro + Verification\r\n\r\n### Environment\r\n\r\n- OS: macOS\r\n- Runtime/container: N/A (Documentation only)\r\n- Model/provider: N/A\r\n- Integration/channel (if any): N/A\r\n- Relevant config (redacted): N/A\r\n\r\n### Steps\r\n\r\n1. Checkout the branch `french-docs`.\r\n2. Open `README.fr.md`.\r\n3. Navigate to `docs/fr/index.md` and `docs/fr/start/getting-started.md`.\r\n\r\n### Expected\r\n\r\n- Content should be in French and accurately reflect the original English documentation.\r\n\r\n### Actual\r\n\r\n- Content is translated into French.\r\n\r\n## Evidence\r\n\r\nAttach at least one:\r\n\r\n- [ ] Failing test/log before + passing after\r\n- [ ] Trace/log snippets\r\n- [x] Screenshot/recording (See file contents)\r\n- [ ] Perf numbers (if relevant)\r\n\r\n## Human Verification (required)\r\n\r\nWhat you personally verified (not just CI), and how:\r\n\r\n- Verified scenarios: Checked translation accuracy against English originals for README, index, and getting-started guide.\r\n- Edge cases checked: Verified relative links and formatting in markdown files.\r\n- What you did **not** verify: Did not verify every single link target (assumed English links are valid).\r\n\r\n## Compatibility / Migration\r\n\r\n- Backward compatible? (`Yes`)\r\n- Config/env changes? (`No`)\r\n- Migration needed? (`No`)\r\n- If yes, exact upgrade steps: N/A\r\n\r\n## Failure Recovery (if this breaks)\r\n\r\n- How to disable/revert this change quickly: Revert the PR.\r\n- Files/config to restore: Delete added files.\r\n- Known bad symptoms reviewers should watch for: Broken links or typos in French text.\r\n\r\n## Risks and Mitigations\r\n\r\nList only real risks for this PR. Add/remove entries as needed. If none, write `None`.\r\n\r\n- Risk: Translation errors or outdated information if English docs change rapidly.\r\n  - Mitigation: Community review and future updates to keep in sync.\n\n<!-- greptile_comment -->\n\n<h3>Greptile Summary</h3>\n\nAdded French translations for core documentation files (`README.fr.md`, `docs/fr/index.md`, `docs/fr/start/getting-started.md`). The translations are comprehensive and accurately reflect the English originals. All links point to English documentation URLs (appropriate for a translation PR). Found one minor typo (\"Semurit\u00e9\" instead of \"S\u00e9curit\u00e9\").\n\n<h3>Confidence Score: 5/5</h3>\n\n- This PR is safe to merge with minimal risk\n- Documentation-only changes with no code modifications, minimal impact on existing functionality, and only one minor typo found\n- No files require special attention - straightforward documentation translation with one typo to fix\n\n<sub>Last reviewed commit: 50b9afa</sub>\n\n<!-- greptile_other_comments_section -->\n\n<sub>(2/5) Greptile learns from your feedback when you react with thumbs up/down!</sub>\n\n<!-- /greptile_comment -->",
      "author": "rnnpeng",
      "authorAssociation": "NONE",
      "createdAt": "2026-02-15T09:47:58Z",
      "updatedAt": "2026-02-15T20:14:17Z",
      "headRef": "french-docs",
      "baseRef": "main",
      "filesChanged": 7,
      "additions": 898,
      "deletions": 23,
      "commits": 9,
      "labels": [
        "docs",
        "channel: whatsapp-web",
        "scripts",
        "size: L"
      ],
      "ciStatus": "pending",
      "hasIssueRef": false,
      "issueNumbers": [],
      "changedFiles": [
        ".github/workflows/formal-conformance.yml",
        "README.fr.md",
        "docs/fr/index.md",
        "docs/fr/start/getting-started.md",
        "scripts/test-parallel.mjs",
        "src/web/media.test.ts",
        "src/web/media.ts"
      ],
      "diffUrl": "https://github.com/openclaw/openclaw/pull/17012.diff",
      "hasTests": true,
      "testFilesChanged": [
        "src/web/media.test.ts"
      ],
      "ageInDays": 0,
      "mergeable": "mergeable",
      "reviewState": "commented",
      "reviewCount": 1,
      "commentCount": 2,
      "totalScore": 69,
      "signals": [
        {
          "name": "ci_status",
          "score": 50,
          "weight": 0.2,
          "reason": "CI: pending"
        },
        {
          "name": "diff_size",
          "score": 60,
          "weight": 0.1,
          "reason": "921 lines changed (898+/23-)"
        },
        {
          "name": "commit_quality",
          "score": 50,
          "weight": 0.05,
          "reason": "Non-standard title"
        },
        {
          "name": "contributor",
          "score": 46,
          "weight": 0.15,
          "reason": "rnnpeng (NONE, rep: 83)"
        },
        {
          "name": "issue_ref",
          "score": 30,
          "weight": 0.1,
          "reason": "No issue reference"
        },
        {
          "name": "spam",
          "score": 75,
          "weight": 0.15,
          "reason": "No issue ref"
        },
        {
          "name": "test_coverage",
          "score": 90,
          "weight": 0.15,
          "reason": "1 test file(s) changed"
        },
        {
          "name": "staleness",
          "score": 100,
          "weight": 0.1,
          "reason": "0d old (Fresh)"
        },
        {
          "name": "mergeability",
          "score": 100,
          "weight": 0.15,
          "reason": "Merge status: mergeable"
        },
        {
          "name": "review_status",
          "score": 60,
          "weight": 0.1,
          "reason": "Review: commented (1 reviews)"
        },
        {
          "name": "body_quality",
          "score": 100,
          "weight": 0.05,
          "reason": "Body: 4212 chars"
        },
        {
          "name": "activity",
          "score": 70,
          "weight": 0.05,
          "reason": "2 comments"
        },
        {
          "name": "breaking_change",
          "score": 80,
          "weight": 0.05,
          "reason": "No breaking change signals"
        }
      ],
      "isSpam": false,
      "spamReasons": [],
      "visionAlignment": "unchecked"
    },
    {
      "number": 14257,
      "title": "fix: codex keeps dying on pty",
      "body": "wip",
      "author": "onutc",
      "authorAssociation": "CONTRIBUTOR",
      "createdAt": "2026-02-11T20:27:55Z",
      "updatedAt": "2026-02-15T20:35:26Z",
      "headRef": "fix/pty-cleanup-resume-stall",
      "baseRef": "main",
      "filesChanged": 13,
      "additions": 1428,
      "deletions": 255,
      "commits": 11,
      "labels": [
        "docs",
        "agents",
        "maintainer",
        "size: XL"
      ],
      "ciStatus": "pending",
      "hasIssueRef": false,
      "issueNumbers": [],
      "changedFiles": [
        "docs/experiments/plans/pty-process-supervision.md",
        "src/agents/bash-tools.exec-runtime.ts",
        "src/agents/bash-tools.exec.pty-cleanup.test.ts",
        "src/agents/cli-backends.test.ts",
        "src/agents/cli-backends.ts",
        "src/agents/cli-runner.e2e.test.ts",
        "src/agents/cli-runner.ts",
        "src/agents/cli-runner/helpers.ts",
        "src/agents/cli-runner/reliability.ts",
        "src/config/types.agent-defaults.ts",
        "src/config/zod-schema.core.ts",
        "src/process/exec.test.ts",
        "src/process/exec.ts"
      ],
      "diffUrl": "https://github.com/openclaw/openclaw/pull/14257.diff",
      "hasTests": true,
      "testFilesChanged": [
        "src/agents/bash-tools.exec.pty-cleanup.test.ts",
        "src/agents/cli-backends.test.ts",
        "src/agents/cli-runner.e2e.test.ts",
        "src/process/exec.test.ts"
      ],
      "ageInDays": 4,
      "mergeable": "mergeable",
      "reviewState": "none",
      "reviewCount": 0,
      "commentCount": 4,
      "totalScore": 68,
      "signals": [
        {
          "name": "ci_status",
          "score": 50,
          "weight": 0.2,
          "reason": "CI: pending"
        },
        {
          "name": "diff_size",
          "score": 60,
          "weight": 0.1,
          "reason": "1683 lines changed (1428+/255-)"
        },
        {
          "name": "commit_quality",
          "score": 90,
          "weight": 0.05,
          "reason": "Conventional commit format"
        },
        {
          "name": "contributor",
          "score": 75,
          "weight": 0.15,
          "reason": "onutc (CONTRIBUTOR, rep: 88)"
        },
        {
          "name": "issue_ref",
          "score": 30,
          "weight": 0.1,
          "reason": "No issue reference"
        },
        {
          "name": "spam",
          "score": 75,
          "weight": 0.15,
          "reason": "No issue ref, No/short description, contributor bonus -1"
        },
        {
          "name": "test_coverage",
          "score": 90,
          "weight": 0.15,
          "reason": "4 test file(s) changed"
        },
        {
          "name": "staleness",
          "score": 100,
          "weight": 0.1,
          "reason": "4d old (Fresh)"
        },
        {
          "name": "mergeability",
          "score": 100,
          "weight": 0.15,
          "reason": "Merge status: mergeable"
        },
        {
          "name": "review_status",
          "score": 40,
          "weight": 0.1,
          "reason": "Review: none (0 reviews)"
        },
        {
          "name": "body_quality",
          "score": 20,
          "weight": 0.05,
          "reason": "Body: 3 chars"
        },
        {
          "name": "activity",
          "score": 70,
          "weight": 0.05,
          "reason": "4 comments"
        },
        {
          "name": "breaking_change",
          "score": 40,
          "weight": 0.05,
          "reason": "255 deletions"
        }
      ],
      "isSpam": false,
      "spamReasons": [],
      "visionAlignment": "unchecked"
    },
    {
      "number": 16562,
      "title": "fix(signal): preserve case for group and username targets",
      "body": "## Summary\r\n\r\n  - Problem: Signal target normalization lowercased group: and username: target values.\r\n  - Why it matters: Case-sensitive identifiers can be mutated, causing misrouting or failed target resolution. In particular, it failed doing emoji reactions on group messages.\r\n  - What changed: normalizeSignalMessagingTarget now preserves value casing for group: and username: while still\r\n    recognizing prefixes.\r\n  - What did NOT change (scope boundary): UUID normalization paths and other channel normalizers remain unchanged.\r\n\r\n  ## Change Type (select all)\r\n\r\n  - [x] Bug fix\r\n  - [ ] Feature\r\n  - [ ] Refactor\r\n  - [ ] Docs\r\n  - [ ] Security hardening\r\n  - [ ] Chore/infra\r\n\r\n  ## Scope (select all touched areas)\r\n\r\n  - [ ] Gateway / orchestration\r\n  - [ ] Skills / tool execution\r\n  - [ ] Auth / tokens\r\n  - [ ] Memory / storage\r\n  - [x] Integrations\r\n  - [ ] API / contracts\r\n  - [ ] UI / DX\r\n  - [ ] CI/CD / infra\r\n\r\n  ## Linked Issue/PR\r\n\r\n  - Closes #\r\n  - Related #\r\n  - If #12793 covers this exact normalization path, I\u2019m happy to close this as duplicate.\r\n\r\n  ## User-visible / Behavior Changes\r\n\r\n  Signal group: and username: target values keep original case after normalization.\r\n  Previously they were lowercased.\r\n\r\n  ## Security Impact (required)\r\n\r\n  - New permissions/capabilities? (No)\r\n  - Secrets/tokens handling changed? (No)\r\n  - New/changed network calls? (No)\r\n  - Command/tool execution surface changed? (No)\r\n  - Data access scope changed? (No)\r\n  - If any Yes, explain risk + mitigation:\r\n\r\n  ## Repro + Verification\r\n\r\n  ### Environment\r\n\r\n  - OS: macOS\r\n  - Runtime/container: local dev runtime\r\n  - Model/provider: N/A\r\n  - Integration/channel (if any): Signal\r\n  - Relevant config (redacted): Signal target values using group: and username: prefixes\r\n\r\n  ### Steps\r\n\r\n  1. Call normalizeSignalMessagingTarget(\"group:AbC123-CaseSensitive\").\r\n  2. Call normalizeSignalMessagingTarget(\"username:MyMixedCaseUser\").\r\n  3. Compare normalized outputs.\r\n\r\n  ### Expected\r\n\r\n  - group:AbC123-CaseSensitive\r\n  - username:MyMixedCaseUser\r\n\r\n  ### Actual\r\n\r\n  - Before fix: values were lowercased.\r\n  - After fix: original case is preserved.\r\n\r\n  ## Evidence\r\n\r\n  Attach at least one:\r\n\r\n  - [x] Failing test/log before + passing after\r\n  - [ ] Trace/log snippets\r\n  - [ ] Screenshot/recording\r\n  - [ ] Perf numbers (if relevant)\r\n\r\n  ## Human Verification (required)\r\n\r\n  - Verified scenarios:\r\n      - Added tests in src/channels/plugins/normalize/signal.test.ts for case preservation.\r\n      - Ran pnpm test -- src/channels/plugins/normalize/signal.test.ts (passing).\r\n  - Edge cases checked:\r\n      - Existing UUID normalization tests still pass.\r\n  - What you did not verify:\r\n      - Full end-to-end Signal daemon flow in production-like environment.\r\n\r\n  ## Compatibility / Migration\r\n\r\n  - Backward compatible? (Yes)\r\n  - Config/env changes? (No)\r\n  - Migration needed? (No)\r\n  - If yes, exact upgrade steps:\r\n\r\n  ## Failure Recovery (if this breaks)\r\n\r\n  - How to disable/revert this change quickly: Revert commit fix(signal): preserve case for group and username targets.\r\n  - Files/config to restore: src/channels/plugins/normalize/signal.ts, src/channels/plugins/normalize/signal.test.ts\r\n  - Known bad symptoms reviewers should watch for:\r\n      - Unexpected lowercasing reappearing for group: or username: targets.\r\n\r\n  ## Risks and Mitigations\r\n\r\n  - Risk: Downstream logic may have implicitly relied on lowercased group:/username: values.\r\n      - Mitigation: Change is narrowly scoped; UUID normalization behavior unchanged; regression tests added.\n\n<!-- greptile_comment -->\n\n<h2>Greptile Overview</h2>\n\n<h3>Greptile Summary</h3>\n\nThis PR fixes a bug where `normalizeSignalMessagingTarget` was lowercasing `group:` and `username:` target values, which broke case-sensitive identifiers (e.g., emoji reactions on group messages). The fix correctly removes `.toLowerCase()` from the `group:` and `username:` normalization paths while keeping UUID normalization unchanged.\n\n- Preserves original casing for `group:` and `username:` prefixed Signal targets\n- Adds two regression tests for case preservation\n- **Issue**: The `u:` shorthand prefix (a shorthand for `username:`) still applies `.toLowerCase()`, creating an inconsistency where `u:MyUser` normalizes to `username:myuser` while `username:MyUser` normalizes to `username:MyUser`. Since downstream routing uses strict equality (`===`) on peer IDs, these would not match each other.\n\n<h3>Confidence Score: 3/5</h3>\n\n- The core fix is correct but the `u:` shorthand path has been left inconsistent, which could cause misrouted messages when the shorthand is used.\n- The `group:` and `username:` fixes are sound and well-tested. However, the `u:` shorthand\u2014which is an alias for `username:`\u2014still lowercases, creating a behavioral inconsistency. This is a functional issue since downstream routing uses strict equality on normalized IDs.\n- `src/channels/plugins/normalize/signal.ts` \u2014 the `u:` prefix handler at lines 22-25 needs the same case-preservation treatment as the `username:` handler.\n\n<sub>Last reviewed commit: 138954e</sub>\n\n<!-- greptile_other_comments_section -->\n\n<sub>(2/5) Greptile learns from your feedback when you react with thumbs up/down!</sub>\n\n<!-- /greptile_comment -->",
      "author": "akalypse",
      "authorAssociation": "NONE",
      "createdAt": "2026-02-14T21:38:36Z",
      "updatedAt": "2026-02-15T20:03:02Z",
      "headRef": "fix/signal-target-normalization-case",
      "baseRef": "main",
      "filesChanged": 2,
      "additions": 24,
      "deletions": 3,
      "commits": 2,
      "labels": [
        "size: XS"
      ],
      "ciStatus": "failure",
      "hasIssueRef": true,
      "issueNumbers": [
        12793
      ],
      "changedFiles": [
        "src/channels/plugins/normalize/signal.test.ts",
        "src/channels/plugins/normalize/signal.ts"
      ],
      "diffUrl": "https://github.com/openclaw/openclaw/pull/16562.diff",
      "hasTests": true,
      "testFilesChanged": [
        "src/channels/plugins/normalize/signal.test.ts"
      ],
      "ageInDays": 0,
      "mergeable": "unknown",
      "reviewState": "commented",
      "reviewCount": 1,
      "commentCount": 2,
      "totalScore": 67,
      "signals": [
        {
          "name": "ci_status",
          "score": 10,
          "weight": 0.2,
          "reason": "CI: failure"
        },
        {
          "name": "diff_size",
          "score": 70,
          "weight": 0.1,
          "reason": "27 lines changed (24+/3-)"
        },
        {
          "name": "commit_quality",
          "score": 90,
          "weight": 0.05,
          "reason": "Conventional commit format"
        },
        {
          "name": "contributor",
          "score": 42,
          "weight": 0.15,
          "reason": "akalypse (NONE, rep: 69)"
        },
        {
          "name": "issue_ref",
          "score": 90,
          "weight": 0.1,
          "reason": "References: #12793"
        },
        {
          "name": "spam",
          "score": 100,
          "weight": 0.15,
          "reason": "No spam signals"
        },
        {
          "name": "test_coverage",
          "score": 90,
          "weight": 0.15,
          "reason": "1 test file(s) changed"
        },
        {
          "name": "staleness",
          "score": 100,
          "weight": 0.1,
          "reason": "0d old (Fresh)"
        },
        {
          "name": "mergeability",
          "score": 50,
          "weight": 0.15,
          "reason": "Merge status: unknown"
        },
        {
          "name": "review_status",
          "score": 60,
          "weight": 0.1,
          "reason": "Review: commented (1 reviews)"
        },
        {
          "name": "body_quality",
          "score": 100,
          "weight": 0.05,
          "reason": "Body: 5296 chars"
        },
        {
          "name": "activity",
          "score": 70,
          "weight": 0.05,
          "reason": "2 comments"
        },
        {
          "name": "breaking_change",
          "score": 80,
          "weight": 0.05,
          "reason": "No breaking change signals"
        }
      ],
      "isSpam": false,
      "spamReasons": [],
      "visionAlignment": "unchecked",
      "duplicateGroup": 3
    },
    {
      "number": 17487,
      "title": "fix: WhatsApp connection stability - continue reconnection after max attempts",
      "body": "## Summary\n\nInstead of permanently stopping after max reconnection attempts (default 12), the WhatsApp gateway monitor now continues with periodic recovery attempts using the heartbeat interval. This allows the WhatsApp connection to automatically recover without requiring manual gateway restart after transient disconnections that occur after long uptime (8-12 hours).\n\n## Changes\n\n- Modified `src/web/auto-reply/monitor.ts`: When max reconnection attempts are reached, the code now continues with periodic recovery attempts (every 60 seconds by default) instead of breaking out of the monitoring loop entirely.\n- The reconnection logic now distinguishes between initial reconnection attempts (with exponential backoff) and recovery attempts (with fixed interval).\n\n## Testing\n\n- Existing tests pass (reconnect.test.ts, session.test.ts)\n- The fix is backward compatible - normal reconnection behavior is unchanged\n- Only the behavior after max attempts is modified to allow automatic recovery\n\nFixes openclaw/openclaw#17475\n\n<!-- greptile_comment -->\n\n<h3>Greptile Summary</h3>\n\nChanged WhatsApp reconnection behavior to continue with periodic recovery attempts (using heartbeat interval) after max reconnection attempts are reached, instead of permanently stopping. This allows automatic recovery from transient disconnections without manual restart.\n\n- Modified reconnection logic to distinguish between initial attempts (exponential backoff) and recovery attempts (fixed interval)\n- Updated logging to reflect the new \"continuing with periodic recovery attempts\" behavior\n- **Critical issue**: The existing test \"stops after hitting max reconnect attempts\" expects the monitor to stop, but it will now continue indefinitely - this test needs to be updated\n\n<h3>Confidence Score: 2/5</h3>\n\n- This PR has a logical issue that will cause a test failure\n- The code change correctly implements the desired behavior (continue reconnection attempts indefinitely), but breaks an existing test that explicitly verifies the old behavior (stop after max attempts). The test \"stops after hitting max reconnect attempts\" will fail because the monitor no longer stops.\n- The test file `src/web/auto-reply.web-auto-reply.reconnects-after-connection-close.e2e.test.ts` needs attention - specifically the test at line 156\n\n<sub>Last reviewed commit: 043e542</sub>\n\n<!-- greptile_other_comments_section -->\n\n<!-- /greptile_comment -->",
      "author": "MisterGuy420",
      "authorAssociation": "CONTRIBUTOR",
      "createdAt": "2026-02-15T20:13:49Z",
      "updatedAt": "2026-02-15T20:16:18Z",
      "headRef": "fix/issue-17475",
      "baseRef": "main",
      "filesChanged": 1,
      "additions": 29,
      "deletions": 19,
      "commits": 1,
      "labels": [
        "channel: whatsapp-web",
        "size: XS"
      ],
      "ciStatus": "failure",
      "hasIssueRef": true,
      "issueNumbers": [
        17475
      ],
      "changedFiles": [
        "src/web/auto-reply/monitor.ts"
      ],
      "diffUrl": "https://github.com/openclaw/openclaw/pull/17487.diff",
      "hasTests": false,
      "testFilesChanged": [],
      "ageInDays": 0,
      "mergeable": "mergeable",
      "reviewState": "commented",
      "reviewCount": 1,
      "commentCount": 1,
      "totalScore": 65,
      "signals": [
        {
          "name": "ci_status",
          "score": 10,
          "weight": 0.2,
          "reason": "CI: failure"
        },
        {
          "name": "diff_size",
          "score": 70,
          "weight": 0.1,
          "reason": "48 lines changed (29+/19-)"
        },
        {
          "name": "commit_quality",
          "score": 90,
          "weight": 0.05,
          "reason": "Conventional commit format"
        },
        {
          "name": "contributor",
          "score": 57,
          "weight": 0.15,
          "reason": "MisterGuy420 (CONTRIBUTOR, rep: 26)"
        },
        {
          "name": "issue_ref",
          "score": 90,
          "weight": 0.1,
          "reason": "References: #17475"
        },
        {
          "name": "spam",
          "score": 100,
          "weight": 0.15,
          "reason": "No spam signals"
        },
        {
          "name": "test_coverage",
          "score": 20,
          "weight": 0.15,
          "reason": "No test files changed in code PR"
        },
        {
          "name": "staleness",
          "score": 100,
          "weight": 0.1,
          "reason": "0d old (Fresh)"
        },
        {
          "name": "mergeability",
          "score": 100,
          "weight": 0.15,
          "reason": "Merge status: mergeable"
        },
        {
          "name": "review_status",
          "score": 60,
          "weight": 0.1,
          "reason": "Review: commented (1 reviews)"
        },
        {
          "name": "body_quality",
          "score": 90,
          "weight": 0.05,
          "reason": "Body: 2421 chars"
        },
        {
          "name": "activity",
          "score": 50,
          "weight": 0.05,
          "reason": "1 comments"
        },
        {
          "name": "breaking_change",
          "score": 80,
          "weight": 0.05,
          "reason": "No breaking change signals"
        }
      ],
      "isSpam": false,
      "spamReasons": [],
      "visionAlignment": "unchecked"
    },
    {
      "number": 17018,
      "title": "feat(memory): add MongoDB memory backend",
      "body": "## Summary\n\nAdds a MongoDB memory backend as an alternative to the built-in SQLite backend. This is the implementation discussed in **Discussion #16586**.\n\n- **Full MongoDB backend**: sync, search, schema, config, manager \u2014 all new files, zero changes to existing builtin/QMD code paths\n- **6-level search cascade**: $scoreFusion \u2192 $rankFusion \u2192 JS merge \u2192 vector-only \u2192 keyword-only \u2192 $text fallback\n- **ACID transactions**: `withTransaction()` wrappers on all sync operations with graceful standalone fallback\n- **DX**: Onboarding wizard, configure wizard, doctor health check \u2014 with interactive embedding provider + API key setup\n- **Profile-aware config**: Atlas (automated embeddings) vs Community+mongot (managed) vs Community bare ($text only)\n- **TTL indexes**: Auto-expire embedding cache (30d default) and optional memory TTL\n- **Change Streams**: Opt-in real-time cross-instance sync (requires replica set)\n- **Analytics**: `getMemoryStats()` with per-source breakdown, stale detection, search quality metrics\n\n### Key design decisions\n- MongoDB is **opt-in only** \u2014 default backend remains `builtin` (SQLite)\n- All changes are **additive** \u2014 no modifications to existing builtin or QMD code paths\n- Targets **MongoDB 8.0+** (enables $scoreFusion + $rankFusion on all editions)\n- Community Edition with mongot has near feature-parity with Atlas for search\n- `embeddingMode` defaults are **profile-aware**: Atlas=automated, Community=managed\n\n### Files\n\n**Core implementation** (new files):\n- `src/memory/mongodb-manager.ts` \u2014 Main manager (create, sync, search, close)\n- `src/memory/mongodb-sync.ts` \u2014 File/session sync with transactions\n- `src/memory/mongodb-search.ts` \u2014 6-level search dispatcher\n- `src/memory/mongodb-schema.ts` \u2014 Collections, indexes, capability detection\n- `src/memory/mongodb-analytics.ts` \u2014 Aggregation-based stats\n- `src/memory/mongodb-change-stream.ts` \u2014 Real-time cross-instance sync\n\n**DX** (new files):\n- `src/wizard/onboarding-memory.ts` \u2014 Onboarding wizard memory section\n- `src/commands/configure-memory.ts` \u2014 Configure wizard memory section\n\n**Modified files** (minimal, additive changes):\n- `src/memory/backend-config.ts` \u2014 MongoDB config resolution (+88 lines)\n- `src/memory/search-manager.ts` \u2014 Factory: MongoDB branch (+31 lines)\n- `src/config/types.memory.ts` \u2014 MongoDB config types (+44 lines)\n- `src/config/zod-schema.ts` \u2014 Zod validation for MongoDB config (+32 lines)\n- `src/commands/configure.shared.ts` \u2014 Add \"memory\" section (+2 lines)\n- `src/commands/configure.wizard.ts` \u2014 Wire memory section (+10 lines)\n- `src/commands/doctor-memory-search.ts` \u2014 MongoDB health check (+99 lines)\n- `src/wizard/onboarding.ts` \u2014 Wire memory backend selection (+23 lines)\n- `src/infra/openclaw-root.ts` \u2014 Package name detection (+14 lines)\n- `package.json` / `pnpm-lock.yaml` \u2014 `mongodb` driver dependency\n- `docs/concepts/memory.md` \u2014 MongoDB backend documentation (+64 lines)\n\n**Tests**: 257 unit + 35 E2E = 292 total\n- `src/memory/mongodb-*.test.ts` \u2014 Unit tests for all modules\n- `src/memory/mongodb-e2e.e2e.test.ts` \u2014 E2E against real MongoDB 8.2 Community\n\n**Internal docs** (can be excluded if preferred):\n- `docs/plans/`, `docs/research/`, `CLAWMONGO_FRESH_START.md`, `scripts/sync-upstream.sh`\n\n## Test plan\n\n- [x] 257 unit tests passing (`npx vitest run src/memory/ src/wizard/onboarding-memory.test.ts`)\n- [x] 35 E2E tests passing against MongoDB 8.2 Community with replica set\n- [x] TSC clean (`npx tsc --noEmit` \u2014 0 errors)\n- [x] No regressions to existing builtin/QMD tests\n- [x] Tested onboarding wizard flow (all 4 deployment profiles)\n- [x] Tested configure wizard flow (backend switching, connection test)\n- [x] Tested doctor health check (MongoDB connectivity)\n\n## Issues addressed\n\n- #11480 \u2014 Bind-mount persistence (MongoDB is external storage)\n- #14716 \u2014 DatabaseSync limitations (MongoDB driver, no SQLite)\n- #9888 \u2014 Memory persistence across reinstalls\n- #11565 \u2014 Container reset data loss\n- #11308 \u2014 QMD 20+ bugs (alternative backend avoids QMD entirely)\n- #13440 \u2014 Multi-instance sync (MongoDB is shared, Change Streams optional)\n- #10324 \u2014 ACID transactions for sync operations\n- #15093 \u2014 Database backend demand (PostgreSQL request proves interest)\n\n\ud83e\udd16 Generated with [Claude Code](https://claude.com/claude-code)\n\n<!-- greptile_comment -->\n\n<h3>Greptile Summary</h3>\n\nThis PR adds a fully-featured MongoDB memory backend as an alternative to the built-in SQLite backend. The implementation is comprehensive with 6-level search cascade (`$scoreFusion` \u2192 `$rankFusion` \u2192 JS merge \u2192 vector-only \u2192 keyword-only \u2192 `$text` fallback), ACID transactions with graceful standalone fallback, TTL indexes for cache expiry, optional Change Streams for cross-instance sync, and analytics.\n\n**Architecture**: All changes are additive \u2014 no modifications to existing builtin or QMD code paths. The MongoDB backend is opt-in only via `memory.backend=\"mongodb\"` configuration. Integration is clean through the factory pattern in `search-manager.ts`.\n\n**Key strengths**:\n- Profile-aware config defaults (Atlas=automated embeddings, Community=managed)\n- Comprehensive test coverage: 257 unit tests + 35 E2E tests = 292 total tests across ~4,500 lines\n- Proper ACID transaction handling with `withTransaction()` callback API and majority write concern\n- Graceful degradation on standalone MongoDB (no replica set) by falling back to non-transactional writes\n- Security: path traversal protection in `readFile()`, credential redaction in logs, symlink rejection\n- DX: onboarding wizard with interactive embedding provider setup, health checks in `openclaw doctor`\n\n**Technical highlights**:\n- Targets MongoDB 8.0+ for `$scoreFusion` + `$rankFusion` availability on all editions\n- Automated embedding mode uses Voyage AI via MongoDB Atlas (no app-side embedding provider needed)\n- Managed embedding mode uses application's configured embedding provider\n- TTL indexes for auto-expiring embedding cache (30d default) and optional memory TTL\n- Change Streams support for real-time cross-instance sync (requires replica set)\n\nThe implementation follows MongoDB best practices: idempotent transaction bodies, session propagation to all operations, I/O outside transactions, and proper error handling for unsupported features.\n\n<h3>Confidence Score: 4/5</h3>\n\n- Safe to merge with minor observations \u2014 well-tested, additive changes with proper security controls\n- Score reflects strong test coverage (292 tests), clean additive architecture with no breaking changes, proper ACID transaction handling, good security practices (path validation, credential redaction), and comprehensive DX features. Not a 5 because: (1) large PR size (~12k lines) increases review surface area, (2) new dependency `mongodb@^7.1.0` adds supply chain risk, (3) E2E tests require manual MongoDB setup to verify\n- Pay close attention to `mongodb-manager.ts` (connection pooling and lifecycle), `mongodb-sync.ts` (transaction logic), and `mongodb-search.ts` (search cascade fallbacks). Verify E2E tests pass against real MongoDB 8.0+ instances\n\n<sub>Last reviewed commit: 42e8ba2</sub>\n\n<!-- greptile_other_comments_section -->\n\n<sub>(2/5) Greptile learns from your feedback when you react with thumbs up/down!</sub>\n\n<!-- /greptile_comment -->",
      "author": "romiluz13",
      "authorAssociation": "NONE",
      "createdAt": "2026-02-15T09:55:15Z",
      "updatedAt": "2026-02-15T20:14:40Z",
      "headRef": "feat/mongodb-memory-backend",
      "baseRef": "main",
      "filesChanged": 73,
      "additions": 20417,
      "deletions": 29,
      "commits": 26,
      "labels": [
        "docs",
        "cli",
        "scripts",
        "commands",
        "agents",
        "size: XL"
      ],
      "ciStatus": "failure",
      "hasIssueRef": true,
      "issueNumbers": [
        16586,
        11480,
        14716,
        9888,
        11565,
        11308,
        13440,
        10324,
        15093
      ],
      "changedFiles": [
        "CLAWMONGO_FRESH_START.md",
        "docs/concepts/memory.md",
        "docs/discussion-update-16586.md",
        "docs/plans/2026-02-14-clawmongo-implementation-plan.md",
        "docs/plans/2026-02-14-clawmongo-production-readiness-plan.md",
        "docs/plans/2026-02-15-audit-fixes-and-features-plan.md",
        "docs/plans/2026-02-15-mongodb-audit-fixes-plan.md",
        "docs/plans/2026-02-15-perfect-harmony-plan.md",
        "docs/research/2026-02-14-mongodb-capabilities-atlas-vs-community.md",
        "docs/research/2026-02-15-change-streams-ttl-analytics-research.md",
        "docs/research/2026-02-15-perfect-harmony-external-research.md",
        "docs/upstream-pain-showcase.md",
        "package.json",
        "pnpm-lock.yaml",
        "scripts/sync-upstream.sh",
        "src/agents/cli-runner/helpers.ts",
        "src/agents/memory-search.ts",
        "src/agents/pi-embedded-runner/compact.ts",
        "src/agents/pi-embedded-runner/run/attempt.ts",
        "src/agents/pi-embedded-runner/system-prompt.ts",
        "src/agents/system-prompt-mongodb.test.ts",
        "src/agents/system-prompt.ts",
        "src/agents/tool-policy.ts",
        "src/agents/tools/memory-tool-feedback.test.ts",
        "src/agents/tools/memory-tool-mongodb.test.ts",
        "src/agents/tools/memory-tool.ts",
        "src/auto-reply/reply/commands-context-report.ts",
        "src/cli/kb-cli.ts",
        "src/cli/program/register.subclis.ts",
        "src/commands/configure-memory.ts",
        "src/commands/configure.shared.ts",
        "src/commands/configure.wizard.ts",
        "src/commands/doctor-memory-search.ts",
        "src/config/types.memory.ts",
        "src/config/zod-schema.ts",
        "src/infra/openclaw-root.ts",
        "src/memory/backend-config.test.ts",
        "src/memory/backend-config.ts",
        "src/memory/embedding-model-limits.test.ts",
        "src/memory/embedding-model-limits.ts",
        "src/memory/embeddings-voyage.ts",
        "src/memory/mongodb-analytics.test.ts",
        "src/memory/mongodb-analytics.ts",
        "src/memory/mongodb-change-stream.test.ts",
        "src/memory/mongodb-change-stream.ts",
        "src/memory/mongodb-e2e.e2e.test.ts",
        "src/memory/mongodb-embedding-retry.test.ts",
        "src/memory/mongodb-embedding-retry.ts",
        "src/memory/mongodb-hybrid.test.ts",
        "src/memory/mongodb-hybrid.ts",
        "src/memory/mongodb-kb-search.test.ts",
        "src/memory/mongodb-kb-search.ts",
        "src/memory/mongodb-kb.test.ts",
        "src/memory/mongodb-kb.ts",
        "src/memory/mongodb-manager.test.ts",
        "src/memory/mongodb-manager.ts",
        "src/memory/mongodb-perf.test.ts",
        "src/memory/mongodb-schema.test.ts",
        "src/memory/mongodb-schema.ts",
        "src/memory/mongodb-search.test.ts",
        "src/memory/mongodb-search.ts",
        "src/memory/mongodb-structured-memory.test.ts",
        "src/memory/mongodb-structured-memory.ts",
        "src/memory/mongodb-sync.test.ts",
        "src/memory/mongodb-sync.ts",
        "src/memory/mongodb-watcher.test.ts",
        "src/memory/search-manager.ts",
        "src/memory/types.ts",
        "src/plugins/runtime/index.ts",
        "src/plugins/runtime/types.ts",
        "src/wizard/onboarding-memory.test.ts",
        "src/wizard/onboarding-memory.ts",
        "src/wizard/onboarding.ts"
      ],
      "diffUrl": "https://github.com/openclaw/openclaw/pull/17018.diff",
      "hasTests": true,
      "testFilesChanged": [
        "src/agents/system-prompt-mongodb.test.ts",
        "src/agents/tools/memory-tool-feedback.test.ts",
        "src/agents/tools/memory-tool-mongodb.test.ts",
        "src/memory/backend-config.test.ts",
        "src/memory/embedding-model-limits.test.ts",
        "src/memory/mongodb-analytics.test.ts",
        "src/memory/mongodb-change-stream.test.ts",
        "src/memory/mongodb-e2e.e2e.test.ts",
        "src/memory/mongodb-embedding-retry.test.ts",
        "src/memory/mongodb-hybrid.test.ts",
        "src/memory/mongodb-kb-search.test.ts",
        "src/memory/mongodb-kb.test.ts",
        "src/memory/mongodb-manager.test.ts",
        "src/memory/mongodb-perf.test.ts",
        "src/memory/mongodb-schema.test.ts",
        "src/memory/mongodb-search.test.ts",
        "src/memory/mongodb-structured-memory.test.ts",
        "src/memory/mongodb-sync.test.ts",
        "src/memory/mongodb-watcher.test.ts",
        "src/wizard/onboarding-memory.test.ts"
      ],
      "ageInDays": 0,
      "mergeable": "unknown",
      "reviewState": "commented",
      "reviewCount": 8,
      "commentCount": 0,
      "totalScore": 63,
      "signals": [
        {
          "name": "ci_status",
          "score": 10,
          "weight": 0.2,
          "reason": "CI: failure"
        },
        {
          "name": "diff_size",
          "score": 30,
          "weight": 0.1,
          "reason": "20446 lines changed (20417+/29-)"
        },
        {
          "name": "commit_quality",
          "score": 90,
          "weight": 0.05,
          "reason": "Conventional commit format"
        },
        {
          "name": "contributor",
          "score": 51,
          "weight": 0.15,
          "reason": "romiluz13 (NONE, rep: 100)"
        },
        {
          "name": "issue_ref",
          "score": 90,
          "weight": 0.1,
          "reason": "References: #16586, #11480, #14716, #9888, #11565, #11308, #13440, #10324, #15093"
        },
        {
          "name": "spam",
          "score": 100,
          "weight": 0.15,
          "reason": "No spam signals"
        },
        {
          "name": "test_coverage",
          "score": 90,
          "weight": 0.15,
          "reason": "20 test file(s) changed"
        },
        {
          "name": "staleness",
          "score": 100,
          "weight": 0.1,
          "reason": "0d old (Fresh)"
        },
        {
          "name": "mergeability",
          "score": 50,
          "weight": 0.15,
          "reason": "Merge status: unknown"
        },
        {
          "name": "review_status",
          "score": 70,
          "weight": 0.1,
          "reason": "Review: commented (8 reviews)"
        },
        {
          "name": "body_quality",
          "score": 100,
          "weight": 0.05,
          "reason": "Body: 7259 chars"
        },
        {
          "name": "activity",
          "score": 30,
          "weight": 0.05,
          "reason": "0 comments"
        },
        {
          "name": "breaking_change",
          "score": 40,
          "weight": 0.05,
          "reason": "Risky files: package.json"
        }
      ],
      "isSpam": false,
      "spamReasons": [],
      "visionAlignment": "unchecked"
    },
    {
      "number": 12004,
      "title": "fix: persist OpenAI API key to auth-profiles.json for sub-agent resolution",
      "body": "## Summary\n\nFixes #12003\n\nOpenAI was the **only** provider that did not write its API key to `auth-profiles.json` during onboarding. Instead, it only saved the key to a shared `.env` file via `upsertSharedEnvVar`. This caused sub-agents (e.g. `tgbot` for Telegram) to fail with:\n\n```\nFailoverError: No API key found for provider \"openai\".\nAuth store: /root/.openclaw/agents/tgbot/agent/auth-profiles.json\n```\n\n## Root Cause\n\nEvery other provider (Anthropic, xAI, Gemini, OpenRouter, etc.) persists credentials to `auth-profiles.json` via `upsertAuthProfile` and registers the profile via `applyAuthProfileConfig`. The OpenAI handler skipped both steps, so:\n\n1. The main agent's `auth-profiles.json` had no OpenAI entry\n2. Sub-agents that merge from the main agent store found nothing\n3. The `.env` fallback may not be loaded in the gateway process environment\n\n## Changes\n\n- **`src/commands/onboard-auth.credentials.ts`** \u2014 Added `setOpenAIApiKey()` (mirrors every other provider's setter pattern)\n- **`src/commands/onboard-auth.ts`** \u2014 Re-exported `setOpenAIApiKey`\n- **`src/commands/auth-choice.apply.openai.ts`** \u2014 Both \"use existing key\" and \"enter new key\" paths now call `setOpenAIApiKey()` + `applyAuthProfileConfig()` alongside the existing `.env` write\n- **`src/commands/onboard-non-interactive/local/auth-choice.ts`** \u2014 Same fix for the non-interactive onboarding path\n\nThe existing `.env` write is preserved for backward compatibility (launchd, env fallback).\n\n## Testing\n\n- `pnpm tsgo` \u2014 type-check passes\n- `pnpm test` \u2014 890 test files, 5,735 tests all pass\n- `pnpm check` \u2014 lint + format clean\n\n<!-- greptile_comment -->\n\n<h2>Greptile Overview</h2>\n\n<h3>Greptile Summary</h3>\n\nThis PR updates OpenAI onboarding so the API key is persisted to the agent\u2019s `auth-profiles.json` (via a new `setOpenAIApiKey` helper) and the config is updated with `applyAuthProfileConfig`, aligning OpenAI with other providers and allowing sub-agents/gateway processes to resolve credentials.\n\nInteractive OpenAI API-key onboarding now writes both to `auth-profiles.json` and the shared `.env` file; the non-interactive `openai-api-key` path is updated similarly and now also applies the auth profile to the generated config.\n\n<h3>Confidence Score: 4/5</h3>\n\n- This PR is close to safe to merge, with one non-interactive behavior change to confirm/fix.\n- The change is localized and aligns OpenAI with existing credential persistence patterns, but removing `allowProfile: false` in the non-interactive OpenAI path can change how keys are sourced (potentially using an existing profile unexpectedly).\n- src/commands/onboard-non-interactive/local/auth-choice.ts\n\n<!-- greptile_other_comments_section -->\n\n<sub>(2/5) Greptile learns from your feedback when you react with thumbs up/down!</sub>\n\n<!-- /greptile_comment -->",
      "author": "jagguvarma15",
      "authorAssociation": "NONE",
      "createdAt": "2026-02-08T18:02:15Z",
      "updatedAt": "2026-02-15T20:23:24Z",
      "headRef": "fix/openai-auth-profiles-persistence",
      "baseRef": "main",
      "filesChanged": 4,
      "additions": 27,
      "deletions": 1,
      "commits": 5,
      "labels": [
        "commands",
        "size: XS"
      ],
      "ciStatus": "failure",
      "hasIssueRef": true,
      "issueNumbers": [
        12003
      ],
      "changedFiles": [
        "src/commands/auth-choice.apply.openai.ts",
        "src/commands/onboard-auth.credentials.ts",
        "src/commands/onboard-auth.ts",
        "src/commands/onboard-non-interactive/local/auth-choice.ts"
      ],
      "diffUrl": "https://github.com/openclaw/openclaw/pull/12004.diff",
      "hasTests": false,
      "testFilesChanged": [],
      "ageInDays": 7,
      "mergeable": "mergeable",
      "reviewState": "commented",
      "reviewCount": 1,
      "commentCount": 1,
      "totalScore": 62,
      "signals": [
        {
          "name": "ci_status",
          "score": 10,
          "weight": 0.2,
          "reason": "CI: failure"
        },
        {
          "name": "diff_size",
          "score": 70,
          "weight": 0.1,
          "reason": "28 lines changed (27+/1-)"
        },
        {
          "name": "commit_quality",
          "score": 90,
          "weight": 0.05,
          "reason": "Conventional commit format"
        },
        {
          "name": "contributor",
          "score": 47,
          "weight": 0.15,
          "reason": "jagguvarma15 (NONE, rep: 88)"
        },
        {
          "name": "issue_ref",
          "score": 90,
          "weight": 0.1,
          "reason": "References: #12003"
        },
        {
          "name": "spam",
          "score": 100,
          "weight": 0.15,
          "reason": "No spam signals"
        },
        {
          "name": "test_coverage",
          "score": 20,
          "weight": 0.15,
          "reason": "No test files changed in code PR"
        },
        {
          "name": "staleness",
          "score": 70,
          "weight": 0.1,
          "reason": "7d old (Aging)"
        },
        {
          "name": "mergeability",
          "score": 100,
          "weight": 0.15,
          "reason": "Merge status: mergeable"
        },
        {
          "name": "review_status",
          "score": 60,
          "weight": 0.1,
          "reason": "Review: commented (1 reviews)"
        },
        {
          "name": "body_quality",
          "score": 90,
          "weight": 0.05,
          "reason": "Body: 2811 chars"
        },
        {
          "name": "activity",
          "score": 50,
          "weight": 0.05,
          "reason": "1 comments"
        },
        {
          "name": "breaking_change",
          "score": 80,
          "weight": 0.05,
          "reason": "No breaking change signals"
        }
      ],
      "isSpam": false,
      "spamReasons": [],
      "visionAlignment": "unchecked"
    },
    {
      "number": 17469,
      "title": "Improve unknown-model errors for provider/model misconfiguration",
      "body": "## Summary\nImprove diagnostics when a model references a provider prefix that isn't configured (common local proxy misconfiguration like `lmstudio/...` vs `models.providers.lmproxy`).\n\n## What changed\n- `resolveModel()` now appends actionable hints to unknown-model errors:\n  - Lists configured custom providers when provider is missing.\n  - Detects normalized provider mismatch and reports the configured key(s).\n- Added test coverage in `src/agents/pi-embedded-runner/model.test.ts` for provider-hint behavior.\n- Relaxed a few brittle equality assertions to `toContain` in unknown-model tests.\n\n## Why\nToday this failure mode can look like transport/network trouble (\"no socket opened\") even though resolution failed pre-transport. This patch makes failures immediate and obvious so users can fix config quickly.\n\n## Example\nBefore:\n- `Unknown model: lmstudio/minicpm-o-4_5`\n\nAfter:\n- `Unknown model: lmstudio/minicpm-o-4_5. Configured custom providers: \"lmproxy\".`\n\n## Notes\n- I couldn't run vitest in this environment because `pnpm` is not installed on this host.\n\n<!-- greptile_comment -->\n\n<h3>Greptile Summary</h3>\n\nImproves diagnostics for unknown-model errors in `resolveModel()` by appending actionable hints about configured custom providers or detected provider-name mismatches. This helps users quickly identify local proxy misconfigurations (e.g., using `lmstudio/...` when the configured provider is `lmproxy`).\n\n- Appends \"Configured custom providers\" or \"Provider mismatch\" detail to unknown-model errors in `src/agents/pi-embedded-runner/model.ts`\n- Relaxes existing unit test assertions from `.toBe` to `.toContain` for error messages, adds a new test for the provider-hint feature\n- **Issue**: The e2e test at `model.e2e.test.ts:61` still uses `.toBe(\"Unknown model: openai-codex/gpt-4.1-mini\")` and will break because the error now includes a trailing period even when no detail is appended\n- Missing test coverage for the \"Provider mismatch\" branch (`normalizedMatches.length > 0`)\n\n<h3>Confidence Score: 3/5</h3>\n\n- The logic is sound but a missed e2e test update will cause test failures\n- The core idea is good and the implementation logic is correct. However, the error format change (unconditional trailing period) breaks an existing e2e test that was not updated in this PR. The PR author noted they couldn't run tests locally, which explains the oversight.\n- src/agents/pi-embedded-runner/model.e2e.test.ts needs its .toBe assertion updated to match the new error format\n\n<sub>Last reviewed commit: 241a058</sub>\n\n<!-- greptile_other_comments_section -->\n\n<sub>(2/5) Greptile learns from your feedback when you react with thumbs up/down!</sub>\n\n<!-- /greptile_comment -->",
      "author": "megahappyclaw",
      "authorAssociation": "NONE",
      "createdAt": "2026-02-15T19:54:21Z",
      "updatedAt": "2026-02-15T19:57:13Z",
      "headRef": "fix/model-provider-mismatch-hint",
      "baseRef": "main",
      "filesChanged": 2,
      "additions": 40,
      "deletions": 4,
      "commits": 1,
      "labels": [
        "agents",
        "size: XS"
      ],
      "ciStatus": "pending",
      "hasIssueRef": false,
      "issueNumbers": [],
      "changedFiles": [
        "src/agents/pi-embedded-runner/model.test.ts",
        "src/agents/pi-embedded-runner/model.ts"
      ],
      "diffUrl": "https://github.com/openclaw/openclaw/pull/17469.diff",
      "hasTests": true,
      "testFilesChanged": [
        "src/agents/pi-embedded-runner/model.test.ts"
      ],
      "ageInDays": 0,
      "mergeable": "unknown",
      "reviewState": "commented",
      "reviewCount": 1,
      "commentCount": 0,
      "totalScore": 61,
      "signals": [
        {
          "name": "ci_status",
          "score": 50,
          "weight": 0.2,
          "reason": "CI: pending"
        },
        {
          "name": "diff_size",
          "score": 70,
          "weight": 0.1,
          "reason": "44 lines changed (40+/4-)"
        },
        {
          "name": "commit_quality",
          "score": 50,
          "weight": 0.05,
          "reason": "Non-standard title"
        },
        {
          "name": "contributor",
          "score": 27,
          "weight": 0.15,
          "reason": "megahappyclaw (NONE, rep: 21)"
        },
        {
          "name": "issue_ref",
          "score": 30,
          "weight": 0.1,
          "reason": "No issue reference"
        },
        {
          "name": "spam",
          "score": 75,
          "weight": 0.15,
          "reason": "No issue ref"
        },
        {
          "name": "test_coverage",
          "score": 90,
          "weight": 0.15,
          "reason": "1 test file(s) changed"
        },
        {
          "name": "staleness",
          "score": 100,
          "weight": 0.1,
          "reason": "0d old (Fresh)"
        },
        {
          "name": "mergeability",
          "score": 50,
          "weight": 0.15,
          "reason": "Merge status: unknown"
        },
        {
          "name": "review_status",
          "score": 60,
          "weight": 0.1,
          "reason": "Review: commented (1 reviews)"
        },
        {
          "name": "body_quality",
          "score": 90,
          "weight": 0.05,
          "reason": "Body: 2700 chars"
        },
        {
          "name": "activity",
          "score": 30,
          "weight": 0.05,
          "reason": "0 comments"
        },
        {
          "name": "breaking_change",
          "score": 80,
          "weight": 0.05,
          "reason": "No breaking change signals"
        }
      ],
      "isSpam": false,
      "spamReasons": [],
      "visionAlignment": "unchecked"
    },
    {
      "number": 17320,
      "title": "fix(auth): implement true OAuth flow for Anthropic provider",
      "body": "## Summary\n\n- Implements a proper OAuth login flow for the Anthropic provider, fixing the missing refresh token issue\n- Adds `anthropic-oauth.ts` wrapper around `loginAnthropic()` from `@mariozechner/pi-ai`, following the same VPS-aware pattern as OpenAI Codex OAuth\n- Separates the `\"oauth\"` auth choice from `\"setup-token\"`/`\"token\"` in `auth-choice.apply.anthropic.ts`\n- OAuth credentials are now persisted via `writeOAuthCredentials()` with `refresh`, `access`, and `expires` fields, enabling automatic token renewal\n\n## Problem\n\nWhen users selected OAuth for Anthropic authentication, the code treated it identically to the `setup-token` flow (lines 14-17 of `auth-choice.apply.anthropic.ts`). This stored credentials as `type: \"token\"` without a refresh token or expiration, causing:\n\n1. Tokens expired silently after a short period\n2. Users got `authentication_error: invalid x-api-key` errors\n3. Manual re-authentication was required each time\n\n## Solution\n\nFollow the exact pattern established by `openai-codex-oauth.ts` and `auth-choice.apply.openai.ts`:\n\n1. **New file `anthropic-oauth.ts`**: Wraps `loginAnthropic()` with VPS-aware handlers via `createVpsAwareOAuthHandlers()`, adapting the callback signatures (Anthropic uses positional args, not an options object)\n2. **Modified `auth-choice.apply.anthropic.ts`**: The `\"oauth\"` choice now triggers a real browser-based OAuth flow and saves credentials with `writeOAuthCredentials(\"anthropic\", creds)`, storing `refresh`, `access`, and `expires` fields\n\n## Test plan\n\n- [ ] Verify TypeScript compilation passes\n- [ ] Test Anthropic OAuth flow with a Claude Pro/Max account\n- [ ] Confirm `auth-profiles.json` contains `type: \"oauth\"` with `refresh` and `expires` fields\n- [ ] Verify setup-token and API key flows remain unchanged\n\nCloses #17274\n\n\n\n<!-- greptile_comment -->\n\n<h3>Greptile Summary</h3>\n\nThis PR implements a proper OAuth login flow for the Anthropic provider, replacing the previous behavior where the `\"oauth\"` auth choice was incorrectly treated as a `\"setup-token\"` flow. The new implementation follows the established pattern from the OpenAI Codex OAuth flow.\n\n- Adds `anthropic-oauth.ts` wrapping `loginAnthropic()` from `@mariozechner/pi-ai` with VPS-aware handlers via `createVpsAwareOAuthHandlers()`\n- Separates the `\"oauth\"` branch in `auth-choice.apply.anthropic.ts` from the `\"setup-token\"`/`\"token\"` flow, storing credentials with `writeOAuthCredentials()` for automatic token renewal\n- The `\"setup-token\"`, `\"token\"`, and `\"apiKey\"` flows remain unchanged\n- **Potential issue:** The hardcoded `profileId: \"anthropic:default\"` in `applyAuthProfileConfig` may not match the profile key that `writeOAuthCredentials` generates when OAuth creds include an email. The Chutes OAuth flow handles this correctly by deriving the profileId from `creds.email`\n- No unit tests for the new `anthropic-oauth.ts` module (the equivalent OpenAI codex wrapper has `openai-codex-oauth.test.ts`), and the e2e test suite does not mock `loginAnthropicOAuth`\n\n<h3>Confidence Score: 3/5</h3>\n\n- Mostly safe to merge \u2014 the core OAuth flow follows the established pattern, but there is a potential profileId mismatch that could cause the config to reference a non-existent profile when creds include an email.\n- The implementation closely follows the existing OpenAI Codex OAuth pattern and the code structure is sound. Deducting points for: (1) a potential profileId mismatch between writeOAuthCredentials and applyAuthProfileConfig when creds include an email field, and (2) no unit tests for the new module, unlike the equivalent OpenAI codex wrapper which has test coverage.\n- `src/commands/auth-choice.apply.anthropic.ts` \u2014 verify that the hardcoded `profileId: \"anthropic:default\"` matches what `writeOAuthCredentials` generates, especially if the Anthropic OAuth response includes an email field.\n\n<sub>Last reviewed commit: f058610</sub>\n\n<!-- greptile_other_comments_section -->\n\n<sub>(4/5) You can add custom instructions or style guidelines for the agent [here](https://app.greptile.com/review/github)!</sub>\n\n<!-- /greptile_comment -->\n",
      "author": "miloudbelarebia",
      "authorAssociation": "NONE",
      "createdAt": "2026-02-15T16:59:09Z",
      "updatedAt": "2026-02-15T20:57:21Z",
      "headRef": "fix/anthropic-oauth-refresh-token",
      "baseRef": "main",
      "filesChanged": 2,
      "additions": 102,
      "deletions": 6,
      "commits": 3,
      "labels": [
        "commands",
        "size: S"
      ],
      "ciStatus": "failure",
      "hasIssueRef": true,
      "issueNumbers": [
        17274
      ],
      "changedFiles": [
        "src/commands/anthropic-oauth.ts",
        "src/commands/auth-choice.apply.anthropic.ts"
      ],
      "diffUrl": "https://github.com/openclaw/openclaw/pull/17320.diff",
      "hasTests": false,
      "testFilesChanged": [],
      "ageInDays": 0,
      "mergeable": "unknown",
      "reviewState": "commented",
      "reviewCount": 1,
      "commentCount": 0,
      "totalScore": 60,
      "signals": [
        {
          "name": "ci_status",
          "score": 10,
          "weight": 0.2,
          "reason": "CI: failure"
        },
        {
          "name": "diff_size",
          "score": 100,
          "weight": 0.1,
          "reason": "108 lines changed (102+/6-)"
        },
        {
          "name": "commit_quality",
          "score": 90,
          "weight": 0.05,
          "reason": "Conventional commit format"
        },
        {
          "name": "contributor",
          "score": 43,
          "weight": 0.15,
          "reason": "miloudbelarebia (NONE, rep: 73)"
        },
        {
          "name": "issue_ref",
          "score": 90,
          "weight": 0.1,
          "reason": "References: #17274"
        },
        {
          "name": "spam",
          "score": 100,
          "weight": 0.15,
          "reason": "No spam signals"
        },
        {
          "name": "test_coverage",
          "score": 20,
          "weight": 0.15,
          "reason": "No test files changed in code PR"
        },
        {
          "name": "staleness",
          "score": 100,
          "weight": 0.1,
          "reason": "0d old (Fresh)"
        },
        {
          "name": "mergeability",
          "score": 50,
          "weight": 0.15,
          "reason": "Merge status: unknown"
        },
        {
          "name": "review_status",
          "score": 60,
          "weight": 0.1,
          "reason": "Review: commented (1 reviews)"
        },
        {
          "name": "body_quality",
          "score": 100,
          "weight": 0.05,
          "reason": "Body: 4112 chars"
        },
        {
          "name": "activity",
          "score": 30,
          "weight": 0.05,
          "reason": "0 comments"
        },
        {
          "name": "breaking_change",
          "score": 80,
          "weight": 0.05,
          "reason": "No breaking change signals"
        }
      ],
      "isSpam": false,
      "spamReasons": [],
      "visionAlignment": "unchecked"
    },
    {
      "number": 13251,
      "title": "fix: Windows local embeddings race condition",
      "body": "## Problem\nLocal embeddings timeout/hang on Windows when using node-llama-cpp. The process would hang indefinitely during model initialization, eventually timing out after 300s.\n\n## Root Cause\nRace conditions in model initialization:\n1. Concurrent calls to \\embedBatch\\ triggering parallel llama model loads\n2. No locking around the lazy initialization of the embeddings provider\n3. No locking around manager creation\n\n## Fix\n1. **Sequential \\embedBatch\\** - Process embedding requests sequentially rather than in parallel\n2. **Initialization lock in \\embeddings.ts\\** - Mutex to prevent concurrent model loading\n3. **Initialization lock in \\manager.ts\\** - Mutex to prevent concurrent manager creation\n\n## Testing\n- Tested on Windows 11 (x64)\n- Node v22.22.0\n- Model: embeddinggemma-300M-Q8_0.gguf via node-llama-cpp\n- Before: 100% timeout rate on memory_search\n- After: Memory search completes in 2-3 seconds\n\n## Related\n- Addresses Windows-specific issues with local embedding provider\n- May also help Linux/Mac users experiencing similar race conditions\n\n<!-- greptile_comment -->\n\n<h2>Greptile Overview</h2>\n\n<h3>Greptile Summary</h3>\n\nThis PR addresses a Windows hang in local embeddings by serializing initialization and embedding calls:\n- `src/memory/embeddings.ts` adds a per-provider init promise/error cache around `getLlama()`/model loading/context creation and changes `embedBatch()` to run sequentially to avoid concurrent `getEmbeddingFor()` calls.\n- `src/memory/manager.ts` adds a per-cache-key initialization lock to prevent concurrent `MemoryIndexManager` creation (and thus concurrent provider/model initialization).\n\nOverall the approach fits the existing lazy-init/cached-manager design: providers are created on demand and cached per agent/workspace/settings, with the new locks preventing concurrent initialization races that are especially problematic on Windows/node-llama-cpp.\n\n<h3>Confidence Score: 4/5</h3>\n\n- This PR is generally safe to merge once a small type-level issue in the manager init lock map is fixed.\n- The concurrency/locking changes are localized and consistent with the reported race-condition root cause. The main remaining issue is an incorrect `INDEX_INIT_LOCKS` promise type that can leak `null` into the `get()` fast-path return and/or force incorrect downstream typing.\n- src/memory/manager.ts\n\n<!-- greptile_other_comments_section -->\n\n<!-- /greptile_comment -->",
      "author": "fayrose",
      "authorAssociation": "NONE",
      "createdAt": "2026-02-10T07:28:38Z",
      "updatedAt": "2026-02-15T20:03:47Z",
      "headRef": "fix/windows-local-embeddings-race",
      "baseRef": "main",
      "filesChanged": 2,
      "additions": 98,
      "deletions": 35,
      "commits": 3,
      "labels": [
        "size: S"
      ],
      "ciStatus": "failure",
      "hasIssueRef": false,
      "issueNumbers": [],
      "changedFiles": [
        "src/memory/embeddings.ts",
        "src/memory/manager.ts"
      ],
      "diffUrl": "https://github.com/openclaw/openclaw/pull/13251.diff",
      "hasTests": false,
      "testFilesChanged": [],
      "ageInDays": 5,
      "mergeable": "mergeable",
      "reviewState": "commented",
      "reviewCount": 2,
      "commentCount": 1,
      "totalScore": 60,
      "signals": [
        {
          "name": "ci_status",
          "score": 10,
          "weight": 0.2,
          "reason": "CI: failure"
        },
        {
          "name": "diff_size",
          "score": 100,
          "weight": 0.1,
          "reason": "133 lines changed (98+/35-)"
        },
        {
          "name": "commit_quality",
          "score": 90,
          "weight": 0.05,
          "reason": "Conventional commit format"
        },
        {
          "name": "contributor",
          "score": 50,
          "weight": 0.15,
          "reason": "fayrose (NONE, rep: 98)"
        },
        {
          "name": "issue_ref",
          "score": 30,
          "weight": 0.1,
          "reason": "No issue reference"
        },
        {
          "name": "spam",
          "score": 75,
          "weight": 0.15,
          "reason": "No issue ref"
        },
        {
          "name": "test_coverage",
          "score": 20,
          "weight": 0.15,
          "reason": "No test files changed in code PR"
        },
        {
          "name": "staleness",
          "score": 100,
          "weight": 0.1,
          "reason": "5d old (Fresh)"
        },
        {
          "name": "mergeability",
          "score": 100,
          "weight": 0.15,
          "reason": "Merge status: mergeable"
        },
        {
          "name": "review_status",
          "score": 70,
          "weight": 0.1,
          "reason": "Review: commented (2 reviews)"
        },
        {
          "name": "body_quality",
          "score": 90,
          "weight": 0.05,
          "reason": "Body: 2413 chars"
        },
        {
          "name": "activity",
          "score": 50,
          "weight": 0.05,
          "reason": "1 comments"
        },
        {
          "name": "breaking_change",
          "score": 80,
          "weight": 0.05,
          "reason": "No breaking change signals"
        }
      ],
      "isSpam": false,
      "spamReasons": [],
      "visionAlignment": "unchecked"
    },
    {
      "number": 17482,
      "title": "fix(gateway): preserve scopes for shared-auth clients without device identity (#17408)",
      "body": "## Summary\n\nFixes #17408. Clients authenticating with a valid shared `auth.token` (no device identity) have their requested scopes silently cleared to `[]`, causing `missing scope: operator.write` errors on `chat.send` and other operations.\n\n## Root Cause\n\nIn `message-handler.ts`, the `!device` branch unconditionally clears all scopes:\n\n```ts\nif (!device) {\n  if (scopes.length > 0) {\n    scopes = [];              // \u2190 clears scopes even when token auth succeeded\n    connectParams.scopes = scopes;\n  }\n```\n\nThis affects webchat clients, Tauri apps, and any client using token-based auth without device pairing.\n\n## Fix\n\nOnly clear scopes when shared auth also failed \u2014 preserving the security intent (unauthenticated clients get no scopes) while allowing properly authenticated token-based clients to keep their requested scopes:\n\n```ts\nif (scopes.length > 0 && !sharedAuthOk) {\n```\n\nOne-line change, no new dependencies, no behaviour change for unauthenticated clients.\n\n*AI-assisted (Claude). Reviewed by human.*\n\n<!-- greptile_comment -->\n\n<h3>Greptile Summary</h3>\n\nPreserves scopes for token-authenticated clients without device identity. Previously, the code unconditionally cleared scopes when `!device`, preventing properly authenticated shared-token clients (webchat, Tauri) from executing operations like `chat.send` that require `operator.write` scope. The fix adds `&& !sharedAuthOk` to only clear scopes when shared authentication failed, maintaining the security intent (unauthenticated clients get no scopes) while allowing authenticated token-based clients to use their requested scopes.\n\n**Changes:**\n- Modified scope-clearing logic in `message-handler.ts:430` to check both `!device` and `!sharedAuthOk`\n- Aligns with existing pattern: `canSkipDevice = sharedAuthOk` on line 434 already uses the same condition\n\n<h3>Confidence Score: 5/5</h3>\n\n- This PR is safe to merge with minimal risk\n- Single-line logical fix that correctly preserves the security model (only clears scopes when authentication fails) while fixing the bug (preserves scopes when shared auth succeeds). The condition `!sharedAuthOk` already exists and is used on line 434 for the same purpose, indicating this pattern is established and correct. No new dependencies, no behavior change for unauthenticated clients\n- No files require special attention\n\n<sub>Last reviewed commit: cd2c66d</sub>\n\n<!-- greptile_other_comments_section -->\n\n<!-- /greptile_comment -->",
      "author": "robbyczgw-cla",
      "authorAssociation": "CONTRIBUTOR",
      "createdAt": "2026-02-15T20:10:01Z",
      "updatedAt": "2026-02-15T20:11:54Z",
      "headRef": "fix/scope-clearing-shared-auth-17408",
      "baseRef": "main",
      "filesChanged": 1,
      "additions": 1,
      "deletions": 1,
      "commits": 1,
      "labels": [
        "gateway",
        "size: XS",
        "experienced-contributor"
      ],
      "ciStatus": "failure",
      "hasIssueRef": true,
      "issueNumbers": [
        17408
      ],
      "changedFiles": [
        "src/gateway/server/ws-connection/message-handler.ts"
      ],
      "diffUrl": "https://github.com/openclaw/openclaw/pull/17482.diff",
      "hasTests": false,
      "testFilesChanged": [],
      "ageInDays": 0,
      "mergeable": "mergeable",
      "reviewState": "none",
      "reviewCount": 0,
      "commentCount": 0,
      "totalScore": 59,
      "signals": [
        {
          "name": "ci_status",
          "score": 10,
          "weight": 0.2,
          "reason": "CI: failure"
        },
        {
          "name": "diff_size",
          "score": 20,
          "weight": 0.1,
          "reason": "2 lines changed (1+/1-)"
        },
        {
          "name": "commit_quality",
          "score": 90,
          "weight": 0.05,
          "reason": "Conventional commit format"
        },
        {
          "name": "contributor",
          "score": 75,
          "weight": 0.15,
          "reason": "robbyczgw-cla (CONTRIBUTOR, rep: 88)"
        },
        {
          "name": "issue_ref",
          "score": 90,
          "weight": 0.1,
          "reason": "References: #17408"
        },
        {
          "name": "spam",
          "score": 75,
          "weight": 0.15,
          "reason": "<3 lines, contributor bonus -1"
        },
        {
          "name": "test_coverage",
          "score": 20,
          "weight": 0.15,
          "reason": "No test files changed in code PR"
        },
        {
          "name": "staleness",
          "score": 100,
          "weight": 0.1,
          "reason": "0d old (Fresh)"
        },
        {
          "name": "mergeability",
          "score": 100,
          "weight": 0.15,
          "reason": "Merge status: mergeable"
        },
        {
          "name": "review_status",
          "score": 40,
          "weight": 0.1,
          "reason": "Review: none (0 reviews)"
        },
        {
          "name": "body_quality",
          "score": 90,
          "weight": 0.05,
          "reason": "Body: 2454 chars"
        },
        {
          "name": "activity",
          "score": 30,
          "weight": 0.05,
          "reason": "0 comments"
        },
        {
          "name": "breaking_change",
          "score": 80,
          "weight": 0.05,
          "reason": "No breaking change signals"
        }
      ],
      "isSpam": false,
      "spamReasons": [],
      "visionAlignment": "unchecked"
    },
    {
      "number": 13556,
      "title": "UI: add model selector and auth profile badge to chat compose bar",
      "body": "## Summary\n\nAdds a compact model selector dropdown and auth profile badge directly in the chat compose bar, so users can see and change their active model without navigating to settings.\n\n## What it does\n\n- **Model selector** \u2014 Interactive dropdown in the compose bar showing available models. Changing it patches the session via `sessions.patch`. Shows \"default\" when no override is set.\n- **Auth profile badge** \u2014 Read-only pill showing the current provider (e.g. \"anthropic\"). Interactive profile switching is deferred to a follow-up (requires new gateway support).\n- Both appear between the textarea and the action buttons (New session / Send).\n\n## Layout\n\n```\n[  textarea                                              ]\n  [provider badge] [model \u25be]    [New session] [Send \u21b5]\n```\n\n## Implementation\n\n- **`ui/src/ui/app-gateway.ts`** \u2014 Loads models (`models.list`) and auth profiles (`config.get \u2192 auth.profiles`) on connect\n- **`ui/src/ui/app-view-state.ts`** + **`ui/src/ui/app.ts`** \u2014 New state fields: `chatModels`, `chatAuthProfiles`\n- **`ui/src/ui/app-render.ts`** \u2014 Passes new props to `renderChat`\n- **`ui/src/ui/views/chat.ts`** \u2014 `renderComposeSelectors()` renders the model dropdown + auth badge\n- **`ui/src/ui/controllers/sessions.ts`** \u2014 Extended `patchSession` to support `model` param\n- **`ui/src/styles/chat/selectors.css`** \u2014 Compact pill-style styling using existing CSS variables\n\n## Design decisions\n\n- Model selector uses native `<select>` for accessibility and simplicity\n- Auth profile is display-only for now \u2014 gateway `sessions.patch` doesn't support auth profile override yet\n- Compact 28px height pills, visually subordinate to the 40px action buttons\n- Uses existing CSS variables for theme consistency\n- No external libraries, follows existing Lit patterns\n\n## Testing\n\n- `pnpm build && pnpm check` all green (format, tsgo, lint \u2014 0 errors)\n- UI-only changes, no backend modifications\n\n<!-- greptile_comment -->\n\n<h2>Greptile Overview</h2>\n\n<h3>Greptile Summary</h3>\n\nThis PR adds compact \u201cpills\u201d in the chat compose bar: a native `<select>` to change the active chat model (via `sessions.patch`) and a read-only provider badge, plus new gateway bootstrap loading for `models.list` and `config.get` auth profiles.\n\nThe change is wired through the app state (`chatModels`, `chatAuthProfiles`) and passed down to `renderChat`, with new CSS for the selector styling.\n\nKey issues to address before merge:\n- The \u201cAuth profile\u201d badge currently displays `activeSession.modelProvider` (model provider), and the loaded `auth.profiles` list is not used.\n- The model dropdown can\u2019t correctly reflect the \u201cdefault\u201d state because `sessions.list` exposes `model` as a resolved model string, not an override/default signal.\n- `chatModels`/`chatAuthProfiles` can remain stale across reconnect because they aren\u2019t cleared when reconnecting.\n\n<h3>Confidence Score: 3/5</h3>\n\n- This PR is close, but has user-visible correctness issues in the compose selectors.\n- The core wiring compiles, but the auth badge semantics are incorrect and the model selector can\u2019t represent the intended \u201cdefault vs override\u201d state with the current session data, which will mislead users.\n- ui/src/ui/views/chat.ts, ui/src/ui/app-gateway.ts\n\n<!-- greptile_other_comments_section -->\n\n<sub>(3/5) Reply to the agent's comments like \"Can you suggest a fix for this @greptileai?\" or ask follow-up questions!</sub>\n\n<!-- /greptile_comment -->",
      "author": "emre6943",
      "authorAssociation": "NONE",
      "createdAt": "2026-02-10T18:08:31Z",
      "updatedAt": "2026-02-15T20:13:33Z",
      "headRef": "feature/chat-auth-model-selector",
      "baseRef": "main",
      "filesChanged": 14,
      "additions": 332,
      "deletions": 16,
      "commits": 8,
      "labels": [
        "app: web-ui",
        "gateway",
        "size: M"
      ],
      "ciStatus": "failure",
      "hasIssueRef": false,
      "issueNumbers": [],
      "changedFiles": [
        "src/gateway/protocol/schema/sessions.ts",
        "src/gateway/session-utils.ts",
        "src/gateway/session-utils.types.ts",
        "src/gateway/sessions-patch.ts",
        "ui/src/styles/chat.css",
        "ui/src/styles/chat/layout.css",
        "ui/src/styles/chat/selectors.css",
        "ui/src/ui/app-gateway.ts",
        "ui/src/ui/app-render.ts",
        "ui/src/ui/app-view-state.ts",
        "ui/src/ui/app.ts",
        "ui/src/ui/controllers/sessions.ts",
        "ui/src/ui/types.ts",
        "ui/src/ui/views/chat.ts"
      ],
      "diffUrl": "https://github.com/openclaw/openclaw/pull/13556.diff",
      "hasTests": false,
      "testFilesChanged": [],
      "ageInDays": 5,
      "mergeable": "mergeable",
      "reviewState": "commented",
      "reviewCount": 1,
      "commentCount": 1,
      "totalScore": 58,
      "signals": [
        {
          "name": "ci_status",
          "score": 10,
          "weight": 0.2,
          "reason": "CI: failure"
        },
        {
          "name": "diff_size",
          "score": 100,
          "weight": 0.1,
          "reason": "348 lines changed (332+/16-)"
        },
        {
          "name": "commit_quality",
          "score": 50,
          "weight": 0.05,
          "reason": "Non-standard title"
        },
        {
          "name": "contributor",
          "score": 50,
          "weight": 0.15,
          "reason": "emre6943 (NONE, rep: 98)"
        },
        {
          "name": "issue_ref",
          "score": 30,
          "weight": 0.1,
          "reason": "No issue reference"
        },
        {
          "name": "spam",
          "score": 75,
          "weight": 0.15,
          "reason": "No issue ref"
        },
        {
          "name": "test_coverage",
          "score": 20,
          "weight": 0.15,
          "reason": "No test files changed in code PR"
        },
        {
          "name": "staleness",
          "score": 100,
          "weight": 0.1,
          "reason": "5d old (Fresh)"
        },
        {
          "name": "mergeability",
          "score": 100,
          "weight": 0.15,
          "reason": "Merge status: mergeable"
        },
        {
          "name": "review_status",
          "score": 60,
          "weight": 0.1,
          "reason": "Review: commented (1 reviews)"
        },
        {
          "name": "body_quality",
          "score": 90,
          "weight": 0.05,
          "reason": "Body: 3430 chars"
        },
        {
          "name": "activity",
          "score": 50,
          "weight": 0.05,
          "reason": "1 comments"
        },
        {
          "name": "breaking_change",
          "score": 80,
          "weight": 0.05,
          "reason": "No breaking change signals"
        }
      ],
      "isSpam": false,
      "spamReasons": [],
      "visionAlignment": "unchecked"
    },
    {
      "number": 10870,
      "title": "feat(tts): add pocket-tts provider for local CPU-based TTS",
      "body": "## Summary\n\nAdds support for [Pocket TTS](https://github.com/kyutai-labs/pocket-tts) as a new TTS provider.\n\n## Features\n\n- **Local, offline TTS** - No API key required, runs entirely on CPU\n- **Fast** - ~200ms latency after model loads\n- **Voice options** - 8 built-in voices + voice cloning via reference audio\n- **Auto-start** - Optional automatic server spawning\n- **Doctor integration** - Checks for misconfigurations\n\n## Configuration\n\n```json5\n{\n  messages: {\n    tts: {\n      provider: \"pocket\",\n      pocket: {\n        enabled: true,           // default\n        baseUrl: \"http://localhost:8000\",  // default\n        voice: \"alba\",          // default\n        autoStart: false         // default\n      }\n    }\n  }\n}\n```\n\n## Notes\n\n- Output format is WAV (uncompressed, ~5-10x larger than MP3)\n- First request takes 10-30s for model loading (~400MB download on first run)\n- Falls back to other providers if server unavailable\n\n## Testing\n\n- [x] Unit tests for helpers (parsePocketBaseUrl, isValidPocketVoice, etc.)\n- [x] Manual integration testing against real pocket-tts server\n- [x] TypeScript compiles cleanly\n- [x] Doctor checks work\n\n## Files Changed\n\n| File | Change |\n|------|--------|\n| `src/tts/tts.ts` | Pocket provider implementation |\n| `src/tts/tts.test.ts` | Unit tests |\n| `src/config/types.tts.ts` | Config schema |\n| `src/commands/doctor-tts.ts` | NEW - Doctor TTS checks |\n| `src/commands/doctor.ts` | Import doctor-tts |\n| `docs/providers/pocket-tts.md` | NEW - Full documentation |\n| `docs/tts.md` | Add pocket to provider list |\n\n---\n*Rebased off main (Feb 2026)*\n\n<!-- greptile_comment -->\n\n<h2>Greptile Overview</h2>\n\n<h3>Greptile Summary</h3>\n\n- Adds a new `pocket` TTS provider with config defaults, provider ordering, and WAV output handling in `src/tts/tts.ts`.\n- Implements Pocket server health checks and an optional auto-start path that spawns `pocket-tts serve` locally.\n- Extends TTS config schema (`src/config/types.tts.ts`), adds `doctor` checks for common Pocket misconfiguration, and updates docs + unit tests accordingly.\n\n<h3>Confidence Score: 4/5</h3>\n\n- Generally safe to merge, but the new Pocket TTS auto-start adds global process signal handlers that should be scoped/guarded to avoid listener leaks in long-running or watch-mode processes.\n- Changes are mostly additive with tests and clear configuration defaults. The main correctness issue found is top-level `process.on(...)` registration in a commonly-imported module, which can create unwanted global side effects and listener accumulation.\n- src/tts/tts.ts\n\n<!-- greptile_other_comments_section -->\n\n<!-- /greptile_comment -->",
      "author": "fayrose",
      "authorAssociation": "NONE",
      "createdAt": "2026-02-07T03:57:49Z",
      "updatedAt": "2026-02-15T20:04:02Z",
      "headRef": "feat/pocket-tts-provider",
      "baseRef": "main",
      "filesChanged": 7,
      "additions": 966,
      "deletions": 3,
      "commits": 7,
      "labels": [
        "docs",
        "commands",
        "size: L"
      ],
      "ciStatus": "failure",
      "hasIssueRef": false,
      "issueNumbers": [],
      "changedFiles": [
        "docs/providers/pocket-tts.md",
        "docs/tts.md",
        "src/commands/doctor-tts.ts",
        "src/commands/doctor.ts",
        "src/config/types.tts.ts",
        "src/tts/tts.test.ts",
        "src/tts/tts.ts"
      ],
      "diffUrl": "https://github.com/openclaw/openclaw/pull/10870.diff",
      "hasTests": true,
      "testFilesChanged": [
        "src/tts/tts.test.ts"
      ],
      "ageInDays": 8,
      "mergeable": "unknown",
      "reviewState": "commented",
      "reviewCount": 2,
      "commentCount": 0,
      "totalScore": 57,
      "signals": [
        {
          "name": "ci_status",
          "score": 10,
          "weight": 0.2,
          "reason": "CI: failure"
        },
        {
          "name": "diff_size",
          "score": 60,
          "weight": 0.1,
          "reason": "969 lines changed (966+/3-)"
        },
        {
          "name": "commit_quality",
          "score": 90,
          "weight": 0.05,
          "reason": "Conventional commit format"
        },
        {
          "name": "contributor",
          "score": 50,
          "weight": 0.15,
          "reason": "fayrose (NONE, rep: 98)"
        },
        {
          "name": "issue_ref",
          "score": 30,
          "weight": 0.1,
          "reason": "No issue reference"
        },
        {
          "name": "spam",
          "score": 75,
          "weight": 0.15,
          "reason": "No issue ref"
        },
        {
          "name": "test_coverage",
          "score": 90,
          "weight": 0.15,
          "reason": "1 test file(s) changed"
        },
        {
          "name": "staleness",
          "score": 70,
          "weight": 0.1,
          "reason": "8d old (Aging)"
        },
        {
          "name": "mergeability",
          "score": 50,
          "weight": 0.15,
          "reason": "Merge status: unknown"
        },
        {
          "name": "review_status",
          "score": 70,
          "weight": 0.1,
          "reason": "Review: commented (2 reviews)"
        },
        {
          "name": "body_quality",
          "score": 100,
          "weight": 0.05,
          "reason": "Body: 2634 chars"
        },
        {
          "name": "activity",
          "score": 30,
          "weight": 0.05,
          "reason": "0 comments"
        },
        {
          "name": "breaking_change",
          "score": 80,
          "weight": 0.05,
          "reason": "No breaking change signals"
        }
      ],
      "isSpam": false,
      "spamReasons": [],
      "visionAlignment": "unchecked"
    },
    {
      "number": 10030,
      "title": "Guard network interface enumeration",
      "body": "Handle os.networkInterfaces() errors in restricted environments to prevent CLI crashes. Also make systemd user service check\n  tolerant when the user bus is unavailable.\n\n<!-- greptile_comment -->\n\n<h2>Greptile Overview</h2>\n\n<h3>Greptile Summary</h3>\n\nThis PR hardens system/environment probing paths used by the CLI/daemon.\n\n- In `src/infra/tailnet.ts`, it wraps `os.networkInterfaces()` so failures in restricted environments (e.g., sandboxed containers, limited /proc access) don\u2019t crash the process.\n- In `src/infra/system-presence.ts` and `src/daemon/systemd.ts`, it makes \u201csystemd user service present/running\u201d checks tolerant of a missing/unreachable user D-Bus, avoiding false negatives and hard failures.\n\nOverall, the changes fit into the existing \u201csystem presence\u201d detection and tailnet networking utilities by converting previously-throwing environment queries into best-effort checks that degrade gracefully.\n\n<h3>Confidence Score: 5/5</h3>\n\n- This PR is safe to merge with minimal risk.\n- Changes are narrowly scoped to error-handling around environment detection (`os.networkInterfaces()` and systemd user-bus checks) and are unlikely to affect core functionality beyond preventing crashes in restricted environments.\n- No files require special attention\n\n<!-- greptile_other_comments_section -->\n\n<sub>(2/5) Greptile learns from your feedback when you react with thumbs up/down!</sub>\n\n**Context used:**\n\n- Context from `dashboard` - CLAUDE.md ([source](https://app.greptile.com/review/custom-context?memory=fd949e91-5c3a-4ab5-90a1-cbe184fd6ce8))\n- Context from `dashboard` - AGENTS.md ([source](https://app.greptile.com/review/custom-context?memory=0d0c8278-ef8e-4d6c-ab21-f5527e322f13))\n\n<!-- /greptile_comment -->",
      "author": "TheAxumite",
      "authorAssociation": "NONE",
      "createdAt": "2026-02-06T01:34:22Z",
      "updatedAt": "2026-02-15T20:33:27Z",
      "headRef": "fix/robust-networkinterfaces",
      "baseRef": "main",
      "filesChanged": 3,
      "additions": 13,
      "deletions": 3,
      "commits": 4,
      "labels": [
        "gateway",
        "size: XS"
      ],
      "ciStatus": "failure",
      "hasIssueRef": false,
      "issueNumbers": [],
      "changedFiles": [
        "src/daemon/systemd.ts",
        "src/infra/system-presence.ts",
        "src/infra/tailnet.ts"
      ],
      "diffUrl": "https://github.com/openclaw/openclaw/pull/10030.diff",
      "hasTests": false,
      "testFilesChanged": [],
      "ageInDays": 9,
      "mergeable": "mergeable",
      "reviewState": "none",
      "reviewCount": 0,
      "commentCount": 1,
      "totalScore": 52,
      "signals": [
        {
          "name": "ci_status",
          "score": 10,
          "weight": 0.2,
          "reason": "CI: failure"
        },
        {
          "name": "diff_size",
          "score": 70,
          "weight": 0.1,
          "reason": "16 lines changed (13+/3-)"
        },
        {
          "name": "commit_quality",
          "score": 50,
          "weight": 0.05,
          "reason": "Non-standard title"
        },
        {
          "name": "contributor",
          "score": 45,
          "weight": 0.15,
          "reason": "TheAxumite (NONE, rep: 80)"
        },
        {
          "name": "issue_ref",
          "score": 30,
          "weight": 0.1,
          "reason": "No issue reference"
        },
        {
          "name": "spam",
          "score": 75,
          "weight": 0.15,
          "reason": "No issue ref"
        },
        {
          "name": "test_coverage",
          "score": 20,
          "weight": 0.15,
          "reason": "No test files changed in code PR"
        },
        {
          "name": "staleness",
          "score": 70,
          "weight": 0.1,
          "reason": "9d old (Aging)"
        },
        {
          "name": "mergeability",
          "score": 100,
          "weight": 0.15,
          "reason": "Merge status: mergeable"
        },
        {
          "name": "review_status",
          "score": 40,
          "weight": 0.1,
          "reason": "Review: none (0 reviews)"
        },
        {
          "name": "body_quality",
          "score": 90,
          "weight": 0.05,
          "reason": "Body: 1733 chars"
        },
        {
          "name": "activity",
          "score": 50,
          "weight": 0.05,
          "reason": "1 comments"
        },
        {
          "name": "breaking_change",
          "score": 80,
          "weight": 0.05,
          "reason": "No breaking change signals"
        }
      ],
      "isSpam": false,
      "spamReasons": [],
      "visionAlignment": "unchecked"
    },
    {
      "number": 17452,
      "title": "ci: Grant write perms for Issues for formal-conformance.yml",
      "body": "This pull request makes a minor update to the GitHub Actions workflow configuration by adjusting permissions to ensure proper functionality.\r\n\r\n* Updated the `.github/workflows/formal-conformance.yml` workflow to explicitly add `issues: write` permission, which is required for the workflow to function correctly.\r\n\r\nThat's it.\n\n<!-- greptile_comment -->\n\n<h3>Greptile Summary</h3>\n\nAdded `issues: write` permission to the formal-conformance workflow, which is required for the workflow to post comments on pull requests using `github.rest.issues.createComment()` (line 126).\n\n- The permission is necessary because GitHub treats PR comments as issue comments in the REST API\n- Without this permission, the workflow would fail when attempting to post the drift detection comment\n\n<h3>Confidence Score: 5/5</h3>\n\n- This PR is safe to merge with minimal risk\n- Single-line addition of a required permission for an existing API call; the change is necessary for correct workflow functionality and carries no risk\n- No files require special attention\n\n<sub>Last reviewed commit: badca70</sub>\n\n<!-- greptile_other_comments_section -->\n\n<sub>(5/5) You can turn off certain types of comments like style [here](https://app.greptile.com/review/github)!</sub>\n\n<!-- /greptile_comment -->",
      "author": "thesomewhatyou",
      "authorAssociation": "CONTRIBUTOR",
      "createdAt": "2026-02-15T19:33:13Z",
      "updatedAt": "2026-02-15T19:56:40Z",
      "headRef": "patch-1",
      "baseRef": "main",
      "filesChanged": 1,
      "additions": 1,
      "deletions": 0,
      "commits": 3,
      "labels": [
        "size: XS"
      ],
      "ciStatus": "failure",
      "hasIssueRef": false,
      "issueNumbers": [],
      "changedFiles": [
        ".github/workflows/formal-conformance.yml"
      ],
      "diffUrl": "https://github.com/openclaw/openclaw/pull/17452.diff",
      "hasTests": false,
      "testFilesChanged": [],
      "ageInDays": 0,
      "mergeable": "unknown",
      "reviewState": "commented",
      "reviewCount": 1,
      "commentCount": 0,
      "totalScore": 52,
      "signals": [
        {
          "name": "ci_status",
          "score": 10,
          "weight": 0.2,
          "reason": "CI: failure"
        },
        {
          "name": "diff_size",
          "score": 20,
          "weight": 0.1,
          "reason": "1 lines changed (1+/0-)"
        },
        {
          "name": "commit_quality",
          "score": 90,
          "weight": 0.05,
          "reason": "Conventional commit format"
        },
        {
          "name": "contributor",
          "score": 77,
          "weight": 0.15,
          "reason": "thesomewhatyou (CONTRIBUTOR, rep: 94)"
        },
        {
          "name": "issue_ref",
          "score": 30,
          "weight": 0.1,
          "reason": "No issue reference"
        },
        {
          "name": "spam",
          "score": 50,
          "weight": 0.15,
          "reason": "<3 lines, No issue ref, contributor bonus -1"
        },
        {
          "name": "test_coverage",
          "score": 60,
          "weight": 0.15,
          "reason": "Docs/config PR \u2014 tests not expected"
        },
        {
          "name": "staleness",
          "score": 100,
          "weight": 0.1,
          "reason": "0d old (Fresh)"
        },
        {
          "name": "mergeability",
          "score": 50,
          "weight": 0.15,
          "reason": "Merge status: unknown"
        },
        {
          "name": "review_status",
          "score": 60,
          "weight": 0.1,
          "reason": "Review: commented (1 reviews)"
        },
        {
          "name": "body_quality",
          "score": 90,
          "weight": 0.05,
          "reason": "Body: 1277 chars"
        },
        {
          "name": "activity",
          "score": 30,
          "weight": 0.05,
          "reason": "0 comments"
        },
        {
          "name": "breaking_change",
          "score": 80,
          "weight": 0.05,
          "reason": "No breaking change signals"
        }
      ],
      "isSpam": false,
      "spamReasons": [],
      "visionAlignment": "unchecked",
      "duplicateGroup": 2
    }
  ],
  "summary": "Scanned 50 PRs in openclaw/openclaw. 0 flagged as spam. 5 duplicate clusters found. Top PR: #17517 (87/100) \u2014 fix(browser): catch unhandled promise rejection in dialog handling"
}